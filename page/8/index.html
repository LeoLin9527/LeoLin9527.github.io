<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="江湖の林九">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="江湖の林九">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leo Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/8/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>江湖の林九</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">江湖の林九</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">相逢何必曾相识！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/05/Javascript%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%847%E7%A7%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/05/Javascript%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E7%9A%847%E7%A7%8D%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Javascript创建对象的7种方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-05 22:25:07" itemprop="dateCreated datePublished" datetime="2019-10-05T22:25:07+08:00">2019-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 10:39:03" itemprop="dateModified" datetime="2020-04-24T10:39:03+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">前端进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>JavaScript创建对象的方式有很多，通过Object构造函数或对象字面量的方式也可以创建单个对象，显然这两种方式会产生大量的重复代码，并不适合量产。接下来介绍七种非常经典的创建对象的方式，他们也各有优缺点</p>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPerson</span>(<span class="params">name, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line">  o.name = name</span><br><span class="line">  o.job = job</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = createPerson(‘Jiang’, ‘student’)</span><br><span class="line"><span class="keyword">var</span> person2 = createPerson(‘X’, ‘Doctor’)</span><br></pre></td></tr></table></figure>
<p>可以无数次调用这个工厂函数，每次都会返回一个包含两个属性和一个方法的对象</p>
<p>工厂模式虽然解决了创建多个相似对象的问题，但是没有解决对象识别问题，即不能知道一个对象的类型</p>
<h3 id="构造函数模式"><a href="#构造函数模式" class="headerlink" title="构造函数模式"></a>构造函数模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, job</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.job = job</span><br><span class="line">  <span class="built_in">this</span>.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(‘Jiang’, ‘student’)</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person(‘X’, ‘Doctor’)</span><br></pre></td></tr></table></figure>
<p>没有显示的创建对象，使用new来调用这个构造函数，使用new后会自动执行如下操作</p>
<ul>
<li>创建一个新对象</li>
<li>这个新对象会被执行[[prototype]]链接</li>
<li>这个新对象会绑定到函数调用的this</li>
<li>返回这个对象</li>
</ul>
<p>使用这个方式创建对象可以检测对象类型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">person1 <span class="keyword">instanceof</span> <span class="built_in">Object</span> <span class="comment">// true</span></span><br><span class="line">person1 <span class="keyword">instanceof</span> Person <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<p>但是使用构造函数创建对象，每个方法都要在每个实例上重新创建一次</p>
<h3 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.name = ‘Jiang’</span><br><span class="line">Person.prototype.job = ‘student’</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure>
<p>将信息直接添加到原型对象上。使用原型的好处是可以让所有的实例对象共享它所包含的属性和方法，不必在构造函数中定义对象实例信息。</p>
<p>原型是一个非常重要的概念，在一篇文章看懂proto和prototype的关系及区别中讲的非常详细</p>
<p>更简单的写法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  name: ‘jiang’,</span><br><span class="line">  job: ‘student’,</span><br><span class="line">  sayName: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person()</span><br></pre></td></tr></table></figure>
<p>将Person.prototype设置为等于一个以对象字面量形式创建的对象，但是会导致.constructor不在指向Person了。</p>
<p>使用这种方式，完全重写了默认的Person.prototype对象，因此 .constructor也不会存在这里</p>
<p>Person.prototype.constructor === Person  // false<br>如果需要这个属性的话，可以手动添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  <span class="keyword">constructor</span>：Person</span><br><span class="line">  name: ‘jiang’,</span><br><span class="line">  job: ‘student’,</span><br><span class="line">  sayName: function() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不过这种方式还是不够好，应为constructor属性默认是不可枚举的，这样直接设置，它将是可枚举的。所以可以时候，Object.defineProperty方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.defineProperty(Person.prototype, ‘<span class="keyword">constructor</span>’, &#123;</span><br><span class="line">  enumerable: <span class="literal">false</span>,</span><br><span class="line">  value: Person</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>缺点:</p>
<p>使用原型，所有的属性都将被共享，这是个很大的优点，同样会带来一些缺点</p>
<p>原型中所有属性实例是被很多实例共享的，这种共享对于函数非常合适。对于那些包含基本值的属性也勉强可以，毕竟实例属性可以屏蔽原型属性。但是引用类型值，就会出现问题了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype = &#123;</span><br><span class="line">  name: ‘jiang’,</span><br><span class="line">  friends: [‘Shelby’, ‘Court’]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person()</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person()</span><br><span class="line">person1.friends.push(‘Van’)</span><br><span class="line"><span class="built_in">console</span>.log(person1.friends) <span class="comment">//[“Shelby”, “Court”, “Van”]</span></span><br><span class="line"><span class="built_in">console</span>.log(person2.friends) <span class="comment">//[“Shelby”, “Court”, “Van”]</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.friends === person2.friends) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<p>friends存在与原型中，实例person1和person2指向同一个原型，person1修改了引用的数组，也会反应到实例person2中</p>
<h3 id="组合使用构造函数模式和原型模式"><a href="#组合使用构造函数模式和原型模式" class="headerlink" title="组合使用构造函数模式和原型模式"></a>组合使用构造函数模式和原型模式</h3><p>这是使用最为广泛、认同度最高的一种创建自定义类型的方法。它可以解决上面那些模式的缺点</p>
<p>使用此模式可以让每个实例都会有自己的一份实例属性副本，但同时又共享着对方法的引用</p>
<p>这样的话，即使实例属性修改引用类型的值，也不会影响其他实例的属性值了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.friends = [‘Shelby’, ‘Court’]</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person()</span><br><span class="line"><span class="keyword">var</span> person2 = <span class="keyword">new</span> Person()</span><br><span class="line">person1.friends.push(‘Van’)</span><br><span class="line"><span class="built_in">console</span>.log(person1.friends)  <span class="comment">//[“Shelby”, “Court”, “Van”]</span></span><br><span class="line"><span class="built_in">console</span>.log(person2.friends) <span class="comment">// [“Shelby”, “Court”]</span></span><br><span class="line"><span class="built_in">console</span>.log(person1.friends === person2.friends) <span class="comment">//false</span></span><br></pre></td></tr></table></figure>
<h3 id="动态原型模式"><a href="#动态原型模式" class="headerlink" title="动态原型模式"></a>动态原型模式</h3><p>动态原型模式将所有信息都封装在了构造函数中，初始化的时候，通过检测某个应该存在的方法时候有效，来决定是否需要初始化原型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, job</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 属性</span></span><br><span class="line">  <span class="built_in">this</span>.name = name</span><br><span class="line">  <span class="built_in">this</span>.job = job</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 方法</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="built_in">this</span>.sayName !== ‘<span class="function"><span class="keyword">function</span>’) </span>&#123;</span><br><span class="line">    Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(‘Jiang’, ‘Student’)</span><br><span class="line">person1.sayName()</span><br></pre></td></tr></table></figure>
<p>只有在sayName方法不存在的时候，才会将它添加到原型中。这段代码只会初次调用构造函数的时候才会执行。</p>
<p>此后原型已经完成初始化，不需要在做什么修改了</p>
<p>这里对原型所做的修改，能够立即在所有实例中得到反映</p>
<p>其次，if语句检查的可以是初始化之后应该存在的任何属性或方法，所以不必用一大堆的if语句检查每一个属性和方法，只要检查一个就行</p>
<h3 id="寄生构造函数模式"><a href="#寄生构造函数模式" class="headerlink" title="寄生构造函数模式"></a>寄生构造函数模式</h3><p>这种模式的基本思想就是创建一个函数，该函数的作用仅仅是封装创建对象的代码，然后再返回新建的对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line">  o.name = name</span><br><span class="line">  o.job = job</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = <span class="keyword">new</span> Person(‘Jiang’, ‘student’)</span><br><span class="line">person1.sayName()</span><br></pre></td></tr></table></figure>
<p>这个模式，除了使用new操作符并把使用的包装函数叫做构造函数之外，和工厂模式几乎一样</p>
<p>构造函数如果不返回对象，默认也会返回一个新的对象，通过在构造函数的末尾添加一个return语句，可以重写调用构造函数时返回的值</p>
<h3 id="稳妥构造函数模式"><a href="#稳妥构造函数模式" class="headerlink" title="稳妥构造函数模式"></a>稳妥构造函数模式</h3><p>首先明白稳妥对象指的是没有公共属性，而且其方法也不引用this。</p>
<p>稳妥对象最适合在一些安全环境中（这些环境会禁止使用this和new），或防止数据被其他应用程序改动时使用</p>
<p>稳妥构造函数模式和寄生模式类似，有两点不同:一是创建对象的实例方法不引用this，而是不使用new操作符调用构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name, job</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>()</span><br><span class="line">  o.name = name</span><br><span class="line">  o.job = job</span><br><span class="line">  o.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> o</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> person1 = Person(‘Jiang’, ‘student’)</span><br><span class="line">person1.sayName()</span><br></pre></td></tr></table></figure>
<p>和寄生构造函数模式一样，这样创建出来的对象与构造函数之间没有什么关系，instanceof操作符对他们没有意义</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/05/Javascript%E6%B7%B7%E6%B7%86%E3%80%81%E5%8E%8B%E7%BC%A9%E3%80%81%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/05/Javascript%E6%B7%B7%E6%B7%86%E3%80%81%E5%8E%8B%E7%BC%A9%E3%80%81%E5%8A%A0%E5%AF%86/" class="post-title-link" itemprop="url">Javascript混淆、压缩、加密</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-05 22:25:00" itemprop="dateCreated datePublished" datetime="2019-10-05T22:25:00+08:00">2019-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 10:50:45" itemprop="dateModified" datetime="2020-04-24T10:50:45+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">前端进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-关于三者的定义与区别"><a href="#1-关于三者的定义与区别" class="headerlink" title="1.关于三者的定义与区别"></a>1.关于三者的定义与区别</h2><p><strong>压缩</strong>：删除 Javascript 代码中所有注释、跳格符号、换行符号及无用的空格，从而压缩 JS 文件大小，优化页面加载速度。</p>
<p><strong>混淆</strong>：经过编码将变量和函数原命名改为毫无意义的命名（如function(a,b,c,e,g)等），以防止他人窥视和窃取 Javascript 源代码，也有一定压缩效果。</p>
<p><strong>加密</strong>：一般用eval方法加密，效果与混淆相似，也做到了压缩的效果。</p>
<p>从定义中可以看出，压缩的主要目的是消除注释等无用字符，达到精简js代码，减小js文件大小的目的，这也是页面优化的一种方式；而混淆和加密的目的比较接近，都是为了防止他人直接查看源码，对代码（如重要的api等）起保护作用，但这也只是增加了阅读代码的代价，也就是所谓的防君子不防小人。但是当混淆和加密联合使用时，如先混淆在加密（或者先加密再混淆）时，破解时间就会增加。关于js的加密，可以参考这篇文章：<a target="_blank" rel="noopener" href="http://www.cnblogs.com/top5/archive/2009/08/07/1540860.html">http://www.cnblogs.com/top5/archive/2009/08/07/1540860.html</a></p>
<h2 id="2-示例"><a href="#2-示例" class="headerlink" title="2.示例"></a>2.示例</h2><p>下面以更直观的方式来体会一下这四种方式（压缩、混淆、加密、混淆&amp;加密）的不同。</p>
<p>源js代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 这个是一个类 */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">xx</span>(<span class="params">num, str</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//说明</span></span><br><span class="line">    <span class="keyword">var</span> a = num;</span><br><span class="line">    <span class="built_in">this</span>.aa = a;</span><br><span class="line">    <span class="built_in">this</span>.bb = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;alert(str);&#125;</span><br><span class="line">    <span class="built_in">this</span>.cc = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">document</span>.title = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.yy = <span class="keyword">new</span> yy();</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">xxf</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(<span class="string">&quot;xxf&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="regexp">/\&#123;\d+\&#125;/</span>).test(<span class="string">&quot;a\sdf&#123;2&#125;ab&quot;</span>))</span><br><span class="line">            alert(<span class="string">&quot;&#123;\\d&#125; is match!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">xx.prototype.dd = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">&quot;dd&quot;</span>);</span><br><span class="line">    a.yy.ll();</span><br><span class="line">    <span class="keyword">var</span> fnx = <span class="function"><span class="keyword">function</span>(<span class="params">i</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.ab = i;</span><br><span class="line">        <span class="built_in">this</span>.aa = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            alert(<span class="built_in">this</span>.ab);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> f1 = <span class="keyword">new</span> fnx(<span class="number">1</span>);</span><br><span class="line">    f1.aa();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">yy</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    alert(<span class="string">&#x27;yy&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">yy.prototype.ll = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">&quot;yyll&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> xx(<span class="number">100</span>, <span class="string">&quot;hello&quot;</span>), b = <span class="keyword">new</span> xx(<span class="number">0</span>, <span class="string">&quot;ttyp&quot;</span>);</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">&quot;a.aa=20&quot;</span>);</span><br><span class="line">a.bb();</span><br><span class="line">b.dd();</span><br><span class="line">alert(a.aa);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> k = <span class="number">9</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">kk</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> k = <span class="number">0</span>;</span><br><span class="line">    alert(k);</span><br><span class="line">&#125;</span><br><span class="line">kk();</span><br><span class="line">alert(k);</span><br><span class="line"><span class="comment">//输入结果alert:&quot;yy&quot;-&gt;&quot;yy&quot;-&gt;&quot;hello&quot;-&gt;&quot;dd&quot;-&gt;&quot;yyll&quot;-&gt;&quot;12&quot;-&gt;&quot;20&quot;-&gt;&quot;0&quot;-&gt;&quot;9&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="（1）经过压缩后的代码如下："><a href="#（1）经过压缩后的代码如下：" class="headerlink" title="（1）经过压缩后的代码如下："></a>（1）经过压缩后的代码如下：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="function"><span class="keyword">function</span> <span class="title">xx</span>(<span class="params">num,str</span>)</span>&#123;<span class="keyword">var</span> a=num;<span class="built_in">this</span>.aa=a;<span class="built_in">this</span>.bb=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(str)&#125;;<span class="built_in">this</span>.cc=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;<span class="built_in">document</span>.title=i&#125;&#125;;<span class="built_in">this</span>.yy=<span class="keyword">new</span> yy();<span class="function"><span class="keyword">function</span> <span class="title">xxf</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&quot;xxf&quot;</span>);<span class="keyword">if</span>((<span class="regexp">/\&#123;\d+\&#125;/</span>).test(<span class="string">&quot;a\sdf&#123;2&#125;ab&quot;</span>))alert(<span class="string">&quot;&#123;\\d&#125; is match!&quot;</span>)&#125;&#125;;xx.prototype.dd=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&quot;dd&quot;</span>);a.yy.ll();<span class="keyword">var</span> fnx=<span class="function"><span class="keyword">function</span>(<span class="params">i</span>)</span>&#123;<span class="built_in">this</span>.ab=i;<span class="built_in">this</span>.aa=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="built_in">this</span>.ab)&#125;&#125;;<span class="keyword">var</span> f1=<span class="keyword">new</span> fnx(<span class="number">1</span>);f1.aa()&#125;;<span class="function"><span class="keyword">function</span> <span class="title">yy</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&#x27;yy&#x27;</span>)&#125;;yy.prototype.ll=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&quot;yyll&quot;</span>)&#125;;<span class="keyword">var</span> a=<span class="keyword">new</span> xx(<span class="number">100</span>,<span class="string">&quot;hello&quot;</span>),b=<span class="keyword">new</span> xx(<span class="number">0</span>,<span class="string">&quot;ttyp&quot;</span>);<span class="built_in">eval</span>(<span class="string">&quot;a.aa=20&quot;</span>);a.bb();b.dd();alert(a.aa);<span class="keyword">var</span> k=<span class="number">9</span>;<span class="function"><span class="keyword">function</span> <span class="title">kk</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> k=<span class="number">0</span>;alert(k)&#125;;kk();alert(k);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>压缩后与源码相比只是少了注释、空格、换行等。</p>
<h4 id="（2）经过混淆后的代码如下："><a href="#（2）经过混淆后的代码如下：" class="headerlink" title="（2）经过混淆后的代码如下："></a>（2）经过混淆后的代码如下：</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="function"><span class="keyword">function</span> <span class="title">xx</span>(<span class="params">d,e</span>)</span>&#123;<span class="keyword">var</span> f=d;<span class="built_in">this</span>.aa=f;<span class="built_in">this</span>.bb=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(e)&#125;;<span class="built_in">this</span>.cc=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> g=<span class="number">0</span>;g&lt;<span class="number">10</span>;g++)&#123;<span class="built_in">document</span>.title=g&#125;&#125;;<span class="built_in">this</span>.yy=<span class="keyword">new</span> yy();<span class="function"><span class="keyword">function</span> <span class="title">xxf</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&quot;xxf&quot;</span>);<span class="keyword">if</span>((<span class="regexp">/\&#123;\d+\&#125;/</span>).test(<span class="string">&quot;a\sdf&#123;2&#125;ab&quot;</span>))alert(<span class="string">&quot;&#123;\\d&#125; is match!&quot;</span>)&#125;&#125;;xx.prototype.dd=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&quot;dd&quot;</span>);a.yy.ll();<span class="keyword">var</span> fnx=<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="built_in">this</span>.ab=e;<span class="built_in">this</span>.aa=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="built_in">this</span>.ab)&#125;&#125;;<span class="keyword">var</span> d=<span class="keyword">new</span> fnx(<span class="number">1</span>);d.aa()&#125;;<span class="function"><span class="keyword">function</span> <span class="title">yy</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&#x27;yy&#x27;</span>)&#125;;yy.prototype.ll=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;alert(<span class="string">&quot;yyll&quot;</span>)&#125;;<span class="keyword">var</span> a=<span class="keyword">new</span> xx(<span class="number">100</span>,<span class="string">&quot;hello&quot;</span>),b=<span class="keyword">new</span> xx(<span class="number">0</span>,<span class="string">&quot;ttyp&quot;</span>);<span class="built_in">eval</span>(<span class="string">&quot;a.aa=20&quot;</span>);a.bb();b.dd();alert(a.aa);<span class="keyword">var</span> c=<span class="number">9</span>;<span class="function"><span class="keyword">function</span> <span class="title">kk</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> d=<span class="number">0</span>;alert(d)&#125;;kk();alert(c);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>混淆后除了少了注释、空格和换行等，参数也被a，b，c，d，e等字符代替，提高了阅读的难度。</p>
<h4 id="（3）经过加密后的代码如下："><a href="#（3）经过加密后的代码如下：" class="headerlink" title="（3）经过加密后的代码如下："></a>（3）经过加密后的代码如下：</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">1</span> eval(function(p,a,c,k,e,d)&#123;e=function(c)&#123;return(c&lt;a?<span class="string">&quot;&quot;</span>:e(parseInt(c/a)))+((c=c%a)&gt;<span class="number">35</span>?String.fromCharCode(c+<span class="number">29</span>):c.toString(<span class="number">36</span>))&#125;;if(!&#x27;&#x27;.replace(/^/,String))&#123;while(c--)d[e(c)]=k[c]||e(c);k=[function(e)&#123;return d[e]&#125;];e=function()&#123;return&#x27;\\w+&#x27;&#125;;c=<span class="number">1</span>;&#125;;while(c--)if(k[c])p=p.replace(new RegExp(&#x27;\\b&#x27;+e(c)+&#x27;\\b&#x27;,&#x27;g&#x27;),k[c]);return p;&#125;(&#x27;<span class="number">3</span> e(o,l)&#123;<span class="number">5</span> a=o;<span class="number">6</span>.<span class="number">8</span>=a;<span class="number">6</span>.p=<span class="number">3</span>()&#123;<span class="number">4</span>(l)&#125;;<span class="number">6</span>.B=<span class="number">3</span>()&#123;A(<span class="number">5</span> i=<span class="number">0</span>;i&lt;y;i++)&#123;x.z=i&#125;&#125;;<span class="number">6</span>.<span class="number">7</span>=c <span class="number">7</span>();<span class="number">3</span> j()&#123;<span class="number">4</span>(<span class="string">&quot;j&quot;</span>);t((/\\&#123;\\d+\\&#125;/).s(<span class="string">&quot;a\\u&#123;2&#125;g&quot;</span>))<span class="number">4</span>(<span class="string">&quot;&#123;\\\\d&#125; w v!&quot;</span>)&#125;&#125;;e.r.f=<span class="number">3</span>()&#123;<span class="number">4</span>(<span class="string">&quot;f&quot;</span>);a.<span class="number">7</span>.h();<span class="number">5</span> n=<span class="number">3</span>(i)&#123;<span class="number">6</span>.g=i;<span class="number">6</span>.<span class="number">8</span>=<span class="number">3</span>()&#123;<span class="number">4</span>(<span class="number">6</span>.g)&#125;&#125;;<span class="number">5</span> m=c n(<span class="number">1</span>);m.<span class="number">8</span>()&#125;;<span class="number">3</span> <span class="number">7</span>()&#123;<span class="number">4</span>(\&#x27;<span class="number">7</span>\&#x27;)&#125;;<span class="number">7</span>.r.h=<span class="number">3</span>()&#123;<span class="number">4</span>(<span class="string">&quot;D&quot;</span>)&#125;;<span class="number">5</span> a=c e(F,<span class="string">&quot;H&quot;</span>),b=c e(<span class="number">0</span>,<span class="string">&quot;G&quot;</span>);E(<span class="string">&quot;a.8=C&quot;</span>);a.p();b.f();<span class="number">4</span>(a.<span class="number">8</span>);<span class="number">5</span> k=<span class="number">9</span>;<span class="number">3</span> q()&#123;<span class="number">5</span> k=<span class="number">0</span>;<span class="number">4</span>(k)&#125;;q();<span class="number">4</span>(k);&#x27;,<span class="number">44</span>,<span class="number">44</span>,&#x27;|||function|alert|var|this|yy|aa||||new||xx|dd|ab|ll||xxf||str|f<span class="number">1</span>|fnx|num|bb|kk|prototype|test|if|sdf|match|is|document|<span class="number">10</span>|title|for|cc|<span class="number">20</span>|yyll|eval|<span class="number">100</span>|ttyp|hello&#x27;.split(&#x27;|&#x27;),<span class="number">0</span>,&#123;&#125;))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>加密后除了有混淆的作用外，有些代码被加密了，进一步提高了阅读的难度。</p>
<h4 id="（4）经过混淆-amp-加密后的代码如下"><a href="#（4）经过混淆-amp-加密后的代码如下" class="headerlink" title="（4）经过混淆&amp;加密后的代码如下"></a>（4）经过混淆&amp;加密后的代码如下</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">eval</span>(function(p,a,c,k,e,d)&#123;e=function(c)&#123;return(c&lt;a?<span class="string">&quot;&quot;</span>:e(parseInt(c/a)))+((c=c%a)&gt;<span class="number">35</span>?String.fromCharCode(c+<span class="number">29</span>):c.toString(<span class="number">36</span>))&#125;;if(!&#x27;&#x27;.replace(/^/,String))&#123;while(c--)d[e(c)]=k[c]||e(c);k=[function(e)&#123;return d[e]&#125;];e=function()&#123;return&#x27;\\w+&#x27;&#125;;c=<span class="number">1</span>;&#125;;while(c--)if(k[c])p=p.replace(new RegExp(&#x27;\\b&#x27;+e(c)+&#x27;\\b&#x27;,&#x27;g&#x27;),k[c]);return p;&#125;(&#x27;<span class="number">4</span> i(d,e)&#123;<span class="number">5</span> f=d;<span class="number">6</span>.<span class="number">8</span>=f;<span class="number">6</span>.p=<span class="number">4</span>()&#123;<span class="number">3</span>(e)&#125;;<span class="number">6</span>.s=<span class="number">4</span>()&#123;t(<span class="number">5</span> g=<span class="number">0</span>;g&lt;y;g++)&#123;G.F=g&#125;&#125;;<span class="number">6</span>.<span class="number">7</span>=h <span class="number">7</span>();<span class="number">4</span> l()&#123;<span class="number">3</span>(<span class="string">&quot;l&quot;</span>);x((/\\&#123;\\d+\\&#125;/).v(<span class="string">&quot;a\\u&#123;2&#125;j&quot;</span>))<span class="number">3</span>(<span class="string">&quot;&#123;\\\\d&#125; w r!&quot;</span>)&#125;&#125;;i.o.k=<span class="number">4</span>()&#123;<span class="number">3</span>(<span class="string">&quot;k&quot;</span>);a.<span class="number">7</span>.m();<span class="number">5</span> n=<span class="number">4</span>(e)&#123;<span class="number">6</span>.j=e;<span class="number">6</span>.<span class="number">8</span>=<span class="number">4</span>()&#123;<span class="number">3</span>(<span class="number">6</span>.j)&#125;&#125;;<span class="number">5</span> d=h n(<span class="number">1</span>);d.<span class="number">8</span>()&#125;;<span class="number">4</span> <span class="number">7</span>()&#123;<span class="number">3</span>(\&#x27;<span class="number">7</span>\&#x27;)&#125;;<span class="number">7</span>.o.m=<span class="number">4</span>()&#123;<span class="number">3</span>(<span class="string">&quot;E&quot;</span>)&#125;;<span class="number">5</span> a=h i(A,<span class="string">&quot;z&quot;</span>),b=h i(<span class="number">0</span>,<span class="string">&quot;B&quot;</span>);D(<span class="string">&quot;a.8=C&quot;</span>);a.p();b.k();<span class="number">3</span>(a.<span class="number">8</span>);<span class="number">5</span> c=<span class="number">9</span>;<span class="number">4</span> q()&#123;<span class="number">5</span> d=<span class="number">0</span>;<span class="number">3</span>(d)&#125;;q();<span class="number">3</span>(c);&#x27;,<span class="number">43</span>,<span class="number">43</span>,&#x27;|||alert|function|var|this|yy|aa|||||||||new|xx|ab|dd|xxf|ll|fnx|prototype|bb|kk|match|cc|for|sdf|test|is|if|<span class="number">10</span>|hello|<span class="number">100</span>|ttyp|<span class="number">20</span>|eval|yyll|title|document&#x27;.split(&#x27;|&#x27;),<span class="number">0</span>,&#123;&#125;))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="3-浏览器是怎么解析混淆和加密后的js代码的"><a href="#3-浏览器是怎么解析混淆和加密后的js代码的" class="headerlink" title="3.浏览器是怎么解析混淆和加密后的js代码的"></a>3.浏览器是怎么解析混淆和加密后的js代码的</h2><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">其实变量名只要是<span class="built_in">Unicode</span>字符就行了，对于js引擎来说都是一样的，只是人类觉得他们不同而已。</span><br></pre></td></tr></table></figure>

<h2 id="4-js压缩工具"><a href="#4-js压缩工具" class="headerlink" title="4.js压缩工具"></a>4.js压缩工具</h2><p>其实js的压缩工具网上有很多，在线和安装版的都有，文章中使用的是HDS JSObfuscator v2.13绿色版。</p>
<p>在线的js压缩工具：<a target="_blank" rel="noopener" href="http://tool.chinaz.com/js.aspx">http://tool.chinaz.com/js.aspx</a></p>
<h2 id="5-注意事项"><a href="#5-注意事项" class="headerlink" title="5.注意事项"></a>5.注意事项</h2><p>源js文件一定要按照规范编写，分号，注释符，var等都要规范，否则很容易出错。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/05/JsCrack%20%E7%B2%89%E7%AC%94%E7%BD%91RSA%E7%99%BB%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/05/JsCrack%20%E7%B2%89%E7%AC%94%E7%BD%91RSA%E7%99%BB%E5%BD%95/" class="post-title-link" itemprop="url">JsCrack 粉笔网RSA登录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-05 10:30:00" itemprop="dateCreated datePublished" datetime="2019-10-05T10:30:00+08:00">2019-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 21:23:26" itemprop="dateModified" datetime="2020-04-23T21:23:26+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>1、搜关键词打断点分析 或 XHR断点后追踪调试，发现如下位置的加密</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = &#123;</span><br><span class="line">	password: <span class="built_in">this</span>.encrypt(<span class="built_in">this</span>.password),</span><br><span class="line">	persistent: !<span class="number">0</span>,</span><br><span class="line">	app: <span class="string">&quot;web&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>2、追踪this.encrypt进行调试，函数2中三段代码类似JSEncrypt的加密用法，考虑RSA加密。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数1</span></span><br><span class="line">encrypt(n) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">window</span>.encrypt(<span class="built_in">this</span>.publicKey, n)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 函数2</span></span><br><span class="line">av.encrypt = <span class="function"><span class="keyword">function</span>(<span class="params">aG, z</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> t = <span class="keyword">new</span> N();</span><br><span class="line">	t.setPublic(a(aG), <span class="string">&quot;10001&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> ai(t.encrypt(z))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3、JSEncrypt部分源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> JSEncrypt = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">JSEncrypt</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        options = options || &#123;&#125;;</span><br><span class="line">        <span class="built_in">this</span>.default_key_size = <span class="built_in">parseInt</span>(options.default_key_size, <span class="number">10</span>) || <span class="number">1024</span>;</span><br><span class="line">        <span class="built_in">this</span>.default_public_exponent = options.default_public_exponent || <span class="string">&quot;010001&quot;</span>; <span class="comment">// 65537 default openssl public exponent for rsa key type</span></span><br><span class="line">        <span class="built_in">this</span>.log = options.log || <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">// The private and public key.</span></span><br><span class="line">        <span class="built_in">this</span>.key = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Method to set the rsa key parameter (one method is enough to set both the public</span></span><br></pre></td></tr></table></figure>

<h2 id="扣取JS"><a href="#扣取JS" class="headerlink" title="扣取JS"></a>扣取JS</h2><p>发现JS代码有所改动，本文不打算直接利用JSEncrypt生成。<br>直接复制该文件下的全部代码，运行报错 window is undefine<br>添加：var window = {}<br>继续报错 navigator is not defined<br>继续添加 var navigator = {}</p>
<h2 id="补充知识"><a href="#补充知识" class="headerlink" title="补充知识"></a>补充知识</h2><p>尝试为一个“定义函数”末尾加上()，解析器是无法理解的，可通过下列方式转为函数表达式:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">方式一</span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)()</span><br><span class="line">方式二</span><br><span class="line">!<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;()</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/04/Encrypt%20RSA%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/04/Encrypt%20RSA%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">Encrypt RSA原理与实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-04 22:30:00" itemprop="dateCreated datePublished" datetime="2019-10-04T22:30:00+08:00">2019-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 21:26:25" itemprop="dateModified" datetime="2020-04-24T21:26:25+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">加密算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="RSA简介"><a href="#RSA简介" class="headerlink" title="RSA简介"></a>RSA简介</h2><p>RSA是第一个既能用于数据加密也能用于数字签名的算法，非对称密钥，公开密钥。</p>
<p><strong>加密：</strong>公钥负责加密，私钥负责解密。</p>
<p><strong>数字签名：</strong>私钥负责签名，公钥负责验证</p>
<p>1.把内容用hash函数，生成内容的摘要。</p>
<p>2.再用私钥对摘要进行加密，生成『数字签名』。</p>
<p>3.将数字签名和内容同时发给别人。</p>
<p>4.接收者使用公钥解密，得到摘要。在对内容进行hash函数，对比结果是否一致，防止被篡改。</p>
<p><strong>签名作用：</strong></p>
<p>a) 对签名者进行身份认证；</p>
<p>b) 保证信息的完整性（在交易过程中，没有被篡改）</p>
<p>c) 防止交易中的抵赖发生（签名者无法否认信息是由自己发出的）</p>
<p>   加密的功能：</p>
<p>a) 重点在于“数据的安全性”，可以防止数据被监听攻击。</p>
<h3 id="互素数："><a href="#互素数：" class="headerlink" title="互素数："></a>互素数：</h3><p>1、两个质数一定是互质数。例如，2与7、13与19。<br>2、一个质数如果不能整除另一个合数，这两个数为互质数。例如，3与10、5与 26。</p>
<h3 id="算法原理"><a href="#算法原理" class="headerlink" title="算法原理:"></a>算法原理:</h3><p>1、选取两个<strong>大素数</strong>p和q，计算n=p*q 例n = 67 * 71 = 4751转为二进制1001010010101。</p>
<p>2、计算欧拉函数: φ(n) = (p-1)(q-1)，</p>
<p>3、选取加密密钥e，其与φ(n)互素。e的常用值为3，17，65537</p>
<p>4、整数 d可以使得 e<em>d 除以 φ(n) 的余数为 1。e</em>d= 1 mod φ(n) ,公钥为e和n，私钥为d</p>
<p>5、加密消息时将其看为大整数,并分为比n小的数据分组，c = m^e mod n</p>
<p>6、解密密文c时，取每一个加密后的分组c并计算即，m=c^d mod n</p>
<p><strong>注</strong>：φ(n) 表示在小于等于 n 的正整数之中，与 n 构成互质关系的数的个数</p>
<p><img src="/images/17-base64/1-rsa.png" alt="逻辑图"></p>
<h2 id="nodejs的RSA加密"><a href="#nodejs的RSA加密" class="headerlink" title="nodejs的RSA加密"></a>nodejs的RSA加密</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> NodeRSA = <span class="built_in">require</span>(<span class="string">&#x27;node-rsa&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> key = <span class="keyword">new</span> NodeRSA(&#123;<span class="attr">b</span>: <span class="number">512</span>&#125;);</span><br><span class="line">    key.setOptions(&#123;<span class="attr">encryptionScheme</span>: <span class="string">&#x27;pkcs1&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> privatePem = key.exportKey(<span class="string">&#x27;pkcs1-private-pem&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> publicPem = key.exportKey(<span class="string">&#x27;pkcs1-public-pem&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    fs.writeFile(<span class="string">&#x27;./public.pem&#x27;</span>, publicPem, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;公钥已保存！&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    fs.writeFile(<span class="string">&#x27;./private.pem&#x27;</span>, privatePem, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;私钥已保存！&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    fs.readFile(<span class="string">&#x27;./public.pem&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> key = <span class="keyword">new</span> NodeRSA(data);</span><br><span class="line">        <span class="keyword">let</span> cipherText = key.encryptPrivate(text, <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;encrypt:&#x27;</span>, cipherText);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    fs.readFile(<span class="string">&#x27;./private.pem&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> key = <span class="keyword">new</span> NodeRSA(data);</span><br><span class="line">        <span class="keyword">let</span> rawText = key.decryptPublic(text, <span class="string">&#x27;utf8&#x27;</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&quot;decrypt:&quot;</span>, rawText);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//generator();</span></span><br><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">encrypt(text);</span><br><span class="line"><span class="keyword">var</span> cipherText = <span class="string">&quot;kcC3naR7VPztt+5ojZAh3r4mAi++KAGnRpDqAiCYpPB5M0sJxCU0XaYWma749AuF8QTaIK+vBqJAzN4Ego/q0g==&quot;</span>;</span><br><span class="line">decrypt(cipherText);</span><br></pre></td></tr></table></figure>

<h2 id="Python-RSA工具类"><a href="#Python-RSA工具类" class="headerlink" title="Python RSA工具类"></a>Python RSA工具类</h2><ul>
<li>安装：<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> pycryptodomex</span><br></pre></td></tr></table></figure></li>
<li>区别：<br>pycryptodome与pyCrypto有一定的关联，在从pyCrypto迁移到pycryptodome时，可以认为简易替换。<br>pycryptodomex是PyCryptodome的一个独立版本，具有不同的命名约定;您必须使用Cryptodome，而不是使用Crypto包。<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">USE_RSA</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    生成密钥可保存.pem格式文件</span></span><br><span class="line"><span class="string">    1024位的证书，加密时最大支持117个字节，解密时为128；</span></span><br><span class="line"><span class="string">    2048位的证书，加密时最大支持245个字节，解密时为256。</span></span><br><span class="line"><span class="string">    加密大文件时需要先用AES或者DES加密，再用RSA加密密钥，详细见文档</span></span><br><span class="line"><span class="string">    文档:https://stuvel.eu/files/python-rsa-doc/usage.html#generating-keys</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, number=<span class="number">1024</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param number: 公钥、私钥</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.pubkey, self.privkey = rsa.newkeys(number)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rsaEncrypt</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param test: str</span></span><br><span class="line"><span class="string">        :return: bytes</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        content = text.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        crypto = rsa.encrypt(content, self.pubkey)</span><br><span class="line">        <span class="keyword">return</span> crypto</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rsaDecrypt</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param text:bytes </span></span><br><span class="line"><span class="string">        :return: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        content = rsa.decrypt(text, self.privkey)</span><br><span class="line">        con = content.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> con</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">savePem</span>(<span class="params">self, path_name, text</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param path_name: 保存路径</span></span><br><span class="line"><span class="string">        :param text: str</span></span><br><span class="line"><span class="string">        :return:bytes</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;PEM&quot;</span> <span class="keyword">in</span> path_name.upper():</span><br><span class="line">            path_name = path_name[:<span class="number">-4</span>]</span><br><span class="line">        <span class="keyword">with</span> open(<span class="string">&#x27;&#123;&#125;.pem&#x27;</span>.format(path_name), <span class="string">&#x27;bw&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(text.save_pkcs1())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">readPem</span>(<span class="params">self, path_name, key_type</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        :param path_name: 密钥文件</span></span><br><span class="line"><span class="string">        :param key_type:类型 </span></span><br><span class="line"><span class="string">        :return: </span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;pubkey&#x27;</span> <span class="keyword">in</span> key_type:</span><br><span class="line">            self.pubkey = rsa.PublicKey.load_pkcs1(path_name)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.privkey = rsa.PublicKey.load_pkcs1(path_name)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sign</span>(<span class="params">self, message, priv_key=None, hash_method=<span class="string">&#x27;SHA-1&#x27;</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        生成明文的哈希签名以便还原后对照</span></span><br><span class="line"><span class="string">        :param message: str</span></span><br><span class="line"><span class="string">        :param priv_key:</span></span><br><span class="line"><span class="string">        :param hash_method: 哈希的模式</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span> == priv_key:</span><br><span class="line">            priv_key = self.privkey</span><br><span class="line">        <span class="keyword">return</span> rsa.sign(message.encode(), priv_key, hash_method)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self, mess, result, pubkey=None</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        验证签名：传入解密后明文、签名、公钥，验证成功返回哈希方法，失败则报错</span></span><br><span class="line"><span class="string">        :param mess: str</span></span><br><span class="line"><span class="string">        :param result: bytes</span></span><br><span class="line"><span class="string">        :param pubkey: </span></span><br><span class="line"><span class="string">        :return: str</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">None</span> == pubkey:</span><br><span class="line">            pubkey = self.privkey</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = rsa.verify(mess, result, pubkey)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="补充内容"><a href="#补充内容" class="headerlink" title="补充内容"></a>补充内容</h2><p>1、PEM： 基于ASCII(Base64)的编码。OpenSSL 使用 PEM 文件格式存储证书和密钥。<br>PEM 实质上是 base64 编码的二进制内容，再进行增加或裁剪特殊字符-、n、r、begin信息、end信息等</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">BEGIN</span> <span class="comment">CERTIFICATE</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span></span><br><span class="line"><span class="comment">内容</span></span><br><span class="line"><span class="comment"></span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">END</span> <span class="comment">CERTIFICATE</span>--<span class="literal">-</span><span class="literal">-</span><span class="literal">-</span></span><br></pre></td></tr></table></figure>
<p>2、PKCS(The Public-Key Cryptography Standards)由美国RSA公司及其合作伙伴制定的一组公钥密码学标准，其中包括证书申请、证书更新、证书作废表发布、扩展证书内容以及数字签名、数字信封的格式等方面的一系列相关协议。<br>PCKS8 的pem格式头：</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//公钥</span></span><br><span class="line">-----<span class="keyword">BEGIN</span> <span class="keyword">PUBLIC</span> KEY-----</span><br><span class="line">MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKzY3F21g7UWaTcIk/ltUy4LuuHK5Hhl</span><br><span class="line"><span class="number">9</span>ZpdxDr4+WA7pNwhCzhgBKbWUa+XotUYet841I2mYPJ6+<span class="number">6</span>X32LwotF0CAwEAAQ==</span><br><span class="line">-----<span class="keyword">END</span> <span class="keyword">PUBLIC</span> KEY-----</span><br></pre></td></tr></table></figure>
<p>3、<a target="_blank" rel="noopener" href="https://juejin.im/post/5a76d7e3f265da4e752770a3">扩展文章</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/04/Encrypt%20Base64%E7%BC%96%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/04/Encrypt%20Base64%E7%BC%96%E7%A0%81/" class="post-title-link" itemprop="url">Encrypt Base64编码</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-04 09:00:00" itemprop="dateCreated datePublished" datetime="2019-10-04T09:00:00+08:00">2019-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 15:15:23" itemprop="dateModified" datetime="2020-04-24T15:15:23+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">加密算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Base64介绍"><a href="#Base64介绍" class="headerlink" title="Base64介绍"></a>Base64介绍</h2><p>1、由来<br>ASCII码中规定，0-31、128这33个字符属于控制字符，32~127这95个字符属可打印字符。</p>
<p>Base64被设计用来把任意序列的8位字节描述为一种不易被人直接识别的形式。本质是将二进制数据转成可打印字符数据的方案，它是可逆的。</p>
<p>因在网络上只能准确传输可打印字符或由于某些系统中只能使用ASCII字符，为降低不可见字符被错误的处理的风险，采用Base64编码将不可打印的二进制数据转换成可打印的字符串。</p>
<p>2、应用</p>
<p>广泛用于邮件编码、数据签名/数据校验编码以及HTML/XML复杂数据编码。</p>
<p>3、邮件</p>
<p>传统邮件规范：规定电子邮件只能使用ASCII字符。</p>
<p>导致三个结果：</p>
<ul>
<li>1）非英语字符都不能在电子邮件中使用；</li>
<li>2）电子邮件中不能插入二进制文件（如图片）；</li>
<li>3）电子邮件不能有附件。</li>
</ul>
<p>MIME规范进行了补充：但附件数据往往有不可见字符，例如传数图片、视频等二进制文件，同时MIME使用的不是标准Base64编码。</p>
<p>4、图片base64编码</p>
<p>前端为了减少外部资源加载，降低页面加载时间，采用base64将图片编码成字符串，直接内嵌到页面中。这种内嵌方式的实现，得益于大部分浏览器对Data URI scheme特性的支持，该特性通常用在CSS设置背景图片，其格式为：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">background:url(data:文件类型;编码方式,编码后的文件内容);</span><br><span class="line">data:[&lt;mime type&gt;][;charset=&lt;charset&gt;][;&lt;encoding&gt;],&lt;encoded data&gt;</span><br><span class="line">1.  data ：协议名称；</span><br><span class="line">2.  [&lt;mime type&gt;] ：可选项，数据类型（image/png、text/plain等）</span><br><span class="line">3.  [;charset=&lt;charset&gt;] ：可选项，源文本的字符集编码方式</span><br><span class="line">4.  [;&lt;encoding&gt;] ：数据编码方式（默认US-ASCII，BASE64两种）</span><br><span class="line">5.  &lt;encoded data&gt; ：编码后的数据</span><br></pre></td></tr></table></figure>
<p>5、编码原理<br>表中的可打印字符包括A-Z、a-z、0-9加上+、/共64个字符，因此称为Base64编码，实际还有填充字符=来作为填充符。<br>标准Base64编码不是 url/filename safe 的，对于URL来说&amp;、/都是具有特殊含义的字符，不能将该 Base64 编码直接与url拼接或用来命名文件。<br>根据最后两位字符的不同编码又有很多变种，Base64 URL是标准Base64编码的一个变种，去除了末尾’=’将表中的“+”和“/”分别替换为“-”和“_”。<br><img src="/images/17-base64/base1.png"></p>
<p>Base64编码是每3个原始字符编码成4个字符，每连续6bit计算其十进制值，根据该值在上面的索引表中找到对应的字符，得到文本字符串。<br><img src="/images/17-base64/base2.png"></p>
<p>*若字节数不是3的倍数，则添加1个或2个零值字节。标准Base64编码通常用 = 字符来替换最后的 A，=作为Base64编码字符串结束符号。<br>如果Base64编码字符串不会相互拼接再传输，那么最后的=也可以省略。<br><img src="/images/17-base64/base3.png"></p>
<p>汉字本身可以有多种编码，比如gb2312、utf-8、gbk等等，每一种编码的Base64对应值都不一样，以”汉”的utf8为例E6B189。</p>
<h2 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line"><span class="comment"># - - - - - 对普通字符串进行base64编解码  - - - - - #</span></span><br><span class="line">encodeStrTest = base64.encodebytes(bytes(<span class="string">&quot;this is a test&quot;</span>, <span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">decodeStrTest = base64.decodebytes(encodeStrTest)</span><br><span class="line">print(str(decodeStrTest, <span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"><span class="comment"># - - - - - 对url进行base64编解码  - - - - - #</span></span><br><span class="line">url = <span class="string">&quot;http://www.baidu.com&quot;</span></span><br><span class="line">urlEncodeTest = base64.urlsafe_b64encode(bytes(url, <span class="string">&quot;utf8&quot;</span>))</span><br><span class="line">urlDecodeTest = base64.urlsafe_b64decode(urlEncodeTest)</span><br><span class="line">print(str(urlDecodeTest, <span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"><span class="comment"># - - - - -  b64.encode和b64.decode 替换+和/ - - - - - #</span></span><br><span class="line">str2 = <span class="string">&quot;Hello, World!&quot;</span></span><br><span class="line">binIO = BytesIO()</span><br><span class="line">binIO.write(bytes(str2, <span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"></span><br><span class="line">encodeTest = BytesIO()</span><br><span class="line">decodeTest = BytesIO()</span><br><span class="line"><span class="comment"># 对BytesIO内的数据进行编码</span></span><br><span class="line">binIO.seek(<span class="number">0</span>)</span><br><span class="line">base64.encode(binIO, encodeTest)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对BytesIO内的数据进行解码</span></span><br><span class="line">encodeTest.seek(<span class="number">0</span>)</span><br><span class="line">base64.decode(encodeTest, decodeTest)</span><br><span class="line">print(str(decodeTest.getvalue(), <span class="string">&quot;utf8&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># - - - - - 对图片进行 Base64 编解码 - - - - - #</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_local_image</span>():</span></span><br><span class="line">    <span class="comment"># 原始图片 ==&gt; base64 编码</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;/path/alpha.png&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fin:</span><br><span class="line">        image_data = fin.read()</span><br><span class="line">        base64_data = base64.b64encode(image_data)</span><br><span class="line">        fout = open(<span class="string">&#x27;/path/base64_content.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">        fout.write(base64_data)</span><br><span class="line">        fout.close()</span><br><span class="line">    <span class="comment"># base64 编码 ==&gt; 原始图片</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;/path/base64_content.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> fin:</span><br><span class="line">        base64_data = fin.read()</span><br><span class="line">        ori_image_data = base64.b64decode(base64_data)</span><br><span class="line">        fout = open(<span class="string">&#x27;/path/beta.png&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">        fout.write(ori_image_data)</span><br><span class="line">        fout.close()</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/04/Encrypt%20Jsencrypt%20RSA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/04/Encrypt%20Jsencrypt%20RSA/" class="post-title-link" itemprop="url">Encrypt Jsencrypt RSA</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-04 09:00:00" itemprop="dateCreated datePublished" datetime="2019-10-04T09:00:00+08:00">2019-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 15:18:12" itemprop="dateModified" datetime="2020-04-24T15:18:12+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">加密算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="How-to-use-this-library"><a href="#How-to-use-this-library" class="headerlink" title="How to use this library"></a>How to use this library</h2><p>安装openssl使用命令行进行动态生成</p>
<p>Within your terminal (Unix based OS) type the following:</p>
<p><code>openssl genrsa -out rsa_1024_priv.pem 1024</code></p>
<p>This generates a private key, which you can see by doing the following…</p>
<p><code>cat rsa_1024_priv.pem #if you are on mac you can | pbcopy to copy to the clipboard</code></p>
<p>You can then copy and paste this in the Private Key section of the demo page.</p>
<p>Next, you can then get the public key by executing the following command.</p>
<p><code>openssl rsa -pubout -in rsa_1024_priv.pem -out rsa_1024_pub.pem</code></p>
<p>You can see the public key by typing…</p>
<p><code>cat rsa_1024_pub.pem</code></p>
<h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><p>jsencrypt在加密或者解密的时候需要用到密钥，所以需要先生成一对密钥：公钥（加密），私钥（解密），自身使用的是pkcs1加密方案。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;JavaScript RSA Encryption&lt;/title&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;http://code.jquery.com/jquery-1.8.3.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;bin/jsencrypt.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Call this code when the page is done loading.</span></span><br><span class="line">      $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Run a quick encryption/decryption when they click.</span></span><br><span class="line">        $(<span class="string">&#x27;#testme&#x27;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="comment">// Encrypt with the public key...</span></span><br><span class="line">          <span class="keyword">var</span> encrypt = <span class="keyword">new</span> JSEncrypt();</span><br><span class="line">          encrypt.setPublicKey($(<span class="string">&#x27;#pubkey&#x27;</span>).val());</span><br><span class="line">          <span class="keyword">var</span> encrypted = encrypt.encrypt($(<span class="string">&#x27;#input&#x27;</span>).val());</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Decrypt with the private key...</span></span><br><span class="line">          <span class="keyword">var</span> decrypt = <span class="keyword">new</span> JSEncrypt();</span><br><span class="line">          decrypt.setPrivateKey($(<span class="string">&#x27;#privkey&#x27;</span>).val());</span><br><span class="line">          <span class="keyword">var</span> uncrypted = decrypt.decrypt(encrypted);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// Now a simple check to see if the round-trip worked.</span></span><br><span class="line">          <span class="keyword">if</span> (uncrypted == $(<span class="string">&#x27;#input&#x27;</span>).val()) &#123;</span><br><span class="line">            alert(<span class="string">&#x27;It works!!!&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            alert(<span class="string">&#x27;Something went wrong....&#x27;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;privkey&quot;</span>&gt;Private Key&lt;<span class="regexp">/label&gt;&lt;br/</span>&gt;</span><br><span class="line">    &lt;textarea id=<span class="string">&quot;privkey&quot;</span> rows=<span class="string">&quot;15&quot;</span> cols=<span class="string">&quot;65&quot;</span>&gt;-----BEGIN PRIVATE KEY-----</span><br><span class="line">MIICeQIBADANBgkqhkiG9w0BAQEFAASCAmMwggJfAgEAAoGBAMDl6LIyW/Wu0cdl</span><br><span class="line">ZMlUcBTwTJnfDv2sydVzhNP4EXQK/Cx8682SZUpcWLkqVwDc3wii69gXdNJbx+TH</span><br><span class="line">ILiI8phtCiOmVWMB/<span class="number">8</span>lch8uCQKnvrwE/xfsPbieOoeauG0a24k0bhLWUwb1t9ha5</span><br><span class="line">W1NY+gA7CiEy7hrtB<span class="comment">//y9y1BS+PvAgMBAAECgYEAhJzKd891NxcDc0B6pIqfL1Xw</span></span><br><span class="line">Y4xc4vrqGwt60rrlTNDMgs0y0zYE2rVX7Zx1CcvOrUJMP1gI4SFl8BsRnKvRktUS</span><br><span class="line">SnkDO+<span class="number">4</span>ePUe0NykW8lk6eCpzx9Awd8bPSjtTWXCgJJNS1cf45pUlEe/<span class="number">2</span>jm5BibqG</span><br><span class="line">csG3K8YDc2ficZz7otECQQDl79JA0loXNNcQJd5D/CKVKjtUK0Ks0xxLjn2YaRuk</span><br><span class="line"><span class="number">4</span>m1JW+JmtMTp2IBYTmsE64UrRhAiOvCIWP9binhKPtx3AkEA1sNRkLUpSQKCCOsB</span><br><span class="line">INiRvTtqv5BdwiJzWolD4Dm/Fz2aD6FN5NinaWgfaQ2wfL1NiCR+S0OagLBKK7fz</span><br><span class="line">NsiqSQJBAIBGPyRcdVf26XefuJRyx5QxoDF/hM3HZESedGCfWoWsr806Dl6/wA64</span><br><span class="line"><span class="number">8</span>jjRXpC7F2qhxoRiHyfhhmu6HwtEcFcCQQDM0GcoT205ILgskxp3XbLXuiOa365a</span><br><span class="line"><span class="number">54</span>oFbOUboVbZbjlP8LCdr/UwtElIYfLPc6XOUadUVfuyAO4rdXnw5DxpAkEAhG6O</span><br><span class="line">ibo8nSlcYn6Co60IIx/cARqC1J1pRMnYpB062eoLrHpRBW8G5Y8XBfETFMHU6WzY</span><br><span class="line">+SZwal49Jf9+FiG2qQ==</span><br><span class="line">-----END PRIVATE KEY-----&lt;<span class="regexp">/textarea&gt;&lt;br/</span>&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;pubkey&quot;</span>&gt;Public Key&lt;<span class="regexp">/label&gt;&lt;br/</span>&gt;</span><br><span class="line">    &lt;textarea id=<span class="string">&quot;pubkey&quot;</span> rows=<span class="string">&quot;15&quot;</span> cols=<span class="string">&quot;65&quot;</span>&gt;-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDA5eiyMlv1rtHHZWTJVHAU8EyZ</span><br><span class="line"><span class="number">3</span>w79rMnVc4TT+BF0CvwsfOvNkmVKXFi5KlcA3N8IouvYF3TSW8fkxyC4iPKYbQoj</span><br><span class="line">plVjAf/JXIfLgkCp768BP8X7D24njqHmrhtGtuJNG4S1lMG9bfYWuVtTWPoAOwoh</span><br><span class="line">Mu4a7Qf/<span class="number">8</span>vctQUvj7wIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----&lt;<span class="regexp">/textarea&gt;&lt;br/</span>&gt;</span><br><span class="line">    &lt;label <span class="keyword">for</span>=<span class="string">&quot;input&quot;</span>&gt;Text to encrypt:&lt;<span class="regexp">/label&gt;&lt;br/</span>&gt;</span><br><span class="line">    &lt;textarea id=<span class="string">&quot;input&quot;</span> name=<span class="string">&quot;input&quot;</span> type=<span class="string">&quot;text&quot;</span> rows=<span class="number">4</span> cols=<span class="number">70</span>&gt;This is a test!&lt;<span class="regexp">/textarea&gt;&lt;br/</span>&gt;</span><br><span class="line">    &lt;input id=<span class="string">&quot;testme&quot;</span> type=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;Test Me!!!&quot;</span> /&gt;<span class="xml"><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="长字符分段加解密"><a href="#长字符分段加解密" class="headerlink" title="长字符分段加解密"></a>长字符分段加解密</h2><p>由于RSA的特性，一个1024位的密钥只能加密117位字节数据，当数据量超过117位字节的时候，程序就会抛出异常。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">JSEncrypt.prototype.encryptLong = <span class="function"><span class="keyword">function</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> k = <span class="built_in">this</span>.getKey();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> lt = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> ct = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">//RSA每次加密117bytes，需要辅助方法判断字符串截取位置</span></span><br><span class="line">        <span class="comment">//1.获取字符串截取点</span></span><br><span class="line">        <span class="keyword">var</span> bytes = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">        bytes.push(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">var</span> byteNo = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> len, c;</span><br><span class="line">        len = string.length;</span><br><span class="line">        <span class="keyword">var</span> temp = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">            c = string.charCodeAt(i);</span><br><span class="line">            <span class="keyword">if</span> (c &gt;= <span class="number">0x010000</span> &amp;&amp; c &lt;= <span class="number">0x10FFFF</span>) &#123;</span><br><span class="line">                byteNo += <span class="number">4</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c &gt;= <span class="number">0x000800</span> &amp;&amp; c &lt;= <span class="number">0x00FFFF</span>) &#123;</span><br><span class="line">                byteNo += <span class="number">3</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (c &gt;= <span class="number">0x000080</span> &amp;&amp; c &lt;= <span class="number">0x0007FF</span>) &#123;</span><br><span class="line">                byteNo += <span class="number">2</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                byteNo += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ((byteNo % <span class="number">117</span>) &gt;= <span class="number">114</span> || (byteNo % <span class="number">117</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (byteNo - temp &gt;= <span class="number">114</span>) &#123;</span><br><span class="line">                    bytes.push(i);</span><br><span class="line">                    temp = byteNo;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//2.截取字符串并分段加密</span></span><br><span class="line">        <span class="keyword">if</span> (bytes.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">var</span> str;</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                    str = string.substring(<span class="number">0</span>, bytes[i + <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    str = string.substring(bytes[i] + <span class="number">1</span>, bytes[i + <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> t1 = k.encrypt(str);</span><br><span class="line">                ct += t1;</span><br><span class="line">            &#125;</span><br><span class="line">            ;</span><br><span class="line">            <span class="keyword">if</span> (bytes[bytes.length - <span class="number">1</span>] != string.length - <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> lastStr = string.substring(bytes[bytes.length - <span class="number">1</span>] + <span class="number">1</span>);</span><br><span class="line">                ct += k.encrypt(lastStr);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> hexToBytes(ct);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> t = k.encrypt(string);</span><br><span class="line">        <span class="keyword">var</span> y = hexToBytes(t);</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">JSEncrypt.prototype.decryptLong = <span class="function"><span class="keyword">function</span> (<span class="params">string</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> k = <span class="built_in">this</span>.getKey();</span><br><span class="line">    <span class="comment">// var maxLength = ((k.n.bitLength()+7)&gt;&gt;3);</span></span><br><span class="line">    <span class="keyword">var</span> MAX_DECRYPT_BLOCK = <span class="number">128</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> ct = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> t1;</span><br><span class="line">        <span class="keyword">var</span> bufTmp;</span><br><span class="line">        <span class="keyword">var</span> hexTmp;</span><br><span class="line">        <span class="keyword">var</span> str = bytesToHex(string);</span><br><span class="line">        <span class="keyword">var</span> buf = hexToBytes(str);</span><br><span class="line">        <span class="keyword">var</span> inputLen = buf.length;</span><br><span class="line">        <span class="comment">//开始长度</span></span><br><span class="line">        <span class="keyword">var</span> offSet = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//结束长度</span></span><br><span class="line">        <span class="keyword">var</span> endOffSet = MAX_DECRYPT_BLOCK;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//分段加密</span></span><br><span class="line">        <span class="keyword">while</span> (inputLen - offSet &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (inputLen - offSet &gt; MAX_DECRYPT_BLOCK) &#123;</span><br><span class="line">                bufTmp = buf.slice(offSet, endOffSet);</span><br><span class="line">                hexTmp = bytesToHex(bufTmp);</span><br><span class="line">                t1 = k.decrypt(hexTmp);</span><br><span class="line">                ct += t1;</span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                bufTmp = buf.slice(offSet, inputLen);</span><br><span class="line">                hexTmp = bytesToHex(bufTmp);</span><br><span class="line">                t1 = k.decrypt(hexTmp);</span><br><span class="line">                ct += t1;</span><br><span class="line">             </span><br><span class="line">            &#125;</span><br><span class="line">            offSet += MAX_DECRYPT_BLOCK;</span><br><span class="line">            endOffSet += MAX_DECRYPT_BLOCK;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ct;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Python简易实现"><a href="#Python简易实现" class="headerlink" title="Python简易实现"></a>Python简易实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Cryptodome <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Cryptodome.Cipher <span class="keyword">import</span> PKCS1_v1_5 <span class="keyword">as</span> Cipher_pkcs1_v1_5</span><br><span class="line"><span class="keyword">from</span> Cryptodome.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line"><span class="comment"># 伪随机数生成器</span></span><br><span class="line">random_generator = Random.new().read</span><br><span class="line"></span><br><span class="line"><span class="comment"># rsa算法生成实例</span></span><br><span class="line">rsa = RSA.generate(<span class="number">1024</span>, random_generator)</span><br><span class="line"></span><br><span class="line"><span class="comment"># master的秘钥对的生成</span></span><br><span class="line">private_pem = rsa.exportKey()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产私钥私钥并放到文件里</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;master-private.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(private_pem)</span><br><span class="line">public_pem = rsa.publickey().exportKey()</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;master-public.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(public_pem)</span><br><span class="line"></span><br><span class="line">message = <span class="string">&#x27;I_LOVE_YAYA&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开公钥文件</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;master-public.pem&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = f.read()</span><br><span class="line">rsakey = RSA.importKey(key)</span><br><span class="line">cipher = Cipher_pkcs1_v1_5.new(rsakey)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密时使用base64加密</span></span><br><span class="line">cipher_text = base64.b64encode(cipher.encrypt(bytes(message, <span class="string">&quot;utf8&quot;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用私钥解密</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">&#x27;master-private.pem&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = f.read()</span><br><span class="line">rsakey = RSA.importKey(key)</span><br><span class="line">cipher = Cipher_pkcs1_v1_5.new(rsakey)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用base64解密，(在前端js加密时自动是base64加密)</span></span><br><span class="line">text = cipher.decrypt(base64.b64decode(cipher_text), random_generator)</span><br><span class="line">print(str(text, <span class="string">&quot;utf8&quot;</span>))</span><br></pre></td></tr></table></figure>

<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">//</span> base64传输到后台的时候<span class="string">&quot;+&quot;</span>号被会转为空格，故而需要先替换，后台解析的时候转回来</span><br><span class="line">var rr =&#123;imfor:btoa(encryptoPasswd).replace(<span class="regexp">/\+/g</span>,<span class="string">&quot;%$#%&quot;</span>)&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/04/Encrypt%20MD5%20%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/04/Encrypt%20MD5%20%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">Encrypt MD5 案例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-04 09:00:00" itemprop="dateCreated datePublished" datetime="2019-10-04T09:00:00+08:00">2019-10-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 15:05:28" itemprop="dateModified" datetime="2020-04-24T15:05:28+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">加密算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="MD5介绍"><a href="#MD5介绍" class="headerlink" title="MD5介绍"></a>MD5介绍</h2><p>MD5 消息摘要算法对输入的任意长度的消息进行运算，产生一个128位的消息摘要，运用在数字签名、文件完整性验证以及口令加密等方面。<br><strong>用途：</strong></p>
<ul>
<li>防篡改</li>
<li>防明文暴露</li>
<li>防抵赖(数字签名)</li>
</ul>
<p><strong>算法原理：</strong><br>1、数据填充，添加长度<br>首先，我们计算出原文长度(bit)对512求余的结果，如果不等于448，就需要填充原文使得原文对512求余的结果等于448。填充的方法是第一位填充1，其余位填充0。填充完后，信息的长度就是512<em>N+448。<br>之后，用剩余的位置（512-448=64位）记录原文的真正长度，把长度的二进制值补在最后。这样处理后的信息长度就是512</em>(N+1)。</p>
<p>2、初始化变量<br>用4个变量(A、B、C、D)来计算消息摘要，这里的A、B、C、D都是32位的寄存器，A=0x01234567 ，B=0x89ABCDEF ， C=0xFEDCBA98 ，D=0x76543210。</p>
<p>3、数据处理</p>
<h2 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5value</span>(<span class="params">s</span>):</span></span><br><span class="line">    a = md5(s.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">print(md5value(<span class="string">&#x27;11111111&#x27;</span>).upper())</span><br><span class="line"></span><br><span class="line"><span class="comment">## output:1bbd886460827015e5d605ed44252251</span></span><br></pre></td></tr></table></figure>

<h2 id="爬虫实战"><a href="#爬虫实战" class="headerlink" title="爬虫实战"></a>爬虫实战</h2><p>目标网址: 一品威客网<br>其密码是MD5，用扣JS方式进行验证。<br>formhash: 04988f<br>txt_account: 12345678<br>pwd_password: 1bbd886460827015e5d605ed44252251<br>login_type: 3<br>ckb_cookie: 0<br>….</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_js_function</span>(<span class="params">js_path, func_name, func_args</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    获取指定目录下的js代码, 并且指定js代码中函数的名字以及函数的参数。</span></span><br><span class="line"><span class="string">    :param js_path: js代码的位置</span></span><br><span class="line"><span class="string">    :param func_name: js代码中函数的名字</span></span><br><span class="line"><span class="string">    :param func_args: js代码中函数的参数</span></span><br><span class="line"><span class="string">    :return: 返回调用js函数的结果</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(js_path, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        js = fp.read()</span><br><span class="line">        ctx = execjs.compile(js)</span><br><span class="line">        <span class="keyword">return</span> ctx.call(func_name, func_args)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 给个star吧</span></span><br><span class="line">    passwd = get_js_function(<span class="string">&#x27;epwk.js&#x27;</span>, <span class="string">&#x27;hex_md5&#x27;</span>, <span class="string">&#x27;11111111&#x27;</span>)</span><br><span class="line">    print(passwd)</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">epwk.js </span><br><span class="line">复制md5.js?version下所有代码</span><br><span class="line"><span class="keyword">var</span> hexcase = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> b64pad = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> chrsz = <span class="number">8</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hex_md5</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2hex(core_md5(str2binl(r), r.length * chrsz))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64_md5</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2b64(core_md5(str2binl(r), r.length * chrsz))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_md5</span>(<span class="params">r</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2str(core_md5(str2binl(r), r.length * chrsz))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hex_hmac_md5</span>(<span class="params">r, d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2hex(core_hmac_md5(r, d))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b64_hmac_md5</span>(<span class="params">r, d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2b64(core_hmac_md5(r, d))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_hmac_md5</span>(<span class="params">r, d</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> binl2str(core_hmac_md5(r, d))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">md5_vm_test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hex_md5(<span class="string">&quot;abc&quot;</span>) == <span class="string">&quot;900150983cd24fb0d6963f7d28e17f72&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">core_md5</span>(<span class="params">r, d</span>) </span>&#123;</span><br><span class="line">    r[d &gt;&gt; <span class="number">5</span>] |= <span class="number">128</span> &lt;&lt; d % <span class="number">32</span>;</span><br><span class="line">    r[(d + <span class="number">64</span> &gt;&gt;&gt; <span class="number">9</span> &lt;&lt; <span class="number">4</span>) + <span class="number">14</span>] = d;</span><br><span class="line">    <span class="keyword">var</span> _ = <span class="number">1732584193</span>;</span><br><span class="line">    <span class="keyword">var</span> m = <span class="number">-271733879</span>;</span><br><span class="line">    <span class="keyword">var</span> n = <span class="number">-1732584194</span>;</span><br><span class="line">    <span class="keyword">var</span> h = <span class="number">271733878</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> f = <span class="number">0</span>; f &lt; r.length; f += <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> a = _;</span><br><span class="line">以下略...</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/03/Encrypt%20AES%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/03/Encrypt%20AES%E5%8E%9F%E7%90%86%E4%B8%8E%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">EncryptAES原理与实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-03 22:25:00" itemprop="dateCreated datePublished" datetime="2019-10-03T22:25:00+08:00">2019-10-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 15:19:55" itemprop="dateModified" datetime="2020-04-24T15:19:55+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">加密算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="AES-简介"><a href="#AES-简介" class="headerlink" title="AES 简介"></a>AES 简介</h2><p>AES(Advanced Encryption Standard)是对称加密算法，即加密和解密使用相同的密钥，用于保护私密信息不被泄露。<br><strong>加密流程：</strong><br>1.把明文按照128bit拆分成若干个明文块。</p>
<p>2.按照选择的填充方式来填充最后一个明文块。</p>
<p>3.每一个明文块利用AES加密器和密钥，加密成密文块。</p>
<p>4.拼接所有的密文块，成为最终的密文结果。<br><img src="https://i.loli.net/2019/10/02/XE9oOHBsGLRy5d2.png"><br>实际中，一般是通过RSA加密AES的密钥，传输到接收方，接收方解密得到AES密钥，然后发送方和接收方用AES密钥来通信。</p>
<p>5、密钥<br>| AES      | 密钥长度（32位比特字) | 分组长度(32位比特字) | 加密轮数 |<br>|———-|—————|—————-|——|<br>| AES-128 | 4             | 4              | 10   |<br>| AES-192 | 6             | 4              | 12   |<br>| AES-256 | 8             | 4              | 14   |</p>
<h3 id="填充"><a href="#填充" class="headerlink" title="填充"></a>填充</h3><p><strong>分组加密：</strong>并不是把整个明文一股脑加密成一整段密文，而是把明文拆分成一个个独立的明文块，每块的长度是 16 个字节，如果原文不到 16 个字节，则需要填充至 16 个字节后再进行处理。</p>
<p><strong>填充方式：</strong></p>
<p>NoPadding：不做任何填充，但是要求明文必须是16字节的整数倍。</p>
<p>PKCS5Padding（默认）：如果明文块少于16个字节（128bit），在明文块末尾补足相应数量的字符，且每个字节的值等于缺少的字符数。</p>
<p>比如明文：{1,2,3,4,5,a,b,c,d,e},缺少6个字节，则补全为{1,2,3,4,5,a,b,c,d,e,6,6,6,6,6,6}</p>
<p><img src="https://i.loli.net/2019/10/02/gmFrqAn3t15vKD7.png"></p>
<h3 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h3><p>AES的工作模式，体现在把明文块加密成密文块的处理过程中。如果AES在加密时使用了某一种工作模式，解密时也必须采用同样的工作模式。</p>
<p>CBC模式：</p>
<p>电码本模式(Electronic Codebook Book)引入了一个新的概念：初始向量IV（Initialization Vector）。</p>
<p>IV的作用:对于每个块来说key是不变的，但是只有第一个块的IV是用户提供的，其他块IV都是自动生成。</p>
<p>ECB模式（默认）：</p>
<p>密码分组链接模式(Cipher Block Chaining)在该模式下，每一个明文块的加密都是完全独立，互不干涉的。</p>
<p>CTR模式：</p>
<p>计算器模式(Counter)</p>
<p>CFB模式：</p>
<p>密码反馈模式(Cipher FeedBack)</p>
<p>OFB模式：</p>
<p>输出反馈模式(Output FeedBack)</p>
<h2 id="前端加密JS库CryptoJS"><a href="#前端加密JS库CryptoJS" class="headerlink" title="前端加密JS库CryptoJS"></a>前端加密JS库CryptoJS</h2><p>注:JavaScript 只能 pkcs7padding,但与pkcs5padding效果一致</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> CryptoJS = <span class="built_in">require</span>(<span class="string">&quot;crypto-js&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> key = <span class="string">&quot;aaaabbbbccccddddeeeeffffgggghhhh&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> iv = <span class="string">&quot;1234567812345678&quot;</span>; <span class="comment">// 用来加密或者解密的初始向量(必须是16位)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// CryptoJS.enc.Utf8.parse 将数据转为128bits</span></span><br><span class="line">    <span class="comment">// 16位十六进制数作为密钥key</span></span><br><span class="line">    <span class="comment">// 16位十六进制数作为密钥偏移量iv</span></span><br><span class="line">    <span class="keyword">return</span> CryptoJS.AES.encrypt(text, CryptoJS.enc.Utf8.parse(key), &#123;</span><br><span class="line">        iv: CryptoJS.enc.Utf8.parse(iv),</span><br><span class="line">        mode: CryptoJS.mode.CBC,</span><br><span class="line">        padding: CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span>(<span class="params">text</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> decryptedStr = CryptoJS.AES.decrypt(text, CryptoJS.enc.Utf8.parse(key), &#123;</span><br><span class="line">        iv: CryptoJS.enc.Utf8.parse(iv),</span><br><span class="line">        mode: CryptoJS.mode.CBC,</span><br><span class="line">        padding: CryptoJS.pad.Pkcs7</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> decryptedStr.toString(CryptoJS.enc.Utf8)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;你好&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> encoded = encrypt(text)</span><br><span class="line"><span class="comment">//由于CryptoJS生成的密文是一个对象，直接将其转为字符串得到Base64编码字符串</span></span><br><span class="line"><span class="built_in">console</span>.log(encoded.toString());</span><br><span class="line"><span class="built_in">console</span>.log(decrypt(encoded));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;CryptoJS v3.1.2/components/core-min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;CryptoJS v3.1.2/rollups/aes.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> pwd = <span class="string">&quot;eos&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> str=<span class="string">&quot;longzhoufeng&quot;</span></span><br><span class="line">    <span class="keyword">var</span> mi = CryptoJS.AES.encrypt(str, pwd);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;加密密文:&quot;</span> + mi);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = CryptoJS.AES.decrypt(mi, pwd).toString(CryptoJS.enc.Utf8);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;解密结果：&quot;</span> + result);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 加密：填充加密文本和密钥为16字节,对aes加密后的文本进行base64编码，转为字符串形式。</span></span><br><span class="line"><span class="comment"># 解密：先逆向解密base64成bytes转字符串，将多余位数的’\0’替换为空。</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Aes128</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, key=None, iv=None</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> key:</span><br><span class="line">            self.key = self.get_key(<span class="number">16</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> len(key) &gt; <span class="number">32</span>:</span><br><span class="line">                key = key[:<span class="number">32</span>]</span><br><span class="line"></span><br><span class="line">            self.key = self.to_16(key)</span><br><span class="line"></span><br><span class="line">        self.iv = iv</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_key</span>(<span class="params">n=<span class="number">16</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        获取密钥 n 密钥长度</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        c_length = int(n)</span><br><span class="line"></span><br><span class="line">        source = <span class="string">&#x27;ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678&#x27;</span></span><br><span class="line">        length = len(source) - <span class="number">1</span></span><br><span class="line">        result = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(c_length):</span><br><span class="line">            result += source[random.randint(<span class="number">0</span>, length)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pkcs7padding</span>(<span class="params">text</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        明文使用PKCS7填充</span></span><br><span class="line"><span class="string">        最终调用AES加密方法时，传入的是一个byte数组，要求是16的整数倍，因此需要对明文进行处理</span></span><br><span class="line"><span class="string">        :param text: 待加密内容(明文)</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        bs = AES.block_size  <span class="comment"># 16</span></span><br><span class="line">        length = len(text)</span><br><span class="line">        bytes_length = len(bytes(text, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="comment"># tips：utf-8编码时，英文占1个byte，而中文占3个byte</span></span><br><span class="line">        padding_size = length <span class="keyword">if</span> (bytes_length == length) <span class="keyword">else</span> bytes_length</span><br><span class="line"></span><br><span class="line">        padding = bs - padding_size % bs</span><br><span class="line">        <span class="comment"># tips：chr(padding)看与其它语言的约定，有的会使用&#x27;\0&#x27;</span></span><br><span class="line">        padding_text = chr(padding) * padding</span><br><span class="line">        <span class="comment"># bytes_length = len(bytes(text + padding_text, encoding=&#x27;utf-8&#x27;))</span></span><br><span class="line">        <span class="comment"># print(bytes_length)</span></span><br><span class="line">        <span class="keyword">return</span> text + padding_text</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pkcs7unpadding</span>(<span class="params">text</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        处理使用PKCS7填充过的数据</span></span><br><span class="line"><span class="string">        :param text: 解密后的字符串</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        length = len(text)</span><br><span class="line">        unpadding = ord(text[length - <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> text[<span class="number">0</span>:length - unpadding]</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_16</span>(<span class="params">key</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        将key转为16倍数的bytes数据</span></span><br><span class="line"><span class="string">        :param key:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key_bytes = bytes(key, encoding=<span class="string">&quot;utf8&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> len(key_bytes) % <span class="number">16</span> != <span class="number">0</span>:</span><br><span class="line">            key_bytes += <span class="string">b&#x27;\0&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> key  <span class="comment"># 返回bytes</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt_CBC</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        AES加密</span></span><br><span class="line"><span class="string">        key,iv使用同一个</span></span><br><span class="line"><span class="string">        模式cbc</span></span><br><span class="line"><span class="string">        填充pkcs7</span></span><br><span class="line"><span class="string">        :param key: 密钥</span></span><br><span class="line"><span class="string">        :param content: 加密内容</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key_bytes = bytes(self.key, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.iv:</span><br><span class="line">            iv = key_bytes</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            iv = self.iv</span><br><span class="line">        cipher = AES.new(key_bytes, AES.MODE_CBC, iv)  <span class="comment"># 初始化加密器</span></span><br><span class="line">        <span class="comment"># 处理明文</span></span><br><span class="line">        content_padding = self.pkcs7padding(content)</span><br><span class="line">        <span class="comment"># 加密</span></span><br><span class="line">        encrypt_bytes = cipher.encrypt(bytes(content_padding, encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="comment"># 重新编码</span></span><br><span class="line">        result = str(base64.b64encode(encrypt_bytes), encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt_CBC</span>(<span class="params">self, content</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        AES解密</span></span><br><span class="line"><span class="string">         key,iv使用同一个</span></span><br><span class="line"><span class="string">        模式cbc</span></span><br><span class="line"><span class="string">        去填充pkcs7</span></span><br><span class="line"><span class="string">        :param key:</span></span><br><span class="line"><span class="string">        :param content:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        key_bytes = bytes(self.key, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.iv:</span><br><span class="line">            iv = key_bytes</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            iv = self.iv</span><br><span class="line">        cipher = AES.new(key_bytes, AES.MODE_CBC, iv)</span><br><span class="line">        <span class="comment"># base64解码</span></span><br><span class="line">        encrypt_bytes = base64.b64decode(content)</span><br><span class="line">        <span class="comment"># 解密</span></span><br><span class="line">        decrypt_bytes = cipher.decrypt(encrypt_bytes)</span><br><span class="line">        <span class="comment"># 重新编码</span></span><br><span class="line">        result = str(decrypt_bytes, encoding=<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="comment"># 去除填充内容</span></span><br><span class="line">        result = self.pkcs7unpadding(result)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt_ECB</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        aes = AES.new(self.key, AES.MODE_ECB)  <span class="comment"># 初始化加密器</span></span><br><span class="line">        <span class="keyword">return</span> str(base64.encodebytes(aes.encrypt(self.to_16(text))),</span><br><span class="line">                   encoding=<span class="string">&#x27;utf8&#x27;</span>).replace(<span class="string">&#x27;\n&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  <span class="comment"># 加密</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decodebytes_ECB</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        aes = AES.new(self.key, AES.MODE_ECB)  <span class="comment"># 初始化加密器</span></span><br><span class="line">        <span class="keyword">return</span> str(aes.decrypt(base64.decodebytes(bytes(</span><br><span class="line">            text, encoding=<span class="string">&#x27;utf8&#x27;</span>))).rstrip(<span class="string">b&#x27;\0&#x27;</span>).decode(<span class="string">&quot;utf8&quot;</span>))  <span class="comment"># 解密</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># AesCbc128.pkcs7padding(&quot;你好&quot;)</span></span><br><span class="line">    iv = <span class="string">b&quot;1234567812345678&quot;</span></span><br><span class="line">    key = <span class="string">&quot;aaaabbbbccccdddd&quot;</span></span><br><span class="line">    content = <span class="string">&quot;Hello,你好&quot;</span></span><br><span class="line">    aes = Aes128(key, iv)</span><br><span class="line">    encrypt_en = aes.encrypt_CBC(content)</span><br><span class="line">    print(encrypt_en)</span><br><span class="line">    decrypt_en = aes.decrypt_CBC(encrypt_en)</span><br><span class="line">    print(decrypt_en)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/01/Numpy%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/01/Numpy%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">Numpy速查手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-01 09:25:00" itemprop="dateCreated datePublished" datetime="2019-10-01T09:25:00+08:00">2019-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-05 20:11:34" itemprop="dateModified" datetime="2020-06-05T20:11:34+08:00">2020-06-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数据科学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="分布类型"><a href="#分布类型" class="headerlink" title="分布类型"></a>分布类型</h2><p><strong>均匀分布：</strong><br>均匀分布也叫矩形分布，它是对称概率分布，在相同长度间隔的分布概率是等可能的。 均匀分布由两个参数a和b定义，它们是数轴上的最小值和最大值，通常缩写为U（a，b）。</p>
<p><strong>正态分布：</strong><br>又名高斯分布，正态分布的概率密度函数曲线呈钟形，因此人们又经常称之为钟形曲线。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>固定内存块的解释：</p>
<ul>
<li>数据类型（整数、浮点或者Python 对象）</li>
<li>数据大小 </li>
<li>字节序</li>
<li>在结构化类型的情况下，字段的名称每个字段的数据类型，和每个字段占用的内存块部分</li>
<li>如果数据类型是子序列，它的形状和数据类型</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np <span class="comment"># 一般以np作为numpy的别名</span></span><br><span class="line">my_arr = np.arange(<span class="number">1000000</span>)</span><br><span class="line"><span class="comment"># 2行3列正态分布</span></span><br><span class="line">data = np.random.randn(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">data = data * <span class="number">10</span></span><br><span class="line"><span class="comment"># 2行3列均匀分布</span></span><br><span class="line">data = np.random.randn(<span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure>

<p>1、ndarray是一个通用的同构数据多维容器，其中的所有元素必须是相同类型的。<br>每个数组都有一个shape（一个表示各维度大小的元组）和一个dtype（一个用于说明数组数据类型的对象）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">6</span>]: data.shape</span><br><span class="line">Out[<span class="number">6</span>]: (<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">7</span>]: data.dtype</span><br><span class="line">Out[<span class="number">7</span>]: dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">8</span>]: data.ndim</span><br><span class="line">Out[<span class="number">8</span>]: <span class="number">2</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">31</span>]: np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>],dtype=bool)</span><br><span class="line">Out[<span class="number">31</span>]: array([ <span class="literal">True</span>,  <span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">False</span>])</span><br></pre></td></tr></table></figure>

<p>2、修改数据类型及保留小数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.astype(<span class="string">&#x27;i1&#x27;</span>)</span><br><span class="line">np.round(b,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>3、嵌套序列（比如由一组等长列表组成的列表）将会被转换为一个多维数组：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">22</span>]: data2 = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]]</span><br><span class="line"></span><br><span class="line">In [<span class="number">23</span>]: arr2 = np.array(data2)</span><br><span class="line"></span><br><span class="line">In [<span class="number">24</span>]: arr2</span><br><span class="line">Out[<span class="number">24</span>]: </span><br><span class="line">array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">       [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]])</span><br></pre></td></tr></table></figure>

<p>4、二项分布</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 函数的返回值表示n中成功的次数且以Cn^x*p^x*(1-p)^(n-x)的概率选择成功x次。</span></span><br><span class="line"><span class="comment"># 一次试验抛5次硬币朝上的硬币数，做2*3次试验。</span></span><br><span class="line">np.random.binomial(<span class="number">5</span>, <span class="number">0.5</span>, size=(<span class="number">2</span>,<span class="number">3</span>)) </span><br></pre></td></tr></table></figure>

<h2 id="数组形状"><a href="#数组形状" class="headerlink" title="数组形状"></a>数组形状</h2><p>1、查看和修改数组形状</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">3</span>]: a = np.array([[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>]])</span><br><span class="line"></span><br><span class="line">In [<span class="number">9</span>]: a.shape</span><br><span class="line">Out[<span class="number">9</span>]: (<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: a.reshape(<span class="number">1</span>,<span class="number">4</span>)</span><br><span class="line">Out[<span class="number">10</span>]: array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line"></span><br><span class="line">In [<span class="number">12</span>]: a.reshape(<span class="number">4</span>,)</span><br><span class="line">Out[<span class="number">12</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">14</span>]: a.flatten()</span><br><span class="line">Out[<span class="number">14</span>]: array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>2、数组计算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t3 = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">np.sum(t3)</span><br><span class="line">np.sum(t3,axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 求0轴中值,不指定轴则默认返回多维数组的全部统计结果。</span></span><br><span class="line">np.median(t3,axis=<span class="number">0</span>)</span><br><span class="line"><span class="comment"># 0轴标准差</span></span><br><span class="line">t3.std(axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>广播原则：</strong></p>
<ul>
<li>如果两个数组的后缘维度即从末尾开始算起的维度的轴长度相符或其中一方的长度为1，则认为它们是广播兼容的。广播会在缺失和长度为1的维度上进行。</li>
<li>shape为(3,3,2)的数组可以跟(3,2)的数组进行计算。</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">21</span>]: b = np.arange(<span class="number">10</span>).reshape(<span class="number">2</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">22</span>]: b</span><br><span class="line">Out[<span class="number">22</span>]:</span><br><span class="line">array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line">       [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</span><br><span class="line">	   </span><br><span class="line">In [<span class="number">24</span>]: c</span><br><span class="line">Out[<span class="number">24</span>]:</span><br><span class="line">array([[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">       [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]])</span><br><span class="line">			  </span><br><span class="line">In [<span class="number">26</span>]: d = np.array([<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>])</span><br><span class="line">			  </span><br><span class="line">b - c?</span><br><span class="line">b - d?</span><br></pre></td></tr></table></figure>

<h2 id="numpy读取文件"><a href="#numpy读取文件" class="headerlink" title="numpy读取文件"></a>numpy读取文件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">np.loadtxt(frame.dtype=np.float,delimiter=<span class="literal">None</span>,skiprows=<span class="number">0</span>,usecols=<span class="literal">None</span>,unpack=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">unpack:转置，等价于transpose()</span><br></pre></td></tr></table></figure>

<h2 id="索引切片-数值修改"><a href="#索引切片-数值修改" class="headerlink" title="索引切片,数值修改"></a>索引切片,数值修改</h2><p>1、一维数组索引切片：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">4</span>]: a = np.arange(<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: a</span><br><span class="line">Out[<span class="number">5</span>]: array([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">In [<span class="number">6</span>]: a[:<span class="number">7</span>:<span class="number">2</span>]</span><br><span class="line">Out[<span class="number">6</span>]: array([<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>])</span><br></pre></td></tr></table></figure>

<p>2、多维数组</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">24</span>).reshape(<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure>
<p>array([[[ 0,  1,  2,  3],<br>        [ 4,  5,  6,  7],<br>        [ 8,  9, 10, 11]],<br>       [[12, 13, 14, 15],<br>        [16, 17, 18, 19],<br>        [20, 21, 22, 23]]])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[:,:,<span class="number">2</span>:]</span><br></pre></td></tr></table></figure>
<p>array([[[ 2,  3],<br>        [ 6,  7],<br>        [10, 11]],<br>       [[14, 15],<br>        [18, 19],<br>        [22, 23]]])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取第2-3行，2-4列</span></span><br><span class="line">a[:,<span class="number">1</span>:<span class="number">3</span>,<span class="number">1</span>:<span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>array([[[ 5,  6,  7],<br>        [ 9, 10, 11]],<br>       [[17, 18, 19],<br>        [21, 22, 23]]])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 取多个不相邻的点</span></span><br><span class="line">a[[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]]</span><br></pre></td></tr></table></figure>
<p>array([1, 5, 9])</p>
<p>3、数值修改</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bool索引将矩阵中小于10的数值替换为10</span></span><br><span class="line">a[a&lt;<span class="number">10</span>] = <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>array([[[10, 10, 10, 10],<br>        [10, 10, 10, 10],<br>        [10, 10, 10, 11]],<br>       [[12, 13, 14, 15],<br>        [16, 17, 18, 19],<br>        [20, 21, 22, 23]]])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># numpy三目运算符</span></span><br><span class="line">b = np.where(a&lt;<span class="number">15</span>,<span class="number">6</span>,<span class="number">8</span>)</span><br></pre></td></tr></table></figure>
<p>array([[[6, 6, 6, 6],<br>        [6, 6, 6, 6],<br>        [6, 6, 6, 6]],<br>       [[6, 6, 6, 8],<br>        [8, 8, 8, 8],<br>        [8, 8, 8, 8]]])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 裁剪 如小于7全替换为7 ，大于8全替换为8</span></span><br><span class="line">b.clip(<span class="number">7</span>,<span class="number">8</span>)</span><br></pre></td></tr></table></figure>

<h2 id="拼接"><a href="#拼接" class="headerlink" title="拼接"></a>拼接</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">np.hstack((a,b))</span><br><span class="line">np.vstack((a,b))</span><br></pre></td></tr></table></figure>

<h2 id="复制"><a href="#复制" class="headerlink" title="复制"></a>复制</h2><p>acopy = lena.copy() # 深拷贝,完全复制数组和数据。<br>aview = lena.view() # 浅拷贝,重新开辟了一块内存，view和原始数据共享一份数据，修改一个会影响另一个，但有自己的数据结构。</p>
<h2 id="nan与inf"><a href="#nan与inf" class="headerlink" title="nan与inf"></a>nan与inf</h2><h3 id="nan-not-a-number"><a href="#nan-not-a-number" class="headerlink" title="nan(not a number)"></a>nan(not a number)</h3><p>1、读取本地文件为float时候，如果有缺失就会出现nan<br>2、不合适的计算</p>
<h3 id="inf-infinity"><a href="#inf-infinity" class="headerlink" title="inf(infinity)"></a>inf(infinity)</h3><p>1、数字除以0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">9</span>]: type(np.inf)</span><br><span class="line">Out[<span class="number">9</span>]: float</span><br><span class="line"></span><br><span class="line">In [<span class="number">10</span>]: type(np.nan)</span><br><span class="line">Out[<span class="number">10</span>]: float</span><br></pre></td></tr></table></figure>

<p>1、判断一个数字是否为nan</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">2</span>]: np.nan == np.nan</span><br><span class="line">Out[<span class="number">2</span>]: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">np.isnan(a) 返回bool</span><br></pre></td></tr></table></figure>
<p><strong>缺失值处理：</strong>一般把缺失值替换为均值（中值）或者直接删除有缺失值的一行。</p>
<h2 id="实战填充NAN"><a href="#实战填充NAN" class="headerlink" title="实战填充NAN"></a>实战填充NAN</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill_nadrray</span>(<span class="params">t1</span>):</span></span><br><span class="line">    <span class="comment"># 遍历每一列</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(t1.shape[<span class="number">1</span>]):</span><br><span class="line">        temp_col = t1[:,i]</span><br><span class="line">        nan_num = np.count_nonzero(temp_col!=temp_col)</span><br><span class="line">        <span class="keyword">if</span> nan_num != <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 当前一列不为nan的array</span></span><br><span class="line">            temp_not_nan_col = temp_col[temp_col == temp_col]</span><br><span class="line">            <span class="comment"># 选中当前为nan的位置，把值赋值为不为nan的均值</span></span><br><span class="line">            temp_col[np.isnan(temp_col)] = temp_not_nan_col.mean()</span><br><span class="line">    <span class="keyword">return</span> t1</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span> __name__ = <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	t1 = np.arange(<span class="number">24</span>).reshape(<span class="number">4</span>,<span class="number">6</span>).astype(<span class="string">&quot;float&quot;</span>)</span><br><span class="line">	t1[<span class="number">1</span>,<span class="number">2</span>:] = np.nan</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/30/Font%20%E5%85%A8%E7%BD%91%E4%BB%A3%E7%90%86%E5%AD%97%E4%BD%93%E5%88%86%E5%89%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/30/Font%20%E5%85%A8%E7%BD%91%E4%BB%A3%E7%90%86%E5%AD%97%E4%BD%93%E5%88%86%E5%89%B2/" class="post-title-link" itemprop="url">全网代理字体分割</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-30 12:00:05" itemprop="dateCreated datePublished" datetime="2019-09-30T12:00:05+08:00">2019-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 11:44:55" itemprop="dateModified" datetime="2020-04-24T11:44:55+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>目标网址：<a target="_blank" rel="noopener" href="http://www.goubanjia.com/">全网代理IP</a></p>
<h3 id="一、网址分析"><a href="#一、网址分析" class="headerlink" title="一、网址分析"></a>一、网址分析</h3><p><img src="/images/qwdl/qw1.png"></p>
<ol>
<li>观察上图可知通过正常的元素中插入隐藏元素，然后隐藏元素设置无效值来达到混淆作用。</li>
<li>混淆标签：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1、<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#x27;display: inline-block;&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">2、<span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&#x27;display: none;&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">3、<span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">4、<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&#x27;display:inline-block;&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>应对策略：</li>
</ol>
<ul>
<li>排除空标签</li>
<li>排除隐藏标签</li>
</ul>
<ol start="4">
<li>仔细观察发现source中的port与渲染后展示的不一致，说明端口是后续经JS处理填充的。</li>
<li>应对策略：</li>
</ol>
<ul>
<li><p>常规办法<br>在该节点的父节点处DOM断点subtree modification ,需等待几分钟后刷新（立即刷新不会进入调试界面，未找到原因）<br><img src="/images/qwdl/qw2.png"></p>
</li>
<li><p>取巧办法<br>1、直接请求页面源码到本地，浏览器在禁用JS和开启JS的情况下，打开本地页面观测比对，可发现端口不一致，印证前面提过的观点。<br>2、该页面分别引入三个JS，依次注释掉JS打开页面，判断修改port的是哪个JS文件。<br>3、最后发现是pde.js文件对port进行了处理，打开该文件，发现进行了混淆和eval加密。</p>
</li>
</ul>
<p><img src="/images/qwdl/qw3.png"></p>
<ul>
<li>js packer 特征：packer压缩是以eval(function(p,a,c,k,e,d)  或  eval(function(p,a,c,k,e,r)  开头，只是早前的一些打包算法。</li>
</ul>
<ol start="6">
<li>Javascript 的 eval 函数可以在当前作用域执行一段包含 Javascript 代码的字符串。</li>
</ol>
<ul>
<li>解决：eval解密的网址如<a target="_blank" rel="noopener" href="https://tool.lu/js/">https://tool.lu/js/</a>或在浏览器控制台复制代码删除开头 eval 这4个字母回车运行。<br><img src="/images/qwdl/qw4.png"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _$ = [<span class="string">&#x27;\x2e\x70\x6f\x72\x74&#x27;</span>, <span class="string">&quot;\x65\x61\x63\x68&quot;</span>, <span class="string">&quot;\x68\x74\x6d\x6c&quot;</span>, <span class="string">&quot;\x69\x6e\x64\x65\x78\x4f\x66&quot;</span>, <span class="string">&#x27;\x2a&#x27;</span>, <span class="string">&quot;\x61\x74\x74\x72&quot;</span>, <span class="string">&#x27;\x63\x6c\x61\x73\x73&#x27;</span>, <span class="string">&quot;\x73\x70\x6c\x69\x74&quot;</span>, <span class="string">&quot;\x20&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;\x6c\x65\x6e\x67\x74\x68&quot;</span>, <span class="string">&quot;\x70\x75\x73\x68&quot;</span>, <span class="string">&#x27;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x5a&#x27;</span>, <span class="string">&quot;\x70\x61\x72\x73\x65\x49\x6e\x74&quot;</span>, <span class="string">&quot;\x6a\x6f\x69\x6e&quot;</span>, <span class="string">&#x27;&#x27;</span>];</span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(_$[<span class="number">0</span>])[_$[<span class="number">1</span>]](<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = $(<span class="built_in">this</span>)[_$[<span class="number">2</span>]]();</span><br><span class="line">        <span class="keyword">if</span> (a[_$[<span class="number">3</span>]](_$[<span class="number">4</span>]) != <span class="number">-0x1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        ;<span class="keyword">var</span> b = $(<span class="built_in">this</span>)[_$[<span class="number">5</span>]](_$[<span class="number">6</span>]);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            b = (b[_$[<span class="number">7</span>]](_$[<span class="number">8</span>]))[<span class="number">0x1</span>];</span><br><span class="line">            <span class="keyword">var</span> c = b[_$[<span class="number">7</span>]](_$[<span class="number">9</span>]);</span><br><span class="line">            <span class="keyword">var</span> d = c[_$[<span class="number">10</span>]];</span><br><span class="line">            <span class="keyword">var</span> f = [];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0x0</span>; g &lt; d; g++) &#123;</span><br><span class="line">                f[_$[<span class="number">11</span>]](_$[<span class="number">12</span>][_$[<span class="number">3</span>]](c[g]))</span><br><span class="line">            &#125;</span><br><span class="line">            ;$(<span class="built_in">this</span>)[_$[<span class="number">2</span>]](<span class="built_in">window</span>[_$[<span class="number">13</span>]](f[_$[<span class="number">14</span>]](_$[<span class="number">15</span>])) &gt;&gt; <span class="number">0x3</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
这一段代码还是不清晰，根据代码逻辑把_$[]进行替换，得到最终JS代码，替换所用代码详见文末。<br><img src="/images/qwdl/qw5.png"><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// each() 方法规定为每个匹配元素规定运行的函数。</span></span><br><span class="line">    $(<span class="string">&#x27;.port&#x27;</span>)[<span class="string">&#x27;each&#x27;</span>](<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = $(<span class="built_in">this</span>)[<span class="string">&#x27;html&#x27;</span>]();</span><br><span class="line">        <span class="keyword">if</span> (a[<span class="string">&#x27;indexOf&#x27;</span>](<span class="string">&#x27;*&#x27;</span>) != <span class="number">-0x1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        ;<span class="keyword">var</span> b = $(<span class="built_in">this</span>)[<span class="string">&#x27;attr&#x27;</span>](<span class="string">&#x27;class&#x27;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            b = (b[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27; &#x27;</span>))[<span class="number">0x1</span>];</span><br><span class="line">            <span class="keyword">var</span> c = b[<span class="string">&#x27;split&#x27;</span>](<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> d = c[<span class="string">&#x27;length&#x27;</span>];</span><br><span class="line">            <span class="keyword">var</span> f = [];</span><br><span class="line"><span class="comment">// push() 方法可向数组的末尾添加一个或多个元素，并返回新的长度。</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0x0</span>; g &lt; d; g++) &#123;</span><br><span class="line">                f[<span class="string">&#x27;push&#x27;</span>](<span class="string">&#x27;ABCDEFGHIZ&#x27;</span>[<span class="string">&#x27;indexOf&#x27;</span>](c[g]))</span><br><span class="line">            &#125;</span><br><span class="line">            ;$(<span class="built_in">this</span>)[<span class="string">&#x27;html&#x27;</span>](<span class="built_in">window</span>[<span class="string">&#x27;parseInt&#x27;</span>](f[<span class="string">&#x27;join&#x27;</span>](<span class="string">&#x27;&#x27;</span>)) &gt;&gt; <span class="number">0x3</span>)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
逻辑分析：取端口标签的第二个class，将字符串的每个字母在“ABCDEFG”中寻找对应索引，取得每个字母的索引重新拼接成字符串并转换成数值右移3位即除以8得到最后的端口号。<br>用Python来实现这段代码：<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_real_port</span>(<span class="params">classValue</span>):</span></span><br><span class="line">    port_ = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> classValue:</span><br><span class="line">        port_ += str(<span class="string">&quot;ABCDEFGHIZ&quot;</span>.index(value))</span><br><span class="line">    port = int(port_) &gt;&gt; <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> port</span><br></pre></td></tr></table></figure>

</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leo Lin"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Leo Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>


    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
