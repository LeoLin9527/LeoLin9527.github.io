<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="江湖の林九">
<meta property="og:url" content="http://yoursite.com/page/7/index.html">
<meta property="og:site_name" content="江湖の林九">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leo Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>江湖の林九</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">江湖の林九</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">相逢何必曾相识！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">104</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/LeoLin9527" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/11/JsCrack%20JsFuck%20CloudFlare/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/11/JsCrack%20JsFuck%20CloudFlare/" class="post-title-link" itemprop="url">JsCrack JsFuck CloudFlare</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-11 10:30:00" itemprop="dateCreated datePublished" datetime="2019-10-11T10:30:00+08:00">2019-10-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 21:27:53" itemprop="dateModified" datetime="2020-04-23T21:27:53+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>案例网站：<br>1、<a target="_blank" rel="noopener" href="https://www.biovision.com/">https://www.biovision.com/</a><br>2、<a target="_blank" rel="noopener" href="https://coinone.co.kr/">https://coinone.co.kr/</a></p>
<h2 id="JsFuck简介"><a href="#JsFuck简介" class="headerlink" title="JsFuck简介"></a>JsFuck简介</h2><p>JSFuck 是使用 [、]、(、)、! 和 + 六种字符来表示原有的字符的，解决方案：<code>console.log(xxx)</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">false</span>       =&gt;  ![]</span><br><span class="line"><span class="literal">true</span>        =&gt;  !![]</span><br><span class="line"><span class="literal">undefined</span>   =&gt;  [][[]]</span><br><span class="line"><span class="literal">NaN</span>         =&gt;  +[![]]</span><br><span class="line"><span class="number">0</span>           =&gt;  +[]</span><br><span class="line"><span class="number">1</span>           =&gt;  +!+[]</span><br><span class="line"><span class="number">2</span>           =&gt;  !+[]+!+[]</span><br><span class="line"><span class="number">10</span>          =&gt;  [+!+[]]+[+[]]</span><br><span class="line"><span class="built_in">Array</span>       =&gt;  []</span><br><span class="line"><span class="built_in">Number</span>      =&gt;  +[]</span><br><span class="line"><span class="built_in">String</span>      =&gt;  []+[]</span><br><span class="line"><span class="built_in">Boolean</span>     =&gt;  ![]</span><br><span class="line"><span class="built_in">Function</span>    =&gt;  [][<span class="string">&quot;filter&quot;</span>]</span><br><span class="line"><span class="built_in">eval</span>        =&gt;  [][<span class="string">&quot;filter&quot;</span>][<span class="string">&quot;constructor&quot;</span>]( CODE )()</span><br><span class="line"><span class="built_in">window</span>      =&gt;  [][<span class="string">&quot;filter&quot;</span>][<span class="string">&quot;constructor&quot;</span>](<span class="string">&quot;return this&quot;</span>)()</span><br></pre></td></tr></table></figure>

<h2 id="取巧方法"><a href="#取巧方法" class="headerlink" title="取巧方法"></a>取巧方法</h2><p>1、安装三方库：<br><code>pip install cfscrape</code></p>
<p>2、实例操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cfscrape</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化一个create_scraper对象,请求报错，可以加上延时</span></span><br><span class="line">scraper = cfscrape.create_scraper(delay=<span class="number">10</span>)</span><br><span class="line"><span class="comment"># 获取网页源代码</span></span><br><span class="line">web_data = scraper.get(url).text</span><br><span class="line">print(web_data)</span><br></pre></td></tr></table></figure>

<h2 id="分析解决"><a href="#分析解决" class="headerlink" title="分析解决"></a>分析解决</h2><p>1、通过抓包可以看到503请求数秒后跳转一个类似“<a target="_blank" rel="noopener" href="https://xxxxx/cdn-cgi/l/chk_jschl?s=xxx%E2%80%9D%E7%9A%84302%E8%AF%B7%E6%B1%82%EF%BC%8C%E6%88%90%E5%8A%9F%E5%90%8E%E5%8D%B3%E5%8F%AF%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%9C%9F%E6%9C%9B%E9%A1%B5%E9%9D%A2%E3%80%82">https://xxxxx/cdn-cgi/l/chk_jschl?s=xxx”的302请求，成功后即可跳转到期望页面。</a><br>2、cookie里面会包含__cfduid, cf_clearance 这两个字段。第二个302请求的参数如下图，可用正则直接提取前三个参数，第四个参数由Js动态生成：<br><img src="/images/9-cloudFlare/CloudFlare1.png"><br>1、操作DOM元素部分可去除。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">t = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line">t.innerHTML=<span class="string">&quot;&lt;a href=&#x27;/&#x27;&gt;x&lt;/a&gt;&quot;</span>;</span><br><span class="line">t = t.firstChild.href;r = t.match(<span class="regexp">/https?:\/\//</span>)[<span class="number">0</span>];</span><br><span class="line">t = t.substr(r.length); t = t.substr(<span class="number">0</span>,t.length<span class="number">-1</span>); </span><br><span class="line"></span><br><span class="line">a = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;jschl-answer&#x27;</span>);</span><br><span class="line">f = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;challenge-form&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>2、由于去除DOM部分，修改与之对应的Js代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a.value = (+gRfsikn.fPWFibk + t.length).toFixed(<span class="number">10</span>)</span><br><span class="line"><span class="comment">// a.value 和 t.length 可改为固定变量和固定值</span></span><br></pre></td></tr></table></figure>
<p>3、调用execjs生成对应参数值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> cfscrape</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> gzip <span class="keyword">import</span> GzipFile</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO,StringIO</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CloudFlare</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.session = requests.session()</span><br><span class="line">        self.url = <span class="string">&quot;https://coinone.co.kr/&quot;</span></span><br><span class="line">        self.url_jschl = <span class="string">&quot;https://coinone.co.kr/cdn-cgi/l/chk_jschl&quot;</span></span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;https://coinone.co.kr/&quot;</span>,</span><br><span class="line">            <span class="comment"># &quot;Accept-Encoding&quot;: &quot;gzip, deflate, br&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_clouFlare</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        503 获取cookie __cfduid ， 并从页面提取二次访问的参数</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        resp = self.session.get(self.url, headers=self.headers)</span><br><span class="line">        <span class="comment"># resp.raise_for_status()</span></span><br><span class="line">        text = resp.text</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_params</span>(<span class="params">self, text</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        提取访问参数</span></span><br><span class="line"><span class="string">        :param text:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        pattern = re.compile(<span class="string">&#x27;setTimeout\(function\(\)\&#123;(.*?)f.action \+= location.hash;&#x27;</span>, re.S)</span><br><span class="line">        code = pattern.findall(text)[<span class="number">0</span>].strip()</span><br><span class="line">        <span class="comment"># 正则表达式中\s匹配任何空白字符，包括空格、制表符、换页符等等, 等价于[ \f\n\r\t\v ]</span></span><br><span class="line">        code = re.sub(<span class="string">&#x27;\s+(t = document.*?);\s+;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, code, flags=re.S)</span><br><span class="line">        code = re.sub(<span class="string">&#x27;a.value&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, code)</span><br><span class="line">        code = re.sub(<span class="string">&#x27;t.length&#x27;</span>, <span class="string">&#x27;13&#x27;</span>, code)</span><br><span class="line">        code = <span class="string">&#x27;function test()&#123;&#x27;</span> + code.strip() + <span class="string">&#x27;;return value;&#125;&#x27;</span></span><br><span class="line">        s1 = execjs.compile(code)</span><br><span class="line">        _jschl_answer = s1.call(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line">        _s = re.findall(<span class="string">&#x27;name=&quot;s&quot; value=&quot;(.*?)&quot;&#x27;</span>, text)[<span class="number">0</span>]</span><br><span class="line">        _jschl_vc = re.findall(<span class="string">&#x27;name=&quot;jschl_vc&quot; value=&quot;(.*?)&quot;&#x27;</span>, text)[<span class="number">0</span>]</span><br><span class="line">        _pass = re.findall(<span class="string">&#x27;name=&quot;pass&quot; value=&quot;(.*?)&quot;&#x27;</span>, text)[<span class="number">0</span>]</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;s&#x27;</span>: _s,</span><br><span class="line">            <span class="string">&#x27;jschl_vc&#x27;</span>: _jschl_vc,</span><br><span class="line">            <span class="string">&#x27;pass&#x27;</span>: _pass,</span><br><span class="line">            <span class="string">&#x27;jschl_answer&#x27;</span>: _jschl_answer</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_cf_clearance</span>(<span class="params">self, params</span>):</span></span><br><span class="line">        time.sleep(<span class="number">4</span>)</span><br><span class="line">        resp = self.session.get(self.url_jschl, params=params, headers=self.headers, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">        print(self.session.cookies.get_dict())</span><br><span class="line">        resp = self.session.get(self.url, headers=self.headers)</span><br><span class="line">        resp.encoding = resp.apparent_encoding</span><br><span class="line">        <span class="keyword">return</span> resp.text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        text = self.get_clouFlare()</span><br><span class="line">        params = self.generate_params(text)</span><br><span class="line">        text = self.get_cf_clearance(params)</span><br><span class="line">        print(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    cf = CloudFlare()</span><br><span class="line">    cf.run()</span><br></pre></td></tr></table></figure>

<p><img src="/images/CloudFlare2.png" alt="测试结果"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/10/JsCrack%20%E8%B0%B7%E6%AD%8C-%E6%9C%89%E9%81%93-%E7%99%BE%E5%BA%A6%E7%BF%BB%E8%AF%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/10/JsCrack%20%E8%B0%B7%E6%AD%8C-%E6%9C%89%E9%81%93-%E7%99%BE%E5%BA%A6%E7%BF%BB%E8%AF%91/" class="post-title-link" itemprop="url">JsCrack谷歌-有道-百度翻译</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-10 22:30:00" itemprop="dateCreated datePublished" datetime="2019-10-10T22:30:00+08:00">2019-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 21:29:38" itemprop="dateModified" datetime="2020-04-23T21:29:38+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="有道翻译"><a href="#有道翻译" class="headerlink" title="有道翻译"></a>有道翻译</h3><p>目标网址：<a target="_blank" rel="noopener" href="http://fanyi.youdao.com/">http://fanyi.youdao.com/</a></p>
<ul>
<li>点击翻译按钮后可在XHR处添加“translate_o”断点，执行后代码停留在send处，根据右侧call stack在t.translate处发现如下参数：</li>
</ul>
<p><img src="/images/8-translate/fanyi1.png"></p>
<ul>
<li>查找r的位置如图，追踪生成他的函数：</li>
</ul>
<p><img src="/images/8-translate/fanyi2.png"></p>
<h3 id="百度翻译"><a href="#百度翻译" class="headerlink" title="百度翻译"></a>百度翻译</h3><p>目标网址：<a target="_blank" rel="noopener" href="https://fanyi.baidu.com/">https://fanyi.baidu.com/</a></p>
<ul>
<li>同样观察XHR发现两个接口，先请求<a target="_blank" rel="noopener" href="https://fanyi.baidu.com/langdetect%E5%BE%97%E5%88%B0%E8%BE%93%E5%85%A5%E8%AF%AD%E8%A8%80%E7%B1%BB%E5%9E%8B%EF%BC%8C%E5%8F%AF%E6%89%BE%E5%88%B0%E5%A6%82%E4%B8%8B%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%EF%BC%9A">https://fanyi.baidu.com/langdetect得到输入语言类型，可找到如下回调函数：</a></li>
</ul>
<p><img src="/images/8-translate/fanyi4.png"></p>
<ul>
<li>v2transapi为翻译接口，直接XHR断点根据call stack追踪，发现如下位置：</li>
</ul>
<p><img src="/images/8-translate/fanyi5.png"></p>
<ul>
<li>token由window.common.token生成，可以在页面源码处找到：</li>
</ul>
<p><img src="/images/8-translate/fanyi6.png"></p>
<ul>
<li>from，to两个参数由下图的g产生，而s,o则是从页面中获取</li>
</ul>
<p><img src="/images/8-translate/fanyi7.png"></p>
<ul>
<li>关键在于sign的获取，移动鼠标到m函数处点击跳转Js，复制下图位置的JS函数到Webstorm进行调试。</li>
</ul>
<p><img src="/images/8-translate/fanyi8.png"></p>
<p>需要注意：下图的i是window.gtk也可以在页面源码中找到，但node环境下不具备需要手动赋值。</p>
<p><img src="/images/8-translate/fanyi9.png"></p>
<p><strong>注:</strong> 998错误则意味需要重新加载主页获取新的token。</p>
<h3 id="谷歌翻译"><a href="#谷歌翻译" class="headerlink" title="谷歌翻译"></a>谷歌翻译</h3><p>1、谷歌翻译的接口为GET请求，参数如下图:<br><img src="/images/8-translate/fanyi10.png"></p>
<p>2、同时发现在同个页面翻译同一个文字时，参数不变，可推断tk值与输入的文字有关<br><img src="/images/8-translate/fanyi11.png"></p>
<p>3、进行XHR断点分析参数，发现下图处进行参数添加，但此处未有tk参数，继续调试<br><img src="/images/8-translate/fanyi12.png"></p>
<p>4、在如下位置找到pp函数<br><img src="/images/8-translate/fanyi13.png"></p>
<p>5、追踪pp函数，最后找到tk产生的代码段<br><img src="/images/8-translate/fanyi14.png"></p>
<p>6、完整的Js代码如下</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">var to = function(a) &#123;</span><br><span class="line">    <span class="keyword">return</span> function() &#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">  , uo = function(a, b) &#123;</span><br><span class="line">    <span class="keyword">for</span> (var c = <span class="number">0</span>; c &lt; b.length - <span class="number">2</span>; c += <span class="number">3</span>) &#123;</span><br><span class="line">        var d = b.charAt(c + <span class="number">2</span>);</span><br><span class="line">        d = <span class="string">&quot;a&quot;</span> &lt;= d ? d.charCodeAt(<span class="number">0</span>) - <span class="number">87</span> : Number(d);</span><br><span class="line">        d = <span class="string">&quot;+&quot;</span> == b.charAt(c + <span class="number">1</span>) ? a &gt;&gt;&gt; d : a &lt;&lt; d;</span><br><span class="line">        a = <span class="string">&quot;+&quot;</span> == b.charAt(c) ? a + d &amp; <span class="number">4294967295</span> : a ^ d</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line">  , vo = <span class="literal">null</span></span><br><span class="line">  , wo = function(a) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">null</span> !== vo)</span><br><span class="line">        var b = vo;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        b = to(String.fromCharCode(<span class="number">84</span>));</span><br><span class="line">        var c = to(String.fromCharCode(<span class="number">75</span>));</span><br><span class="line">        b = [b(), b()];</span><br><span class="line">        b[<span class="number">1</span>] = c();</span><br><span class="line">        b = (vo = window[b.join(c())] || <span class="string">&quot;&quot;</span>) || <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    var d = to(String.fromCharCode(<span class="number">116</span>));</span><br><span class="line">    c = to(String.fromCharCode(<span class="number">107</span>));</span><br><span class="line">    d = [d(), d()];</span><br><span class="line">    d[<span class="number">1</span>] = c();</span><br><span class="line">    c = <span class="string">&quot;&amp;&quot;</span> + d.join(<span class="string">&quot;&quot;</span>) + <span class="string">&quot;=&quot;</span>;</span><br><span class="line">    d = b.split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    b = Number(d[<span class="number">0</span>]) || <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (var e = [], f = <span class="number">0</span>, g = <span class="number">0</span>; g &lt; a.length; g++) &#123;</span><br><span class="line">        var h = a.charCodeAt(g);</span><br><span class="line"><span class="comment">// 重写 Python 代码时 关注这条语句</span></span><br><span class="line">        <span class="number">128</span> &gt; h ? e[f++] = h : </span><br><span class="line">(<span class="number">2048</span> &gt; h ? e[f++] = h &gt;&gt; <span class="number">6</span> | <span class="number">192</span> : </span><br><span class="line">(<span class="number">55296</span> == (h &amp; <span class="number">64512</span>) &amp;&amp; g + <span class="number">1</span> &lt; a.length &amp;&amp; <span class="number">56320</span> == (a.charCodeAt(g + <span class="number">1</span>) &amp; <span class="number">64512</span>) ? (h = <span class="number">65536</span> + ((h &amp; <span class="number">1023</span>) &lt;&lt; <span class="number">10</span>) + (a.charCodeAt(++g) &amp; <span class="number">1023</span>),</span><br><span class="line">        e[f++] = h &gt;&gt; <span class="number">18</span> | <span class="number">240</span>,</span><br><span class="line">        e[f++] = h &gt;&gt; <span class="number">12</span> &amp; <span class="number">63</span> | <span class="number">128</span>) : </span><br><span class="line"></span><br><span class="line">e[f++] = h &gt;&gt; <span class="number">12</span> | <span class="number">224</span>,</span><br><span class="line">        e[f++] = h &gt;&gt; <span class="number">6</span> &amp; <span class="number">63</span> | <span class="number">128</span>),</span><br><span class="line">        e[f++] = h &amp; <span class="number">63</span> | <span class="number">128</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    a = b;</span><br><span class="line">    <span class="keyword">for</span> (f = <span class="number">0</span>; f &lt; e.length; f++)</span><br><span class="line">        a += e[f],</span><br><span class="line">        a = uo(a, <span class="string">&quot;+-a^+6&quot;</span>);</span><br><span class="line">    a = uo(a, <span class="string">&quot;+-3^+b+-f&quot;</span>);</span><br><span class="line">    a ^= Number(d[<span class="number">1</span>]) || <span class="number">0</span>;</span><br><span class="line">    <span class="number">0</span> &gt; a &amp;&amp; (a = (a &amp; <span class="number">2147483647</span>) + <span class="number">2147483648</span>);</span><br><span class="line">    a %= <span class="number">1E6</span>;</span><br><span class="line">    <span class="keyword">return</span> c + (a.toString() + <span class="string">&quot;.&quot;</span> + (a ^ b))</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>7、应对策略</p>
<ul>
<li>扣取JS用nodeJs解析生成参数。</li>
<li>用Python重写Js代码实现参数生成。</li>
</ul>
<p>难点在于在JS可以使用 a&gt;&gt;&gt;b来实现无符号位移，但Python中并不存在需要自己实现且Python的int是不会溢出的，达到界限后会自动转为long。</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">3</span>]: d = bin(<span class="number">991837856</span> &lt;&lt;<span class="number">15</span>)</span><br><span class="line">In [<span class="number">4</span>]: d</span><br><span class="line">Out[<span class="number">4</span>]: &#x27;<span class="number">0b111011000111100011111010100000000000000000000</span>&#x27;</span><br><span class="line">In [<span class="number">5</span>]: len(d)</span><br><span class="line">Out[<span class="number">5</span>]: <span class="number">47</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/8-translate/fanyi15.png" alt="成果展示"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/08/JsCrack%20%E4%BC%81%E5%90%8D%E7%89%87encrypt_data%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/08/JsCrack%20%E4%BC%81%E5%90%8D%E7%89%87encrypt_data%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">JsCrack 企名片encrypt_data解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-08 12:00:10" itemprop="dateCreated datePublished" datetime="2019-10-08T12:00:10+08:00">2019-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 21:16:15" itemprop="dateModified" datetime="2020-04-23T21:16:15+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="必备环境与工具："><a href="#必备环境与工具：" class="headerlink" title="必备环境与工具："></a>必备环境与工具：</h2><p>1、Python和JavaScript的IDE或编辑器（Pycharm + WebStorm）<br>2、NodeJS库：Jsdom<br>3、采集页面:<a target="_blank" rel="noopener" href="https://www.qimingpian.cn/finosda/project/pinvestment">点这里跳转</a></p>
<h2 id="网站分析"><a href="#网站分析" class="headerlink" title="网站分析"></a>网站分析</h2><p>1、首先查看Source只找到了一堆JS引用，可以判定数据是动态加载的。查看XHR找到两个接口，猜测加密数据即是所需数据，如下图所示<br><img src="/images/7-qmp/1-xhr.png"></p>
<p>2、查找encrypt_data如何生成及如何解析，全局搜索<code>encrypt_data</code>关键字，分析存在该变量的位置</p>
<p>3、利用<code>productListVip</code>关键字XHR断点，由于此处是返回的加密数据需要寻找解密的位置，所以刷新页面到断点处后应该继续向下执行。</p>
<p><img src="/images/7-qmp/2-send.png"></p>
<p>4、但此处e.encrypt_data只是加密数据，继续往下调试，可以找到解密后的数据</p>
<p><img src="/images/7-qmp/3-data.png"></p>
<p>5、判定Object(d.a)(e.encrypt_data)即是所需解密数据，进入Object(d.a)函数体就能找到解密函数如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">o</span>(<span class="params">t</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">JSON</span>.parse(s(<span class="string">&quot;5e5062e82f15fe4ca9d24bc5&quot;</span>, a.a.decode(t), <span class="number">0</span>, <span class="number">0</span>, <span class="string">&quot;012345677890123&quot;</span>, <span class="number">1</span>))</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/7-qmp/4-option.gif"></p>
<p>6、除了a.a.decode(t)外其他三个都是固定的，复制相关JS代码比如s函数和decode函数，并补充需要的变量，经过webstorm调试输出验证可行。<br><img src="/images/7-qmp/5-result.png"></p>
<h2 id="登录POST参数分析"><a href="#登录POST参数分析" class="headerlink" title="登录POST参数分析"></a>登录POST参数分析</h2><p>1、该网站未登录状态下只能查看20条，登录状态下可查看40条。<br>2、看更多数据需要进行认证，且接口调用到一定次数会出现<code>极验</code>滑动验证码。<br><img src="/images/7-qmp/6-loginFlag.png"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/08/JsCrack%20%E6%B1%BD%E8%BD%A6%E4%B9%8B%E5%AE%B6%E8%BD%A6%E5%9E%8B%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/08/JsCrack%20%E6%B1%BD%E8%BD%A6%E4%B9%8B%E5%AE%B6%E8%BD%A6%E5%9E%8B%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">JsCrack 汽车之家车型配置</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-08 12:00:00" itemprop="dateCreated datePublished" datetime="2019-10-08T12:00:00+08:00">2019-10-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 20:58:45" itemprop="dateModified" datetime="2020-04-23T20:58:45+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、浅谈伪元素"><a href="#一、浅谈伪元素" class="headerlink" title="一、浅谈伪元素"></a>一、浅谈伪元素</h3><p>CSS伪元素是用来添加一些选择器的特殊效果。<br>常通过 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/content" title="CSS的 content CSS 属性用于在元素的  ::before 和 ::after 伪元素中插入内容。使用content 属性插入的内容都是匿名的可替换元素。"><code>content</code></a> 属性来为一个元素添加修饰性的内容。此元素默认为行内元素。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* CSS3 语法 */</span></span><br><span class="line"><span class="attribute">element</span>::before &#123; 样式 &#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">/* （单冒号）CSS2 过时语法 (仅用来支持 IE8) */</span></span><br><span class="line"><span class="attribute">element</span>:before  &#123; 样式 &#125;  </span><br><span class="line"></span><br><span class="line"><span class="attribute">h1</span>:before </span><br><span class="line">&#123;</span><br><span class="line">    <span class="attribute">content</span>:url(<span class="string">smiley.gif</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二、页面分析-以option为例"><a href="#二、页面分析-以option为例" class="headerlink" title="二、页面分析(以option为例)"></a>二、页面分析(以option为例)</h3><p>1、 该网页禁用了鼠标右键，可用Ctrl+Shift+I进入审查元素。</p>
<p>2、发现如下图的伪元素部分，但在源码中未找到<code>&lt;style&gt;&lt;/style&gt;</code>的相关内容。可以通过元素的getPropertyValue(‘content’)方法来获取CSS伪元素的content属性。<br><img src="/images/6-carHome/1-before.png"></p>
<p><strong>注</strong>：此处获取content未达到预期，因对getPropertyValue进行了重写，如下所示<br><img src="/images/6-catHome/2-content.png"></p>
<p>3、 可推测样式代码是动态加载的，仔细阅读<code>&lt;script&gt;&lt;/script&gt;</code>会发现如下代码，或者直接搜before也可发现此处。<br><img src="/images/6-carHome/3-style.png"></p>
<p>4、 将相应Js代码复制到snippet，在末尾处断点运行，发现两个变量<code>$ruleDict$</code>和<code>$rulePosList$</code>，可能包含了所需要的汉字与对应索引，如下图<br><img src="/images/6-carHome/4-rule.png"></p>
<p>5、 继续阅读代码进入<code>$RenderToHTML$()</code>函数，函数名很明显是渲染html页面，继续进入<code>$InsertRuleRun$()</code>函数，分析可以得出该函数根据索引生成before对应的文字。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">function <span class="symbol">$</span>InsertRuleRun<span class="symbol">$</span>() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="symbol">$</span>index<span class="symbol">$</span> = <span class="number">0</span>; <span class="symbol">$</span>index<span class="symbol">$</span> &lt; <span class="symbol">$</span>rulePosList<span class="symbol">$</span>.length; <span class="symbol">$</span>index<span class="symbol">$</span>++) &#123;</span><br><span class="line">		<span class="comment">// $rulePosList$ = [ &#x27;100&#x27;, &#x27;44,83&#x27;,  &#x27;94,108,53&#x27;,</span></span><br><span class="line">		var <span class="symbol">$</span>tempArray<span class="symbol">$</span> = <span class="symbol">$</span>Split<span class="symbol">$</span>(<span class="symbol">$</span>rulePosList<span class="symbol">$</span>[<span class="symbol">$</span>index<span class="symbol">$</span>], <span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">		var <span class="symbol">$</span>temp<span class="symbol">$</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		<span class="comment">// 一个索引对应多个文字的场景</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="symbol">$</span>itemIndex<span class="symbol">$</span> = <span class="number">0</span>; <span class="symbol">$</span>itemIndex<span class="symbol">$</span> &lt; <span class="symbol">$</span>tempArray<span class="symbol">$</span>.length; <span class="symbol">$</span>itemIndex<span class="symbol">$</span>++) &#123;</span><br><span class="line">			<span class="symbol">$</span>temp<span class="symbol">$</span> += <span class="symbol">$</span>ChartAt<span class="symbol">$</span>(<span class="symbol">$</span>tempArray<span class="symbol">$</span>[<span class="symbol">$</span>itemIndex<span class="symbol">$</span>]) + <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		console.info(<span class="string">&#x27;$InsertRuleRun$:&#x27;</span>, <span class="symbol">$</span>index<span class="symbol">$</span>, <span class="symbol">$</span>temp<span class="symbol">$</span>);</span><br><span class="line">		<span class="comment">// 索引与对应文字插入样式表</span></span><br><span class="line">		<span class="symbol">$</span>InsertRule<span class="symbol">$</span>(<span class="symbol">$</span>index<span class="symbol">$</span>, <span class="symbol">$</span>temp<span class="symbol">$</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function <span class="symbol">$</span>InsertRule<span class="symbol">$</span>(<span class="symbol">$</span>index<span class="symbol">$</span>, <span class="symbol">$</span>item<span class="symbol">$</span>) &#123;</span><br><span class="line">	<span class="comment">// myStyle.insertRule(&quot;#blanc &#123; color: white &#125;&quot;, 0);</span></span><br><span class="line">	<span class="symbol">$</span>sheet<span class="symbol">$</span>[<span class="string">&#x27;&#x27;</span> + io_(<span class="string">&#x27;in&#x27;</span>) + kl_() + (function(It__) &#123;</span><br><span class="line">			<span class="string">&#x27;return It_&#x27;</span>;</span><br><span class="line">			return It__;</span><br><span class="line">		&#125;</span><br><span class="line">	)(<span class="string">&#x27;er&#x27;</span>) + Zw_() + iI_() + Cm_() + (function() &#123;</span><br><span class="line">			<span class="string">&#x27;return mJ_&#x27;</span>;</span><br><span class="line">			return <span class="string">&#x27;le&#x27;</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="comment">// &#x27;.hs_kw&#x27; + $index$ + &#x27;_configAC&#x27;;&#x27; + ::before &#123; content:&#x27;+ &quot; $item$ ，参数0表示在样式表顶部插入新的规则</span></span><br><span class="line">	)()](<span class="symbol">$</span>GetClassName<span class="symbol">$</span>(<span class="symbol">$</span>index<span class="symbol">$</span>) + <span class="symbol">$</span>RuleCalss1<span class="symbol">$</span>() + <span class="string">&#x27;&quot;&#x27;</span> + <span class="symbol">$</span>item<span class="symbol">$</span> + <span class="string">&#x27;&quot; &#125;&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	console.<span class="built_in">log</span>(<span class="symbol">$</span>GetClassName<span class="symbol">$</span>(<span class="symbol">$</span>index<span class="symbol">$</span>) + <span class="symbol">$</span>RuleCalss1<span class="symbol">$</span>() + <span class="string">&#x27;&quot;&#x27;</span> + <span class="symbol">$</span>item<span class="symbol">$</span> + <span class="string">&#x27;&quot; &#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	var <span class="symbol">$</span>tempArray<span class="symbol">$</span> = <span class="symbol">$</span>GetElementsByCss<span class="symbol">$</span>(<span class="symbol">$</span>GetClassName<span class="symbol">$</span>(<span class="symbol">$</span>index<span class="symbol">$</span>));</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (x in <span class="symbol">$</span>tempArray<span class="symbol">$</span>) &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			<span class="symbol">$</span>tempArray<span class="symbol">$</span>[x].currentStyle = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">		&#125; catch (e) &#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function <span class="symbol">$</span>GetClassName<span class="symbol">$</span>(<span class="symbol">$</span>index<span class="symbol">$</span>) &#123;</span><br><span class="line">	<span class="comment">// 可见class变化的数字index是文字对应的索引</span></span><br><span class="line">	return <span class="string">&#x27;.hs_kw&#x27;</span> + <span class="symbol">$</span>index<span class="symbol">$</span> + <span class="string">&#x27;_configAC&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function <span class="symbol">$</span>RuleCalss1<span class="symbol">$</span>() &#123;</span><br><span class="line">	return <span class="string">&#x27;::before &#123; content:&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>6、重要混淆函数还原</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">混淆：$GetWindow$()[<span class="string">&#x27;&#x27;</span> + LD_() + ti_() + SE_() + YO_() + Je_() + ee_() + <span class="string">&#x27;St&#x27;</span> + CH_(<span class="string">&#x27;yl&#x27;</span>) + FZ_] </span><br><span class="line">解析：this.window.getComputedStyle</span><br><span class="line">混淆：<span class="symbol">$s</span>heet$[<span class="string">&#x27;&#x27;</span> + kj_() + jE_() + (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="string">&#x27;return si_&#x27;</span>; <span class="keyword">return</span> <span class="string">&#x27;R&#x27;</span>&#125;)() + qe_()]</span><br><span class="line">解析：style.sheet.insertRule</span><br></pre></td></tr></table></figure>

<p>7、document是浏览器中特有的一个全局变量，Jsdom可用来模拟浏览器的dom操作，添加如下Js代码并运行。</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const jsdom = <span class="built_in">require</span>(<span class="string">&quot;jsdom&quot;</span>);</span><br><span class="line">const &#123;JSDOM&#125; = jsdom;</span><br><span class="line">const dom = <span class="keyword">new</span> JSDOM();</span><br><span class="line"><span class="regexp">//</span> 存储返回 <span class="class"><span class="keyword">class</span> 和 文字</span></span><br><span class="line">var mydict= &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span> = dom.<span class="built_in">window</span>;</span><br><span class="line"><span class="built_in">document</span> = <span class="built_in">window</span>.<span class="built_in">document</span>;</span><br><span class="line"><span class="built_in">window</span>.<span class="built_in">decodeURIComponent</span> = <span class="built_in">decodeURIComponent</span>;</span><br></pre></td></tr></table></figure>

<p>8、上述分析只是生成<code>&lt;style&gt;</code>的部分，呈现的效果是如何实现的呢？<br>全局搜索source中没有，但Elements中存在的元素，如类名fontf，可以找到<code>config-min.js</code>文件。</p>
<p>9、接下来就是利用解析出来的字典进行替换，没有什么难度。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/07/JsCrack%20%E7%9F%A5%E4%B9%8E%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/07/JsCrack%20%E7%9F%A5%E4%B9%8E%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95/" class="post-title-link" itemprop="url">JsCrack 知乎模拟登录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-07 12:00:00" itemprop="dateCreated datePublished" datetime="2019-10-07T12:00:00+08:00">2019-10-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 20:39:38" itemprop="dateModified" datetime="2020-04-23T20:39:38+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="网址分析"><a href="#网址分析" class="headerlink" title="网址分析"></a>网址分析</h2><p>1、打上sign_in的XHR断点，可以发现此时参数已经被加密了，根据call stack不断向下回调，根据关键字body查看直到找到没加密的数据，如下图所示。<br><img src="/images/1-zhihu/zhihu-1.png"><br>2、可判断<code>r.default</code>用于将参数生成为加密字符串，追踪该函数可找到下图函数，<code>function(module, exports, __webpack_require__)&#123; &#125;</code>由这段代码可以看出是经过webpack打包后的，去掉外层函数，调用加密函数b。<br><img src="/images/1-zhihu/zhihu-2.png"><br>3、代码调试与问题解决：</p>
<ul>
<li>TypeError: __g._encrypt is not a function<br>解决：注意加密函数上方的<code>&quot;undefined&quot; != typeof window &amp;&amp; (new G).v</code>代码，通过window来判断是否在浏览器上运行，通过修改为<code>1 &amp;&amp; (new G).v</code>解决问题。</li>
<li>ReferenceError: atob is not defined<br>解决：atob 是将 base64 加密的字符串给解密，在 node 环境下是没有这个方法的，采用Buffer.from(e, ‘base64’).toString(‘binary’)替换。</li>
<li>输出与实际结果不符<br>解决：用html文件引入Js输出正常，但node下直接输出不符，考虑和环境参数有关，用Jsdom模拟window对象。</li>
</ul>
<h2 id="参数解析"><a href="#参数解析" class="headerlink" title="参数解析"></a>参数解析</h2><p><img src="/images/1-zhihu/zhihu-3.png"><br>1、timestamp 时间戳，直接用Python构造即可</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">timestamp</span> = str(<span class="type">int</span>(<span class="type">time</span>.time()*<span class="number">1000</span>))</span><br></pre></td></tr></table></figure>
<p>2、全局搜索signature，可找到下图位置<br><img src="/images/1-zhihu/zhihu-4.png"></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_signature</span><span class="params">(<span class="keyword">self</span>, timestamp)</span></span><span class="symbol">:</span></span><br><span class="line">    ha = hmac.new(b<span class="string">&#x27;d1b964811afb40118a12068ff74a12f4&#x27;</span>, digestmod=hashlib.sha1)</span><br><span class="line">    grant_type = <span class="keyword">self</span>.login_data[<span class="string">&#x27;grant_type&#x27;</span>]</span><br><span class="line">    client_id = <span class="keyword">self</span>.login_data[<span class="string">&#x27;client_id&#x27;</span>]</span><br><span class="line">    source = <span class="keyword">self</span>.login_data[<span class="string">&#x27;source&#x27;</span>]</span><br><span class="line">    ha.update(bytes((grant_type + client_id + source + timestamp), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> ha.hexdigest()</span><br></pre></td></tr></table></figure>
<p>3、其他参数基本是固定的，按照自己要求填写即可。<br>4、lang=’en’是字符验证码，’cn’则是中文汉字验证码。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/07/JsCrack%20%E6%B5%99%E6%B1%9F%E6%94%BF%E5%8A%A1JS%20%E6%B7%B7%E6%B7%86%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/07/JsCrack%20%E6%B5%99%E6%B1%9F%E6%94%BF%E5%8A%A1JS%20%E6%B7%B7%E6%B7%86%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">JsCrack 浙江政务JS混淆处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-07 12:00:00" itemprop="dateCreated datePublished" datetime="2019-10-07T12:00:00+08:00">2019-10-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 20:54:13" itemprop="dateModified" datetime="2020-04-23T20:54:13+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>采集浙江政务网事项时，遇到直接请求返回一堆JS代码，如下所示:<br>点击<a target="_blank" rel="noopener" href="http://www.zjzwfw.gov.cn/zjservice/item/detail/index.do?localInnerCode=5d3897f3-fd52-46a3-868c-7c271ad1789d&webId=8&eventType=2">示例网址</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;<span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">var arg1=&#x27;58D144B55D654665F61C1E42FC02C0AD30D92BEC&#x27;;</span></span><br><span class="line">var _0x4818=[&#x27;\x63\x73\x4b\x48\x77\x71\x4d\x49&#x27;,&#x27;\x5a\x73\x4b\x4a\x77\x72\x38\x56\x65\x41\x73\x79&#x27;,&#x27;\x55\x63\x4b\x69\x4e\x38\x4f\x2f\x77\x70\x6c\x77\x4d\x41\x3d\x3d&#x27;,&#x27;\x4a\x52\x38\x43\x54\x67\x3d\x3d&#x27;,&#x27;\x59\x73\x4f\x6e\x62\x53\x45\x51\x77\x37\x6f\x7a\x77\x71\x5a\x4b\x65\x73\x4b\x55\x77\x37\x6b\x77\x58\x38\x4f\x52\x49\x51\x3d\x3d&#x27;,&#x27;\x77\x37\x6f\x56\x53\x38\x4f\x53\x77\x6f\x50\x43\x6c\x33\x6a\x43\x68\x4d\x4b\x68\x77\x36\x48\x44\x6c\x73\x4b\x58\x77\x34\x73\x2f\x59\x73\x4f\x47&#x27;,&#x27;\x66\x77\x56\x6d\x49\x31\x41\x74\x77\x70\x6c\x61\x59\x38\x4f\x74\x77\x35\x63\x4e\x66\x53\x67\x70\x77\x36\x4d\x3d&#x27;,&#x27;\x4f\x63\x4f\x4e\x77\x72\x6a\x43\x71\x73\x4b\x78\x54\x47\x54\x43\x68\x73\x4f\x6a\x45\x57\x45\x38\x50\x63\x4f\x63\x4a\x38\x4b\x36&#x27;,&#x27;\x55\x38\x4b\x35\x4c\x63\x4f\x74\x77\x70\x56\x30\x45\x4d\x4f\x6b\x77\x34\x37\x44\x72\x4d\x4f\x58&#x27;,&#x27;\x48\x4d\x4f\x32\x77\x6f\x48\x43\x69\x4d\x4b\x39\x53\x6c\x58\x43\x6c\x63\x4f\x6f\x43\x31\x6b\x3d&#x27;,&#x27;\x61\x73\x4b\x49\x77\x71\x4d\x44\x64\x67\x4d\x75\x50\x73\x4f\x4b\x42\x4d\x4b\x63\x77\x72\x72\x43\x74\x6b\x4c\x44\x72\x4d\x4b\x42\x77\x36\x34\x64&#x27;,&#x27;\x77\x71\x49\x6d\x4d\x54\x30\x74\x77\x36\x52\x4e\x77\x35\x6b\x3d&#x27;,&#x27;\x44\x4d\x4b\x63\x55\x30\x4a\x6d\x55\x77\x55\x76&#x27;,&#x27;\x56\x6a\x48\x44\x6c\x4d\x4f\x48\x56\x63\x4f\x4e\x58\x33\x66\x44\x69\x63\x4b\x4a\x48\x51\x3d\x3d&#x27;,&#x27;\x77\x71\x68\x42\x48\x38\x4b\x6e\x77\x34\x54\x44\x68\x53\x44\x44\x67\x4d\x4f\x64\x77\x72\x6a\x43\x6e\x63\x4f\x57\x77\x70\x68\x68\x4e\x38\x4b\x43\x47\x63\x4b\x71\x77\x36\x64\x48\x41\x55\x35\x2b\x77\x72\x67\x32\x4a\x63\x4b\x61\x77\x34\x49\x45\x4a\x63\x4f\x63\x77\x72\x52\x4a\x77\x6f\x5a\x30\x77\x71\x46\x39\x59\x67\x41\x56&#x27;,&#x27;\x64\x7a\x64\x32\x77\x35\x62\x44\x6d\x33\x6a\x44\x70\x73\x4b\x33\x77\x70\x59\x3d&#x27;,&#x27;\x77\x34\x50\x44\x67\x63\x4b\x58\x77\x6f\x33\x43\x6b\x63\x4b\x4c\x77\x72\x35\x71\x77\x72\x59\x3d&#x27;,&#x27;\x77\x72\x4a\x4f\x54\x63\x4f\x51\x57\x4d\x4f\x67&#x27;,&#x27;\x77\x71\x54\x44\x76\x63\x4f\x6a\x77\x34\x34\x37\x77\x72\x34\x3d&#x27;,&#x27;\x77\x35\x58\x44\x71\x73\x4b\x68\x4d\x46\x31\x2f&#x27;,&#x27;\x77\x72\x41\x79\x48\x73\x4f\x66\x77\x70\x70\x63&#x27;,&#x27;\x4a\x33\x64\x56\x50\x63\x4f\x78\x4c\x67\x3d\x3d&#x27;,&#x27;\x77\x72\x64\x48\x77\x37\x70\x39\x5a\x77\x3d\x3d&#x27;,&#x27;\x77\x34\x72\x44\x6f\x38\x4b\x6d\x4e\x45\x77\x3d&#x27;,&#x27;\x49\x4d\x4b\x41\x55\x6b\x42\x74&#x27;,&#x27;\x77\x36\x62\x44\x72\x63\x4b\x51\x77\x70\x56\x48\x77\x70\x4e\x51\x77\x71\x55\x3d&#x27;,&#x27;\x64\x38\x4f\x73\x57\x68\x41\x55\x77\x37\x59\x7a\x77\x72\x55\x3d&#x27;,&#x27;\x77\x71\x6e\x43\x6b\x73\x4f\x65\x65\x7a\x72\x44\x68\x77\x3d\x3d&#x27;,&#x27;\x55\x73\x4b\x6e\x49\x4d\x4b\x57\x56\x38\x4b\x2f&#x27;,&#x27;\x77\x34\x7a\x44\x6f\x63\x4b\x38\x4e\x55\x5a\x76&#x27;,&#x27;\x63\x38\x4f\x78\x5a\x68\x41\x4a\x77\x36\x73\x6b\x77\x71\x4a\x6a&#x27;,&#x27;\x50\x63\x4b\x49\x77\x34\x6e\x43\x6b\x6b\x56\x62&#x27;,&#x27;\x4b\x48\x67\x6f\x64\x4d\x4f\x32\x56\x51\x3d\x3d&#x27;,&#x27;\x77\x70\x73\x6d\x77\x71\x76\x44\x6e\x47\x46\x71&#x27;,&#x27;\x77\x71\x4c\x44\x74\x38\x4f\x6b\x77\x34\x63\x3d&#x27;,&#x27;\x77\x37\x77\x31\x77\x34\x50\x43\x70\x73\x4f\x34\x77\x71\x41\x3d&#x27;,&#x27;\x77\x71\x39\x46\x52\x73\x4f\x71\x57\x4d\x4f\x71&#x27;,&#x27;\x62\x79\x42\x68\x77\x37\x72\x44\x6d\x33\x34\x3d&#x27;,&#x27;\x4c\x48\x67\x2b\x53\x38\x4f\x74\x54\x77\x3d\x3d&#x27;,&#x27;\x77\x71\x68\x4f\x77\x37\x31\x35\x64\x73\x4f\x48&#x27;,&#x27;\x55\x38\x4f\x37\x56\x73\x4f\x30\x77\x71\x76\x44\x76\x63\x4b\x75\x4b\x73\x4f\x71\x58\x38\x4b\x72&#x27;,&#x27;\x59\x69\x74\x74\x77\x35\x44\x44\x6e\x57\x6e\x44\x72\x41\x3d\x3d&#x27;,&#x27;\x59\x4d\x4b\x49\x77\x71\x55\x55\x66\x67\x49\x6b&#x27;,&#x27;\x61\x42\x37\x44\x6c\x4d\x4f\x44\x54\x51\x3d\x3d&#x27;,&#x27;\x77\x70\x66\x44\x68\x38\x4f\x72\x77\x36\x6b\x6b&#x27;,&#x27;\x77\x37\x76\x43\x71\x4d\x4f\x72\x59\x38\x4b\x41\x56\x6b\x35\x4f\x77\x70\x6e\x43\x75\x38\x4f\x61\x58\x73\x4b\x5a\x50\x33\x44\x43\x6c\x63\x4b\x79\x77\x36\x48\x44\x72\x51\x3d\x3d&#x27;,&#x27;\x77\x6f\x77\x2b\x77\x36\x76\x44\x6d\x48\x70\x73\x77\x37\x52\x74\x77\x6f\x39\x38\x4c\x43\x37\x43\x69\x47\x37\x43\x6b\x73\x4f\x52\x54\x38\x4b\x6c\x57\x38\x4f\x35\x77\x72\x33\x44\x69\x38\x4f\x54\x48\x73\x4f\x44\x65\x48\x6a\x44\x6d\x63\x4b\x6c\x4a\x73\x4b\x71\x56\x41\x3d\x3d&#x27;,&#x27;\x4e\x77\x56\x2b&#x27;,&#x27;\x77\x37\x48\x44\x72\x63\x4b\x74\x77\x70\x4a\x61\x77\x70\x5a\x62&#x27;,&#x27;\x77\x70\x51\x73\x77\x71\x76\x44\x69\x48\x70\x75\x77\x36\x49\x3d&#x27;,&#x27;\x59\x4d\x4b\x55\x77\x71\x4d\x4a\x5a\x51\x3d\x3d&#x27;,&#x27;\x4b\x48\x31\x56\x4b\x63\x4f\x71\x4b\x73\x4b\x31&#x27;,&#x27;\x66\x51\x35\x73\x46\x55\x6b\x6b\x77\x70\x49\x3d&#x27;,&#x27;\x77\x72\x76\x43\x72\x63\x4f\x42\x52\x38\x4b\x6b&#x27;,&#x27;\x4d\x33\x77\x30\x66\x51\x3d\x3d&#x27;,&#x27;\x77\x36\x78\x58\x77\x71\x50\x44\x76\x4d\x4f\x46\x77\x6f\x35\x64&#x27;];(function(_0x4c97f0,_0x1742fd)&#123;var _0x4db1c=function(_0x48181e)&#123;while(--_0x48181e)&#123;_0x4c97f0[&#x27;\x70\x75\x73\x68&#x27;](_0x4c97f0[&#x27;\x73\x68\x69\x66\x74&#x27;]());&#125;&#125;;var _0x3cd6c6=function()&#123;var _0xb8360b=&#123;&#x27;\x64\x61\x74\x61&#x27;:&#123;&#x27;\x6b\x65\x79&#x27;:&#x27;\x63\x6f\x6f\x6b\x69\x65&#x27;,&#x27;\x76\x61\x6c\x75\x65&#x27;:&#x27;\x74\x69\x6d\x65\x6f\x75\x74&#x27;&#125;,&#x27;\x73\x65\x74\x43\x6f\x6f\x6b\x69\x65&#x27;:function(_0x20bf34,_0x3e840e,_0x5693d3,_0x5e8b26)&#123;_0x5e8b26=_0x5e8b26||&#123;&#125;;var _0xba82f0=_0x3e840e+&#x27;\x3d&#x27;+_0x5693d3;var _0x5afe31=0x0;for(var _0x5afe31=0x0,_0x178627=_0x20bf34[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];_0x5afe31&lt;_0x178627;_0x5afe31++)&#123;var _0x41b2ff=_0x20bf34[_0x5afe31];_0xba82f0+=&#x27;\x3b\x20&#x27;+_0x41b2ff;var _0xd79219=_0x20bf34[_0x41b2ff];_0x20bf34[&#x27;\x70\x75\x73\x68&#x27;](_0xd79219);_0x178627=_0x20bf34[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];if(_0xd79219!==!![])&#123;_0xba82f0+=&#x27;\x3d&#x27;+_0xd79219;&#125;&#125;_0x5e8b26[&#x27;\x63\x6f\x6f\x6b\x69\x65&#x27;]=_0xba82f0;&#125;,&#x27;\x72\x65\x6d\x6f\x76\x65\x43\x6f\x6f\x6b\x69\x65&#x27;:function()&#123;return&#x27;\x64\x65\x76&#x27;;&#125;,&#x27;\x67\x65\x74\x43\x6f\x6f\x6b\x69\x65&#x27;:function(_0x4a11fe,_0x189946)&#123;_0x4a11fe=_0x4a11fe||function(_0x6259a2)&#123;return _0x6259a2;&#125;;var _0x25af93=_0x4a11fe(new RegExp(&#x27;\x28\x3f\x3a\x5e\x7c\x3b\x20\x29&#x27;+_0x189946[&#x27;\x72\x65\x70\x6c\x61\x63\x65&#x27;](/([.$?*|&#123;&#125;()[]\/+^])/g,&#x27;\x24\x31&#x27;)+&#x27;\x3d\x28\x5b\x5e\x3b\x5d\x2a\x29&#x27;));var _0x52d57c=function(_0x105f59,_0x3fd789)&#123;_0x105f59(++_0x3fd789);&#125;;_0x52d57c(_0x4db1c,_0x1742fd);return _0x25af93?decodeURIComponent(_0x25af93[0x1]):undefined;&#125;&#125;;var _0x4a2aed=function()&#123;var _0x124d17=new RegExp(&#x27;\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d&#x27;);return _0x124d17[&#x27;\x74\x65\x73\x74&#x27;](_0xb8360b[&#x27;\x72\x65\x6d\x6f\x76\x65\x43\x6f\x6f\x6b\x69\x65&#x27;][&#x27;\x74\x6f\x53\x74\x72\x69\x6e\x67&#x27;]());&#125;;_0xb8360b[&#x27;\x75\x70\x64\x61\x74\x65\x43\x6f\x6f\x6b\x69\x65&#x27;]=_0x4a2aed;var _0x2d67ec=&#x27;&#x27;;var _0x120551=_0xb8360b[&#x27;\x75\x70\x64\x61\x74\x65\x43\x6f\x6f\x6b\x69\x65&#x27;]();if(!_0x120551)&#123;_0xb8360b[&#x27;\x73\x65\x74\x43\x6f\x6f\x6b\x69\x65&#x27;]([&#x27;\x2a&#x27;],&#x27;\x63\x6f\x75\x6e\x74\x65\x72&#x27;,0x1);&#125;else if(_0x120551)&#123;_0x2d67ec=_0xb8360b[&#x27;\x67\x65\x74\x43\x6f\x6f\x6b\x69\x65&#x27;](null,&#x27;\x63\x6f\x75\x6e\x74\x65\x72&#x27;);&#125;else&#123;_0xb8360b[&#x27;\x72\x65\x6d\x6f\x76\x65\x43\x6f\x6f\x6b\x69\x65&#x27;]();&#125;&#125;;_0x3cd6c6();&#125;(_0x4818,0x15b));var _0x55f3=function(_0x4c97f0,_0x1742fd)&#123;var _0x4c97f0=parseInt(_0x4c97f0,0x10);var _0x48181e=_0x4818[_0x4c97f0];if(!_0x55f3[&#x27;\x61\x74\x6f\x62\x50\x6f\x6c\x79\x66\x69\x6c\x6c\x41\x70\x70\x65\x6e\x64\x65\x64&#x27;])&#123;(function()&#123;var _0xdf49c6=Function(&#x27;\x72\x65\x74\x75\x72\x6e\x20\x28\x66\x75\x6e\x63\x74\x69\x6f\x6e\x20\x28\x29\x20&#x27;+&#x27;\x7b\x7d\x2e\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72\x28\x22\x72\x65\x74\x75\x72\x6e\x20\x74\x68\x69\x73\x22\x29\x28\x29&#x27;+&#x27;\x29\x3b&#x27;);var _0xb8360b=_0xdf49c6();var _0x389f44=&#x27;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x2b\x2f\x3d&#x27;;_0xb8360b[&#x27;\x61\x74\x6f\x62&#x27;]||(_0xb8360b[&#x27;\x61\x74\x6f\x62&#x27;]=function(_0xba82f0)&#123;var _0xec6bb4=String(_0xba82f0)[&#x27;\x72\x65\x70\x6c\x61\x63\x65&#x27;](/=+$/,&#x27;&#x27;);for(var _0x1a0f04=0x0,_0x18c94e,_0x41b2ff,_0xd79219=0x0,_0x5792f7=&#x27;&#x27;;_0x41b2ff=_0xec6bb4[&#x27;\x63\x68\x61\x72\x41\x74&#x27;](_0xd79219++);~_0x41b2ff&amp;&amp;(_0x18c94e=_0x1a0f04%0x4?_0x18c94e*0x40+_0x41b2ff:_0x41b2ff,_0x1a0f04++%0x4)?_0x5792f7+=String[&#x27;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&#x27;](0xff&amp;_0x18c94e&gt;&gt;(-0x2*_0x1a0f04&amp;0x6)):0x0)&#123;_0x41b2ff=_0x389f44[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;](_0x41b2ff);&#125;return _0x5792f7;&#125;);&#125;());_0x55f3[&#x27;\x61\x74\x6f\x62\x50\x6f\x6c\x79\x66\x69\x6c\x6c\x41\x70\x70\x65\x6e\x64\x65\x64&#x27;]=!![];&#125;if(!_0x55f3[&#x27;\x72\x63\x34&#x27;])&#123;var _0x232678=function(_0x401af1,_0x532ac0)&#123;var _0x45079a=[],_0x52d57c=0x0,_0x105f59,_0x3fd789=&#x27;&#x27;,_0x4a2aed=&#x27;&#x27;;_0x401af1=atob(_0x401af1);for(var _0x124d17=0x0,_0x1b9115=_0x401af1[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];_0x124d17&lt;_0x1b9115;_0x124d17++)&#123;_0x4a2aed+=&#x27;\x25&#x27;+(&#x27;\x30\x30&#x27;+_0x401af1[&#x27;\x63\x68\x61\x72\x43\x6f\x64\x65\x41\x74&#x27;](_0x124d17)[&#x27;\x74\x6f\x53\x74\x72\x69\x6e\x67&#x27;](0x10))[&#x27;\x73\x6c\x69\x63\x65&#x27;](-0x2);&#125;_0x401af1=decodeURIComponent(_0x4a2aed);for(var _0x2d67ec=0x0;_0x2d67ec&lt;0x100;_0x2d67ec++)&#123;_0x45079a[_0x2d67ec]=_0x2d67ec;&#125;for(_0x2d67ec=0x0;_0x2d67ec&lt;0x100;_0x2d67ec++)&#123;_0x52d57c=(_0x52d57c+_0x45079a[_0x2d67ec]+_0x532ac0[&#x27;\x63\x68\x61\x72\x43\x6f\x64\x65\x41\x74&#x27;](_0x2d67ec%_0x532ac0[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;]))%0x100;_0x105f59=_0x45079a[_0x2d67ec];_0x45079a[_0x2d67ec]=_0x45079a[_0x52d57c];_0x45079a[_0x52d57c]=_0x105f59;&#125;_0x2d67ec=0x0;_0x52d57c=0x0;for(var _0x4e5ce2=0x0;_0x4e5ce2&lt;_0x401af1[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];_0x4e5ce2++)&#123;_0x2d67ec=(_0x2d67ec+0x1)%0x100;_0x52d57c=(_0x52d57c+_0x45079a[_0x2d67ec])%0x100;_0x105f59=_0x45079a[_0x2d67ec];_0x45079a[_0x2d67ec]=_0x45079a[_0x52d57c];_0x45079a[_0x52d57c]=_0x105f59;_0x3fd789+=String[&#x27;\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65&#x27;](_0x401af1[&#x27;\x63\x68\x61\x72\x43\x6f\x64\x65\x41\x74&#x27;](_0x4e5ce2)^_0x45079a[(_0x45079a[_0x2d67ec]+_0x45079a[_0x52d57c])%0x100]);&#125;return _0x3fd789;&#125;;_0x55f3[&#x27;\x72\x63\x34&#x27;]=_0x232678;&#125;if(!_0x55f3[&#x27;\x64\x61\x74\x61&#x27;])&#123;_0x55f3[&#x27;\x64\x61\x74\x61&#x27;]=&#123;&#125;;&#125;if(_0x55f3[&#x27;\x64\x61\x74\x61&#x27;][_0x4c97f0]===undefined)&#123;if(!_0x55f3[&#x27;\x6f\x6e\x63\x65&#x27;])&#123;var _0x5f325c=function(_0x23a392)&#123;this[&#x27;\x72\x63\x34\x42\x79\x74\x65\x73&#x27;]=_0x23a392;this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;]=[0x1,0x0,0x0];this[&#x27;\x6e\x65\x77\x53\x74\x61\x74\x65&#x27;]=function()&#123;return&#x27;\x6e\x65\x77\x53\x74\x61\x74\x65&#x27;;&#125;;this[&#x27;\x66\x69\x72\x73\x74\x53\x74\x61\x74\x65&#x27;]=&#x27;\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a&#x27;;this[&#x27;\x73\x65\x63\x6f\x6e\x64\x53\x74\x61\x74\x65&#x27;]=&#x27;\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d&#x27;;&#125;;_0x5f325c[&#x27;\x70\x72\x6f\x74\x6f\x74\x79\x70\x65&#x27;][&#x27;\x63\x68\x65\x63\x6b\x53\x74\x61\x74\x65&#x27;]=function()&#123;var _0x19f809=new RegExp(this[&#x27;\x66\x69\x72\x73\x74\x53\x74\x61\x74\x65&#x27;]+this[&#x27;\x73\x65\x63\x6f\x6e\x64\x53\x74\x61\x74\x65&#x27;]);return this[&#x27;\x72\x75\x6e\x53\x74\x61\x74\x65&#x27;](_0x19f809[&#x27;\x74\x65\x73\x74&#x27;](this[&#x27;\x6e\x65\x77\x53\x74\x61\x74\x65&#x27;][&#x27;\x74\x6f\x53\x74\x72\x69\x6e\x67&#x27;]())?--this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;][0x1]:--this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;][0x0]);&#125;;_0x5f325c[&#x27;\x70\x72\x6f\x74\x6f\x74\x79\x70\x65&#x27;][&#x27;\x72\x75\x6e\x53\x74\x61\x74\x65&#x27;]=function(_0x4380bd)&#123;if(!Boolean(~_0x4380bd))&#123;return _0x4380bd;&#125;return this[&#x27;\x67\x65\x74\x53\x74\x61\x74\x65&#x27;](this[&#x27;\x72\x63\x34\x42\x79\x74\x65\x73&#x27;]);&#125;;_0x5f325c[&#x27;\x70\x72\x6f\x74\x6f\x74\x79\x70\x65&#x27;][&#x27;\x67\x65\x74\x53\x74\x61\x74\x65&#x27;]=function(_0x58d85e)&#123;for(var _0x1c9f5b=0x0,_0x1ce9e0=this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;][&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];_0x1c9f5b&lt;_0x1ce9e0;_0x1c9f5b++)&#123;this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;][&#x27;\x70\x75\x73\x68&#x27;](Math[&#x27;\x72\x6f\x75\x6e\x64&#x27;](Math[&#x27;\x72\x61\x6e\x64\x6f\x6d&#x27;]()));_0x1ce9e0=this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;][&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];&#125;return _0x58d85e(this[&#x27;\x73\x74\x61\x74\x65\x73&#x27;][0x0]);&#125;;new _0x5f325c(_0x55f3)[&#x27;\x63\x68\x65\x63\x6b\x53\x74\x61\x74\x65&#x27;]();_0x55f3[&#x27;\x6f\x6e\x63\x65&#x27;]=!![];&#125;_0x48181e=_0x55f3[&#x27;\x72\x63\x34&#x27;](_0x48181e,_0x1742fd);_0x55f3[&#x27;\x64\x61\x74\x61&#x27;][_0x4c97f0]=_0x48181e;&#125;else&#123;_0x48181e=_0x55f3[&#x27;\x64\x61\x74\x61&#x27;][_0x4c97f0];&#125;return _0x48181e;&#125;;var arg3=null;var arg4=null;var arg5=null;var arg6=null;var arg7=null;var arg8=null;var arg9=null;var arg10=null;var l=function()&#123;while(window[_0x55f3(&#x27;0x1&#x27;, &#x27;\x58\x4d\x57\x5e&#x27;)]||window[&#x27;\x5f\x5f\x70\x68\x61\x6e\x74\x6f\x6d\x61\x73&#x27;])&#123;&#125;;var _0x5e8b26=_0x55f3(&#x27;0x3&#x27;, &#x27;\x6a\x53\x31\x59&#x27;);String[_0x55f3(&#x27;0x5&#x27;, &#x27;\x6e\x5d\x66\x52&#x27;)][_0x55f3(&#x27;0x6&#x27;, &#x27;\x50\x67\x35\x34&#x27;)]=function(_0x4e08d8)&#123;var _0x5a5d3b=&#x27;&#x27;;for(var _0xe89588=0x0;_0xe89588&lt;this[_0x55f3(&#x27;0x8&#x27;, &#x27;\x29\x68\x52\x63&#x27;)]&amp;&amp;_0xe89588&lt;_0x4e08d8[_0x55f3(&#x27;0xa&#x27;, &#x27;\x6a\x45\x26\x5e&#x27;)];_0xe89588+=0x2)&#123;var _0x401af1=parseInt(this[_0x55f3(&#x27;0xb&#x27;, &#x27;\x56\x32\x4b\x45&#x27;)](_0xe89588,_0xe89588+0x2),0x10);var _0x105f59=parseInt(_0x4e08d8[_0x55f3(&#x27;0xd&#x27;, &#x27;\x58\x4d\x57\x5e&#x27;)](_0xe89588,_0xe89588+0x2),0x10);var _0x189e2c=(_0x401af1^_0x105f59)[_0x55f3(&#x27;0xf&#x27;, &#x27;\x57\x31\x46\x45&#x27;)](0x10);if(_0x189e2c[_0x55f3(&#x27;0x11&#x27;, &#x27;\x4d\x47\x72\x76&#x27;)]==0x1)&#123;_0x189e2c=&#x27;\x30&#x27;+_0x189e2c;&#125;_0x5a5d3b+=_0x189e2c;&#125;return _0x5a5d3b;&#125;;String[&#x27;\x70\x72\x6f\x74\x6f\x74\x79\x70\x65&#x27;][_0x55f3(&#x27;0x14&#x27;, &#x27;\x5a\x2a\x44\x4d&#x27;)]=function()&#123;var _0x4b082b=[0xf,0x23,0x1d,0x18,0x21,0x10,0x1,0x26,0xa,0x9,0x13,0x1f,0x28,0x1b,0x16,0x17,0x19,0xd,0x6,0xb,0x27,0x12,0x14,0x8,0xe,0x15,0x20,0x1a,0x2,0x1e,0x7,0x4,0x11,0x5,0x3,0x1c,0x22,0x25,0xc,0x24];var _0x4da0dc=[];var _0x12605e=&#x27;&#x27;;for(var _0x20a7bf=0x0;_0x20a7bf&lt;this[&#x27;\x6c\x65\x6e\x67\x74\x68&#x27;];_0x20a7bf++)&#123;var _0x385ee3=this[_0x20a7bf];for(var _0x217721=0x0;_0x217721&lt;_0x4b082b[_0x55f3(&#x27;0x16&#x27;, &#x27;\x61\x48\x2a\x4e&#x27;)];_0x217721++)&#123;if(_0x4b082b[_0x217721]==_0x20a7bf+0x1)&#123;_0x4da0dc[_0x217721]=_0x385ee3;&#125;&#125;&#125;_0x12605e=_0x4da0dc[&#x27;\x6a\x6f\x69\x6e&#x27;](&#x27;&#x27;);return _0x12605e;&#125;;var _0x23a392=arg1[_0x55f3(&#x27;0x19&#x27;, &#x27;\x50\x67\x35\x34&#x27;)]();arg2=_0x23a392[_0x55f3(&#x27;0x1b&#x27;, &#x27;\x7a\x35\x4f\x26&#x27;)](_0x5e8b26);setTimeout(&#x27;\x72\x65\x6c\x6f\x61\x64\x28\x61\x72\x67\x32\x29&#x27;,0x66a);&#125;;var _0x4db1c=function()&#123;function _0x355d23(_0x450614)&#123;if((&#x27;&#x27;+_0x450614/_0x450614)[_0x55f3(&#x27;0x1c&#x27;, &#x27;\x56\x32\x4b\x45&#x27;)]!==0x1||_0x450614%0x14===0x0)&#123;(function()&#123;&#125;[_0x55f3(&#x27;0x1d&#x27;, &#x27;\x43\x4e\x55\x59&#x27;)]((undefined+&#x27;&#x27;)[0x2]+(!![]+&#x27;&#x27;)[0x3]+([][_0x55f3(&#x27;0x1e&#x27;, &#x27;\x77\x38\x50\x52&#x27;)]()+&#x27;&#x27;)[0x2]+(undefined+&#x27;&#x27;)[0x0]+(![]+[0x0]+String)[0x14]+(![]+[0x0]+String)[0x14]+(!![]+&#x27;&#x27;)[0x3]+(!![]+&#x27;&#x27;)[0x1])());&#125;else&#123;(function()&#123;&#125;[&#x27;\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72&#x27;]((undefined+&#x27;&#x27;)[0x2]+(!![]+&#x27;&#x27;)[0x3]+([][_0x55f3(&#x27;0x1f&#x27;, &#x27;\x4c\x24\x28\x44&#x27;)]()+&#x27;&#x27;)[0x2]+(undefined+&#x27;&#x27;)[0x0]+(![]+[0x0]+String)[0x14]+(![]+[0x0]+String)[0x14]+(!![]+&#x27;&#x27;)[0x3]+(!![]+&#x27;&#x27;)[0x1])());&#125;_0x355d23(++_0x450614);&#125;try&#123;_0x355d23(0x0);&#125;catch(_0x54c483)&#123;&#125;&#125;;if(function()&#123;var _0x470d8f=function()&#123;var _0x4c97f0=!![];return function(_0x1742fd,_0x4db1c)&#123;var _0x48181e=_0x4c97f0?function()&#123;if(_0x4db1c)&#123;var _0x55f3be=_0x4db1c[&#x27;\x61\x70\x70\x6c\x79&#x27;](_0x1742fd,arguments);_0x4db1c=null;return _0x55f3be;&#125;&#125;:function()&#123;&#125;;_0x4c97f0=![];return _0x48181e;&#125;;&#125;();var _0x501fd7=_0x470d8f(this,function()&#123;var _0x4c97f0=function()&#123;return&#x27;\x64\x65\x76&#x27;;&#125;,_0x1742fd=function()&#123;return&#x27;\x77\x69\x6e\x64\x6f\x77&#x27;;&#125;;var _0x55f3be=function()&#123;var _0x3ad9a1=new RegExp(&#x27;\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d&#x27;);return!_0x3ad9a1[&#x27;\x74\x65\x73\x74&#x27;](_0x4c97f0[&#x27;\x74\x6f\x53\x74\x72\x69\x6e\x67&#x27;]());&#125;;var _0x1b93ad=function()&#123;var _0x20bf34=new RegExp(&#x27;\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b&#x27;);return _0x20bf34[&#x27;\x74\x65\x73\x74&#x27;](_0x1742fd[&#x27;\x74\x6f\x53\x74\x72\x69\x6e\x67&#x27;]());&#125;;var _0x5afe31=function(_0x178627)&#123;var _0x1a0f04=~-0x1&gt;&gt;0x1+0xff%0x0;if(_0x178627[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;](&#x27;\x69&#x27;===_0x1a0f04))&#123;_0xd79219(_0x178627);&#125;&#125;;var _0xd79219=function(_0x5792f7)&#123;var _0x4e08d8=~-0x4&gt;&gt;0x1+0xff%0x0;if(_0x5792f7[&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;]((!![]+&#x27;&#x27;)[0x3])!==_0x4e08d8)&#123;_0x5afe31(_0x5792f7);&#125;&#125;;if(!_0x55f3be())&#123;if(!_0x1b93ad())&#123;_0x5afe31(&#x27;\x69\x6e\x64\u0435\x78\x4f\x66&#x27;);&#125;else&#123;_0x5afe31(&#x27;\x69\x6e\x64\x65\x78\x4f\x66&#x27;);&#125;&#125;else&#123;_0x5afe31(&#x27;\x69\x6e\x64\u0435\x78\x4f\x66&#x27;);&#125;&#125;);_0x501fd7();var _0x3a394d=function()&#123;var _0x1ab151=!![];return function(_0x372617,_0x42d229)&#123;var _0x3b3503=_0x1ab151?function()&#123;if(_0x42d229)&#123;var _0x7086d9=_0x42d229[_0x55f3(&#x27;0x21&#x27;, &#x27;\x4b\x4e\x29\x46&#x27;)](_0x372617,arguments);_0x42d229=null;return _0x7086d9;&#125;&#125;:function()&#123;&#125;;_0x1ab151=![];return _0x3b3503;&#125;;&#125;();var _0x5b6351=_0x3a394d(this,function()&#123;var _0x46cbaa=Function(_0x55f3(&#x27;0x22&#x27;, &#x27;\x26\x68\x5a\x59&#x27;)+_0x55f3(&#x27;0x23&#x27;, &#x27;\x61\x48\x2a\x4e&#x27;)+&#x27;\x29\x3b&#x27;);var _0x1766ff=function()&#123;&#125;;var _0x9b5e29=_0x46cbaa();_0x9b5e29[_0x55f3(&#x27;0x26&#x27;, &#x27;\x61\x48\x2a\x4e&#x27;)][&#x27;\x6c\x6f\x67&#x27;]=_0x1766ff;_0x9b5e29[_0x55f3(&#x27;0x29&#x27;, &#x27;\x56\x25\x59\x52&#x27;)][_0x55f3(&#x27;0x2a&#x27;, &#x27;\x50\x5e\x45\x71&#x27;)]=_0x1766ff;_0x9b5e29[_0x55f3(&#x27;0x2c&#x27;, &#x27;\x6c\x67\x4d\x30&#x27;)][_0x55f3(&#x27;0x2d&#x27;, &#x27;\x4c\x24\x28\x44&#x27;)]=_0x1766ff;_0x9b5e29[_0x55f3(&#x27;0x2f&#x27;, &#x27;\x43\x5a\x63\x38&#x27;)][_0x55f3(&#x27;0x30&#x27;, &#x27;\x57\x75\x36\x25&#x27;)]=_0x1766ff;&#125;);_0x5b6351();try&#123;return!!window[&#x27;\x61\x64\x64\x45\x76\x65\x6e\x74\x4c\x69\x73\x74\x65\x6e\x65\x72&#x27;];&#125;catch(_0x35538d)&#123;return![];&#125;&#125;())&#123;document[_0x55f3(&#x27;0x33&#x27;, &#x27;\x56\x25\x59\x52&#x27;)](_0x55f3(&#x27;0x34&#x27;, &#x27;\x79\x41\x70\x7a&#x27;),l,![]);&#125;else&#123;document[_0x55f3(&#x27;0x36&#x27;, &#x27;\x79\x41\x70\x7a&#x27;)](_0x55f3(&#x27;0x37&#x27;, &#x27;\x4c\x24\x28\x44&#x27;),l);&#125;_0x4db1c();setInterval(function()&#123;_0x4db1c();&#125;,0xfa0);</span><br><span class="line">        </span><br><span class="line">function setCookie(name,value)&#123;var expiredate=new Date();expiredate.setTime(expiredate.getTime()+(3600*1000));document.cookie=name+&quot;=&quot;+value+&quot;;expires=&quot;+expiredate.toGMTString()+&quot;;max-age=3600;path=/&quot;;&#125;</span><br><span class="line">function reload(x) &#123;setCookie(&quot;acw_sc__v2&quot;, x);document.location.reload();&#125;</span><br><span class="line">&lt;/script&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="反调试处理"><a href="#反调试处理" class="headerlink" title="反调试处理"></a>反调试处理</h2><p>1、重写函数表达式即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_0x355d23 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/5-zjzw/zjzw1.png" alt="断点"></p>
<h2 id="代码格式化"><a href="#代码格式化" class="headerlink" title="代码格式化"></a>代码格式化</h2><p>1、工具：<a target="_blank" rel="noopener" href="https://beautifier.io/">https://beautifier.io/</a><br><img src="/images/5-zjzw/zjzw2.png"><br><strong>注</strong>：勾选箭头所示选项否则不能解析”\x”字符</p>
<p>2、自己写的解析脚本（有Bug无法处理正则部分转义）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse16</span>():</span></span><br><span class="line">    content = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;xxx.js&#x27;</span>, <span class="string">&#x27;r+&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        content = f.read()</span><br><span class="line">        <span class="comment"># 匹配16进制字符串</span></span><br><span class="line">        pattern = re.compile(<span class="string">r&#x27;\\x[a-zA-Z0-9]&#123;2&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> pattern.findall(content):</span><br><span class="line">            <span class="comment"># 解码并替换16进制字符串</span></span><br><span class="line">            content = content.replace(i, i.encode(<span class="string">&#x27;utf-8&#x27;</span>).decode(<span class="string">&#x27;unicode_escape&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;xxx.js&#x27;</span>, <span class="string">&#x27;w+&#x27;</span>, encoding=<span class="string">&#x27;utf8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(content)</span><br></pre></td></tr></table></figure>

<h2 id="Cookie分析"><a href="#Cookie分析" class="headerlink" title="Cookie分析"></a>Cookie分析</h2><p>从如下函数即可看出，设置cookie后刷新该页，从此图可验证：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reload</span>(<span class="params">x</span>) </span>&#123;setCookie(<span class="string">&quot;acw_sc__v2&quot;</span>, x);<span class="built_in">document</span>.location.reload();&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/5-zjzw/zjzw3.png"></p>
<h2 id="acw-sc-v2如何生成"><a href="#acw-sc-v2如何生成" class="headerlink" title="acw_sc__v2如何生成"></a>acw_sc__v2如何生成</h2><p>arg2是通过执行_0x23a392[_0x55f3(‘0x1b’, ‘z5O&amp;’)] 函数返回得到，实参是 _0x5e8b26。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x23a392 = arg1[_0x55f3(<span class="string">&#x27;0x19&#x27;</span>, <span class="string">&#x27;Pg54&#x27;</span>)]();</span><br><span class="line">arg2 = _0x23a392[_0x55f3(<span class="string">&#x27;0x1b&#x27;</span>, <span class="string">&#x27;z5O&amp;&#x27;</span>)](_0x5e8b26);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="string">&#x27;reload(arg2)&#x27;</span>, <span class="number">0x66a</span>);</span><br></pre></td></tr></table></figure>

<h3 id="第一部分（匿名函数）：此函数是用于对大数组-0x4818-进行操作。"><a href="#第一部分（匿名函数）：此函数是用于对大数组-0x4818-进行操作。" class="headerlink" title="第一部分（匿名函数）：此函数是用于对大数组 _0x4818 进行操作。"></a>第一部分（匿名函数）：此函数是用于对大数组 _0x4818 进行操作。</h3><p>代码压缩：<a target="_blank" rel="noopener" href="https://www.sojson.com/yasuojs.html">https://www.sojson.com/yasuojs.html</a><br><strong>注</strong>：实参是数组和一个十六进制数，正则不匹配换行，所以需要将此函数压缩后再运行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x4db1c = <span class="function"><span class="keyword">function</span>(<span class="params">_0x48181e</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (--_0x48181e) &#123;</span><br><span class="line">		<span class="comment">// shift将数组第一个元素删除,并返回第一个元素的值,push在末尾添加值</span></span><br><span class="line">		qs_base_data[<span class="string">&#x27;push&#x27;</span>](qs_base_data[<span class="string">&#x27;shift&#x27;</span>]());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_0x52d57c(_0x4db1c, _0x1742fd);</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于防代码格式化</span></span><br><span class="line"><span class="keyword">var</span> _0x4a2aed = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> _0x124d17 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;\\w+ *\\(\\) *&#123;\\w+ *[\&#x27;|\&quot;].+[\&#x27;|\&quot;];? *&#125;&#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> _0x124d17[<span class="string">&#x27;test&#x27;</span>](_0xb8360b[<span class="string">&#x27;removeCookie&#x27;</span>][<span class="string">&#x27;toString&#x27;</span>]());</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>得到处理后的数组：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&quot;wqImMT0tw6RNw5k=&quot;</span>, <span class="string">&quot;DMKcU0JmUwUv&quot;</span>, <span class="string">&quot;VjHDlMOHVcONX3fDicKJHQ==&quot;</span>, <span class="string">&quot;wqhBH8Knw4TDhSDDgMOdwrjCncOWwphhN8KCGcKqw6dHAU5+wrg2JcKaw4IEJcOcwrRJwoZ0wqF9YgAV&quot;</span>, <span class="string">&quot;dzd2w5bDm3jDpsK3wpY=&quot;</span>, <span class="string">&quot;w4PDgcKXwo3CkcKLwr5qwrY=&quot;</span>, <span class="string">&quot;wrJOTcOQWMOg&quot;</span>, <span class="string">&quot;wqTDvcOjw447wr4=&quot;</span>, <span class="string">&quot;w5XDqsKhMF1/&quot;</span>, <span class="string">&quot;wrAyHsOfwppc&quot;</span>, <span class="string">&quot;J3dVPcOxLg==&quot;</span>, <span class="string">&quot;wrdHw7p9Zw==&quot;</span>, <span class="string">&quot;w4rDo8KmNEw=&quot;</span>, <span class="string">&quot;IMKAUkBt&quot;</span>, <span class="string">&quot;w6bDrcKQwpVHwpNQwqU=&quot;</span>, <span class="string">&quot;d8OsWhAUw7YzwrU=&quot;</span>, <span class="string">&quot;wqnCksOeezrDhw==&quot;</span>, <span class="string">&quot;UsKnIMKWV8K/&quot;</span>, <span class="string">&quot;w4zDocK8NUZv&quot;</span>, <span class="string">&quot;c8OxZhAJw6skwqJj&quot;</span>, <span class="string">&quot;PcKIw4nCkkVb&quot;</span>, <span class="string">&quot;KHgodMO2VQ==&quot;</span>, <span class="string">&quot;wpsmwqvDnGFq&quot;</span>, <span class="string">&quot;wqLDt8Okw4c=&quot;</span>, <span class="string">&quot;w7w1w4PCpsO4wqA=&quot;</span>, <span class="string">&quot;wq9FRsOqWMOq&quot;</span>, <span class="string">&quot;byBhw7rDm34=&quot;</span>, <span class="string">&quot;LHg+S8OtTw==&quot;</span>, <span class="string">&quot;wqhOw715dsOH&quot;</span>, <span class="string">&quot;U8O7VsO0wqvDvcKuKsOqX8Kr&quot;</span>, <span class="string">&quot;Yittw5DDnWnDrA==&quot;</span>, <span class="string">&quot;YMKIwqUUfgIk&quot;</span>, <span class="string">&quot;aB7DlMODTQ==&quot;</span>, <span class="string">&quot;wpfDh8Orw6kk&quot;</span>, <span class="string">&quot;w7vCqMOrY8KAVk5OwpnCu8OaXsKZP3DClcKyw6HDrQ==&quot;</span>, <span class="string">&quot;wow+w6vDmHpsw7Rtwo98LC7CiG7CksORT8KlW8O5wr3Di8OTHsODeHjDmcKlJsKqVA==&quot;</span>, <span class="string">&quot;NwV+&quot;</span>, <span class="string">&quot;w7HDrcKtwpJawpZb&quot;</span>, <span class="string">&quot;wpQswqvDiHpuw6I=&quot;</span>, <span class="string">&quot;YMKUwqMJZQ==&quot;</span>, <span class="string">&quot;KH1VKcOqKsK1&quot;</span>, <span class="string">&quot;fQ5sFUkkwpI=&quot;</span>, <span class="string">&quot;wrvCrcOBR8Kk&quot;</span>, <span class="string">&quot;M3w0fQ==&quot;</span>, <span class="string">&quot;w6xXwqPDvMOFwo5d&quot;</span>, <span class="string">&quot;csKHwqMI&quot;</span>, <span class="string">&quot;ZsKJwr8VeAsy&quot;</span>, <span class="string">&quot;UcKiN8O/wplwMA==&quot;</span>, <span class="string">&quot;JR8CTg==&quot;</span>, <span class="string">&quot;YsOnbSEQw7ozwqZKesKUw7kwX8ORIQ==&quot;</span>, <span class="string">&quot;w7oVS8OSwoPCl3jChMKhw6HDlsKXw4s/YsOG&quot;</span>, <span class="string">&quot;fwVmI1AtwplaY8Otw5cNfSgpw6M=&quot;</span>, <span class="string">&quot;OcONwrjCqsKxTGTChsOjEWE8PcOcJ8K6&quot;</span>, <span class="string">&quot;U8K5LcOtwpV0EMOkw47DrMOX&quot;</span>, <span class="string">&quot;HMO2woHCiMK9SlXClcOoC1k=&quot;</span>, <span class="string">&quot;asKIwqMDdgMuPsOKBMKcwrrCtkLDrMKBw64d&quot;</span>]</span><br></pre></td></tr></table></figure>

<h3 id="第二部分（解密字符串函数）"><a href="#第二部分（解密字符串函数）" class="headerlink" title="第二部分（解密字符串函数）"></a>第二部分（解密字符串函数）</h3><p>什么也不用改，压缩后调用即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> _0x55f3=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4c97f0,_0x1742fd</span>)</span>&#123;<span class="keyword">var</span> _0x4c97f0=<span class="built_in">parseInt</span>(_0x4c97f0,<span class="number">0x10</span>);<span class="keyword">var</span> _0x48181e=_0x4818[_0x4c97f0];<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;atobPolyfillAppended&#x27;</span>])&#123;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> _0xdf49c6=<span class="built_in">Function</span>(<span class="string">&#x27;return (function () &#123;&#125;.constructor(\&quot;return this\&quot;)());&#x27;</span>);<span class="keyword">var</span> _0xb8360b=_0xdf49c6();<span class="keyword">var</span> _0x389f44=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span>;_0xb8360b[<span class="string">&#x27;atob&#x27;</span>]||(_0xb8360b[<span class="string">&#x27;atob&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">_0xba82f0</span>)</span>&#123;<span class="keyword">var</span> _0xec6bb4=<span class="built_in">String</span>(_0xba82f0)[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/=+$/</span>,<span class="string">&#x27;&#x27;</span>);<span class="keyword">for</span>(<span class="keyword">var</span> _0x1a0f04=<span class="number">0x0</span>,_0x18c94e,_0x41b2ff,_0xd79219=<span class="number">0x0</span>,_0x5792f7=<span class="string">&#x27;&#x27;</span>;_0x41b2ff=_0xec6bb4[<span class="string">&#x27;charAt&#x27;</span>](_0xd79219++);~_0x41b2ff&amp;&amp;(_0x18c94e=_0x1a0f04%<span class="number">0x4</span>?_0x18c94e*<span class="number">0x40</span>+_0x41b2ff:_0x41b2ff,_0x1a0f04++%<span class="number">0x4</span>)?_0x5792f7+=<span class="built_in">String</span>[<span class="string">&#x27;fromCharCode&#x27;</span>](<span class="number">0xff</span>&amp;_0x18c94e&gt;&gt;(<span class="number">-0x2</span>*_0x1a0f04&amp;<span class="number">0x6</span>)):<span class="number">0x0</span>)&#123;_0x41b2ff=_0x389f44[<span class="string">&#x27;indexOf&#x27;</span>](_0x41b2ff)&#125;<span class="keyword">return</span> _0x5792f7&#125;)&#125;());_0x55f3[<span class="string">&#x27;atobPolyfillAppended&#x27;</span>]=!![]&#125;<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;rc4&#x27;</span>])&#123;<span class="keyword">var</span> _0x232678=<span class="function"><span class="keyword">function</span>(<span class="params">_0x401af1,_0x532ac0</span>)</span>&#123;<span class="keyword">var</span> _0x45079a=[],_0x52d57c=<span class="number">0x0</span>,_0x105f59,_0x3fd789=<span class="string">&#x27;&#x27;</span>,_0x4a2aed=<span class="string">&#x27;&#x27;</span>;_0x401af1=atob(_0x401af1);<span class="keyword">for</span>(<span class="keyword">var</span> _0x124d17=<span class="number">0x0</span>,_0x1b9115=_0x401af1[<span class="string">&#x27;length&#x27;</span>];_0x124d17&lt;_0x1b9115;_0x124d17++)&#123;_0x4a2aed+=<span class="string">&#x27;%&#x27;</span>+(<span class="string">&#x27;00&#x27;</span>+_0x401af1[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x124d17)[<span class="string">&#x27;toString&#x27;</span>](<span class="number">0x10</span>))[<span class="string">&#x27;slice&#x27;</span>](<span class="number">-0x2</span>)&#125;_0x401af1=<span class="built_in">decodeURIComponent</span>(_0x4a2aed);<span class="keyword">for</span>(<span class="keyword">var</span> _0x2d67ec=<span class="number">0x0</span>;_0x2d67ec&lt;<span class="number">0x100</span>;_0x2d67ec++)&#123;_0x45079a[_0x2d67ec]=_0x2d67ec&#125;<span class="keyword">for</span>(_0x2d67ec=<span class="number">0x0</span>;_0x2d67ec&lt;<span class="number">0x100</span>;_0x2d67ec++)&#123;_0x52d57c=(_0x52d57c+_0x45079a[_0x2d67ec]+_0x532ac0[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x2d67ec%_0x532ac0[<span class="string">&#x27;length&#x27;</span>]))%<span class="number">0x100</span>;_0x105f59=_0x45079a[_0x2d67ec];_0x45079a[_0x2d67ec]=_0x45079a[_0x52d57c];_0x45079a[_0x52d57c]=_0x105f59&#125;_0x2d67ec=<span class="number">0x0</span>;_0x52d57c=<span class="number">0x0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x4e5ce2=<span class="number">0x0</span>;_0x4e5ce2&lt;_0x401af1[<span class="string">&#x27;length&#x27;</span>];_0x4e5ce2++)&#123;_0x2d67ec=(_0x2d67ec+<span class="number">0x1</span>)%<span class="number">0x100</span>;_0x52d57c=(_0x52d57c+_0x45079a[_0x2d67ec])%<span class="number">0x100</span>;_0x105f59=_0x45079a[_0x2d67ec];_0x45079a[_0x2d67ec]=_0x45079a[_0x52d57c];_0x45079a[_0x52d57c]=_0x105f59;_0x3fd789+=<span class="built_in">String</span>[<span class="string">&#x27;fromCharCode&#x27;</span>](_0x401af1[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x4e5ce2)^_0x45079a[(_0x45079a[_0x2d67ec]+_0x45079a[_0x52d57c])%<span class="number">0x100</span>])&#125;<span class="keyword">return</span> _0x3fd789&#125;;_0x55f3[<span class="string">&#x27;rc4&#x27;</span>]=_0x232678&#125;<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;data&#x27;</span>])&#123;_0x55f3[<span class="string">&#x27;data&#x27;</span>]=&#123;&#125;&#125;<span class="keyword">if</span>(_0x55f3[<span class="string">&#x27;data&#x27;</span>][_0x4c97f0]===<span class="literal">undefined</span>)&#123;<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;once&#x27;</span>])&#123;<span class="keyword">var</span> _0x5f325c=<span class="function"><span class="keyword">function</span>(<span class="params">_0x23a392</span>)</span>&#123;<span class="built_in">this</span>[<span class="string">&#x27;rc4Bytes&#x27;</span>]=_0x23a392;<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>]=[<span class="number">0x1</span>,<span class="number">0x0</span>,<span class="number">0x0</span>];<span class="built_in">this</span>[<span class="string">&#x27;newState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">&#x27;newState&#x27;</span>&#125;;<span class="built_in">this</span>[<span class="string">&#x27;firstState&#x27;</span>]=<span class="string">&#x27;\\w+ *\\(\\) *&#123;\\w+ *&#x27;</span>;<span class="built_in">this</span>[<span class="string">&#x27;secondState&#x27;</span>]=<span class="string">&#x27;[\&#x27;|\&quot;].+[\&#x27;|\&quot;];? *&#125;&#x27;</span>&#125;;_0x5f325c[<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;checkState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> _0x19f809=<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="built_in">this</span>[<span class="string">&#x27;firstState&#x27;</span>]+<span class="built_in">this</span>[<span class="string">&#x27;secondState&#x27;</span>]);<span class="keyword">return</span> <span class="built_in">this</span>[<span class="string">&#x27;runState&#x27;</span>](_0x19f809[<span class="string">&#x27;test&#x27;</span>](<span class="built_in">this</span>[<span class="string">&#x27;newState&#x27;</span>][<span class="string">&#x27;toString&#x27;</span>]())?--<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="number">0x1</span>]:--<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="number">0x0</span>])&#125;;_0x5f325c[<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;runState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4380bd</span>)</span>&#123;<span class="keyword">if</span>(!<span class="built_in">Boolean</span>(~_0x4380bd))&#123;<span class="keyword">return</span> _0x4380bd&#125;<span class="keyword">return</span> <span class="built_in">this</span>[<span class="string">&#x27;getState&#x27;</span>](<span class="built_in">this</span>[<span class="string">&#x27;rc4Bytes&#x27;</span>])&#125;;_0x5f325c[<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;getState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">_0x58d85e</span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> _0x1c9f5b=<span class="number">0x0</span>,_0x1ce9e0=<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="string">&#x27;length&#x27;</span>];_0x1c9f5b&lt;_0x1ce9e0;_0x1c9f5b++)&#123;<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="string">&#x27;push&#x27;</span>](<span class="built_in">Math</span>[<span class="string">&#x27;round&#x27;</span>](<span class="built_in">Math</span>[<span class="string">&#x27;random&#x27;</span>]()));_0x1ce9e0=<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="string">&#x27;length&#x27;</span>]&#125;<span class="keyword">return</span> _0x58d85e(<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="number">0x0</span>])&#125;;<span class="keyword">new</span> _0x5f325c(_0x55f3)[<span class="string">&#x27;checkState&#x27;</span>]();_0x55f3[<span class="string">&#x27;once&#x27;</span>]=!![]&#125;_0x48181e=_0x55f3[<span class="string">&#x27;rc4&#x27;</span>](_0x48181e,_0x1742fd);_0x55f3[<span class="string">&#x27;data&#x27;</span>][_0x4c97f0]=_0x48181e&#125;<span class="keyword">else</span>&#123;_0x48181e=_0x55f3[<span class="string">&#x27;data&#x27;</span>][_0x4c97f0]&#125;<span class="keyword">return</span> _0x48181e&#125;;</span><br><span class="line"> _0x55f3(<span class="string">&#x27;0x3&#x27;</span>, <span class="string">&#x27;jS1Y&#x27;</span>);</span><br><span class="line"><span class="string">&quot;3000176000856006061501533003690027800375&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="第三部分-生成arg2"><a href="#第三部分-生成arg2" class="headerlink" title="第三部分 生成arg2"></a>第三部分 生成arg2</h3><p>将arg2的值返回即可。</p>
<h3 id="第四部分-反调试"><a href="#第四部分-反调试" class="headerlink" title="第四部分 反调试"></a>第四部分 反调试</h3><p>可直接删除该部分代码。</p>
<h2 id="改写后的JS文件"><a href="#改写后的JS文件" class="headerlink" title="改写后的JS文件"></a>改写后的JS文件</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arg1 = <span class="string">&#x27;3BCA0C4E465FE26F5624EE022F71C91FD4D78682&#x27;</span>;</span><br><span class="line"><span class="comment">// var _0x4818 = [&#x27;csKHwqMI&#x27;, &#x27;ZsKJwr8VeAsy&#x27;, &#x27;UcKiN8O/wplwMA==&#x27;, &#x27;JR8CTg==&#x27;, &#x27;YsOnbSEQw7ozwqZKesKUw7kwX8ORIQ==&#x27;, &#x27;w7oVS8OSwoPCl3jChMKhw6HDlsKXw4s/YsOG&#x27;, &#x27;fwVmI1AtwplaY8Otw5cNfSgpw6M=&#x27;, &#x27;OcONwrjCqsKxTGTChsOjEWE8PcOcJ8K6&#x27;, &#x27;U8K5LcOtwpV0EMOkw47DrMOX&#x27;, &#x27;HMO2woHCiMK9SlXClcOoC1k=&#x27;, &#x27;asKIwqMDdgMuPsOKBMKcwrrCtkLDrMKBw64d&#x27;, &#x27;wqImMT0tw6RNw5k=&#x27;, &#x27;DMKcU0JmUwUv&#x27;, &#x27;VjHDlMOHVcONX3fDicKJHQ==&#x27;, &#x27;wqhBH8Knw4TDhSDDgMOdwrjCncOWwphhN8KCGcKqw6dHAU5+wrg2JcKaw4IEJcOcwrRJwoZ0wqF9YgAV&#x27;, &#x27;dzd2w5bDm3jDpsK3wpY=&#x27;, &#x27;w4PDgcKXwo3CkcKLwr5qwrY=&#x27;, &#x27;wrJOTcOQWMOg&#x27;, &#x27;wqTDvcOjw447wr4=&#x27;, &#x27;w5XDqsKhMF1/&#x27;, &#x27;wrAyHsOfwppc&#x27;, &#x27;J3dVPcOxLg==&#x27;, &#x27;wrdHw7p9Zw==&#x27;, &#x27;w4rDo8KmNEw=&#x27;, &#x27;IMKAUkBt&#x27;, &#x27;w6bDrcKQwpVHwpNQwqU=&#x27;, &#x27;d8OsWhAUw7YzwrU=&#x27;, &#x27;wqnCksOeezrDhw==&#x27;, &#x27;UsKnIMKWV8K/&#x27;, &#x27;w4zDocK8NUZv&#x27;, &#x27;c8OxZhAJw6skwqJj&#x27;, &#x27;PcKIw4nCkkVb&#x27;, &#x27;KHgodMO2VQ==&#x27;, &#x27;wpsmwqvDnGFq&#x27;, &#x27;wqLDt8Okw4c=&#x27;, &#x27;w7w1w4PCpsO4wqA=&#x27;, &#x27;wq9FRsOqWMOq&#x27;, &#x27;byBhw7rDm34=&#x27;, &#x27;LHg+S8OtTw==&#x27;, &#x27;wqhOw715dsOH&#x27;, &#x27;U8O7VsO0wqvDvcKuKsOqX8Kr&#x27;, &#x27;Yittw5DDnWnDrA==&#x27;, &#x27;YMKIwqUUfgIk&#x27;, &#x27;aB7DlMODTQ==&#x27;, &#x27;wpfDh8Orw6kk&#x27;, &#x27;w7vCqMOrY8KAVk5OwpnCu8OaXsKZP3DClcKyw6HDrQ==&#x27;, &#x27;wow+w6vDmHpsw7Rtwo98LC7CiG7CksORT8KlW8O5wr3Di8OTHsODeHjDmcKlJsKqVA==&#x27;, &#x27;NwV+&#x27;, &#x27;w7HDrcKtwpJawpZb&#x27;, &#x27;wpQswqvDiHpuw6I=&#x27;, &#x27;YMKUwqMJZQ==&#x27;, &#x27;KH1VKcOqKsK1&#x27;, &#x27;fQ5sFUkkwpI=&#x27;, &#x27;wrvCrcOBR8Kk&#x27;, &#x27;M3w0fQ==&#x27;, &#x27;w6xXwqPDvMOFwo5d&#x27;];</span></span><br><span class="line"><span class="keyword">var</span> _0x4818 = [<span class="string">&quot;wqImMT0tw6RNw5k=&quot;</span>, <span class="string">&quot;DMKcU0JmUwUv&quot;</span>, <span class="string">&quot;VjHDlMOHVcONX3fDicKJHQ==&quot;</span>, <span class="string">&quot;wqhBH8Knw4TDhSDDgMOdwrjCncOWwphhN8KCGcKqw6dHAU5+wrg2JcKaw4IEJcOcwrRJwoZ0wqF9YgAV&quot;</span>, <span class="string">&quot;dzd2w5bDm3jDpsK3wpY=&quot;</span>, <span class="string">&quot;w4PDgcKXwo3CkcKLwr5qwrY=&quot;</span>, <span class="string">&quot;wrJOTcOQWMOg&quot;</span>, <span class="string">&quot;wqTDvcOjw447wr4=&quot;</span>, <span class="string">&quot;w5XDqsKhMF1/&quot;</span>, <span class="string">&quot;wrAyHsOfwppc&quot;</span>, <span class="string">&quot;J3dVPcOxLg==&quot;</span>, <span class="string">&quot;wrdHw7p9Zw==&quot;</span>, <span class="string">&quot;w4rDo8KmNEw=&quot;</span>, <span class="string">&quot;IMKAUkBt&quot;</span>, <span class="string">&quot;w6bDrcKQwpVHwpNQwqU=&quot;</span>, <span class="string">&quot;d8OsWhAUw7YzwrU=&quot;</span>, <span class="string">&quot;wqnCksOeezrDhw==&quot;</span>, <span class="string">&quot;UsKnIMKWV8K/&quot;</span>, <span class="string">&quot;w4zDocK8NUZv&quot;</span>, <span class="string">&quot;c8OxZhAJw6skwqJj&quot;</span>, <span class="string">&quot;PcKIw4nCkkVb&quot;</span>, <span class="string">&quot;KHgodMO2VQ==&quot;</span>, <span class="string">&quot;wpsmwqvDnGFq&quot;</span>, <span class="string">&quot;wqLDt8Okw4c=&quot;</span>, <span class="string">&quot;w7w1w4PCpsO4wqA=&quot;</span>, <span class="string">&quot;wq9FRsOqWMOq&quot;</span>, <span class="string">&quot;byBhw7rDm34=&quot;</span>, <span class="string">&quot;LHg+S8OtTw==&quot;</span>, <span class="string">&quot;wqhOw715dsOH&quot;</span>, <span class="string">&quot;U8O7VsO0wqvDvcKuKsOqX8Kr&quot;</span>, <span class="string">&quot;Yittw5DDnWnDrA==&quot;</span>, <span class="string">&quot;YMKIwqUUfgIk&quot;</span>, <span class="string">&quot;aB7DlMODTQ==&quot;</span>, <span class="string">&quot;wpfDh8Orw6kk&quot;</span>, <span class="string">&quot;w7vCqMOrY8KAVk5OwpnCu8OaXsKZP3DClcKyw6HDrQ==&quot;</span>, <span class="string">&quot;wow+w6vDmHpsw7Rtwo98LC7CiG7CksORT8KlW8O5wr3Di8OTHsODeHjDmcKlJsKqVA==&quot;</span>, <span class="string">&quot;NwV+&quot;</span>, <span class="string">&quot;w7HDrcKtwpJawpZb&quot;</span>, <span class="string">&quot;wpQswqvDiHpuw6I=&quot;</span>, <span class="string">&quot;YMKUwqMJZQ==&quot;</span>, <span class="string">&quot;KH1VKcOqKsK1&quot;</span>, <span class="string">&quot;fQ5sFUkkwpI=&quot;</span>, <span class="string">&quot;wrvCrcOBR8Kk&quot;</span>, <span class="string">&quot;M3w0fQ==&quot;</span>, <span class="string">&quot;w6xXwqPDvMOFwo5d&quot;</span>, <span class="string">&quot;csKHwqMI&quot;</span>, <span class="string">&quot;ZsKJwr8VeAsy&quot;</span>, <span class="string">&quot;UcKiN8O/wplwMA==&quot;</span>, <span class="string">&quot;JR8CTg==&quot;</span>, <span class="string">&quot;YsOnbSEQw7ozwqZKesKUw7kwX8ORIQ==&quot;</span>, <span class="string">&quot;w7oVS8OSwoPCl3jChMKhw6HDlsKXw4s/YsOG&quot;</span>, <span class="string">&quot;fwVmI1AtwplaY8Otw5cNfSgpw6M=&quot;</span>, <span class="string">&quot;OcONwrjCqsKxTGTChsOjEWE8PcOcJ8K6&quot;</span>, <span class="string">&quot;U8K5LcOtwpV0EMOkw47DrMOX&quot;</span>, <span class="string">&quot;HMO2woHCiMK9SlXClcOoC1k=&quot;</span>, <span class="string">&quot;asKIwqMDdgMuPsOKBMKcwrrCtkLDrMKBw64d&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> _0x55f3=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4c97f0,_0x1742fd</span>)</span>&#123;<span class="keyword">var</span> _0x4c97f0=<span class="built_in">parseInt</span>(_0x4c97f0,<span class="number">0x10</span>);<span class="keyword">var</span> _0x48181e=_0x4818[_0x4c97f0];<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;atobPolyfillAppended&#x27;</span>])&#123;(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> _0xdf49c6=<span class="built_in">Function</span>(<span class="string">&#x27;return (function () &#123;&#125;.constructor(\&quot;return this\&quot;)());&#x27;</span>);<span class="keyword">var</span> _0xb8360b=_0xdf49c6();<span class="keyword">var</span> _0x389f44=<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&#x27;</span>;_0xb8360b[<span class="string">&#x27;atob&#x27;</span>]||(_0xb8360b[<span class="string">&#x27;atob&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">_0xba82f0</span>)</span>&#123;<span class="keyword">var</span> _0xec6bb4=<span class="built_in">String</span>(_0xba82f0)[<span class="string">&#x27;replace&#x27;</span>](<span class="regexp">/=+$/</span>,<span class="string">&#x27;&#x27;</span>);<span class="keyword">for</span>(<span class="keyword">var</span> _0x1a0f04=<span class="number">0x0</span>,_0x18c94e,_0x41b2ff,_0xd79219=<span class="number">0x0</span>,_0x5792f7=<span class="string">&#x27;&#x27;</span>;_0x41b2ff=_0xec6bb4[<span class="string">&#x27;charAt&#x27;</span>](_0xd79219++);~_0x41b2ff&amp;&amp;(_0x18c94e=_0x1a0f04%<span class="number">0x4</span>?_0x18c94e*<span class="number">0x40</span>+_0x41b2ff:_0x41b2ff,_0x1a0f04++%<span class="number">0x4</span>)?_0x5792f7+=<span class="built_in">String</span>[<span class="string">&#x27;fromCharCode&#x27;</span>](<span class="number">0xff</span>&amp;_0x18c94e&gt;&gt;(<span class="number">-0x2</span>*_0x1a0f04&amp;<span class="number">0x6</span>)):<span class="number">0x0</span>)&#123;_0x41b2ff=_0x389f44[<span class="string">&#x27;indexOf&#x27;</span>](_0x41b2ff)&#125;<span class="keyword">return</span> _0x5792f7&#125;)&#125;());_0x55f3[<span class="string">&#x27;atobPolyfillAppended&#x27;</span>]=!![]&#125;<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;rc4&#x27;</span>])&#123;<span class="keyword">var</span> _0x232678=<span class="function"><span class="keyword">function</span>(<span class="params">_0x401af1,_0x532ac0</span>)</span>&#123;<span class="keyword">var</span> _0x45079a=[],_0x52d57c=<span class="number">0x0</span>,_0x105f59,_0x3fd789=<span class="string">&#x27;&#x27;</span>,_0x4a2aed=<span class="string">&#x27;&#x27;</span>;_0x401af1=atob(_0x401af1);<span class="keyword">for</span>(<span class="keyword">var</span> _0x124d17=<span class="number">0x0</span>,_0x1b9115=_0x401af1[<span class="string">&#x27;length&#x27;</span>];_0x124d17&lt;_0x1b9115;_0x124d17++)&#123;_0x4a2aed+=<span class="string">&#x27;%&#x27;</span>+(<span class="string">&#x27;00&#x27;</span>+_0x401af1[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x124d17)[<span class="string">&#x27;toString&#x27;</span>](<span class="number">0x10</span>))[<span class="string">&#x27;slice&#x27;</span>](<span class="number">-0x2</span>)&#125;_0x401af1=<span class="built_in">decodeURIComponent</span>(_0x4a2aed);<span class="keyword">for</span>(<span class="keyword">var</span> _0x2d67ec=<span class="number">0x0</span>;_0x2d67ec&lt;<span class="number">0x100</span>;_0x2d67ec++)&#123;_0x45079a[_0x2d67ec]=_0x2d67ec&#125;<span class="keyword">for</span>(_0x2d67ec=<span class="number">0x0</span>;_0x2d67ec&lt;<span class="number">0x100</span>;_0x2d67ec++)&#123;_0x52d57c=(_0x52d57c+_0x45079a[_0x2d67ec]+_0x532ac0[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x2d67ec%_0x532ac0[<span class="string">&#x27;length&#x27;</span>]))%<span class="number">0x100</span>;_0x105f59=_0x45079a[_0x2d67ec];_0x45079a[_0x2d67ec]=_0x45079a[_0x52d57c];_0x45079a[_0x52d57c]=_0x105f59&#125;_0x2d67ec=<span class="number">0x0</span>;_0x52d57c=<span class="number">0x0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> _0x4e5ce2=<span class="number">0x0</span>;_0x4e5ce2&lt;_0x401af1[<span class="string">&#x27;length&#x27;</span>];_0x4e5ce2++)&#123;_0x2d67ec=(_0x2d67ec+<span class="number">0x1</span>)%<span class="number">0x100</span>;_0x52d57c=(_0x52d57c+_0x45079a[_0x2d67ec])%<span class="number">0x100</span>;_0x105f59=_0x45079a[_0x2d67ec];_0x45079a[_0x2d67ec]=_0x45079a[_0x52d57c];_0x45079a[_0x52d57c]=_0x105f59;_0x3fd789+=<span class="built_in">String</span>[<span class="string">&#x27;fromCharCode&#x27;</span>](_0x401af1[<span class="string">&#x27;charCodeAt&#x27;</span>](_0x4e5ce2)^_0x45079a[(_0x45079a[_0x2d67ec]+_0x45079a[_0x52d57c])%<span class="number">0x100</span>])&#125;<span class="keyword">return</span> _0x3fd789&#125;;_0x55f3[<span class="string">&#x27;rc4&#x27;</span>]=_0x232678&#125;<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;data&#x27;</span>])&#123;_0x55f3[<span class="string">&#x27;data&#x27;</span>]=&#123;&#125;&#125;<span class="keyword">if</span>(_0x55f3[<span class="string">&#x27;data&#x27;</span>][_0x4c97f0]===<span class="literal">undefined</span>)&#123;<span class="keyword">if</span>(!_0x55f3[<span class="string">&#x27;once&#x27;</span>])&#123;<span class="keyword">var</span> _0x5f325c=<span class="function"><span class="keyword">function</span>(<span class="params">_0x23a392</span>)</span>&#123;<span class="built_in">this</span>[<span class="string">&#x27;rc4Bytes&#x27;</span>]=_0x23a392;<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>]=[<span class="number">0x1</span>,<span class="number">0x0</span>,<span class="number">0x0</span>];<span class="built_in">this</span>[<span class="string">&#x27;newState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">&#x27;newState&#x27;</span>&#125;;<span class="built_in">this</span>[<span class="string">&#x27;firstState&#x27;</span>]=<span class="string">&#x27;\\w+ *\\(\\) *&#123;\\w+ *&#x27;</span>;<span class="built_in">this</span>[<span class="string">&#x27;secondState&#x27;</span>]=<span class="string">&#x27;[\&#x27;|\&quot;].+[\&#x27;|\&quot;];? *&#125;&#x27;</span>&#125;;_0x5f325c[<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;checkState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> _0x19f809=<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="built_in">this</span>[<span class="string">&#x27;firstState&#x27;</span>]+<span class="built_in">this</span>[<span class="string">&#x27;secondState&#x27;</span>]);<span class="keyword">return</span> <span class="built_in">this</span>[<span class="string">&#x27;runState&#x27;</span>](_0x19f809[<span class="string">&#x27;test&#x27;</span>](<span class="built_in">this</span>[<span class="string">&#x27;newState&#x27;</span>][<span class="string">&#x27;toString&#x27;</span>]())?--<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="number">0x1</span>]:--<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="number">0x0</span>])&#125;;_0x5f325c[<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;runState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">_0x4380bd</span>)</span>&#123;<span class="keyword">if</span>(!<span class="built_in">Boolean</span>(~_0x4380bd))&#123;<span class="keyword">return</span> _0x4380bd&#125;<span class="keyword">return</span> <span class="built_in">this</span>[<span class="string">&#x27;getState&#x27;</span>](<span class="built_in">this</span>[<span class="string">&#x27;rc4Bytes&#x27;</span>])&#125;;_0x5f325c[<span class="string">&#x27;prototype&#x27;</span>][<span class="string">&#x27;getState&#x27;</span>]=<span class="function"><span class="keyword">function</span>(<span class="params">_0x58d85e</span>)</span>&#123;<span class="keyword">for</span>(<span class="keyword">var</span> _0x1c9f5b=<span class="number">0x0</span>,_0x1ce9e0=<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="string">&#x27;length&#x27;</span>];_0x1c9f5b&lt;_0x1ce9e0;_0x1c9f5b++)&#123;<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="string">&#x27;push&#x27;</span>](<span class="built_in">Math</span>[<span class="string">&#x27;round&#x27;</span>](<span class="built_in">Math</span>[<span class="string">&#x27;random&#x27;</span>]()));_0x1ce9e0=<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="string">&#x27;length&#x27;</span>]&#125;<span class="keyword">return</span> _0x58d85e(<span class="built_in">this</span>[<span class="string">&#x27;states&#x27;</span>][<span class="number">0x0</span>])&#125;;<span class="keyword">new</span> _0x5f325c(_0x55f3)[<span class="string">&#x27;checkState&#x27;</span>]();_0x55f3[<span class="string">&#x27;once&#x27;</span>]=!![]&#125;_0x48181e=_0x55f3[<span class="string">&#x27;rc4&#x27;</span>](_0x48181e,_0x1742fd);_0x55f3[<span class="string">&#x27;data&#x27;</span>][_0x4c97f0]=_0x48181e&#125;<span class="keyword">else</span>&#123;_0x48181e=_0x55f3[<span class="string">&#x27;data&#x27;</span>][_0x4c97f0]&#125;<span class="keyword">return</span> _0x48181e&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> l = <span class="function"><span class="keyword">function</span> (<span class="params">arg1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e8b26 = <span class="string">&quot;3000176000856006061501533003690027800375&quot;</span>;</span><br><span class="line">    <span class="built_in">String</span>[<span class="string">&quot;prototype&quot;</span>][<span class="string">&quot;hexXor&quot;</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4e08d8</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _0x5a5d3b = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> _0xe89588 = <span class="number">0x0</span>; _0xe89588 &lt; <span class="built_in">this</span>[_0x55f3(<span class="string">&#x27;0x8&#x27;</span>, <span class="string">&#x27;)hRc&#x27;</span>)] &amp;&amp; _0xe89588 &lt; _0x4e08d8[_0x55f3(<span class="string">&#x27;0xa&#x27;</span>, <span class="string">&#x27;jE&amp;^&#x27;</span>)]; _0xe89588 += <span class="number">0x2</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x401af1 = <span class="built_in">parseInt</span>(<span class="built_in">this</span>[_0x55f3(<span class="string">&#x27;0xb&#x27;</span>, <span class="string">&#x27;V2KE&#x27;</span>)](_0xe89588, _0xe89588 + <span class="number">0x2</span>), <span class="number">0x10</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x105f59 = <span class="built_in">parseInt</span>(_0x4e08d8[_0x55f3(<span class="string">&#x27;0xd&#x27;</span>, <span class="string">&#x27;XMW^&#x27;</span>)](_0xe89588, _0xe89588 + <span class="number">0x2</span>), <span class="number">0x10</span>);</span><br><span class="line">            <span class="keyword">var</span> _0x189e2c = (_0x401af1 ^ _0x105f59)[_0x55f3(<span class="string">&#x27;0xf&#x27;</span>, <span class="string">&#x27;W1FE&#x27;</span>)](<span class="number">0x10</span>);</span><br><span class="line">            <span class="keyword">if</span> (_0x189e2c[_0x55f3(<span class="string">&#x27;0x11&#x27;</span>, <span class="string">&#x27;MGrv&#x27;</span>)] == <span class="number">0x1</span>) &#123;</span><br><span class="line">                _0x189e2c = <span class="string">&#x27;0&#x27;</span> + _0x189e2c;</span><br><span class="line">            &#125;</span><br><span class="line">            _0x5a5d3b += _0x189e2c;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> _0x5a5d3b;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">String</span>[<span class="string">&#x27;prototype&#x27;</span>][_0x55f3(<span class="string">&#x27;0x14&#x27;</span>, <span class="string">&#x27;Z*DM&#x27;</span>)] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> _0x4b082b = [<span class="number">0xf</span>, <span class="number">0x23</span>, <span class="number">0x1d</span>, <span class="number">0x18</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0x1</span>, <span class="number">0x26</span>, <span class="number">0xa</span>, <span class="number">0x9</span>, <span class="number">0x13</span>, <span class="number">0x1f</span>, <span class="number">0x28</span>, <span class="number">0x1b</span>, <span class="number">0x16</span>, <span class="number">0x17</span>, <span class="number">0x19</span>, <span class="number">0xd</span>, <span class="number">0x6</span>, <span class="number">0xb</span>, <span class="number">0x27</span>, <span class="number">0x12</span>, <span class="number">0x14</span>, <span class="number">0x8</span>, <span class="number">0xe</span>, <span class="number">0x15</span>, <span class="number">0x20</span>, <span class="number">0x1a</span>, <span class="number">0x2</span>, <span class="number">0x1e</span>, <span class="number">0x7</span>, <span class="number">0x4</span>, <span class="number">0x11</span>, <span class="number">0x5</span>, <span class="number">0x3</span>, <span class="number">0x1c</span>, <span class="number">0x22</span>, <span class="number">0x25</span>, <span class="number">0xc</span>, <span class="number">0x24</span>];</span><br><span class="line">        <span class="keyword">var</span> _0x4da0dc = [];</span><br><span class="line">        <span class="keyword">var</span> _0x12605e = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> _0x20a7bf = <span class="number">0x0</span>; _0x20a7bf &lt; <span class="built_in">this</span>[<span class="string">&#x27;length&#x27;</span>]; _0x20a7bf++) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x385ee3 = <span class="built_in">this</span>[_0x20a7bf];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> _0x217721 = <span class="number">0x0</span>; _0x217721 &lt; _0x4b082b[_0x55f3(<span class="string">&#x27;0x16&#x27;</span>, <span class="string">&#x27;aH*N&#x27;</span>)]; _0x217721++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (_0x4b082b[_0x217721] == _0x20a7bf + <span class="number">0x1</span>) &#123;</span><br><span class="line">                    _0x4da0dc[_0x217721] = _0x385ee3;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        _0x12605e = _0x4da0dc[<span class="string">&#x27;join&#x27;</span>](<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> _0x12605e;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> _0x23a392 = arg1[_0x55f3(<span class="string">&#x27;0x19&#x27;</span>, <span class="string">&#x27;Pg54&#x27;</span>)]();</span><br><span class="line">    arg2 = _0x23a392[_0x55f3(<span class="string">&#x27;0x1b&#x27;</span>, <span class="string">&#x27;z5O&amp;&#x27;</span>)](_0x5e8b26);</span><br><span class="line">    <span class="comment">// console.info(arg2)</span></span><br><span class="line">    <span class="keyword">return</span> arg2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.info(l(arg1));</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/06/JsCrack%20%E7%88%B1%E5%A5%87%E8%89%BA%E7%99%BB%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/06/JsCrack%20%E7%88%B1%E5%A5%87%E8%89%BA%E7%99%BB%E5%BD%95/" class="post-title-link" itemprop="url">JsCrack 爱奇艺登录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-06 22:30:00" itemprop="dateCreated datePublished" datetime="2019-10-06T22:30:00+08:00">2019-10-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-23 21:24:55" itemprop="dateModified" datetime="2020-04-23T21:24:55+08:00">2020-04-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB/" itemprop="url" rel="index"><span itemprop="name">网络爬虫</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="网页分析"><a href="#网页分析" class="headerlink" title="网页分析"></a>网页分析</h2><p>进行XHR断点，Call stack 调试找到如下位置，e.passwd &amp;&amp; (e.passwd = r.rsaFun(e.passwd))，得到公钥和偏移量t,a，继续追踪getKeyPair函数，即可发现生成函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rsaFun: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> t = <span class="string">&quot;ab86b6371b5318aaa1d3c9e612a9f1264f372323c8c0f19875b5fc3b3fd3afcc1e5bec527aa94bfa85bffc157e4245aebda05389a5357b75115ac94f074aefcd&quot;</span></span><br><span class="line">	  , a = <span class="string">&quot;10001&quot;</span></span><br><span class="line">	  , n = Q.crypto.rsa.RSAUtils.getKeyPair(a, <span class="string">&quot;&quot;</span>, t)</span><br><span class="line">	  , i = Q.crypto.rsa.RSAUtils.encryptedString(n, <span class="built_in">encodeURIComponent</span>(e)).replace(<span class="regexp">/\s/g</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>未删减直接将整个对象内容取出来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;&#125;;b=&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = f</span><br><span class="line">        , c = b.biDivideByRadixPower(a, <span class="built_in">this</span>.k - <span class="number">1</span>)</span><br><span class="line">        , d = b.biMultiply(c, <span class="built_in">this</span>.mu)</span><br><span class="line">        , e = b.biDivideByRadixPower(d, <span class="built_in">this</span>.k + <span class="number">1</span>)</span><br><span class="line">        , g = b.biModuloByRadixPower(a, <span class="built_in">this</span>.k + <span class="number">1</span>)</span><br><span class="line">        , h = b.biMultiply(e, <span class="built_in">this</span>.modulus)</span><br><span class="line">        , i = b.biModuloByRadixPower(h, <span class="built_in">this</span>.k + <span class="number">1</span>)</span><br><span class="line">        , j = b.biSubtract(g, i);</span><br><span class="line">    j.isNeg &amp;&amp; (j = b.biAdd(j, <span class="built_in">this</span>.bkplus1));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k = b.biCompare(j, <span class="built_in">this</span>.modulus) &gt;= <span class="number">0</span>; k; )</span><br><span class="line">        j = b.biSubtract(j, <span class="built_in">this</span>.modulus),</span><br><span class="line">            k = b.biCompare(j, <span class="built_in">this</span>.modulus) &gt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> j</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = f.biMultiply(a, b);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.modulo(c)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">e</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="keyword">new</span> t;</span><br><span class="line">    c.digits[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> d = a, e = b; ; ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> != (<span class="number">1</span> &amp; e.digits[<span class="number">0</span>]) &amp;&amp; (c = <span class="built_in">this</span>.multiplyMod(c, d)),</span><br><span class="line">            e = f.biShiftRight(e, <span class="number">1</span>),</span><br><span class="line">        <span class="number">0</span> == e.digits[<span class="number">0</span>] &amp;&amp; <span class="number">0</span> == f.biHighIndex(e))</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        d = <span class="built_in">this</span>.multiplyMod(d, d)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> f, g = &#123;&#125;;</span><br><span class="line"><span class="string">&quot;undefined&quot;</span> == <span class="keyword">typeof</span> g.RSAUtils &amp;&amp; (f = g.RSAUtils = &#123;&#125;);</span><br><span class="line"><span class="keyword">var</span> h, k, l, m, n = <span class="number">16</span>, o = n, p = <span class="number">65536</span>, q = p &gt;&gt;&gt; <span class="number">1</span>, r = p * p, s = p - <span class="number">1</span>, t = g.BigInt = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.digits = <span class="string">&quot;boolean&quot;</span> == <span class="keyword">typeof</span> a &amp;&amp; a === !<span class="number">0</span> ? <span class="literal">null</span> : k.slice(<span class="number">0</span>),</span><br><span class="line">            <span class="built_in">this</span>.isNeg = !<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">;</span><br><span class="line">f.setMaxDigits = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    h = a,</span><br><span class="line">        k = <span class="keyword">new</span> <span class="built_in">Array</span>(h);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>; b &lt; k.length; b++)</span><br><span class="line">        k[b] = <span class="number">0</span>;</span><br><span class="line">    l = <span class="keyword">new</span> t,</span><br><span class="line">        m = <span class="keyword">new</span> t,</span><br><span class="line">        m.digits[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">    ,</span><br><span class="line">    f.setMaxDigits(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">var</span> u = <span class="number">15</span>;</span><br><span class="line">f.biFromNumber = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="keyword">new</span> t;</span><br><span class="line">    b.isNeg = <span class="number">0</span> &gt; a,</span><br><span class="line">        a = <span class="built_in">Math</span>.abs(a);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> c = <span class="number">0</span>; a &gt; <span class="number">0</span>; )</span><br><span class="line">        b.digits[c++] = a &amp; s,</span><br><span class="line">            a = <span class="built_in">Math</span>.floor(a / p);</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="keyword">var</span> v = f.biFromNumber(<span class="number">1e15</span>);</span><br><span class="line">f.biFromDecimal = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> b, c = <span class="string">&quot;-&quot;</span> == a.charAt(<span class="number">0</span>), d = c ? <span class="number">1</span> : <span class="number">0</span>; d &lt; a.length &amp;&amp; <span class="string">&quot;0&quot;</span> == a.charAt(d); )</span><br><span class="line">        ++d;</span><br><span class="line">    <span class="keyword">if</span> (d == a.length)</span><br><span class="line">        b = <span class="keyword">new</span> t;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> e = a.length - d</span><br><span class="line">            , g = e % u;</span><br><span class="line">        <span class="keyword">for</span> (<span class="number">0</span> == g &amp;&amp; (g = u),</span><br><span class="line">                 b = f.biFromNumber(<span class="built_in">Number</span>(a.substr(d, g))),</span><br><span class="line">                 d += g; d &lt; a.length; )</span><br><span class="line">            b = f.biAdd(f.biMultiply(b, v), f.biFromNumber(<span class="built_in">Number</span>(a.substr(d, u)))),</span><br><span class="line">                d += u;</span><br><span class="line">        b.isNeg = c</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biCopy = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="keyword">new</span> t(!<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> b.digits = a.digits.slice(<span class="number">0</span>),</span><br><span class="line">            b.isNeg = a.isNeg,</span><br><span class="line">            b</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.reverseStr = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="string">&quot;&quot;</span>, c = a.length - <span class="number">1</span>; c &gt; <span class="number">-1</span>; --c)</span><br><span class="line">            b += a.charAt(c);</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line">;</span><br><span class="line"><span class="keyword">var</span> w = [<span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>, <span class="string">&quot;g&quot;</span>, <span class="string">&quot;h&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;j&quot;</span>, <span class="string">&quot;k&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;m&quot;</span>, <span class="string">&quot;n&quot;</span>, <span class="string">&quot;o&quot;</span>, <span class="string">&quot;p&quot;</span>, <span class="string">&quot;q&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;s&quot;</span>, <span class="string">&quot;t&quot;</span>, <span class="string">&quot;u&quot;</span>, <span class="string">&quot;v&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;y&quot;</span>, <span class="string">&quot;z&quot;</span>];</span><br><span class="line">f.biToString = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="keyword">new</span> t;</span><br><span class="line">    c.digits[<span class="number">0</span>] = b;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> d = f.biDivideModulo(a, c), e = w[d[<span class="number">1</span>].digits[<span class="number">0</span>]]; <span class="number">1</span> == f.biCompare(d[<span class="number">0</span>], l); )</span><br><span class="line">        d = f.biDivideModulo(d[<span class="number">0</span>], c),</span><br><span class="line">            digit = d[<span class="number">1</span>].digits[<span class="number">0</span>],</span><br><span class="line">            e += w[d[<span class="number">1</span>].digits[<span class="number">0</span>]];</span><br><span class="line">    <span class="keyword">return</span> (a.isNeg ? <span class="string">&quot;-&quot;</span> : <span class="string">&quot;&quot;</span>) + f.reverseStr(e)</span><br><span class="line">&#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biToDecimal = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="keyword">new</span> t;</span><br><span class="line">        b.digits[<span class="number">0</span>] = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> c = f.biDivideModulo(a, b), d = <span class="built_in">String</span>(c[<span class="number">1</span>].digits[<span class="number">0</span>]); <span class="number">1</span> == f.biCompare(c[<span class="number">0</span>], l); )</span><br><span class="line">            c = f.biDivideModulo(c[<span class="number">0</span>], b),</span><br><span class="line">                d += <span class="built_in">String</span>(c[<span class="number">1</span>].digits[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> (a.isNeg ? <span class="string">&quot;-&quot;</span> : <span class="string">&quot;&quot;</span>) + f.reverseStr(d)</span><br><span class="line">    &#125;</span><br><span class="line">;</span><br><span class="line"><span class="keyword">var</span> x = [<span class="string">&quot;0&quot;</span>, <span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;8&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;c&quot;</span>, <span class="string">&quot;d&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;f&quot;</span>];</span><br><span class="line">f.digitToHex = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">15</span></span><br><span class="line">        , c = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; <span class="number">4</span> &gt; i; ++i)</span><br><span class="line">        c += x[a &amp; b],</span><br><span class="line">            a &gt;&gt;&gt;= <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> f.reverseStr(c)</span><br><span class="line">&#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biToHex = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        f.biHighIndex(a);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> c = f.biHighIndex(a); c &gt; <span class="number">-1</span>; --c)</span><br><span class="line">            b += f.digitToHex(a.digits[c]);</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.charToHex = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b, c = <span class="number">48</span>, d = c + <span class="number">9</span>, e = <span class="number">97</span>, f = e + <span class="number">25</span>, g = <span class="number">65</span>, h = <span class="number">90</span>;</span><br><span class="line">        <span class="keyword">return</span> b = a &gt;= c &amp;&amp; d &gt;= a ? a - c : a &gt;= g &amp;&amp; h &gt;= a ? <span class="number">10</span> + a - g : a &gt;= e &amp;&amp; f &gt;= a ? <span class="number">10</span> + a - e : <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.hexToDigit = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="number">0</span>, c = <span class="built_in">Math</span>.min(a.length, <span class="number">4</span>), d = <span class="number">0</span>; c &gt; d; ++d)</span><br><span class="line">            b &lt;&lt;= <span class="number">4</span>,</span><br><span class="line">                b |= f.charToHex(a.charCodeAt(d));</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biFromHex = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> b = <span class="keyword">new</span> t, c = a.length, d = c, e = <span class="number">0</span>; d &gt; <span class="number">0</span>; d -= <span class="number">4</span>,</span><br><span class="line">            ++e)</span><br><span class="line">            b.digits[e] = f.hexToDigit(a.substr(<span class="built_in">Math</span>.max(d - <span class="number">4</span>, <span class="number">0</span>), <span class="built_in">Math</span>.min(d, <span class="number">4</span>)));</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biFromString = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="string">&quot;-&quot;</span> == a.charAt(<span class="number">0</span>)</span><br><span class="line">            , d = c ? <span class="number">1</span> : <span class="number">0</span></span><br><span class="line">            , e = <span class="keyword">new</span> t</span><br><span class="line">            , g = <span class="keyword">new</span> t;</span><br><span class="line">        g.digits[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> h = a.length - <span class="number">1</span>; h &gt;= d; h--) &#123;</span><br><span class="line">            <span class="keyword">var</span> i = a.charCodeAt(h)</span><br><span class="line">                , j = f.charToHex(i)</span><br><span class="line">                , k = f.biMultiplyDigit(g, j);</span><br><span class="line">            e = f.biAdd(e, k),</span><br><span class="line">                g = f.biMultiplyDigit(g, b)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> e.isNeg = c,</span><br><span class="line">            e</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biDump = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (a.isNeg ? <span class="string">&quot;-&quot;</span> : <span class="string">&quot;&quot;</span>) + a.digits.join(<span class="string">&quot; &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biAdd = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c;</span><br><span class="line">        <span class="keyword">if</span> (a.isNeg != b.isNeg)</span><br><span class="line">            b.isNeg = !b.isNeg,</span><br><span class="line">                c = f.biSubtract(a, b),</span><br><span class="line">                b.isNeg = !b.isNeg;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            c = <span class="keyword">new</span> t;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> d, e = <span class="number">0</span>, g = <span class="number">0</span>; g &lt; a.digits.length; ++g)</span><br><span class="line">                d = a.digits[g] + b.digits[g] + e,</span><br><span class="line">                    c.digits[g] = d % p,</span><br><span class="line">                    e = <span class="built_in">Number</span>(d &gt;= p);</span><br><span class="line">            c.isNeg = a.isNeg</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biSubtract = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c;</span><br><span class="line">        <span class="keyword">if</span> (a.isNeg != b.isNeg)</span><br><span class="line">            b.isNeg = !b.isNeg,</span><br><span class="line">                c = f.biAdd(a, b),</span><br><span class="line">                b.isNeg = !b.isNeg;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            c = <span class="keyword">new</span> t;</span><br><span class="line">            <span class="keyword">var</span> d, e;</span><br><span class="line">            e = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0</span>; g &lt; a.digits.length; ++g)</span><br><span class="line">                d = a.digits[g] - b.digits[g] + e,</span><br><span class="line">                    c.digits[g] = d % p,</span><br><span class="line">                c.digits[g] &lt; <span class="number">0</span> &amp;&amp; (c.digits[g] += p),</span><br><span class="line">                    e = <span class="number">0</span> - <span class="built_in">Number</span>(<span class="number">0</span> &gt; d);</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">-1</span> == e) &#123;</span><br><span class="line">                e = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0</span>; g &lt; a.digits.length; ++g)</span><br><span class="line">                    d = <span class="number">0</span> - c.digits[g] + e,</span><br><span class="line">                        c.digits[g] = d % p,</span><br><span class="line">                    c.digits[g] &lt; <span class="number">0</span> &amp;&amp; (c.digits[g] += p),</span><br><span class="line">                        e = <span class="number">0</span> - <span class="built_in">Number</span>(<span class="number">0</span> &gt; d);</span><br><span class="line">                c.isNeg = !a.isNeg</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                c.isNeg = a.isNeg</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biHighIndex = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> b = a.digits.length - <span class="number">1</span>; b &gt; <span class="number">0</span> &amp;&amp; <span class="number">0</span> == a.digits[b]; )</span><br><span class="line">            --b;</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biNumBits = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> b, c = f.biHighIndex(a), d = a.digits[c], e = (c + <span class="number">1</span>) * o;</span><br><span class="line">        <span class="keyword">for</span> (b = e; b &gt; e - o &amp;&amp; <span class="number">0</span> == (<span class="number">32768</span> &amp; d); --b)</span><br><span class="line">            d &lt;&lt;= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biMultiply = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> c, d, e, g = <span class="keyword">new</span> t, h = f.biHighIndex(a), i = f.biHighIndex(b), k = <span class="number">0</span>; i &gt;= k; ++k) &#123;</span><br><span class="line">            <span class="keyword">for</span> (c = <span class="number">0</span>,</span><br><span class="line">                     e = k,</span><br><span class="line">                     j = <span class="number">0</span>; h &gt;= j; ++j,</span><br><span class="line">                     ++e)</span><br><span class="line">                d = g.digits[e] + a.digits[j] * b.digits[k] + c,</span><br><span class="line">                    g.digits[e] = d &amp; s,</span><br><span class="line">                    c = d &gt;&gt;&gt; n;</span><br><span class="line">            g.digits[k + h + <span class="number">1</span>] = c</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> g.isNeg = a.isNeg != b.isNeg,</span><br><span class="line">            g</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biMultiplyDigit = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c, d, e;</span><br><span class="line">        result = <span class="keyword">new</span> t,</span><br><span class="line">            c = f.biHighIndex(a),</span><br><span class="line">            d = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> g = <span class="number">0</span>; c &gt;= g; ++g)</span><br><span class="line">            e = result.digits[g] + a.digits[g] * b + d,</span><br><span class="line">                result.digits[g] = e &amp; s,</span><br><span class="line">                d = e &gt;&gt;&gt; n;</span><br><span class="line">        <span class="keyword">return</span> result.digits[<span class="number">1</span> + c] = d,</span><br><span class="line">            result</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.arrayCopy = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c, d, e</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> f = <span class="built_in">Math</span>.min(b + e, a.length), g = b, h = d; f &gt; g; ++g,</span><br><span class="line">            ++h)</span><br><span class="line">            c[h] = a[g]</span><br><span class="line">    &#125;</span><br><span class="line">;</span><br><span class="line"><span class="keyword">var</span> y = [<span class="number">0</span>, <span class="number">32768</span>, <span class="number">49152</span>, <span class="number">57344</span>, <span class="number">61440</span>, <span class="number">63488</span>, <span class="number">64512</span>, <span class="number">65024</span>, <span class="number">65280</span>, <span class="number">65408</span>, <span class="number">65472</span>, <span class="number">65504</span>, <span class="number">65520</span>, <span class="number">65528</span>, <span class="number">65532</span>, <span class="number">65534</span>, <span class="number">65535</span>];</span><br><span class="line">f.biShiftLeft = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="built_in">Math</span>.floor(b / o)</span><br><span class="line">        , d = <span class="keyword">new</span> t;</span><br><span class="line">    f.arrayCopy(a.digits, <span class="number">0</span>, d.digits, c, d.digits.length - c);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> e = b % o, g = o - e, h = d.digits.length - <span class="number">1</span>, i = h - <span class="number">1</span>; h &gt; <span class="number">0</span>; --h,</span><br><span class="line">        --i)</span><br><span class="line">        d.digits[h] = d.digits[h] &lt;&lt; e &amp; s | (d.digits[i] &amp; y[e]) &gt;&gt;&gt; g;</span><br><span class="line">    <span class="keyword">return</span> d.digits[<span class="number">0</span>] = d.digits[h] &lt;&lt; e &amp; s,</span><br><span class="line">        d.isNeg = a.isNeg,</span><br><span class="line">        d</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="keyword">var</span> z = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">31</span>, <span class="number">63</span>, <span class="number">127</span>, <span class="number">255</span>, <span class="number">511</span>, <span class="number">1023</span>, <span class="number">2047</span>, <span class="number">4095</span>, <span class="number">8191</span>, <span class="number">16383</span>, <span class="number">32767</span>, <span class="number">65535</span>];</span><br><span class="line">f.biShiftRight = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="built_in">Math</span>.floor(b / o)</span><br><span class="line">        , d = <span class="keyword">new</span> t;</span><br><span class="line">    f.arrayCopy(a.digits, c, d.digits, <span class="number">0</span>, a.digits.length - c);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> e = b % o, g = o - e, h = <span class="number">0</span>, i = h + <span class="number">1</span>; h &lt; d.digits.length - <span class="number">1</span>; ++h,</span><br><span class="line">        ++i)</span><br><span class="line">        d.digits[h] = d.digits[h] &gt;&gt;&gt; e | (d.digits[i] &amp; z[e]) &lt;&lt; g;</span><br><span class="line">    <span class="keyword">return</span> d.digits[d.digits.length - <span class="number">1</span>] &gt;&gt;&gt;= e,</span><br><span class="line">        d.isNeg = a.isNeg,</span><br><span class="line">        d</span><br><span class="line">&#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biMultiplyByRadixPower = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="keyword">new</span> t;</span><br><span class="line">        <span class="keyword">return</span> f.arrayCopy(a.digits, <span class="number">0</span>, c.digits, b, c.digits.length - b),</span><br><span class="line">            c</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biDivideByRadixPower = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="keyword">new</span> t;</span><br><span class="line">        <span class="keyword">return</span> f.arrayCopy(a.digits, b, c.digits, <span class="number">0</span>, c.digits.length - b),</span><br><span class="line">            c</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biModuloByRadixPower = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c = <span class="keyword">new</span> t;</span><br><span class="line">        <span class="keyword">return</span> f.arrayCopy(a.digits, <span class="number">0</span>, c.digits, <span class="number">0</span>, b),</span><br><span class="line">            c</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biCompare = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a.isNeg != b.isNeg)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> - <span class="number">2</span> * <span class="built_in">Number</span>(a.isNeg);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> c = a.digits.length - <span class="number">1</span>; c &gt;= <span class="number">0</span>; --c)</span><br><span class="line">            <span class="keyword">if</span> (a.digits[c] != b.digits[c])</span><br><span class="line">                <span class="keyword">return</span> a.isNeg ? <span class="number">1</span> - <span class="number">2</span> * <span class="built_in">Number</span>(a.digits[c] &gt; b.digits[c]) : <span class="number">1</span> - <span class="number">2</span> * <span class="built_in">Number</span>(a.digits[c] &lt; b.digits[c]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biDivideModulo = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c, d, e = f.biNumBits(a), g = f.biNumBits(b), h = b.isNeg;</span><br><span class="line">        <span class="keyword">if</span> (g &gt; e)</span><br><span class="line">            <span class="keyword">return</span> a.isNeg ? (c = f.biCopy(m),</span><br><span class="line">                c.isNeg = !b.isNeg,</span><br><span class="line">                a.isNeg = !<span class="number">1</span>,</span><br><span class="line">                b.isNeg = !<span class="number">1</span>,</span><br><span class="line">                d = biSubtract(b, a),</span><br><span class="line">                a.isNeg = !<span class="number">0</span>,</span><br><span class="line">                b.isNeg = h) : (c = <span class="keyword">new</span> t,</span><br><span class="line">                d = f.biCopy(a)),</span><br><span class="line">                [c, d];</span><br><span class="line">        c = <span class="keyword">new</span> t,</span><br><span class="line">            d = a;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="built_in">Math</span>.ceil(g / o) - <span class="number">1</span>, j = <span class="number">0</span>; b.digits[i] &lt; q; )</span><br><span class="line">            b = f.biShiftLeft(b, <span class="number">1</span>),</span><br><span class="line">                ++j,</span><br><span class="line">                ++g,</span><br><span class="line">                i = <span class="built_in">Math</span>.ceil(g / o) - <span class="number">1</span>;</span><br><span class="line">        d = f.biShiftLeft(d, j),</span><br><span class="line">            e += j;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="built_in">Math</span>.ceil(e / o) - <span class="number">1</span>, l = f.biMultiplyByRadixPower(b, k - i); <span class="number">-1</span> != f.biCompare(d, l); )</span><br><span class="line">            ++c.digits[k - i],</span><br><span class="line">                d = f.biSubtract(d, l);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> n = k; n &gt; i; --n) &#123;</span><br><span class="line">            <span class="keyword">var</span> u = n &gt;= d.digits.length ? <span class="number">0</span> : d.digits[n]</span><br><span class="line">                , v = n - <span class="number">1</span> &gt;= d.digits.length ? <span class="number">0</span> : d.digits[n - <span class="number">1</span>]</span><br><span class="line">                , w = n - <span class="number">2</span> &gt;= d.digits.length ? <span class="number">0</span> : d.digits[n - <span class="number">2</span>]</span><br><span class="line">                , x = i &gt;= b.digits.length ? <span class="number">0</span> : b.digits[i]</span><br><span class="line">                , y = i - <span class="number">1</span> &gt;= b.digits.length ? <span class="number">0</span> : b.digits[i - <span class="number">1</span>];</span><br><span class="line">            c.digits[n - i - <span class="number">1</span>] = u == x ? s : <span class="built_in">Math</span>.floor((u * p + v) / x);</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> z = c.digits[n - i - <span class="number">1</span>] * (x * p + y), A = u * r + (v * p + w); z &gt; A; )</span><br><span class="line">                --c.digits[n - i - <span class="number">1</span>],</span><br><span class="line">                    z = c.digits[n - i - <span class="number">1</span>] * (x * p | y),</span><br><span class="line">                    A = u * p * p + (v * p + w);</span><br><span class="line">            l = f.biMultiplyByRadixPower(b, n - i - <span class="number">1</span>),</span><br><span class="line">                d = f.biSubtract(d, f.biMultiplyDigit(l, c.digits[n - i - <span class="number">1</span>])),</span><br><span class="line">            d.isNeg &amp;&amp; (d = f.biAdd(d, l),</span><br><span class="line">                --c.digits[n - i - <span class="number">1</span>])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d = f.biShiftRight(d, j),</span><br><span class="line">            c.isNeg = a.isNeg != h,</span><br><span class="line">        a.isNeg &amp;&amp; (c = h ? f.biAdd(c, m) : f.biSubtract(c, m),</span><br><span class="line">            b = f.biShiftRight(b, j),</span><br><span class="line">            d = f.biSubtract(b, d)),</span><br><span class="line">        <span class="number">0</span> == d.digits[<span class="number">0</span>] &amp;&amp; <span class="number">0</span> == f.biHighIndex(d) &amp;&amp; (d.isNeg = !<span class="number">1</span>),</span><br><span class="line">            [c, d]</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biDivide = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f.biDivideModulo(a, b)[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biModulo = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f.biDivideModulo(a, b)[<span class="number">1</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biMultiplyMod = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f.biModulo(f.biMultiply(a, b), c)</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biPow = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> c = m, d = a; ; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> != (<span class="number">1</span> &amp; b) &amp;&amp; (c = f.biMultiply(c, d)),</span><br><span class="line">                b &gt;&gt;= <span class="number">1</span>,</span><br><span class="line">            <span class="number">0</span> == b)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            d = f.biMultiply(d, d)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.biPowMod = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> d = m, e = a, g = b; ; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> != (<span class="number">1</span> &amp; g.digits[<span class="number">0</span>]) &amp;&amp; (d = f.biMultiplyMod(d, e, c)),</span><br><span class="line">                g = f.biShiftRight(g, <span class="number">1</span>),</span><br><span class="line">            <span class="number">0</span> == g.digits[<span class="number">0</span>] &amp;&amp; <span class="number">0</span> == f.biHighIndex(g))</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            e = f.biMultiplyMod(e, e, c)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> d</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    g.BarrettMu = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.modulus = f.biCopy(a),</span><br><span class="line">            <span class="built_in">this</span>.k = f.biHighIndex(<span class="built_in">this</span>.modulus) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> b = <span class="keyword">new</span> t;</span><br><span class="line">        b.digits[<span class="number">2</span> * <span class="built_in">this</span>.k] = <span class="number">1</span>,</span><br><span class="line">            <span class="built_in">this</span>.mu = f.biDivide(b, <span class="built_in">this</span>.modulus),</span><br><span class="line">            <span class="built_in">this</span>.bkplus1 = <span class="keyword">new</span> t,</span><br><span class="line">            <span class="built_in">this</span>.bkplus1.digits[<span class="built_in">this</span>.k + <span class="number">1</span>] = <span class="number">1</span>,</span><br><span class="line">            <span class="built_in">this</span>.modulo = c,</span><br><span class="line">            <span class="built_in">this</span>.multiplyMod = d,</span><br><span class="line">            <span class="built_in">this</span>.powMod = e</span><br><span class="line">    &#125;</span><br><span class="line">;</span><br><span class="line"><span class="keyword">var</span> A = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d = f;</span><br><span class="line">    <span class="built_in">this</span>.e = d.biFromHex(a),</span><br><span class="line">        <span class="built_in">this</span>.d = d.biFromHex(b),</span><br><span class="line">        <span class="built_in">this</span>.m = d.biFromHex(c),</span><br><span class="line">        <span class="built_in">this</span>.chunkSize = <span class="number">2</span> * d.biHighIndex(<span class="built_in">this</span>.m),</span><br><span class="line">        <span class="built_in">this</span>.radix = <span class="number">16</span>,</span><br><span class="line">        <span class="built_in">this</span>.barrett = <span class="keyword">new</span> g.BarrettMu(<span class="built_in">this</span>.m)</span><br><span class="line">&#125;;</span><br><span class="line">f.getKeyPair = <span class="function"><span class="keyword">function</span>(<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> A(a,b,c)</span><br><span class="line">&#125;</span><br><span class="line">    ,</span><br><span class="line"><span class="string">&quot;undefined&quot;</span> == <span class="keyword">typeof</span> g.twoDigit &amp;&amp; (g.twoDigit = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">10</span> &gt; a ? <span class="string">&quot;0&quot;</span> : <span class="string">&quot;&quot;</span>) + <span class="built_in">String</span>(a)</span><br><span class="line">    &#125;</span><br><span class="line">),</span><br><span class="line">    f.encryptedString = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> c = [], d = b.length, e = <span class="number">0</span>; d &gt; e; )</span><br><span class="line">            c[e] = b.charCodeAt(e),</span><br><span class="line">                e++;</span><br><span class="line">        <span class="keyword">for</span> (; <span class="number">0</span> != c.length % a.chunkSize; )</span><br><span class="line">            c[e++] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">var</span> g, h, i, j = c.length, k = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (e = <span class="number">0</span>; j &gt; e; e += a.chunkSize) &#123;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="keyword">new</span> t,</span><br><span class="line">                     g = <span class="number">0</span>,</span><br><span class="line">                     h = e; h &lt; e + a.chunkSize; ++g)</span><br><span class="line">                i.digits[g] = c[h++],</span><br><span class="line">                    i.digits[g] += c[h++] &lt;&lt; <span class="number">8</span>;</span><br><span class="line">            <span class="keyword">var</span> l = a.barrett.powMod(i, a.e)</span><br><span class="line">                , m = <span class="number">16</span> == a.radix ? f.biToHex(l) : f.biToString(l, a.radix);</span><br><span class="line">            k += m + <span class="string">&quot; &quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> k.substring(<span class="number">0</span>, k.length - <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.decryptedString = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> c, d, e, g = b.split(<span class="string">&quot; &quot;</span>), h = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (c = <span class="number">0</span>; c &lt; g.length; ++c) &#123;</span><br><span class="line">            <span class="keyword">var</span> i;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">16</span> == a.radix ? f.biFromHex(g[c]) : f.biFromString(g[c], a.radix),</span><br><span class="line">                     e = a.barrett.powMod(i, a.d),</span><br><span class="line">                     d = <span class="number">0</span>; d &lt;= f.biHighIndex(e); ++d)</span><br><span class="line">                h += <span class="built_in">String</span>.fromCharCode(<span class="number">255</span> &amp; e.digits[d], e.digits[d] &gt;&gt; <span class="number">8</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> == h.charCodeAt(h.length - <span class="number">1</span>) &amp;&amp; (h = h.substring(<span class="number">0</span>, h.length - <span class="number">1</span>)),</span><br><span class="line">            h</span><br><span class="line">    &#125;</span><br><span class="line">    ,</span><br><span class="line">    f.setMaxDigits(<span class="number">130</span>),</span><br><span class="line">    b[a] = g</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getpwd</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> t = <span class="string">&quot;ab86b6371b5318aaa1d3c9e612a9f1264f372323c8c0f19875b5fc3b3fd3afcc1e5bec527aa94bfa85bffc157e4245aebda05389a5357b75115ac94f074aefcd&quot;</span>,</span><br><span class="line">        n = <span class="string">&quot;10001&quot;</span>,</span><br><span class="line">        a = f.getKeyPair(n, <span class="string">&quot;&quot;</span>, t),</span><br><span class="line">        i = f.encryptedString(a, <span class="built_in">encodeURIComponent</span>(e)).replace(<span class="regexp">/\s/g</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> i</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.info(getpwd(<span class="string">&quot;1111111111111&quot;</span>))</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/06/Encrypt%20Python%20RSA%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/06/Encrypt%20Python%20RSA%E6%96%87%E4%BB%B6%E5%8A%A0%E5%AF%86/" class="post-title-link" itemprop="url">Encrypt Python RSA文件加密</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-06 17:25:07" itemprop="dateCreated datePublished" datetime="2019-10-06T17:25:07+08:00">2019-10-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 15:20:23" itemprop="dateModified" datetime="2020-04-24T15:20:23+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">加密算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>如果前面有了解RSA算法的话，那么肯定知道，我们第一步就是要生成公钥和私钥，用公钥对文件进行加密，用私钥对文件进行解密。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES, PKCS1_OAEP</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CreateRSAKeys</span>():</span></span><br><span class="line">    code = <span class="string">&#x27;nooneknows&#x27;</span></span><br><span class="line">    <span class="comment"># 生成2048位的RSA密钥</span></span><br><span class="line">    key = RSA.generate(<span class="number">2048</span>)</span><br><span class="line">    encrypted_key = key.exportKey(passphrase=code, pkcs=<span class="number">8</span>, protection=<span class="string">&quot;scryptAndAES128-CBC&quot;</span>)</span><br><span class="line">    <span class="comment"># 生成私钥</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;my_private_rsa_key.bin&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(encrypted_key)</span><br><span class="line">    <span class="comment"># 生成公钥</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">&#x27;my_rsa_public.pem&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(key.publickey().exportKey())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Encrypt</span>(<span class="params">filename</span>):</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># 二进制只读打开文件,读取文件数据</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> out_file:</span><br><span class="line">        <span class="comment"># 收件人秘钥 - 公钥</span></span><br><span class="line">        recipient_key = RSA.import_key(open(<span class="string">&#x27;my_rsa_public.pem&#x27;</span>).read())</span><br><span class="line">        <span class="comment"># 一个16字节的会话密钥</span></span><br><span class="line">        session_key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line">        <span class="comment"># Encrypt the session key with the public RSA key</span></span><br><span class="line">        cipher_rsa = PKCS1_OAEP.new(recipient_key)  <span class="comment"># 最优非对称加密填充</span></span><br><span class="line">        out_file.write(cipher_rsa.encrypt(session_key))</span><br><span class="line">        <span class="comment"># Encrypt the data with the AES session key</span></span><br><span class="line">        cipher_aes = AES.new(session_key, AES.MODE_EAX)</span><br><span class="line">        <span class="comment"># 得到加密的文本和消息认证码</span></span><br><span class="line">        ciphertext, tag = cipher_aes.encrypt_and_digest(data)</span><br><span class="line">        <span class="comment"># 将随机数，消息认证码和加密的文本写入文件</span></span><br><span class="line">        out_file.write(cipher_aes.nonce)</span><br><span class="line">        out_file.write(tag)</span><br><span class="line">        out_file.write(ciphertext)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Descrypt</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    二进制模式读取加密文件导入私钥，需要提供一个密码</span></span><br><span class="line"><span class="string">    :param filename:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    code = <span class="string">&#x27;nooneknows&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fobj:</span><br><span class="line">        <span class="comment"># 导入密钥</span></span><br><span class="line">        private_key = RSA.import_key(open(<span class="string">&#x27;my_private_rsa_key.bin&#x27;</span>).read(), passphrase=code)</span><br><span class="line">        <span class="comment"># 会话密钥,随机数,消息认证码,加密数据</span></span><br><span class="line">        enc_session_key, nonce, tag, ciphertext = [fobj.read(x)</span><br><span class="line">                                                   <span class="keyword">for</span> x <span class="keyword">in</span> (private_key.size_in_bytes(),</span><br><span class="line">                                                             <span class="number">16</span>, <span class="number">16</span>, <span class="number">-1</span>)]</span><br><span class="line">        cipher_rsa = PKCS1_OAEP.new(private_key)</span><br><span class="line">        session_key = cipher_rsa.decrypt(enc_session_key)</span><br><span class="line">        cipher_aes = AES.new(session_key, AES.MODE_EAX, nonce)</span><br><span class="line">        <span class="comment"># 解密</span></span><br><span class="line">        data = cipher_aes.decrypt_and_verify(ciphertext, tag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> wobj:</span><br><span class="line">        wobj.write(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RenameFile</span>(<span class="params">dir, filename</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    修改文件名后缀</span></span><br><span class="line"><span class="string">    :param dir:</span></span><br><span class="line"><span class="string">    :param filename:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    filename_bytes = filename.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    filename_bytes_base64 = base64.encodebytes(filename_bytes)</span><br><span class="line"></span><br><span class="line">    filename_bytes_base64 = filename_bytes_base64[::<span class="number">-1</span>][<span class="number">1</span>:]</span><br><span class="line">    new_filename = filename_bytes_base64.decode(<span class="string">&#x27;utf-8&#x27;</span>) + <span class="string">&#x27;.crypt1&#x27;</span></span><br><span class="line">    print(os.path.join(dir, filename))</span><br><span class="line">    print(os.path.join(dir, new_filename))</span><br><span class="line">    os.rename(os.path.join(dir, filename), os.path.join(dir, new_filename))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ReserveFilename</span>(<span class="params">dir, filename</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    恢复文件名</span></span><br><span class="line"><span class="string">    :param dir:</span></span><br><span class="line"><span class="string">    :param filename:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    f = filename</span><br><span class="line">    filename = filename[::<span class="number">-1</span>][<span class="number">7</span>:][::<span class="number">-1</span>]</span><br><span class="line">    filename_base64 = filename[::<span class="number">-1</span>] + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    filename_bytes_base64 = filename_base64.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    ori_filename = base64.decodebytes(filename_bytes_base64).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    print(os.path.join(dir, f))</span><br><span class="line">    print(os.path.join(dir, ori_filename))</span><br><span class="line">    os.rename(os.path.join(dir, f), os.path.join(dir, ori_filename))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Main</span>(<span class="params">rootDir</span>):</span></span><br><span class="line">    list_dirs = os.walk(rootDir)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> list_dirs:</span><br><span class="line">        <span class="comment"># 切换加密和解密过程</span></span><br><span class="line">        <span class="comment"># if False:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="comment"># 遍历文件，加密并且改名</span></span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> files:</span><br><span class="line">                filename = os.path.join(root, f)</span><br><span class="line">                Encrypt(filename)</span><br><span class="line">                RenameFile(root, f)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 遍历文件，解密并且恢复名字</span></span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> files:</span><br><span class="line">                filename = os.path.join(root, f)</span><br><span class="line">                Descrypt(filename)</span><br><span class="line">                ReserveFilename(root, f)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># CreateRSAKeys()</span></span><br><span class="line">    d = <span class="string">&#x27;D:/my&#x27;</span></span><br><span class="line">    Main(d)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/05/Javascript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%9A%844%E7%A7%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/05/Javascript%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B%E7%9A%844%E7%A7%8D%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Javascript异步编程的4种方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-05 22:30:00" itemprop="dateCreated datePublished" datetime="2019-10-05T22:30:00+08:00">2019-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 10:50:30" itemprop="dateModified" datetime="2020-04-24T10:50:30+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">前端进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文总结了”异步模式”编程的4种方法，理解它们可以让你写出结构更合理、性能更出色、维护更方便的Javascript程序。</p>
<h2 id="一、回调函数"><a href="#一、回调函数" class="headerlink" title="一、回调函数"></a>一、回调函数</h2><p>这是异步编程最基本的方法。</p>
<p>假定有两个函数f1和f2，后者等待前者的执行结果。</p>
<p>　　f1();</p>
<p>　　f2();</p>
<p>如果f1是一个很耗时的任务，可以考虑改写f1，把f2写成f1的回调函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　　　<span class="comment">// f1的任务代码</span></span><br><span class="line"></span><br><span class="line">　　　　　　callback();</span><br><span class="line"></span><br><span class="line">　　　　&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>执行代码就变成下面这样：</p>
<p>　　f1(f2);</p>
<p>采用这种方式，我们把同步操作变成了异步操作，f1不会堵塞程序运行，相当于先执行程序的主要逻辑，将耗时的操作推迟执行。</p>
<p>回调函数的优点是简单、容易理解和部署，缺点是不利于代码的阅读和维护，各个部分之间高度耦合（Coupling），流程会很混乱，而且每个任务只能指定一个回调函数。</p>
<h2 id="二、事件监听"><a href="#二、事件监听" class="headerlink" title="二、事件监听"></a>二、事件监听</h2><p>另一种思路是采用事件驱动模式。任务的执行不取决于代码的顺序，而取决于某个事件是否发生。</p>
<p>还是以f1和f2为例。首先，为f1绑定一个事件（这里采用的jQuery的写法）。</p>
<p>　　f1.on(‘done’, f2);</p>
<p>上面这行代码的意思是，当f1发生done事件，就执行f2。然后，对f1进行改写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　　　<span class="comment">// f1的任务代码</span></span><br><span class="line"></span><br><span class="line">　　　　　　f1.trigger(<span class="string">&#x27;done&#x27;</span>);</span><br><span class="line"></span><br><span class="line">　　　　&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>f1.trigger(‘done’)表示，执行完成后，立即触发done事件，从而开始执行f2。</p>
<p>这种方法的优点是比较容易理解，可以绑定多个事件，每个事件可以指定多个回调函数，而且可以”去耦合”（Decoupling），有利于实现模块化。缺点是整个程序都要变成事件驱动型，运行流程会变得很不清晰。</p>
<h2 id="三、发布-订阅"><a href="#三、发布-订阅" class="headerlink" title="三、发布/订阅"></a>三、发布/订阅</h2><p>上一节的”事件”，完全可以理解成”信号”。</p>
<p>我们假定，存在一个”信号中心”，某个任务执行完成，就向信号中心”发布”（publish）一个信号，其他任务可以向信号中心”订阅”（subscribe）这个信号，从而知道什么时候自己可以开始执行。这就叫做”发布/订阅模式”（publish-subscribe pattern），又称”观察者模式”（observer pattern）。</p>
<p>这个模式有多种实现，下面采用的是Ben Alman的Tiny Pub/Sub，这是jQuery的一个插件。</p>
<p>首先，f2向”信号中心”jQuery订阅”done”信号。</p>
<p>　　jQuery.subscribe(“done”, f2);</p>
<p>然后，f1进行如下改写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　　　<span class="comment">// f1的任务代码</span></span><br><span class="line"></span><br><span class="line">　　　　　　jQuery.publish(<span class="string">&quot;done&quot;</span>);</span><br><span class="line"></span><br><span class="line">　　　　&#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>jQuery.publish(“done”)的意思是，f1执行完成后，向”信号中心”jQuery发布”done”信号，从而引发f2的执行。</p>
<p>此外，f2完成执行后，也可以取消订阅（unsubscribe）。</p>
<p>　　jQuery.unsubscribe(“done”, f2);</p>
<p>这种方法的性质与”事件监听”类似，但是明显优于后者。因为我们可以通过查看”消息中心”，了解存在多少信号、每个信号有多少订阅者，从而监控程序的运行。</p>
<h2 id="四、Promises对象"><a href="#四、Promises对象" class="headerlink" title="四、Promises对象"></a>四、Promises对象</h2><p>Promises对象是CommonJS工作组提出的一种规范，目的是为异步编程提供统一接口。</p>
<p>简单说，它的思想是，每一个异步任务返回一个Promise对象，该对象有一个then方法，允许指定回调函数。比如，f1的回调函数f2,可以写成：</p>
<p>　　f1().then(f2);</p>
<p>f1要进行如下改写（这里使用的是jQuery的实现）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">　　<span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　<span class="keyword">var</span> dfd = $.Deferred();</span><br><span class="line"></span><br><span class="line">　　　　<span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">　　　　　　<span class="comment">// f1的任务代码</span></span><br><span class="line"></span><br><span class="line">　　　　　　dfd.resolve();</span><br><span class="line"></span><br><span class="line">　　　　&#125;, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">　　　　<span class="keyword">return</span> dfd.promise;</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure>
<p>这样写的优点在于，回调函数变成了链式写法，程序的流程可以看得很清楚，而且有一整套的配套方法，可以实现许多强大的功能。</p>
<p>比如，指定多个回调函数：</p>
<p>　　f1().then(f2).then(f3);</p>
<p>再比如，指定发生错误时的回调函数：</p>
<p>　　f1().then(f2).fail(f3);</p>
<p>而且，它还有一个前面三种方法都没有的好处：如果一个任务已经完成，再添加回调函数，该回调函数会立即执行。<br>所以，你不用担心是否错过了某个事件或信号。这种方法的缺点就是编写和理解，都相对比较难。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/05/JavaScript%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/05/JavaScript%E5%87%BD%E6%95%B0%E5%A3%B0%E6%98%8E%E7%9A%84%E5%85%AD%E7%A7%8D%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">JavaScript函数声明的六种方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-05 22:30:00" itemprop="dateCreated datePublished" datetime="2019-10-05T22:30:00+08:00">2019-10-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-24 10:49:54" itemprop="dateModified" datetime="2020-04-24T10:49:54+08:00">2020-04-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">前端进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一个函数一次性定义的代码块可以多次调用。在JavaScript中，一个函数有很多元素组成，同时也受很多元素影响：</p>
<ul>
<li>函数体的代码</li>
<li>函数的参数列表</li>
<li>接受外部变量域的变量</li>
<li>返回值</li>
<li>当函数被调用时，this指上下文</li>
<li>命名和匿名函数</li>
<li>函数对象作为变量声明</li>
<li>arguments对象(在ES6中的箭头函数中将丢弃这个)<br>这些元素都会影响到函数，但具体影响函数的行为还是取决于函数的声明类型。在JavaScript中常见的声明类型有以下几种方法：</li>
</ul>
<p>函数声明类型对函数代码的影响只是轻微的。重要的是函数如何与外部组件交互功能（比如外部作用域、闭包、对象自身拥有的方法等）和调用方式（普通函数调用、方法调用和构造函数调用等）。</p>
<p>例如，你需要通过this在一个函数调用封闭的下下文（即this从外部函数继承过来）。最好的选择是使用箭头函数，很清楚的提供了必要的下下文。</p>
<p>比如下面示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Names</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">constructor</span> (names) &#123;</span><br><span class="line">        <span class="built_in">this</span>.names = names;</span><br><span class="line">    &#125;</span><br><span class="line">    contains(names) &#123;</span><br><span class="line">        <span class="keyword">return</span> names.every(<span class="function">(<span class="params">name</span>) =&gt;</span> <span class="built_in">this</span>.names.indexOf(name) !== <span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> countries = <span class="keyword">new</span> Names([<span class="string">&#x27;UK&#x27;</span>, <span class="string">&#x27;Italy&#x27;</span>, <span class="string">&#x27;Germany&#x27;</span>, <span class="string">&#x27;France&#x27;</span>]);  </span><br><span class="line">countries.contains([<span class="string">&#x27;UK&#x27;</span>, <span class="string">&#x27;Germany&#x27;</span>]); <span class="comment">// =&gt; true  </span></span><br><span class="line">countries.contains([<span class="string">&#x27;USA&#x27;</span>, <span class="string">&#x27;Italy&#x27;</span>]);  <span class="comment">// =&gt; false  </span></span><br></pre></td></tr></table></figure>
<p>箭头函数传给.every()的this（一个替代Names类）其实就是一个contains()方法。使用一个箭头(=&gt;)来声明一个函数是最适当的声明方式，特别是在这个案例中，上下文需要继承来自外部的方法.contains()。</p>
<p>如果试图使用一个函数表达式来调用.every()，这将需要更多的手工去配置上下文。有两种方式，第一种就是给.every(function(){…}, this)第二个参数，来表示上下文。或者在function(){…}.bind(this)使用.bind()作为回调函数。这是额外的代码，而箭头函数提供的上下文透明度更容易让人理解。</p>
<p>这篇文章介绍了如何在JavaScript中声明一个函数的六种方法。每一种类型都将会通过简短代码来阐述。感偿趣？</p>
<h2 id="函数声明-Function-declaration"><a href="#函数声明-Function-declaration" class="headerlink" title="函数声明(Function declaration)"></a>函数声明(Function declaration)</h2><p>函数声明通过关键词function来声明，关键词后面紧跟的是函数的名称，名称后面有一个小括号(()),括号里面放置了函数的参数(para1,…,paramN)和一对大括号{…}，函数的代码块就放在这个大括号内。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">name</span><span class="params">([param,[, param,[<span class="rest_arg">..., param</span>]]])</span> </span>&#123;</span><br><span class="line">   [statements]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>来看一个函数声明的示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function declaration</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isEven</span> (<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">isEven(<span class="number">24</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">isEven(<span class="number">11</span>); <span class="comment">// =&gt; false</span></span><br></pre></td></tr></table></figure>
<p>function isEven(num) {…}是一个函数声明，定义了一个isEven函数。用来判断一个数是不是偶数。</p>
<p>函数声明创建了一个变量，在当前作用域，这个变量就是函数的名称，而且是一个函数对象。这个函数变量存在变量生命提升，它会提到当前作用域的顶部，也就是说，在函数声明之前可以调用。</p>
<p>函数声明创建的函数已经被命名，也就是说函数对的name属性就是他声明的名称。在调试或者错误信息阅读的时候，其很有用。</p>
<p>下面的示例，演示了这些属性：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hoisted variable</span></span><br><span class="line"><span class="built_in">console</span>.log(hello(<span class="string">&#x27;Aliens&#x27;</span>)); <span class="comment">// =&gt; &#x27;Hello Aliens!&#x27;</span></span><br><span class="line"><span class="comment">// Named function</span></span><br><span class="line"><span class="built_in">console</span>.log(hello.name); <span class="comment">// =&gt; &#x27;hello&#x27;</span></span><br><span class="line"><span class="comment">// Variable holds the function object</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> hello); <span class="comment">// =&gt; &#x27;function&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`Hello <span class="subst">$&#123;name&#125;</span>!`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数声明function hello(name) {…}创建了一个hello变量，并且提升到当前作用域最顶部。hello变量是一个函数对象，以及hello.name包括了函数的名称hello。</p>
<h2 id="一个普通函数"><a href="#一个普通函数" class="headerlink" title="一个普通函数"></a>一个普通函数</h2><p>函数声明匹配的情况应该是创建一个普通函数。普通的意思意味着你声明的函数只是一次声明，但在后面可以多次调用它。它下的示例就是最基本的使用场景：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">5</span>, <span class="number">6</span>); <span class="comment">// =&gt; 11</span></span><br><span class="line">([<span class="number">3</span>, <span class="number">7</span>]).reduce(sum); <span class="comment">// =&gt; 10</span></span><br></pre></td></tr></table></figure>
<p>因为函数声明在当前作用域内创建了一个变量，其除了可以当作普通函数调用之外，还常用于递归或分离的事件侦听。函数表达式或箭头函数是无法创建绑定函数名称作为函数变量。</p>
<p>下面的示例演示了一递归的阶乘计算：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> n * factorial(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">factorial(<span class="number">4</span>); <span class="comment">// =&gt; 24</span></span><br></pre></td></tr></table></figure>
<p>有关于阶乘(Factorial)相关的详细介绍，可以点击这里。</p>
<p>在factorial()函数做递归计算时调用了开始声明的函数，将函数当作一个变量：factorial(n - 1)。当然也可以使用一个函数表达式，将其赋值给一个普能的变量，比如:var factorial = function (n) {…}。但函数声明function factorial(n)看起来更紧凑（不需要var和=）。</p>
<p>函数声明的一个重要属性是它的提升机制。它允许在相同的作用域范围内之前使用声明的函数。提升机制在很多情况下是有用的。例如，当你一个脚本内先看到了被调用的函数，但又没有仔细阅读函数的功能。而函数的功能实现可以位于下面的文件，你甚至都不用滚动代码。</p>
<p>你可以在这里了解函数声明的提升机制。</p>
<h2 id="与函数表达式区别"><a href="#与函数表达式区别" class="headerlink" title="与函数表达式区别"></a>与函数表达式区别</h2><p>函数声明和函数表达式很容易混淆。他们看起来非常相似，但他们具有不同的属性。</p>
<p>一个容易记住的规则：函数声明总是以function关键词开始，如果不是，那它就是一个函数表达式。</p>
<p>下面就是一个函数声明的示例，声明是以function关键词开始：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Function declaration: starts with &quot;function&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNil</span>(<span class="params">value</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> value == <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数表达式不是以function关键词开始（目前都一般出现在代码的中间地方）：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// <span class="keyword">Function</span> <span class="title">expression:</span> starts <span class="keyword">with</span> <span class="string">&quot;var&quot;</span></span><br><span class="line">var isTruthy = <span class="keyword">function</span>(value) &#123;  </span><br><span class="line">    <span class="keyword">return</span> !!value;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">// <span class="keyword">Function</span> <span class="title">expression:</span> an argument for .filter()</span><br><span class="line">var numbers = ([1, false, 5]).filter(<span class="keyword">function</span>(item) &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="type">typeof</span> item === <span class="symbol">&#x27;number</span>&#x27;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// <span class="keyword">Function</span> <span class="title">expression</span> (IIFE): starts <span class="keyword">with</span> <span class="string">&quot;(&quot;</span></span><br><span class="line">(<span class="keyword">function</span> <span class="title">messageFunction</span>(message) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">message</span> + &#x27; World!&#x27;;</span><br><span class="line">&#125;)(<span class="symbol">&#x27;Hello</span>&#x27;);</span><br></pre></td></tr></table></figure>
<h2 id="条件中的函数声明"><a href="#条件中的函数声明" class="headerlink" title="条件中的函数声明"></a>条件中的函数声明</h2><p>当函数声明出现if、for或while这样的条件语句块{…}时，在一些JavaScript环境内可能会抛出一个引用错误。让我们来看看在严格模式下，函数声明出现在一个条件语句块中，看看会发生什么。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;true ok&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">ok</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;false ok&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> ok === <span class="string">&#x27;undefined&#x27;</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="built_in">console</span>.log(ok()); <span class="comment">// Throws &quot;ReferenceError: ok is not defined&quot;</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>当调用ok()函数时，JavaScript抛出一个异常错误”ReferenceError: ok is not defined”,因为函数声明出现在一个条件语句块内。注意，这种情况适用于非严格模式环境下，这让人更感到困惑。</p>
<p>一般来说，在这样的情况之下，当一个函数应该创建在基于某些条件内时，应该使用一个函数表达式，而不应该使用函数声明。比如下面这个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> ok;</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        ok = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;true ok&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ok = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;false ok&#x27;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> ok === <span class="string">&#x27;function&#x27;</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="built_in">console</span>.log(ok()); <span class="comment">// =&gt; &#x27;true ok&#x27;</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<p>因为函数是一个普通对象，根据不同的条件，将其分配给一个变量，是一个不错的选择。调用ok()函数也能正常工作，不会抛出任何错误。</p>
<h2 id="函数表达式"><a href="#函数表达式" class="headerlink" title="函数表达式"></a>函数表达式</h2><p>函数表达式是由一个function关键词，紧随其后的是一个可选的函数名，一串参数(para1,…,paramN)放在小括号内和代码主体放在大括号内{…}。</p>
<p>一些函数表达式的使用方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>) </span>&#123; <span class="comment">// Function expression  </span></span><br><span class="line">    <span class="keyword">return</span> array.length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> methods = &#123;  </span><br><span class="line">    numbers: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">    sum: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// Function expression</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.numbers.reduce(<span class="function"><span class="keyword">function</span>(<span class="params">acc, num</span>) </span>&#123; <span class="comment">// func. expression</span></span><br><span class="line">            <span class="keyword">return</span> acc + num;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">count([<span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>]); <span class="comment">// =&gt; 3  </span></span><br><span class="line">methods.sum();    <span class="comment">// =&gt; 14  </span></span><br></pre></td></tr></table></figure>
<p>函数表达式创建了一个函数对象，可以用在不同的情况下：</p>
<ul>
<li>当作一个对象赋值给一个变量count = function(…) {…}</li>
<li>在一个对象上创建一个方法sum: function() {…}</li>
<li>当作一个回调函数.reduce(function(…) {…})<br>函数表达式在JavaScript中经常使用。大多数的时候，开发人员处理这种类型的函数，喜欢使用箭头函数。</li>
</ul>
<h2 id="命名函数表达式"><a href="#命名函数表达式" class="headerlink" title="命名函数表达式"></a>命名函数表达式</h2><p>当函数没有一个名称（名称属性是一个空字符串）时这个函数是一个匿名函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getType = <span class="function"><span class="keyword">function</span>(<span class="params">variable</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> variable;</span><br><span class="line">&#125;;</span><br><span class="line">getType.name <span class="comment">// =&gt; &#x27;&#x27; </span></span><br></pre></td></tr></table></figure>
<p>getType就是一个匿名函数，其getType.name的值为’’。</p>
<p>当表达式指定了一个名称时，这就是一个命名函数表达式。它和简单的函数表达式相比具有一些额外的属性。</p>
<ul>
<li>创建一个命名函数，其name属性就是函数名</li>
<li>在函数体中具有和函数对象相同名称的一个变量<br>我们使用上面的例子，不同的是在函数表达式内指定了一个名称:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> getType = <span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params">variable</span>) </span>&#123;  </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">typeof</span> funName === <span class="string">&#x27;function&#x27;</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">typeof</span> variable;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getType(<span class="number">3</span>));                    <span class="comment">// =&gt; &#x27;number&#x27;  </span></span><br><span class="line"><span class="built_in">console</span>.log(getType.name);                  <span class="comment">// =&gt; &#x27;funName&#x27;  </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> funName === <span class="string">&#x27;function&#x27;</span>); <span class="comment">// =&gt; false</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">funName</span>(<span class="params">variable</span>) </span>&#123;...&#125;是一个命名函数表达式。在函数作用范围内存一个funName变量。函数对象的name属性就是函数的名称funName。</span><br></pre></td></tr></table></figure>
<h2 id="支持命名函数表达式"><a href="#支持命名函数表达式" class="headerlink" title="支持命名函数表达式"></a>支持命名函数表达式</h2>当变量赋值时使用一个函数表达式var fun = function() {}，很多引擎可以推断这个变量的函数名。回调时常常给其传递的是一个匿名函数表达式，并没有存储到变量中，所以引擎不能确定它的名字。</li>
</ul>
<p>在很多情况之下，使用命名函数和避免匿名函数似乎是很在理的。而且这也会带来一系列的好处：</p>
<ul>
<li>在调试时，错误信息和调用堆栈时使用函数名能显示更详细的信息</li>
<li>调试时更舒服，可以减少anonoymous堆栈的名字出现的次数</li>
<li>函数名有助于快速理解其功能</li>
<li>在函数递归调用的范围内或事件监听时可以按名称来访问函数</li>
</ul>
<h2 id="方法定义"><a href="#方法定义" class="headerlink" title="方法定义"></a>方法定义</h2><p>方法定义可以在object literals和ES6 class时定义。可以使用一个函数的名称，并紧随其后跟一对小括号放置参数列表(para1,…,paramN)和函数主体代码放在一个大括内{…}。</p>
<p>下面的示例是基于object literals上使用方法定义函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> collection = &#123;  </span><br><span class="line">    items: [],</span><br><span class="line">    add(...items) &#123;</span><br><span class="line">        <span class="built_in">this</span>.items.push(...items);</span><br><span class="line">    &#125;,</span><br><span class="line">    get(index) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">collection.add(<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;PHP&#x27;</span>);  </span><br><span class="line">collection.get(<span class="number">1</span>) <span class="comment">// =&gt; &#x27;Java&#x27;</span></span><br></pre></td></tr></table></figure>
<p>add()和get()方法在collection对象使用方法定义。这些方法可以像这样调用collection.add(…)和collection.get(…)。</p>
<p>方法定义和传统的属性定义有点类似，通一个冒号:把名称和函数表达式连接在一起，比如add:function(…) {…}。</p>
<ul>
<li>更短的语法更易读和写</li>
<li>方法定义创建命名函数，和函数表达式刚好相反。有利于用于调试<br>注意，使用class语法需要短形式方法来声明：<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    getMessage(message) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name + message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sun = <span class="keyword">new</span> Star(<span class="string">&#x27;Sun&#x27;</span>);  </span><br><span class="line">sun.getMessage(<span class="string">&#x27; is shining&#x27;</span>) <span class="comment">// =&gt; &#x27;Sun is shining&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="计算属性名和方法"><a href="#计算属性名和方法" class="headerlink" title="计算属性名和方法"></a>计算属性名和方法</h2>ES6中增加了一个很好的特性：在object literals和class中可以计算属性。</li>
</ul>
<p>计算属性的方法和[methodNmae(){…}]略有不同，其定义的方法这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> addMethod = <span class="string">&#x27;add&#x27;</span>,  </span><br><span class="line">    getMethod = <span class="string">&#x27;get&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> collection = &#123;  </span><br><span class="line">    items: [],</span><br><span class="line">    [addMethod](...items) &#123;</span><br><span class="line">        <span class="built_in">this</span>.items.push(...items);</span><br><span class="line">    &#125;,</span><br><span class="line">    [getMethod](index) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.items[index];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">collection[addMethod](<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="string">&#x27;PHP&#x27;</span>);  </span><br><span class="line">collection[getMethod](<span class="number">1</span>) <span class="comment">// =&gt; &#x27;Java&#x27;  </span></span><br></pre></td></tr></table></figure>
<p><a href="...">addMethod</a> {…} 和 <a href="...">getMethod</a> {…}使用了计算属性名快速方法声明。</p>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>箭头函数的定义是使用一对小括号，括号内是一系列的参数(param1,param2,…,paramN),后面紧跟=&gt;符号和{…}，代码主体放置在这对大括号内。</p>
<p>当箭头函数只有一个参数时，可以省略这对小括号，另外它只包含一个声明时，大括号都可以省略。</p>
<p>下面的示例就是一个箭头函数的基本用法：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> absValue = <span class="function">(<span class="params"><span class="built_in">number</span></span>) =&gt;</span> &#123;  </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">number</span> &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="built_in">number</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line">absValue(<span class="number">-10</span>); <span class="comment">// =&gt; 10  </span></span><br><span class="line">absValue(<span class="number">5</span>);   <span class="comment">// =&gt; 5</span></span><br></pre></td></tr></table></figure>
<p>absValue是一个箭头函数，这个函数主要功能就是计算一个数的绝对值。</p>
<p>函数声明使用箭头函数，其中=&gt;具有以下属性：</p>
<ul>
<li>箭头函数不创建执行自己的上下文（函数表达式或函数声明式相反，创建不创建取决于this的调用）</li>
<li>箭头函数是一个匿名函数：name是一个空字符串’’（函数声明式相反，它有一个名字）</li>
<li>arguments对象不可使用箭头函数（与其它声明类型相反，其他类型提供arguments对象）<h2 id="Context-transparency"><a href="#Context-transparency" class="headerlink" title="Context transparency"></a>Context transparency</h2>this关键词的使用在JavaScript中让很多同学都感到困惑。(这篇文章详细介绍了this关键词的使用)。</li>
</ul>
<p>因为函数创建了自己的可执行的上下文(execution context)，这也造成一般情况很难确定this所指。</p>
<p>ES6引用箭头函数改善了这种用法（context lexically）。这是一个很好的特性，因为从现在开始函数需要封闭的上下文时没有必要使用.bind(this)或者var self = this。</p>
<p>来看一个示例，看this如何继承外部函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Numbers &#123;  </span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">array</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.array = array;</span><br><span class="line">    &#125;</span><br><span class="line">    addNumber(<span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">number</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.array.push(<span class="built_in">number</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">(<span class="params"><span class="built_in">number</span></span>) =&gt;</span> &#123; </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span> === numbersObject); <span class="comment">// =&gt; true</span></span><br><span class="line">            <span class="built_in">this</span>.array.push(<span class="built_in">number</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> numbersObject = <span class="keyword">new</span> Numbers([]);  </span><br><span class="line">numbersObject.addNumber(<span class="number">1</span>);  </span><br><span class="line"><span class="keyword">var</span> addMethod = numbersObject.addNumber();  </span><br><span class="line">addMethod(<span class="number">5</span>);</span><br><span class="line"><span class="built_in">console</span>.log(numbersObject.array); <span class="comment">// =&gt; [1, 5]</span></span><br></pre></td></tr></table></figure>
<p>Numbers类有一个数字数组，并且提供了一个addNumber()方法，将新数据插入到这个数组中。</p>
<p>当addNumber()不带任何参数被调用时，则返回一个闭包，允许插入新的数据。这个闭包是一个箭头函数，它的this就相当于numbersObject。因为其上下文意思取自addNumbers()方法。</p>
<p>如果没有箭头函数，那么需要我们自己手动去修复。这也意味着，要添加.bind()方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">number</span>) </span>&#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="built_in">this</span> === numbersObject); <span class="comment">// =&gt; true</span></span><br><span class="line">      <span class="built_in">this</span>.array.push(number);</span><br><span class="line">    &#125;.bind(<span class="built_in">this</span>);</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>或者将上下文(context)存给一个变量var self = this:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">    <span class="keyword">var</span> self = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">number</span>) </span>&#123; </span><br><span class="line">      <span class="built_in">console</span>.log(self === numbersObject); <span class="comment">// =&gt; true</span></span><br><span class="line">      self.array.push(number);</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>context transparency这个属性可以让你在一个封闭的环境内任意使用this。</p>
<h2 id="短回调"><a href="#短回调" class="headerlink" title="短回调"></a>短回调</h2><p>前面也说过了，当创建的箭头函数只有一个参数，或者主体只有一个声明时，小括号()和花括号{}都可以省去。这有助于创建一个非常短的回调函数。</p>
<p>让我们创建一个函数，如果数组只有0这个元素，将它找出来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numbers = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">0</span>];  </span><br><span class="line">numbers.some(<span class="function"><span class="params">item</span> =&gt;</span> item === <span class="number">0</span>); <span class="comment">// =&gt; true </span></span><br></pre></td></tr></table></figure>
<p>item =&gt; item === 0是一个箭头函数，它看上去非常简单。</p>
<p>有时候嵌套短的箭头函数会让代码阅读起来增加困难。所以最方便的方式是当这它是一个回调函数(没有嵌套)可以使用短的箭头函数方式。如果有必要，添加花括号之来，这样有利于代码的阅读。</p>
<h2 id="函数生成器"><a href="#函数生成器" class="headerlink" title="函数生成器"></a>函数生成器</h2><p>生成函数在JavaScript中会返回一个Generator对象。其语法类似于函数表达式、函数声明式和方法声明，不同的是，它需要在function后添加一个*符号。</p>
<p>生成器函数可以按以下这些方式来声明函数：</p>
<p>函数声明function* <name>():</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">indexGenerator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> index++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = indexGenerator();</span><br><span class="line"><span class="built_in">console</span>.log(g.next().value); <span class="comment">// =&gt; 0</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next().value); <span class="comment">// =&gt; 1</span></span><br></pre></td></tr></table></figure>
<p>函数表达式function* ():</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> indexGenerator = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">yield</span> index++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> g = indexGenerator();  </span><br><span class="line"><span class="built_in">console</span>.log(g.next().value); <span class="comment">// =&gt; 0  </span></span><br><span class="line"><span class="built_in">console</span>.log(g.next().value); <span class="comment">// =&gt; 1 </span></span><br></pre></td></tr></table></figure>
<p>方法生成*<name>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;  </span><br><span class="line">    *indexGenerator() &#123;</span><br><span class="line">        <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> index++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = obj.indexGenerator();  </span><br><span class="line"><span class="built_in">console</span>.log(g.next().value); <span class="comment">// =&gt; 0  </span></span><br><span class="line"><span class="built_in">console</span>.log(g.next().value); <span class="comment">// =&gt; 1  </span></span><br></pre></td></tr></table></figure>
<p>上面三种方式生成的函数都会返回一个生成器对象g。然后g可以生成一系列的数字。</p>
<h2 id="函数构造器-new-Function"><a href="#函数构造器-new-Function" class="headerlink" title="函数构造器: new Function"></a>函数构造器: new Function</h2><p>在JavaScript函数中第一个类(class object)对象: 函数是一个普通的对象类型是function。</p>
<p>这种声明的方式创建相同的函数对象类型，来看一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum1</span>(<span class="params">a, b</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sum2 = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> sum3 = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b;  </span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> sum1 === <span class="string">&#x27;function&#x27;</span>); <span class="comment">// =&gt; true  </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> sum2 === <span class="string">&#x27;function&#x27;</span>); <span class="comment">// =&gt; true  </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> sum3 === <span class="string">&#x27;function&#x27;</span>); <span class="comment">// =&gt; true  </span></span><br></pre></td></tr></table></figure>
<p>函数对象类型有一个构造器(constructor):Function。</p>
<p>当Function当作构造器(constructor)new Function(arg1,arg2,…,argN,bodyString),那么Function 构造器会创建一个新的 Function 对象(new Function)。其中参数arg1,arg2,…,argN会传递给构造器(constructor)成为新函数的参数，而且最后一个参数bodyString用作函数体代码。</p>
<p>来看一个示例，创建一个函数，求两个数的和：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numberA = <span class="string">&#x27;numberA&#x27;</span>, numberB = <span class="string">&#x27;numberB&#x27;</span>;  </span><br><span class="line"><span class="keyword">var</span> sumFunction = <span class="keyword">new</span> <span class="built_in">Function</span>(numberA, numberB,  </span><br><span class="line">   <span class="string">&#x27;return numberA + numberB&#x27;</span></span><br><span class="line">);</span><br><span class="line">sumFunction(<span class="number">10</span>, <span class="number">15</span>) <span class="comment">// =&gt; 25  </span></span><br></pre></td></tr></table></figure>
<p>sumFunction创建的Function构造器调用了numberA和numberB两个参数，并且在函数主体内执行return numberA + numberB。</p>
<p>这种方式创建的函数不能访问当前的作用域，因为没办法创建闭包。他们总是在全局作用域内创建的。</p>
<p>一个可能就用new Function的最佳方式是浏览器或NodeJs脚本访问一个全局对象：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">    &#x27;use strict&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">global</span> = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">&#x27;return this&#x27;</span>)();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">global</span> === <span class="built_in">window</span>); <span class="comment">// =&gt; true</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span> === <span class="built_in">window</span>);   <span class="comment">// =&gt; false</span></span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
<h2 id="哪种方式最好"><a href="#哪种方式最好" class="headerlink" title="哪种方式最好"></a>哪种方式最好</h2><p>没有孰好孰坏，函数的声明类型的决定要视实际情况而定。但有一些规则还是值得大家一起遵循。</p>
<p>如果要在一个闭包内使用this，那么箭头函数是一个很好的解决方案。另外回调函数是一个简短声明时，箭头函数也是一个很好的选择，因为它的代码短。</p>
<p>当在object literals上需要一个更短的语法时，方法声明是可取的。</p>
<p>new Function这种方法一般不用来声明函数。主要因为它存在很多问题。</p>
<p>我认为这篇文章另一个作用是让大家写出更具可读性的代码，和减少函数使用的bug。因为他们像细胞一样存在任何一个应用程序当中。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leo Lin"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Leo Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/LeoLin9527" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LeoLin9527" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.weibo.com/6755640749" title="Weibo → https:&#x2F;&#x2F;www.weibo.com&#x2F;6755640749" rel="noopener" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
