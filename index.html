<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="江湖の林九">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="江湖の林九">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Leo Lin">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>江湖の林九</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">江湖の林九</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">相逢何必曾相识！</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">104</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/LeoLin9527" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/08/%E9%98%BF%E9%87%8C%E4%BA%91CentOS7%E5%AE%89%E8%A3%85Hive%20/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/%E9%98%BF%E9%87%8C%E4%BA%91CentOS7%E5%AE%89%E8%A3%85Hive%20/" class="post-title-link" itemprop="url">阿里云CentOS7安装Hive</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-08 12:00:00" itemprop="dateCreated datePublished" datetime="2020-06-08T12:00:00+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-11 00:06:40" itemprop="dateModified" datetime="2020-06-11T00:06:40+08:00">2020-06-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h2><p>Hive是建立在Hadoop上的数据仓库基础架构，提供了一系列的工具可以用来进行数据提取转化加载（ETL），定义了简单的类SQL查询语言QL。<br>Hive是SQL解析引擎，用于将SQL语句转译成M/R Job然后在Hadoop执行。<br>Hive将元数据存储在数据库中(metastore)，目前只支持mysql，derby，元数据包括表的名字，表的列和分区及其属性，表的数据所在目录等。<br>Hive数据存储在HDFS中，大部分的查询由MapReduce完成。</p>
<p><img src="/images/20-database/05-hive.png"></p>
<h2 id="Hadoop3伪分布式集群安装"><a href="#Hadoop3伪分布式集群安装" class="headerlink" title="Hadoop3伪分布式集群安装"></a>Hadoop3伪分布式集群安装</h2><p>1、安装JDK，并配置环境变量</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=<span class="regexp">/usr/java</span><span class="regexp">/jdk1.8.0_151</span></span><br><span class="line"><span class="regexp">export CLASSPATH=.:$JAVA_HOME/jre</span><span class="regexp">/lib/rt</span>.<span class="symbol">jar:</span>$JAVA_HOME/<span class="class"><span class="keyword">lib</span>/<span class="title">dt</span>.<span class="title">jar</span>:$<span class="title">JAVA_HOME</span>/<span class="title">lib</span>/<span class="title">tools</span>.<span class="title">jar</span></span></span><br><span class="line">export PATH=$JAVA_HOME/<span class="symbol">bin:</span>$PATH</span><br></pre></td></tr></table></figure>
<p>2、免密码ssh设置</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~<span class="regexp">/.ssh/</span> <span class="comment"># 若没有该目录，请先执行一次ssh localhost</span></span><br><span class="line">ssh-keygen -t rsa <span class="comment"># 会有提示，都按回车就可以</span></span><br><span class="line">cat .<span class="regexp">/id_rsa.pub &gt;&gt; ./</span>authorized_keys <span class="comment"># 加入授权</span></span><br></pre></td></tr></table></figure>

<p>3、修改配置</p>
<ul>
<li>修改hadoop-env.sh文件，增加环境变量信息<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/data/soft/jdk1.8</span><br></pre></td></tr></table></figure></li>
<li>修改core-site.xml文件<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定HADOOP所使用的文件系统schema（URI），HDFS的老大（NameNode）的地址 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop100:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定hadoop运行时产生文件的存储目录 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>/data/hadoop_repo<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>修改hdfs-site.xml文件，把hdfs中文件副本的数量设置为1<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.replication<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 如果是通过公网IP访问阿里云上内网搭建的集群 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">name</span>&gt;</span>dfs.client.use.datanode.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	    <span class="tag">&lt;<span class="name">description</span>&gt;</span>only cofig in clients<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>修改mapred-site.xml，设置mapreduce使用的资源调度框架<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 指定mr运行在yarn上 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>修改yarn-site.xml，设置yarn上支持运行的服务和环境白名单<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.env-whitelist<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">value</span>&gt;</span>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CL</span><br><span class="line">		ASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>4、格式化namenode</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bin/hdfs namenode -format</span><br><span class="line"><span class="comment"># 如果在后面的日志信息中能看到这一行，则说明namenode 格式化成功。</span></span><br><span class="line">common.Storage: Storage directory <span class="regexp">/data/</span>hadoop_repo<span class="regexp">/dfs/</span>name has been successfully</span><br><span class="line">formatted.</span><br></pre></td></tr></table></figure>
<p>5、修改start-dfs.sh，stop-dfs.sh这两个脚本文件，增加如下内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">HDFS_DATANODE_USER</span>=root</span><br><span class="line"><span class="attr">HDFS_DATANODE_SECURE_USER</span>=hdfs</span><br><span class="line"><span class="attr">HDFS_NAMENODE_USER</span>=root</span><br><span class="line"><span class="attr">HDFS_SECONDARYNAMENODE_USER</span>=root</span><br></pre></td></tr></table></figure>
<p>start-dfs.sh分别用来启动dfs即启动Hadoop文件系统。<br>6、修改start-yarn.sh，stop-yarn.sh 这两个脚本文件，在文件前面增加如下内容</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">YARN_RESOURCEMANAGER_USER</span>=root</span><br><span class="line"><span class="attr">HADOOP_SECURE_DN_USER</span>=yarn</span><br><span class="line"><span class="attr">YARN_NODEMANAGER_USER</span>=root</span><br></pre></td></tr></table></figure>
<p>start-yarn.sh启动yarn脚本，执行此命令将启动yarn守护进程。<br>7、启动集群</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./start-all.sh</span><br><span class="line"></span><br><span class="line">运行jps，出现如下<span class="number">6</span>个进程，则成功</span><br><span class="line"><span class="number">2882</span> ResourceManager</span><br><span class="line"><span class="number">2420</span> DataNode</span><br><span class="line"><span class="number">3365</span> Jps</span><br><span class="line"><span class="number">2619</span> SecondaryNameNode</span><br><span class="line"><span class="number">2315</span> NameNode</span><br><span class="line"><span class="number">2988</span> NodeManager</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：<br>1、查看及修改主机名</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hostname</span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network</span><br><span class="line"><span class="attribute">NETWORKING</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attribute">HOSTNAME</span>=hadoop100</span><br></pre></td></tr></table></figure>
<p>2、hosts映射文件</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 阿里云公网IP需要替换为内网IP</span><br><span class="line">vim /etc/hosts</span><br><span class="line"><span class="number">192.168.111.100</span> hadoop100</span><br></pre></td></tr></table></figure>

<h2 id="Hive安装"><a href="#Hive安装" class="headerlink" title="Hive安装"></a>Hive安装</h2><p>内嵌模式：<br>–元数据保存在内嵌的derby数据库中，只允许一个会话链接，尝试多个会话链接时会报错<br>本地模式：<br>–本地安装模式其实就是把mysql和hive安装在一台机器上而已(这就是本地模式)<br>（本地安装mysql 替代derby存储元数据,使用mysql进行hive的元数据信息管理）<br>远程模式：<br>–远程模式的意思就是mysql的安装和hive的安装没有在同一台机器上，和本地模式最大的区别就是在hive-site.xml中，我们需要修改下mysql的ip地址和端口号。但是我们需要注意以下两个问题:<br>–hive-site.xml中的mysql安装主机的ip地址和端口号.<br>–访问mysql的用户名的访问权限需要进行设置<br>–多用于实际的生产运行环境<br>1、下载文件并解压，下载mysql驱动包并放置到hive文件夹lib目录</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">tar</span> -zxvf apache-hive-<span class="number">2</span>.<span class="number">3</span>.<span class="number">3</span>-bin.tar.gz</span><br><span class="line"></span><br><span class="line"><span class="attribute">mv</span> mysql-connector-java-<span class="number">5</span>.<span class="number">1</span>.<span class="number">6</span>.jar /usr/local/src/hive</span><br></pre></td></tr></table></figure>
<p>2、修改hive-site.xml配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cp hive-default.xml.template hive-site.xml 删除多余配置替换为如下</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>jdbc:mysql://47.100.139.162:3306/hive?createDatabaseIfNotExist=true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 指定驱动类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 指定用户名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>ant2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 指定密码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>Bnm,./321<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.schema.verification<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">value</span>&gt;</span>false<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3、配置环境变量</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">HIVE_HOME</span>=/usr/local/hive</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$HIVE_HOME/bin</span><br></pre></td></tr></table></figure>
<p>4、验证Hive安装</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hive&gt;<span class="keyword">create</span> <span class="keyword">table</span> test1(tid <span class="type">int</span>,tname string);</span><br><span class="line"></span><br><span class="line">hive&gt; <span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line">OK</span><br><span class="line">test1</span><br><span class="line"><span class="type">Time</span> taken: <span class="number">28.297</span> seconds, Fetched: <span class="number">1</span> <span class="keyword">row</span>(s)</span><br></pre></td></tr></table></figure>
<p>5、错误提示<br>问题1：hive环境搭建提示: java.lang.NoSuchMethodError: com.google.common.base.Preconditions.checkArgument<br>解决1：查看hadoop安装目录下share/hadoop/common/lib内guava.jar版本，查看hive安装目录下lib内guava.jar的版本，如果两者不一致，删除版本低的，并拷贝高版本的 问题解决！<br>问题2：Please use schematool (e.g. ./schematool -initSchema -dbType …) to create the schema.<br>解决2：bin目录下./schematool -initSchema -dbType初始化元数据库</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/03/Pandas%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C%E4%B8%AD%E6%96%87%E7%89%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/03/Pandas%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C%E4%B8%AD%E6%96%87%E7%89%88/" class="post-title-link" itemprop="url">Pandas速查手册中文版</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-03 12:20:00" itemprop="dateCreated datePublished" datetime="2020-06-03T12:20:00+08:00">2020-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-10 23:58:17" itemprop="dateModified" datetime="2020-06-10T23:58:17+08:00">2020-06-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数据科学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>十分钟入门Pandas：10 Minutes to pandas—<a target="_blank" rel="noopener" href="https://pandas.pydata.org/pandas-docs/stable/getting_started/10min.html">点击跳转</a><br>关键缩写和包导入<br>在这个速查手册中，我们使用如下缩写：</p>
<p>df：任意的Pandas DataFrame对象<br>s：任意的Pandas Series对象<br>同时我们需要做如下的引入：</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<h2 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pd.read<span class="constructor">_csv(<span class="params">filename</span>)</span>：从CSV文件导入数据</span><br><span class="line">pd.read<span class="constructor">_table(<span class="params">filename</span>)</span>：从限定分隔符的文本文件导入数据</span><br><span class="line">pd.read<span class="constructor">_excel(<span class="params">filename</span>)</span>：从Excel文件导入数据</span><br><span class="line">pd.read<span class="constructor">_sql(<span class="params">query</span>, <span class="params">connection_object</span>)</span>：从SQL表/库导入数据</span><br><span class="line">pd.read<span class="constructor">_json(<span class="params">json_string</span>)</span>：从JSON格式的字符串导入数据</span><br><span class="line">pd.read<span class="constructor">_html(<span class="params">url</span>)</span>：解析URL、字符串或者HTML文件，抽取其中的tables表格</span><br><span class="line">pd.read<span class="constructor">_clipboard()</span>：从你的粘贴板获取内容，并传给read<span class="constructor">_table()</span></span><br><span class="line">pd.<span class="constructor">DataFrame(<span class="params">dict</span>)</span>：从字典对象导入数据，Key是列名，Value是数据</span><br></pre></td></tr></table></figure>

<h2 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">df.<span class="keyword">to</span><span class="constructor">_csv(<span class="params">filename</span>)</span>：导出数据到CSV文件</span><br><span class="line">df.<span class="keyword">to</span><span class="constructor">_excel(<span class="params">filename</span>)</span>：导出数据到Excel文件</span><br><span class="line">df.<span class="keyword">to</span><span class="constructor">_sql(<span class="params">table_name</span>, <span class="params">connection_object</span>)</span>：导出数据到SQL表</span><br><span class="line">df.<span class="keyword">to</span><span class="constructor">_json(<span class="params">filename</span>)</span>：以Json格式导出数据到文本文件</span><br></pre></td></tr></table></figure>

<h2 id="创建测试对象"><a href="#创建测试对象" class="headerlink" title="创建测试对象"></a>创建测试对象</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pd.<span class="constructor">DataFrame(<span class="params">np</span>.<span class="params">random</span>.<span class="params">rand</span>(20,5)</span>)：创建<span class="number">20</span>行<span class="number">5</span>列的随机数组成的DataFrame对象</span><br><span class="line">pd.<span class="constructor">Series(<span class="params">my_list</span>)</span>：从可迭代对象my_list创建一个Series对象</span><br><span class="line">df.index = pd.date<span class="constructor">_range(&#x27;1900<span class="operator">/</span>1<span class="operator">/</span>30&#x27;, <span class="params">periods</span>=<span class="params">df</span>.<span class="params">shape</span>[0])</span>：增加一个日期索引</span><br></pre></td></tr></table></figure>

<h2 id="查看、检查数据"><a href="#查看、检查数据" class="headerlink" title="查看、检查数据"></a>查看、检查数据</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">df</span><span class="selector-class">.head</span>(n)：查看<span class="selector-tag">DataFrame</span>对象的前<span class="selector-tag">n</span>行</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.tail</span>(n)：查看<span class="selector-tag">DataFrame</span>对象的最后<span class="selector-tag">n</span>行</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.shape</span>()：查看行数和列数</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.info</span>()：查看索引、数据类型和内存信息</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.describe</span>()：查看数值型列的汇总统计</span><br><span class="line"><span class="selector-tag">s</span><span class="selector-class">.value_counts</span>(dropna=False)：查看<span class="selector-tag">Series</span>对象的唯一值和计数</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.apply</span>(pd.Series.value_counts)：查看<span class="selector-tag">DataFrame</span>对象中每一列的唯一值和计数</span><br></pre></td></tr></table></figure>

<h2 id="数据选取"><a href="#数据选取" class="headerlink" title="数据选取"></a>数据选取</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">df</span><span class="selector-attr">[col]</span>：根据列名，并以<span class="selector-tag">Series</span>的形式返回列</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-attr">[[col1, col2]</span>]：以<span class="selector-tag">DataFrame</span>形式返回多列</span><br><span class="line"><span class="selector-tag">s</span><span class="selector-class">.iloc</span><span class="selector-attr">[0]</span>：按位置选取数据</span><br><span class="line"><span class="selector-tag">s</span><span class="selector-class">.loc</span><span class="selector-attr">[<span class="string">&#x27;index_one&#x27;</span>]</span>：按索引选取数据</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.iloc</span><span class="selector-attr">[0,:]</span>：返回第一行</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.iloc</span><span class="selector-attr">[0,0]</span>：返回第一列的第一个元素</span><br></pre></td></tr></table></figure>

<h2 id="数据清理"><a href="#数据清理" class="headerlink" title="数据清理"></a>数据清理</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">df.<span class="keyword">columns</span> = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]：重命名列名</span><br><span class="line">pd.<span class="keyword">isnull</span>()：检查DataFrame对象中的空值，并返回一个<span class="type">Boolean</span>数组</span><br><span class="line">pd.<span class="keyword">notnull</span>()：检查DataFrame对象中的非空值，并返回一个<span class="type">Boolean</span>数组</span><br><span class="line">df.dropna()：删除所有包含空值的行</span><br><span class="line">df.dropna(axis=<span class="number">1</span>)：删除所有包含空值的列</span><br><span class="line">df.dropna(axis=<span class="number">1</span>,thresh=n)：删除所有小于n个非空值的列</span><br><span class="line">df.fillna(x)：用x替换DataFrame对象中所有的空值</span><br><span class="line">s.astype(<span class="type">float</span>)：将Series中的数据类型更改为<span class="type">float</span>类型</span><br><span class="line">s.replace(<span class="number">1</span>,<span class="string">&#x27;one&#x27;</span>)：用‘one’代替所有等于<span class="number">1</span>的值</span><br><span class="line">s.replace([<span class="number">1</span>,<span class="number">3</span>],[<span class="string">&#x27;one&#x27;</span>,<span class="string">&#x27;three&#x27;</span>])：用<span class="string">&#x27;one&#x27;</span>代替<span class="number">1</span>，用<span class="string">&#x27;three&#x27;</span>代替<span class="number">3</span></span><br><span class="line">df.<span class="keyword">rename</span>(<span class="keyword">columns</span>=lambda x: x + <span class="number">1</span>)：批量更改列名</span><br><span class="line">df.<span class="keyword">rename</span>(<span class="keyword">columns</span>=&#123;<span class="string">&#x27;old_name&#x27;</span>: <span class="string">&#x27;new_ name&#x27;</span>&#125;)：选择性更改列名</span><br><span class="line">df.set_index(<span class="string">&#x27;column_one&#x27;</span>)：更改索引列</span><br><span class="line">df.<span class="keyword">rename</span>(<span class="keyword">index</span>=lambda x: x + <span class="number">1</span>)：批量重命名索引</span><br></pre></td></tr></table></figure>

<h2 id="数据处理：Filter、Sort和GroupBy"><a href="#数据处理：Filter、Sort和GroupBy" class="headerlink" title="数据处理：Filter、Sort和GroupBy"></a>数据处理：Filter、Sort和GroupBy</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">df</span>[df[col] &gt; <span class="number">0</span>.<span class="number">5</span>]：选择col列的值大于<span class="number">0</span>.<span class="number">5</span>的行</span><br><span class="line"><span class="attribute">df</span>.sort_values(col<span class="number">1</span>)：按照列col<span class="number">1</span>排序数据，默认升序排列</span><br><span class="line"><span class="attribute">df</span>.sort_values(col<span class="number">1</span>, ascending=False)：按照列col降序排列数据</span><br><span class="line"><span class="attribute">df</span>.sort_values([col<span class="number">1</span>,col<span class="number">2</span>], ascending=[True,False])：先按列col<span class="number">1</span>升序排列，后按col<span class="number">2</span>降序排列数据</span><br><span class="line"><span class="attribute">df</span>.groupby(col)：返回一个按列col进行分组的Groupby对象</span><br><span class="line"><span class="attribute">df</span>.groupby([col<span class="number">1</span>,col<span class="number">2</span>])：返回一个按多列进行分组的Groupby对象</span><br><span class="line"><span class="attribute">df</span>.groupby(col<span class="number">1</span>)[col<span class="number">2</span>].mean()：返回按列col<span class="number">1</span>进行分组后，列col<span class="number">2</span>的均值</span><br><span class="line"><span class="attribute">df</span>.pivot_table(index=col<span class="number">1</span>, values=[col<span class="number">2</span>,col<span class="number">3</span>], aggfunc=max)：创建一个按列col<span class="number">1</span>进行分组，并计算col<span class="number">2</span>和col<span class="number">3</span>的最大值的数据透视表</span><br><span class="line"><span class="attribute">df</span>.groupby(col<span class="number">1</span>).agg(np.mean)：返回按列col<span class="number">1</span>分组的所有列的均值</span><br><span class="line"><span class="attribute">data</span>.apply(np.mean)：对DataFrame中的每一列应用函数np.mean</span><br><span class="line"><span class="attribute">data</span>.apply(np.max,axis=<span class="number">1</span>)：对DataFrame中的每一行应用函数np.max</span><br></pre></td></tr></table></figure>

<h2 id="数据合并"><a href="#数据合并" class="headerlink" title="数据合并"></a>数据合并</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">pd</span>.merge(df<span class="number">1</span>,df<span class="number">2</span>) 默认参数how是inner内连接，并且会按照相同的字段key进行合并</span><br><span class="line"><span class="attribute">df1</span>.append(df<span class="number">2</span>)：将df<span class="number">2</span>中的行添加到df<span class="number">1</span>的尾部</span><br><span class="line"><span class="attribute">pd</span>.concat([df<span class="number">1</span>, df<span class="number">2</span>],axis=<span class="number">1</span>)：将df<span class="number">2</span>中的列添加到df<span class="number">1</span>的尾部</span><br><span class="line"><span class="attribute">df1</span>.join(df<span class="number">2</span>,<span class="literal">on</span>=col<span class="number">1</span>,how=&#x27;inner&#x27;)：对df<span class="number">1</span>的列和df<span class="number">2</span>的列执行SQL形式的join</span><br></pre></td></tr></table></figure>

<h2 id="数据统计"><a href="#数据统计" class="headerlink" title="数据统计"></a>数据统计</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">df</span><span class="selector-class">.describe</span>()：查看数据值列的汇总统计</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.mean</span>()：返回所有列的均值</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.corr</span>()：返回列与列之间的相关系数</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.count</span>()：返回每一列中的非空值的个数</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.max</span>()：返回每一列的最大值</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.min</span>()：返回每一列的最小值</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.median</span>()：返回每一列的中位数</span><br><span class="line"><span class="selector-tag">df</span><span class="selector-class">.std</span>()：返回每一列的标准差</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/03/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96Matlabplot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/03/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96Matlabplot/" class="post-title-link" itemprop="url">数据可视化Matlabplot</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-03 12:20:00" itemprop="dateCreated datePublished" datetime="2020-06-03T12:20:00+08:00">2020-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-23 12:28:52" itemprop="dateModified" datetime="2020-06-23T12:28:52+08:00">2020-06-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6/" itemprop="url" rel="index"><span itemprop="name">数据科学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>1、创建一个新的画布(figure)。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.figure(num=None, figsize=None, dpi=None, facecolor=None, edgecolor=None, frameon=True, FigureClass=&lt;class &#x27;matplotlib.figure.Figure&#x27;&gt;, clear=False, **kwargs)</span><br></pre></td></tr></table></figure>
<p>输入参数：<br>num：整型或者字符串，可选参数，默认：None。<br>            如果不提供该参数，一个新的画布(figure)将被创建而且画布数量将会增加。<br>            如果提供该参数，带有id的画布是已经存在的，激活该画布并返回该画布的引用。<br>            如果这个画布不存在，创建并返回画布实例。<br>            如果num是字符串，窗口标题将被设置为该图的数字。<br>figsize：整型元组，可选参数 ，默认：None。<br>                每英寸的宽度和高度。如果不提供，默认值是figure.figsize。<br>dpi：整型，可选参数，默认：None。每英寸像素点。如果不提供，默认是figure.dpi。<br>facecolor：背景色。如果不提供，默认值：figure.facecolor。<br>edgecolor：边界颜色。如果不提供，默认值：figure.edgecolor。<br>framemon：布尔类型，可选参数，默认值：True。如果是False，禁止绘制画图框。<br>FigureClass：源于matplotlib.figure.Figure的类。（可选）使用自定义图实例。<br>clear：布尔类型，可选参数，默认值：False。如果为True和figure已经存在时，这是清理掉改图。</p>
<p>2、添加图例与描述信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plt.legend()</span><br><span class="line"></span><br><span class="line">plt.xlabel(<span class="string">&#x27;X axis&#x27;</span>,fontproperties=)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Y axis&#x27;</span>,fontproperties=)</span><br></pre></td></tr></table></figure>

<p>3、添加刻度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.xticks()</span><br><span class="line">plt.yticks()</span><br><span class="line"></span><br><span class="line">ax.set_xticks([])</span><br><span class="line">ax.set_yticks([])</span><br></pre></td></tr></table></figure>

<p>4、子图操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">10</span>,<span class="number">6</span>))</span><br><span class="line">ax1 = fig.add_subplot(<span class="number">4</span>,<span class="number">3</span>,<span class="number">1</span>)</span><br><span class="line">ax2 = fig.add_subplot(<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">fig,axes = plt.subplots(<span class="number">2</span>,<span class="number">3</span>,figsize=(<span class="number">10</span>,<span class="number">4</span>))</span><br></pre></td></tr></table></figure>

<h2 id="散点图"><a href="#散点图" class="headerlink" title="散点图"></a>散点图</h2><p>可以展示数据的分布和聚合情况。<br>1、colormap:</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cmaps = [(<span class="string">&#x27;Perceptually Uniform Sequential&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;viridis&#x27;</span>, <span class="string">&#x27;plasma&#x27;</span>, <span class="string">&#x27;inferno&#x27;</span>, <span class="string">&#x27;magma&#x27;</span>]),</span><br><span class="line">         (<span class="string">&#x27;Sequential&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;Greys&#x27;</span>, <span class="string">&#x27;Purples&#x27;</span>, <span class="string">&#x27;Blues&#x27;</span>, <span class="string">&#x27;Greens&#x27;</span>, <span class="string">&#x27;Oranges&#x27;</span>, <span class="string">&#x27;Reds&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;YlOrBr&#x27;</span>, <span class="string">&#x27;YlOrRd&#x27;</span>, <span class="string">&#x27;OrRd&#x27;</span>, <span class="string">&#x27;PuRd&#x27;</span>, <span class="string">&#x27;RdPu&#x27;</span>, <span class="string">&#x27;BuPu&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;GnBu&#x27;</span>, <span class="string">&#x27;PuBu&#x27;</span>, <span class="string">&#x27;YlGnBu&#x27;</span>, <span class="string">&#x27;PuBuGn&#x27;</span>, <span class="string">&#x27;BuGn&#x27;</span>, <span class="string">&#x27;YlGn&#x27;</span>]),</span><br><span class="line">         (<span class="string">&#x27;Sequential (2)&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;binary&#x27;</span>, <span class="string">&#x27;gist_yarg&#x27;</span>, <span class="string">&#x27;gist_gray&#x27;</span>, <span class="string">&#x27;gray&#x27;</span>, <span class="string">&#x27;bone&#x27;</span>, <span class="string">&#x27;pink&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;spring&#x27;</span>, <span class="string">&#x27;summer&#x27;</span>, <span class="string">&#x27;autumn&#x27;</span>, <span class="string">&#x27;winter&#x27;</span>, <span class="string">&#x27;cool&#x27;</span>, <span class="string">&#x27;Wistia&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;hot&#x27;</span>, <span class="string">&#x27;afmhot&#x27;</span>, <span class="string">&#x27;gist_heat&#x27;</span>, <span class="string">&#x27;copper&#x27;</span>]),</span><br><span class="line">         (<span class="string">&#x27;Diverging&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;PiYG&#x27;</span>, <span class="string">&#x27;PRGn&#x27;</span>, <span class="string">&#x27;BrBG&#x27;</span>, <span class="string">&#x27;PuOr&#x27;</span>, <span class="string">&#x27;RdGy&#x27;</span>, <span class="string">&#x27;RdBu&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;RdYlBu&#x27;</span>, <span class="string">&#x27;RdYlGn&#x27;</span>, <span class="string">&#x27;Spectral&#x27;</span>, <span class="string">&#x27;coolwarm&#x27;</span>, <span class="string">&#x27;bwr&#x27;</span>, <span class="string">&#x27;seismic&#x27;</span>]),</span><br><span class="line">         (<span class="string">&#x27;Qualitative&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;Pastel1&#x27;</span>, <span class="string">&#x27;Pastel2&#x27;</span>, <span class="string">&#x27;Paired&#x27;</span>, <span class="string">&#x27;Accent&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;Dark2&#x27;</span>, <span class="string">&#x27;Set1&#x27;</span>, <span class="string">&#x27;Set2&#x27;</span>, <span class="string">&#x27;Set3&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;tab10&#x27;</span>, <span class="string">&#x27;tab20&#x27;</span>, <span class="string">&#x27;tab20b&#x27;</span>, <span class="string">&#x27;tab20c&#x27;</span>]),</span><br><span class="line">         (<span class="string">&#x27;Miscellaneous&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;flag&#x27;</span>, <span class="string">&#x27;prism&#x27;</span>, <span class="string">&#x27;ocean&#x27;</span>, <span class="string">&#x27;gist_earth&#x27;</span>, <span class="string">&#x27;terrain&#x27;</span>, <span class="string">&#x27;gist_stern&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;gnuplot&#x27;</span>, <span class="string">&#x27;gnuplot2&#x27;</span>, <span class="string">&#x27;CMRmap&#x27;</span>, <span class="string">&#x27;cubehelix&#x27;</span>, <span class="string">&#x27;brg&#x27;</span>, <span class="string">&#x27;hsv&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;gist_rainbow&#x27;</span>, <span class="string">&#x27;rainbow&#x27;</span>, <span class="string">&#x27;jet&#x27;</span>, <span class="string">&#x27;nipy_spectral&#x27;</span>, <span class="string">&#x27;gist_ncar&#x27;</span>])]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>2、常用参数（示例可查官方文档）：</p>
<ul>
<li>x：指定散点图的x轴数据；</li>
<li>y：指定散点图的y轴数据；</li>
<li>s：指定散点图点的大小，默认为20，通过传入新的变量，实现气泡图的绘制；</li>
<li>c：可用于不同类别的颜色，指定散点图点的颜色，默认为蓝色；b-blue c-cyan g-green k-black m-magenta r-red w-white y-yellow</li>
<li>marker：指定散点图点的形状，默认为圆形；filled_markers = (‘o’, ‘v’, ‘^’, ‘&lt;’, ‘&gt;’, ‘8’, ‘s’, ‘p’, ‘*’, ‘h’, ‘H’, ‘D’, ‘d’, ‘P’, ‘X’)</li>
<li>cmap：指定色图，只有当c参数是一个浮点型的数组的时候才起作用；</li>
<li>alpha：设置散点的透明度；</li>
<li>linewidths：设置散点边界线的宽度；</li>
<li>edgecolors：设置散点边界线的颜色；</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">matplotlib.pyplot.scatter(x, y, s=<span class="literal">None</span>, c=<span class="literal">None</span>, marker=<span class="literal">None</span>, cmap=<span class="literal">None</span>, norm=<span class="literal">None</span>, vmin=<span class="literal">None</span>, vmax=<span class="literal">None</span>, alpha=<span class="literal">None</span>, linewidths=<span class="literal">None</span>, verts=<span class="literal">None</span>, edgecolors=<span class="literal">None</span>, *, plotnonfinite=<span class="literal">False</span>, data=<span class="literal">None</span>, **kwargs)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">8</span>,<span class="number">6</span>))</span><br><span class="line">x = np.random.randn(<span class="number">1000</span>)</span><br><span class="line">y = np.random.randn(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">plt.scatter(x,y,marker=<span class="string">&#x27;.&#x27;</span>,</span><br><span class="line">            s=np.random.randn(<span class="number">1000</span>)*<span class="number">100</span>,</span><br><span class="line">            cmap=<span class="string">&#x27;Reds&#x27;</span>,</span><br><span class="line">            c=y,</span><br><span class="line">            alpha=<span class="number">0.8</span>)</span><br><span class="line">plt.grid()</span><br></pre></td></tr></table></figure>

<h2 id="箱型图"><a href="#箱型图" class="headerlink" title="箱型图"></a>箱型图</h2><p>又称为盒式图，纵轴按数值从下到上按顺序排序并画出四分位5个数值的位置就是箱型图。<br>用作显示一组<strong>数据聚散和偏态情况</strong>资料，常用于识别异常值。<br><img src="/images/seaborn/boxplot.png"></p>
<p>1、五要素</p>
<ul>
<li>下边缘（Q1），表示最小值（排除异常值后）；</li>
<li>下四分位数（Q2），又称“第一四分位数”，等于该样本中所有数值由小到大排列后第25%的数字；即有1/4的数据比它小。</li>
<li>中位数（Q3），又称“第二四分位数”等于该样本中所有数值由小到大排列后第50%的数字；</li>
<li>上四分位数（Q4），又称“第三四分位数”等于该样本中所有数值由小到大排列后第75%的数字；</li>
<li>上边缘（Q5），表述最大值。</li>
</ul>
<p>2、数学示例<br>有序序列test=c(1,2,3,4,5,6,7,8)，序列长度n=8</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">代码运行结果</span></span><br><span class="line"><span class="string">count</span>    <span class="number">8.00000</span></span><br><span class="line"><span class="string">mean</span>     <span class="number">4.50000</span></span><br><span class="line"><span class="string">std</span>      <span class="number">2.44949</span></span><br><span class="line"><span class="string">min</span>      <span class="number">1.00000</span></span><br><span class="line"><span class="number">25</span><span class="string">%</span>      <span class="number">2.75000</span></span><br><span class="line"><span class="number">50</span><span class="string">%</span>      <span class="number">4.50000</span></span><br><span class="line"><span class="number">75</span><span class="string">%</span>      <span class="number">6.25000</span></span><br><span class="line"><span class="string">max</span>      <span class="number">8.00000</span></span><br><span class="line"><span class="attr">Name:</span> <span class="string">A,</span> <span class="attr">dtype:</span> <span class="string">float64</span></span><br></pre></td></tr></table></figure>
<p>n表示项数<br>Q2的位置= (n+1) × 0.25<br>Q3的位置= (n+1) × 0.5<br>Q4的位置= (n+1) × 0.75</p>
<p>下四分位数:(1+n)/4 = 2.25,假设第2个数到第3个数是均匀分布的，可得<code>2*0.25+3*0.75 = 2.75</code></p>
<p>3、常识补充</p>
<ul>
<li>四分位数差（IQR，interquartile range）Q3-Q1 </li>
<li>大于上四分位数1.5倍四分位数差的值，或者小于下四分位数1.5倍四分位数差的值，即使最大值区间Q4+1.5IQR,最小值区间Q2-1.5IQR划为异常值（outliers）</li>
<li>异常值之外，最靠近上边缘和下边缘的两个值处，画横线，作为箱线图的触须。</li>
<li>极端异常值，即超出四分位数差3倍距离的异常值，用实心点表示；较为温和的异常值，即处于1.5倍-3倍四分位数差之间的异常值，用空心点表示。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.rand(<span class="number">10</span>,<span class="number">5</span>),columns=[<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;D&#x27;</span>,<span class="string">&#x27;E&#x27;</span>])</span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">f = df.boxplot(sym=<span class="string">&#x27;o&#x27;</span>, <span class="comment"># 异常点形状</span></span><br><span class="line">              vert=<span class="literal">False</span>, <span class="comment"># 是否垂直</span></span><br><span class="line">              whis=[<span class="number">5</span>,<span class="number">95</span>], <span class="comment"># IQR默认1.5，外限则为3，也可以强制上下边缘数据5%和95%的位置【5，95】</span></span><br><span class="line">              patch_artist = <span class="literal">True</span>, <span class="comment"># 上下四分位框内是否填充</span></span><br><span class="line">              meanline = <span class="literal">False</span>,showmeans=<span class="literal">True</span>, <span class="comment"># 是否有均值线及其形状</span></span><br><span class="line">              showbox = <span class="literal">True</span>, <span class="comment"># 是否显示箱线</span></span><br><span class="line">              showcaps = <span class="literal">True</span>, <span class="comment"># 是否显示边缘线</span></span><br><span class="line">              showfliers = <span class="literal">True</span>, <span class="comment"># 是否显示异常值</span></span><br><span class="line">              notch = <span class="literal">False</span>, <span class="comment"># 中间箱体是否缺口</span></span><br><span class="line">              return_type = <span class="string">&#x27;dict&#x27;</span>)</span><br><span class="line">			  </span><br><span class="line">plt.title(<span class="string">&#x27;boxplot&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="条形图"><a href="#条形图" class="headerlink" title="条形图"></a>条形图</h2><p>可以清楚看出各个数据的大小,比较数据之间的差别。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">bar_height = <span class="number">0.2</span></span><br><span class="line">name = [<span class="string">&#x27;leo&#x27;</span>,<span class="string">&#x27;bob&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>]</span><br><span class="line">x_value = list(range(len(name)))</span><br><span class="line">x_value_mid = [i+bar_height/<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> x_value]</span><br><span class="line">x_value_back = [i+bar_height <span class="keyword">for</span> i <span class="keyword">in</span> x_value]</span><br><span class="line"></span><br><span class="line">score_a = [<span class="number">4</span>,<span class="number">5</span>,<span class="number">2</span>]</span><br><span class="line">score_b = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">fig, [ax1,ax2] = plt.subplots(<span class="number">2</span>,<span class="number">1</span>,figsize=(<span class="number">10</span>,<span class="number">8</span>),facecolor=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">fig.text(<span class="number">0.75</span>, <span class="number">0.45</span>, <span class="string">&#x27;Leo Lin copyright&#x27;</span>,</span><br><span class="line">         fontsize=<span class="number">40</span>, color=<span class="string">&#x27;gray&#x27;</span>,</span><br><span class="line">         ha=<span class="string">&#x27;right&#x27;</span>, va=<span class="string">&#x27;bottom&#x27;</span>, alpha=<span class="number">0.4</span>)</span><br><span class="line"></span><br><span class="line">ax1.barh(x_value,score_a,height=bar_height,color=<span class="string">&#x27;orange&#x27;</span>,label=<span class="string">&quot;a&quot;</span>)</span><br><span class="line">ax1.barh(x_value_back,score_b,height=bar_height,color=<span class="string">&#x27;blue&#x27;</span>,label=<span class="string">&quot;b&quot;</span>)</span><br><span class="line">ax1.legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置x轴刻度标签名称</span></span><br><span class="line">ax1.set_yticks(x_value_mid)</span><br><span class="line">ax1.set_yticklabels(name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 作y=sin(x)函数</span></span><br><span class="line">x1 = np.linspace(<span class="number">0</span>, <span class="number">4</span> * np.pi, <span class="number">100</span>)</span><br><span class="line">y1 = np.sin(x1)</span><br><span class="line">ax2.plot(x1,y1,linestyle=<span class="string">&#x27;--&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># wspace用于控制宽度和高度的百分比</span></span><br><span class="line">plt.subplots_adjust(wspace=<span class="number">0</span>,hspace=<span class="number">0</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%BF%90%E7%BB%B4SQL%E7%AC%94%E8%AF%95%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%BF%90%E7%BB%B4SQL%E7%AC%94%E8%AF%95%E9%A2%98/" class="post-title-link" itemprop="url">记一次运维SQL笔试题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-01 12:24:00" itemprop="dateCreated datePublished" datetime="2020-06-01T12:24:00+08:00">2020-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-08-22 13:37:24" itemprop="dateModified" datetime="2020-08-22T13:37:24+08:00">2020-08-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="创建一个学生表，包含课程、学号、分数"><a href="#创建一个学生表，包含课程、学号、分数" class="headerlink" title="创建一个学生表，包含课程、学号、分数"></a>创建一个学生表，包含课程、学号、分数</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `student` (</span><br><span class="line">  `id` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `num` int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  `course` varchar(255)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  `score` int(11)<span class="built_in"> DEFAULT </span><span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) <span class="attribute">ENGINE</span>=InnoDB<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<h2 id="把001号学生的数学课成绩改为90"><a href="#把001号学生的数学课成绩改为90" class="headerlink" title="把001号学生的数学课成绩改为90"></a>把001号学生的数学课成绩改为90</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> student </span><br><span class="line"><span class="keyword">SET</span> score = <span class="number">90</span> </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="keyword">num</span> = <span class="number">001</span> </span><br><span class="line">	<span class="keyword">AND</span> course_name = <span class="string">&quot;语文&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="查询语文成绩在70-90间的记录"><a href="#查询语文成绩在70-90间的记录" class="headerlink" title="查询语文成绩在70-90间的记录"></a>查询语文成绩在70-90间的记录</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	* </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	course_name = <span class="string">&quot;语文&quot;</span> </span><br><span class="line">	<span class="keyword">AND</span> score <span class="keyword">BETWEEN</span> <span class="number">70</span></span><br><span class="line">	<span class="keyword">AND</span> <span class="number">90</span>;</span><br></pre></td></tr></table></figure>
<h2 id="计算001号学生的成绩总和"><a href="#计算001号学生的成绩总和" class="headerlink" title="计算001号学生的成绩总和"></a>计算001号学生的成绩总和</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">SUM</span>( score ) <span class="keyword">AS</span> total </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="keyword">num</span> = <span class="number">001</span>;</span><br></pre></td></tr></table></figure>
<h2 id="计算所有学生的平均成绩"><a href="#计算所有学生的平均成绩" class="headerlink" title="计算所有学生的平均成绩"></a>计算所有学生的平均成绩</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="keyword">num</span>,</span><br><span class="line">	<span class="keyword">AVG</span>( score ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	<span class="keyword">num</span>;</span><br></pre></td></tr></table></figure>
<h2 id="所有学生的语文成绩都加10分"><a href="#所有学生的语文成绩都加10分" class="headerlink" title="所有学生的语文成绩都加10分"></a>所有学生的语文成绩都加10分</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> student </span><br><span class="line"><span class="keyword">SET</span> score = score + <span class="number">10</span> </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	course_name = <span class="string">&quot;语文&quot;</span>;</span><br></pre></td></tr></table></figure>
<h2 id="centos开启9890端口"><a href="#centos开启9890端口" class="headerlink" title="centos开启9890端口"></a>centos开启9890端口</h2><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-<span class="keyword">cmd</span><span class="bash"> --add-port=9890/tcp</span></span><br></pre></td></tr></table></figure>

<h2 id="收集的笔试题"><a href="#收集的笔试题" class="headerlink" title="收集的笔试题"></a>收集的笔试题</h2><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example 1"></a>Example 1</h3><p>如下两张表name_t 和 age_t</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>Name</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Nick</td>
</tr>
<tr>
<td>2</td>
<td>Tom</td>
</tr>
<tr>
<td>3</td>
<td>John</td>
</tr>
<tr>
<td>4</td>
<td>Peter</td>
</tr>
<tr>
<td>5</td>
<td>Frank</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>ID</th>
<th>Age</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>18</td>
</tr>
<tr>
<td>2</td>
<td>null</td>
</tr>
<tr>
<td>3</td>
<td>35</td>
</tr>
<tr>
<td>5</td>
<td>22</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="keyword">count</span>(t1.ID) <span class="keyword">as</span> cnt</span><br><span class="line"> <span class="keyword">FROM</span> </span><br><span class="line">    name_t t1 </span><br><span class="line"> <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> </span><br><span class="line">    age_t t2</span><br><span class="line"> <span class="keyword">ON</span> </span><br><span class="line">    t1.ID = t2.ID</span><br><span class="line"> <span class="keyword">WHERE</span> </span><br><span class="line">    t2.Age &gt; <span class="number">22</span> </span><br></pre></td></tr></table></figure>

<p>分析：忽略WHERE得出<br>ID    Name ID    Age<br>1   Nick 1 18<br>2    Tom  2 null<br>3    John 3 35<br>4    Peter null null<br>5   Frank 5 22<br>继续可得：<br>ID  Name  ID  Age<br>3   John  3   35</p>
<p>结合表信息，写出SQL的最终结果: 1</p>
<h3 id="Example-2"><a href="#Example-2" class="headerlink" title="Example 2"></a>Example 2</h3><p>请写SQL语句：<br>想要了解班级内同学的考试情况，现有一张成绩表表名为A，每行都包含以下内容（已知表中没有重复内容，但所有的考试结果都录入在了同一张表中，一个同学会有多条考试结果）：<br>student_id，course_name，score<br>现在需要知道：</p>
<ol>
<li>每门课程得到成绩的同学人数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	course_name,</span><br><span class="line">	<span class="keyword">COUNT</span>( score ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	course_name</span><br></pre></td></tr></table></figure></li>
<li>每门课程的平均成绩<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	course_name,</span><br><span class="line">	<span class="keyword">AVG</span>( score ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	course_name</span><br></pre></td></tr></table></figure></li>
<li>如果对于每门课程来说，60分以下为不及格，高于60为及格，统计每门课程及格和不及格的人数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	course_name,</span><br><span class="line">	<span class="keyword">sum</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> score &gt; <span class="number">60</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> ) <span class="keyword">as</span> <span class="string">&#x27;pass&#x27;</span>,</span><br><span class="line">	<span class="keyword">sum</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> score &lt; <span class="number">60</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span> ) <span class="keyword">as</span> <span class="string">&#x27;fail&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	course_name;</span><br></pre></td></tr></table></figure></li>
<li>方案二<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	course_name,</span><br><span class="line">	<span class="keyword">count</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> score &lt; <span class="number">60</span> <span class="keyword">THEN</span> <span class="keyword">num</span> <span class="keyword">END</span> ) <span class="keyword">AS</span> notpassNum,</span><br><span class="line">	<span class="keyword">count</span>( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> score &gt;= <span class="number">60</span> <span class="keyword">THEN</span> <span class="keyword">num</span> <span class="keyword">END</span> ) <span class="keyword">AS</span> passNum </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	student </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	course_name</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/01/win10%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E3%80%81%E8%BF%9B%E7%A8%8BPID/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/win10%E6%9F%A5%E7%9C%8B%E7%AB%AF%E5%8F%A3%E5%8D%A0%E7%94%A8%E3%80%81%E8%BF%9B%E7%A8%8BPID/" class="post-title-link" itemprop="url">win10查看端口占用、进程PID</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-01 12:00:00" itemprop="dateCreated datePublished" datetime="2020-06-01T12:00:00+08:00">2020-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-24 15:38:11" itemprop="dateModified" datetime="2020-06-24T15:38:11+08:00">2020-06-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="查看端口占用"><a href="#查看端口占用" class="headerlink" title="查看端口占用"></a>查看端口占用</h2><p>1、查看所有的端口和对应的PID（正常情况下，没必要看所有的端口）</p>
<p>命令：</p>
<p>netstat -ano<br><img src="/images/16-LinuxOther/2-wnetstat.png"></p>
<p>2、查看具体的端口占用和对应的进程pid</p>
<p>比如查看80端口的占用情况：</p>
<p>命令：</p>
<p>netstat -ano| findstr 80</p>
<p><img src="/images/16-LinuxOther/3-wfindstr.png"></p>
<p>3、查看某个pid进程具体运行什么服务：</p>
<p>比如查看68644这个pid具体是什么服务</p>
<p>命令：</p>
<p>tasklist |findstr 68644</p>
<p><img src="/images/16-LinuxOther/4-tasklist.png"></p>
<h2 id="杀死进程："><a href="#杀死进程：" class="headerlink" title="杀死进程："></a>杀死进程：</h2><p>TASKKILL [/S system [/U username [/P [password]]]] { [/FI filter] [/PID processid | /IM imagename] } [/T] [/F]</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1. /S   <span class="built_in"> system </span>   指定要连接的远程系统。  </span><br><span class="line"> </span><br><span class="line">2. /U    [domain\]user    指定应该在哪个用户上下文执行这个命令。</span><br><span class="line"> </span><br><span class="line">3. /P    [password]       为提供的用户上下文指定密码。如果忽略，提示输入。</span><br><span class="line"> </span><br><span class="line">4. /FI  <span class="built_in"> filter </span>          应用筛选器以选择一组任务。允许使用 <span class="string">&quot;*&quot;</span>。例如，映像名称 eq acme*</span><br><span class="line"> </span><br><span class="line">5. /PID  processid        指定要终止的进程的 PID。使用 TaskList 取得 PID。</span><br><span class="line"> </span><br><span class="line">6. /IM   imagename        指定要终止的进程的映像名称。通配符 <span class="string">&#x27;*&#x27;</span>可用来 指定所有任务或映像名称。</span><br><span class="line"> </span><br><span class="line">7. /T                     终止指定的进程和由它启用的子进程。</span><br><span class="line"> </span><br><span class="line">8. /F                     指定强制终止进程。</span><br><span class="line"> </span><br><span class="line">9. /?                     显示帮助消息。</span><br></pre></td></tr></table></figure>
<p>比如删除14396这个pid：</p>
<p>taskkill /pid 14396  -t  -f</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/01/%E7%BB%8F%E6%B5%8E%E6%9C%BA%E5%99%A8%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E7%9A%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/%E7%BB%8F%E6%B5%8E%E6%9C%BA%E5%99%A8%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E8%A1%8C%E7%9A%84/" class="post-title-link" itemprop="url">经济机器是如何运行的</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-01 12:00:00" itemprop="dateCreated datePublished" datetime="2020-06-01T12:00:00+08:00">2020-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-04 14:08:45" itemprop="dateModified" datetime="2020-06-04T14:08:45+08:00">2020-06-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%87%91%E8%9E%8D%E7%BB%8F%E6%B5%8E/" itemprop="url" rel="index"><span itemprop="name">金融经济</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="交易"><a href="#交易" class="headerlink" title="交易"></a>交易</h2><p>我们先来说经济中最简单的部分：交易！</p>
<p>经济不过是无数交易的总和，而交易是一件非常简单的事情。交易时刻都在发生，你每次买东西都是进行一笔交易。在每次交易中，买方使用货币或信用向卖方交换商品服务或金融资产。信用在使用时和货币一样，因此把花费的货币和信用加在一起，就可以得出支出总额。支出总额是经济的驱动力。如果用支出金额除以销量就得出价格。就是这么简单，这就是交易。交易是经济机器的最基本零件，所有的经济周期和动力都是交易造成的。所以理解了交易就理解了整个经济。</p>
<p>一个市场由买卖同一种商品的所有买方和卖方组成；例如小麦市场，汽车市场股票市场和千百万种其他市场。经济，就是由所有市场内的全部交易构成。把全部市场的总支出和销量加在一起，就得到了了解经济运行所需要的全部信息。就这么简单。</p>
<p>个人、企业、银行和政府都在以上述方式从事交易，用货币和信用交换商品服务和金融资产。政府是最大的买方和卖方，而政府由两个组成部分：收税和花钱的中央政府和中央银行。央行控制的经济中的货币和信贷数量，因此不同于其他买方和卖方。央行通过影响利率和发行更多货币来实行这种控制。我们在下面会看到，正因如此，央行在信贷流通当中发挥着重要作用。</p>
<h2 id="信贷"><a href="#信贷" class="headerlink" title="信贷"></a>信贷</h2><p>请诸位注意信贷。信贷是经济中最重要的组成部分，但也许是人们最不了解的部分。它之所以最重要，是因为它是经济中最大且最为变幻莫测的一部分。</p>
<p>贷款人和借款人与在市场中进行交易的买方和卖方没有两样。通常贷款人希望自己的钱生出更多的钱，而借款人则想购买当前无法负担的某种东西——比如房子汽车或是进行投资，例如开办企业。借贷可以同时满足贷款人和借款人的需要。借款人保证偿还借款，称为本金；并支付额外的款额称为利息。利率高时借贷就会减少，因为贷款变得昂贵；当利率低时借贷就会增加，因为贷款变的便宜。如果借款人保证偿还债务，而且贷款人相信这一承诺，信贷就产生了。任何两个人都可以通过协定凭空创造出信贷。信贷看似简单实则复杂，因为信贷还有其他名称。信贷一旦产生，立即成为债务。债务是贷款人的资产，同时是借款人的负债。等到借款人今后偿还了贷款并支付了利息，这些资产和负债将消失，交易得以完成。</p>
<p>那么为什么信贷如此重要？这是因为借款人一旦获得信贷，便可以增加自己的支出。不要忘记支出是经济的驱动力——这是因为一个人的支出，是另一个人的收入。想想看，你每花一块钱另一个人就挣了一块钱，而你每挣一块钱必定有别人花了一块钱，所以你花的越多别人挣得就越多！如果某人的收入增加，其信用度就会提高，贷款人就更愿意把钱借给他。信用良好的借款人具备两个条件，偿还能力和抵押物收入。债务比率高，借款人就具备偿还能力。如果无法偿还，借款人还可以用有价值可以出售的资产作为抵押物，这样贷款人可以放心的把钱借给他们。所以收入增加使得借贷也增加，从而能够增加支出。由于一个人的支出是另一个人的收入，这将导致借贷进一步增加，并不断循环。这一自我驱动的模式导致经济增长，也正是因为如此，才产生了经济周期。</p>
<h2 id="经济周期"><a href="#经济周期" class="headerlink" title="经济周期"></a>经济周期</h2><p>在一项交易中，为了获得某样东西，你必须付出另一样东西，长期来看你得到多少，取决于你生产多少。我们的知识随时间而逐渐增多，知识的积累会提高我们的生活水平，我们将此称为生产率的提高。一个善于创新和勤奋的人将比那些自满和懒惰的人更快地提高生产率和生活水平，但在短期内不一定体现出来！生产率在长期内最关键，但信贷在短期内最重要。这是因为生产率的提高不会剧烈波动，因此不是经济起伏的一个重要动力。但是债务是这种动力，因为我们能够通过借债让消费超过产出！但是在还债时，人们不得不让消费低于产出。债务量的波动有两大周期，其中一个周期持续大约五年至八年，另一个持续大约 75 年至 100 年。大部分人虽然能够感受到波动，但由于离波动太近，每天每周都身临其境，通常并不认为这是周期。我们将考查这三股主要动力，并观察它们如何相互作用，以及它们在日常经济中的表现。</p>
<p>1、周期的产生<br>如上所述，经济的上下起伏不是取决于人们多么善于创新或勤奋工作，而是主要看信贷的总量。我们先想象一个没有信贷的经济运行，在这样的经济运行中，增加支出的唯一办法是增加收入，因此需要提高生产率和工作量。提高生产率是经济增长的唯一途径。由于我的支出是另一个人的收入，当我或者另一个人提高生产率的时候，经济就会增长。我们如果观察各种交易加以总结，就会发现一条类似于生产力增长轨迹的渐进线。</p>
<p>但是由于我们借债，于是产生了周期，原因并不是任何法规，而是人的天性和信贷的运作方式！借债不过是提前消费，为了购买现在买不起的东西，你的支出必然超过收入。因此你需要借钱，实质上是向未来的自己借钱。你给自己设定了一个未来的时间，到那个时候你的支出必须少于收入，以便偿还债务。 这样马上就形成了一个周期。通常一旦你借钱就制造了一个周期。对于个人是这样，对于整个经济运行也是这样。这就是为什么必须理解信贷，因为信贷触发了一系列机械和可以预料的将在未来发生的事件，这就是信贷不同于货币的地方！完成交易需要使用货币，当你在酒吧用现金买一瓶啤酒时，交易立即完成。但是如果你用信用来买一瓶啤酒，比如赊账，你相当于承诺今后为这瓶啤酒付钱！你和酒吧一起创造了一笔资产和一笔负债，你们凭空制造出了信贷，只有在你今后清偿了这笔赊账之后，上述资产和负债才会消失，债务才会还清，交易才会了结。</p>
<p>现实生活中大部分所谓的钱实际上是信贷。美国国内的信贷总额大约为 50 万亿美元，而货币总额只有大约 3 万亿美元，不要忘记在没有信贷的经济运行中，增加支出的唯一办法是增加生产。但是在有信贷的经济运行中，还可以通过借债来增加支出。因此有信贷的经济运行能增加支出，使得收入的增长速度在短期内超过生产率的增长，但在长期内并非如此。但是请不要误解我的意思，信贷不一定是坏事，只是会导致周期性变化。信贷如果造成超过偿还能力的过度消费就是不良信贷;但是现在如果高效率地分配资源和产生收入，让你能偿还债务就是良性信贷。例如如果你借钱买一台大彩电，电视机不会带来任何收入，但是需要你偿还债务；但是你如果借钱买一台拖拉机，用它来收获更多的庄稼，赚更多的钱，你就能够偿还债务，提高生活水平。</p>
<p>在有现代的经济运行中，我们可以跟踪各种交易，观察信贷如何带来经济增长。我举一个例子，假设你每年挣 10 万美元，没有任何债务，你有不错的信用可以借 1 万美元。例如用信用卡借。因此你每年可以花 11 万美元，即使你的收入只有 10 万美元。由于你的支出是别人的收入，另一个人因此挣了 11 万美元。这个挣了 11 万美元的人，如果没有任何债务，可以借 1.1 万美元。他可以消费 12.1 万美元，即使他的年收入只有 11 万美元。由于他的支出是另一个人的收入，而我们通过跟踪各种交易，可以看到这个过程，不断自我强化。</p>
<p>2、短期债务周期<br>但不要忘记借债形成周期，周期会上升，最终也会下降。下面我们谈谈短期债务周期。随着经济活动的增加，出现了扩张，这是短期债务周期的第一阶段。支出继续增加，价格开始上涨，这里导致支出增加的是信贷，而信贷可以即刻凭空产生。如果支出和收入的增长速度超过所出售的商品的生产速度，价格就会上涨。我们把价格的上涨称为通货膨胀。央行不希望通货膨胀过高，因为这会导致许多问题。央行在看到价格上涨时就会提高利率。随着利率的上升，有能力借钱的人会减少，同时现有的债务成本也会上升，就等于你每个月的信用卡还款额会增加。由于人们减少借债、还款额度增长，剩下来用于支出的资金将减少，因此支出速度放慢。而由于一个人的支出是另一个人的收入，环环相扣，人们的收入将下降。由于支出减少，价格将下跌，我们称之为通货紧缩。经济活动减少，经济便进入衰退。如果衰退过于严重，而且通货膨胀不再成为问题，央行将降低利率，使经济活动重新加速。随着利率降低，偿债成本下降，借债和支出增加，出现另一次经济扩张，可见经济像一部机器一样运行。在短期债务周期中限制支出的唯一因素是贷款人和借款人的贷款和借款意愿。</p>
<p>3、长期债务周期<br>如果信贷易于获得，经济就会扩张。如果信贷不易获得，经济就会衰退。请注意这个周期主要由央行控制。短期债务周期通常持续 5-8 年，在几十年里不断重复。但是请注意在每个周期的低谷和高峰后，经济增长和债务都超过前一个周期。为什么会这样？这是人促成的。人具有借更多钱和花更多钱的倾向，而不喜欢偿还债务。这是人的天性。因此在长期内债务增加的速度超过收入，从而形成长期债务周期。尽管人们的债务增加，但贷款人会提供更宽松的信贷条件。</p>
<p>这是为什么？这是因为大家都以为形势一片大好，人们仅注意最近出现的情况。最近的情况是什么？收入一直在增加，资产价值不断上升，股票市场欣欣向荣，现在是繁荣时期——用借来的钱购买商品服务和金融资产很划算。当人们过度借贷消费使泡沫便产生了。因此尽管债务一直增加，但收入也以相进的速度增加，从而抵消了债务！我们把债务与收入比率称为债务负担。只要收入继续上升，债务负担就可以承受。与此同时，资产价值迅猛上升，人们大量借钱来购买资产，因为投资促使资产价格日益升高，人们感觉自己很富有。因此尽管积累了大量债务，收入和资产价值的上升，帮助借贷人在长期内保持良好的信用度。但是这种情况显然无法永久持续下去，也确实没有持续下去。几十年来债务负担缓慢增加，使偿贷成本越来越高，到了一定的时候，偿债成本的增加速度超过收入，迫使人们削减支出。由于一个人的支出是另一个人的收入，收入开始下降。人们的信用因此降低，致使借贷减少，偿债成本继续增加，使得支出进一步减少，周期开始逆转，这时到达长期债务的顶峰，债务负担变得过重。</p>
<p>美国欧洲和世界上很多其他地区在 2008 年即发生了这一情况，日本在 1989 年和美国在 1929 年因同样原因发生了这一情况。现在经济进入去杠杆化时期，在去杠杆化过程中，人们削减支出、收入下降、信贷消失、资产价格下跌、银行发生挤兑、股票市场暴跌、社会紧张加剧，整个过程开始下滑并形成恶性循环。随着收入下降和偿债成本增加，借款人倍感拮据。随着信用消失信贷枯竭，借款人再也无法借到足够的钱来偿还债务。借款人竭力填补这个窟窿，不得不在支出下降的同时出售资产。出售热潮使市场充斥待售资产，这时股票市场暴跌，不动产市场一蹶不振，银行陷入困境。随着资产价格下跌，借款人能够提供抵押物的价值下降，这进一步降低了借款人的信用，人们觉得自己很穷。信贷迅速消失，支出减少，收入减少，财富减少，信贷减少借债等等随之减少，这是一个恶性循环。</p>
<p>它看起来与衰退相似，但不同之处是无法通过降低利率来挽回局面。在衰退中可以通过降低利率来刺激借贷，但是在去杠杆化过程中，由于利率已经很低接近零，从而丧失刺激功能，因此降低利率不起作用。美国国内的利率在 1930 年代的去杠杆化期间下降到零，在 2008 年也是如此。衰退与去杠杆化之间的差别在于，在去杠杆化过程中，借款人的债务负担变得过重，无法通过降低利率来减轻。贷款人意识到债务过于庞大，根本无法足额偿还。借款人失去了偿债能力，其抵押物失去价值，他们觉得受到债务的极大伤害，不想再借入更多债务。贷款人停止放贷，借款人停止借贷，整个经济体与个人一样都失去了信用度。</p>
<h2 id="去杠杆化的手段"><a href="#去杠杆化的手段" class="headerlink" title="去杠杆化的手段"></a>去杠杆化的手段</h2><p>那么应该怎样应对去杠杆化？问题在于债务负担过重，必须减轻。为此可以采用四种办法：一，个人企业和政府削减支出；二，通过债务违约和重组来减少债务；三，财富再分配，将财富从富人转给穷人；四，最后央行发行更多货币。这四种办法被用于现代历史上的每一个去杠杆化过程。</p>
<p>1、削减支出，共克时艰<br>通常第一个措施是削减支出，我们刚才看到个人企业银行和政府都勒紧裤带削减支出，从而能够减少债务。我们经常把这称为紧缩。当借款人不再借入新的债务，并开始减少旧债务的时候，你会以为债务负担会减轻。但情况正好相反，支出减少了，而一个人的支出是另一个人的收入，这就导致收入下降，收入下降速度超过还债的速度，因此债务负担实际上更为沉重。我们已经看到这种削减支出的做法引起通货紧缩，令人痛苦，企业不得不削减成本，这意味着工作机会减少，失业率上升，这导致下一个步骤：必须减少债务。</p>
<p>很多借款人无法偿还贷款，而借款人的债务是贷款人的资产。如果借款人不偿还银行贷款，人们会担心银行无法返还其存款，因此纷纷从银行取出存款，银行受到挤兑，而个人企业和银行出现债务违约。这种严重的经济收缩就是萧条。萧条的一个主要特征是人们发现他们原来以为属于自己的财富中有很大一部分实际上并不存在。我们再次以酒吧为例，当你用赊账的办法买一瓶啤酒时，是在承诺今后偿还酒吧的赊账，你的承诺成为酒吧的一项资产。但是如果你不兑现承诺，不偿还酒吧的赊账，实际上是债务违约，那么酒吧的这项资产实际上一钱不值，它实际上是消失了。</p>
<p>2、债务重组<br>很多贷款人不希望自己的资产消失，同意债务重组。债务重组意味着贷款人得到的还款减少或偿还期延长，或利率低于当初商定的水平。无论如何合约被破坏，结果是债务减少，贷款人希望多少收回一些贷款，这强过血本无归。债务重组让债务消失，但由于它导致收入和资产价值以更快的速度消失，债务负担继续日趋沉重。削减债务与减少支出一样，令人痛苦和导致通货紧缩。所有这些都对中央政府产生影响。因为收入降低和就业减少意味着政府的税收减少。</p>
<p>3、财富再分配<br>与此同时由于失业率上升，中央政府需要增加支出：很多失业者储蓄不足，需要政府的财务支持；此外政府制定刺激计划和增加支出，以弥补经济活动的减少。在去杠杆化过程中，政府的预算赤字飙升，原因是政府的支出超过税收。你在新闻中所听到的预算赤字正是这种情况。政府必须加税或者举债，以填补赤字。但是在收入下降和很多人失业的时候，应该向谁融资呢？由于政府需要更多的钱，而且大量财富集中在少数人手中，政府自然而然地增加对富人的征税，以帮助经济中的财富再分配，把财富从富人那里，转给穷人。</p>
<p>4、发行货币，量化宽松<br>正在困苦当中的穷人开始怨恨富人，承受经济疲弱资产贬值和增税压力的富人开始怨恨穷人。如果萧条继续下去就会爆发社会动荡！不仅国家内部的紧张加剧，而且国家之间也会这样，债务国和债权国之间尤其如此。这种局势可以导致政治变革，有时是极端的变革，1930 年代这种局势导致希特勒掌权，欧洲爆发战争和美国的大萧条。要求采取行动来结束萧条的压力越来越大，不要忘记人们心目中的货币，实际上大部分是信贷！因此信贷一旦消失，人们的钱会不够花，人们迫切需要钱，而你一定记得谁可以发行货币，中央银行可以。</p>
<p>央行已经把利率降到接近零的水平，现在不得不发行更多货币。发行货币与削减支出、减少债务和财富再分配不同，会引起通货膨胀和刺激经济。中央银行不可避免的凭空发行更多货币，并使用这些货币来购买金融资产和政府债券。这种情况发生在美国大萧条期间，并于 2008 年再次爆发。当时美国的中央银行及联邦储备委员会增加发行了 2 万多亿美元，世界各地能够这样做的其他央行也增发了很多货币。央行通过用这些货币购买金融资产，帮助推升了资产价格，从而提高了人们的信用。但是这仅仅有助于那些拥有金融资产的人。你看央行可以发行货币，但是只能购买金融资产。而另一方面，中央政府可以购买商品和服务，可以向人民送钱，但是无法印钞票。因此为了刺激经济，央行和政府必须合作。央行通过购买政府债券，其实是把钱借给政府，使其能够运行赤字预算，并通过刺激计划和失业救济金来增加购买商品和服务的支出。这增加了人们的收入，也增加了政府的债务。但是这个办法将降低经济中的总债务负担，这是一个风险很大的时刻。</p>
<p>有人问发行货币是否会加剧通货膨胀，如果增发的货币抵消信贷的降幅，就不会引发通货膨胀。不要忘记重要的是支出，每一块钱的支出，无论支付的是货币还是信用，对价格的影响都是一样的。央行可以通过增加货币发行量来弥补消失的信贷。央行为了扭转局面，不仅需要推动收入的增长，而且需要让收入的增长率超过所积累债务的利率，这是什么意思？主要的意思是收入一定要比债务增长的快。例如我们假设有个国家正在经历去杠杆化，其债务收入比率是100%，这意味着债务量相当于整个国家一年的收入。假设这些债务的利率是2%，如果债务以2%的利率速度增加，而收入的增长率仅有大约1%，那么债务负担永远不会减轻，必须发行更多货币，使收入增长率超过利率。然而发行货币太容易了，而且比其他办法受欢迎，因此这个办法可能易于被滥用。关键是避免像1920年代去杠杆化的德国那样发行过多的货币，从而导致恶性通货膨胀。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>决策者需要平衡考虑降低债务负担的四种办法，必须平衡兼顾通货紧缩的办法和通货膨胀的办法，以便保持稳定。如果取成适当的平衡，就可以带来和谐的去杠杆化。所以说去杠杆化可以是痛苦的，也可以是和谐的！怎样才能实现和谐的去杠杆化？尽管去杠杆化是艰难的，但以尽可能好的办法来处理艰难的局势却是一件好事，这比杠杆化阶段大量举债产生过度失衡现象要好得多。在和谐的去杠杆化过程中，债务收入比率下降，经济实际上是正增长；同时通货膨胀并不是一个问题，这是通过适当的平衡所取得的。为了取得适当的平衡，需要结合削减支出、减少债务转移财富和发行货币的办法，以保持经济和社会稳定。</p>
<p>如果决策层取得适当的平衡，去杠杆化过程就不会那样激烈，经济增长速度缓慢，但债务负担会下降，这就是和谐的去杠杆化，当收入上升的时候，借款人的信用度提高，借款人一旦显得更有信用，贷款人就会开始恢复贷款，债务负担终于开始下降，人们可以借到钱就可以增加消费经济终于开始恢复增长长期债务周期，从而进入通货再膨胀阶段去杠杆化过程如果处理不当会非常可怕，但如果处理得当，最终将解决问题！为了使债务负担下降和经济活动恢复正常，大约需要十年或更长的时间，因此有失去的十年这种说法。综上所述，经济当然要比这个模式复杂一点。然而把短期债务周期长期债务周期和生产率增长轨迹结合起来分析，我们会得到一个不错的模式，可以看清我们在过去和当前的处境，以及未来可能的发展方向。</p>
<p>忠告<br>最后我希望大家学到三条经验法则。第一，不要让债务的增长速度超过收入，因为债务负担最终将把你压垮。第二，不要让收入的增长速度超过生产率，因为这最终将使你失去竞争力。第三，尽一切努力提高生产率，因为生产率在长期内起着最关键的作用。这就是我给大家，也是给决策者们的简单的建议。大家也许会吃惊地发现，大多数人包括大多数决策者都没有对此予以足够的重视。这个模式对我很有用，希望他也将对你们有用。谢谢大家。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/10/Mysql%20%E8%A7%86%E5%9B%BE%E3%80%81%E4%BA%8B%E5%8A%A1%E3%80%81%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/10/Mysql%20%E8%A7%86%E5%9B%BE%E3%80%81%E4%BA%8B%E5%8A%A1%E3%80%81%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">Mysql 视图、事务、索引</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-10 10:00:00" itemprop="dateCreated datePublished" datetime="2020-05-10T10:00:00+08:00">2020-05-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 12:25:18" itemprop="dateModified" datetime="2020-05-28T12:25:18+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>QPS：Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够相应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。</p>
<p>TPS：是TransactionsPerSecond的缩写，也就是事务数/秒。它是软件测试结果的测量单位。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请求时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。</p>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><p>视图是基于 SQL 语句的结果集的可视化的表，即视图是一个虚拟存在的表，可以包含表的全部或者部分记录，也可以由一个表或者多个表来创建。</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 一般创建语法</span></span><br><span class="line">create view &lt;视图名称&gt; [(column_list)]</span><br><span class="line">as select语句</span><br><span class="line">with<span class="built_in"> check </span>option;</span><br></pre></td></tr></table></figure>

<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引（Index）是帮助MySQL高效获取数据的数据结构，MySQL只对以下操作符才使用索引：&lt;，&lt;=，=，&gt;，&gt;=，between，in。</p>
<p>设计索引的原则：</p>
<ul>
<li>最适合索引的列是出现在WHERE子句中的列，或连接子句（on语句）中指定的列。</li>
<li>索引列的值中，不相同的数目越多，索引的效果越好。</li>
<li>使用短索引：对于CHAR和VARCHAR列，只用它的一部分来创建索引，可以节省索引空间，也会使查询更快捷。</li>
</ul>
<p>优点：</p>
<ul>
<li>提高了检索速度，若没有索引，MYSQL不得不以第一条记录开始全表扫描直到找出相关的行。</li>
</ul>
<p>缺点：</p>
<ul>
<li>降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。在执行这些操作时，DBMS（数据库管理系统）必须动态更新索引。</li>
<li>占用磁盘空间。</li>
</ul>
<h3 id="索引的类型"><a href="#索引的类型" class="headerlink" title="索引的类型"></a>索引的类型</h3><p>1、从数据结构角度：</p>
<ul>
<li>B+树索引(O(log(n)))：关于B+树索引，可以参考 MySQL索引背后的数据结构及算法原理</li>
<li>hash索引</li>
<li>FULLTEXT索引（现在MyISAM和InnoDB引擎都支持了）</li>
<li>R-Tree索引（用于对GIS数据类型创建SPATIAL索引）</li>
</ul>
<p>1.2 B+Tree索引和Hash索引区别？<br>哈希索引适合等值查询，但是无法进行范围查询<br>哈希索引没办法利用索引完成排序<br>哈希索引不支持多列联合索引的最左匹配规则<br>如果有大量重复键值的情况下，哈希索引的效率会很低，因为存在哈希碰撞问题</p>
<p>2、从物理存储角度：</p>
<ul>
<li>聚簇索引（clustered index）</li>
<li>非聚簇索引（non-clustered index）</li>
</ul>
<p>3、从逻辑角度：</p>
<ul>
<li><p>主键索引：主键索引是一种特殊的唯一索引，不允许有空值<br>在 MYSQL 中，当你建立主键时，主键索引同时也已经建立起来了，不必重复设置。</p>
</li>
<li><p>普通索引或者单列索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 直接创建索引</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> 索引名 <span class="keyword">ON</span> 表名(列名[(<span class="keyword">length</span>)]…); </span><br><span class="line"></span><br><span class="line"><span class="comment">## 修改表结构时添加普通索引，索引值可出现多</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tbl_name <span class="keyword">ADD</span> <span class="keyword">INDEX</span> index_name (column_list)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 查看索引</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">INDEX</span> <span class="keyword">FROM</span> 表名</span><br><span class="line"></span><br><span class="line"><span class="comment">## 删除索引</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> 索引名称 <span class="keyword">ON</span> 表名</span><br></pre></td></tr></table></figure>
</li>
<li><p>多列索引（复合索引）：复合索引指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用，使用复合索引时遵循最左前缀集合。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> student <span class="keyword">add</span> <span class="keyword">index</span> sy(<span class="keyword">name</span>，age，score); </span><br><span class="line"><span class="comment">## 最左前缀匹配</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">&#x27;jia&#x27;</span> <span class="keyword">and</span> age&gt;=<span class="number">12</span> //<span class="keyword">where</span>条件中含有索引的首列字段和第二个字段 </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">&#x27;jia&#x27;</span> //<span class="keyword">where</span>条件中只含有首列字段 </span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> student <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">&#x27;jia&#x27;</span> <span class="keyword">and</span> age=<span class="number">12</span> <span class="keyword">and</span> score &gt; <span class="number">60</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>唯一索引或者非唯一索引<br>创建方式和上方的普通索引类似，即将普通索引的’index’改为’unique index’。</p>
</li>
<li><p>空间索引：空间索引是对空间数据类型的字段建立的索引，MYSQL中的空间数据类型有4种，分别是GEOMETRY、POINT、LINESTRING、POLYGON。MYSQL使用SPATIAL关键字进行扩展，使得能够用于创建正规索引类型的语法创建空间索引。创建空间索引的列，必须将其声明为NOT NULL，空间索引只能在存储引擎为MYISAM的表中创建</p>
</li>
</ul>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>1、四大特性(ACID)<br>原子性（Atomicity）<br>一致性（Consistency）<br>隔离性（lsolation）<br>持久性（Durability）</p>
<p>2、自动提交<br>MySQL 默认开启事务自动提交模式，即除非显式的开启事务（BEGIN 或 START TRANSACTION），否则每条 SOL 语句都会被当做一个单独的事务自动执行。</p>
<p>3、事务隔离级别<br>如果事务没有隔离性，就容易出现脏读、不可重复读和幻读等情况。<br><strong>脏读</strong><br>脏读是指一个事务正在访问数据，并且对数据进行了修改，但是这种修改还没有提交到数据库中，这时，另外一个事务也访问这个数据，然后使用了这个数据。<br><strong>不可重复读</strong><br>不可重复读是指在一个事务内，多次读取同一个数据。<br>在这个事务还没有结束时，另外一个事务也访问了该同一数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改，那么第一个事务两次读到的的数据可能是不一样的。这样在一个事务内两次读到的数据是不一样的，因此称为是不可重复读。<br><strong>幻读</strong><br>幻读是指当事务不是独立执行时发生的一种现象，例如第一个事务对一个表中的数据进行了修改，这种修改涉及到表中的全部数据行。同时，第二个事务也修改这个表中的数据，这种修改是向表中插入一行新数据。那么，以后就会发生操作第一个事务的用户发现表中还有没有修改的数据行，就好象发生了幻觉一样。<br>为了解决以上这些问题，标准 SQL 定义了 4 类事务隔离级别，用来指定事务中的哪些数据改变是可见的，哪些数据改变是不可见的。</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">如何查看事务隔离级别：</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables  like <span class="emphasis">&#x27;%iso%&#x27;</span>;</span><br><span class="line"><span class="code">+---------------+</span>-----------------+</span><br><span class="line">| Variable<span class="emphasis">_name | Value           |</span></span><br><span class="line"><span class="emphasis">+---------------+-----------------+</span></span><br><span class="line"><span class="emphasis">| tx_</span>isolation  | REPEATABLE-READ |</span><br><span class="line"><span class="code">+---------------+</span>-----------------+</span><br><span class="line">1 row in set, 1 warning (0.40 sec)</span><br><span class="line">如何设置事务隔离级别：</span><br><span class="line"></span><br><span class="line">mysql&gt; set session tx<span class="emphasis">_isolation=&#x27;REPEATABLE-READ&#x27;;</span></span><br><span class="line"><span class="emphasis">Query OK, 0 rows affected (0.32 sec)</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/20-database/04-shiwu.png"></p>
<p>4、事务开启与提交</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span> 或者 <span class="keyword">start</span>  <span class="keyword">transaction</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">commit</span> 将缓存的数据变更到物理表钟</span><br><span class="line"></span><br><span class="line"><span class="keyword">rollback</span> 放弃缓存的变更数据</span><br></pre></td></tr></table></figure>

<p>5、大事务<br>定义：运行时间长比较长，操作的数据比较多的事务<br>风险：<br>锁定太多的数据，造成大量的阻塞和锁超时<br>回滚时间所需时间长，回滚的时候，数据同样是处于锁定状态<br>执行时间长，容易造成主从延迟（需要先在主服务器进行）</p>
<p>如何处理大事务？<br>避免一次处理太多的数据（分批处理）<br>移除不必要在事务中的SELECT操作（只有必要的写操作）</p>
<h2 id="查询优化神器-explain"><a href="#查询优化神器-explain" class="headerlink" title="查询优化神器-explain"></a>查询优化神器-explain</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN SELECT * <span class="keyword">FROM</span> cnarea_2018 WHERE id = 1;</span><br><span class="line">1<span class="built_in">	SIMPLE	</span>cnarea_2018	const(走索引)	PRIMARY	PRIMARY	3	const	1	</span><br><span class="line"></span><br><span class="line">EXPLAIN SELECT * <span class="keyword">FROM</span> cnarea_2018 WHERE <span class="attribute">pinyin</span>=<span class="string">&quot;KangYingJiaYuanSiSheQu&quot;</span></span><br><span class="line">1<span class="built_in">	SIMPLE	</span>cnarea_2018	ALL(全表扫描)					778092	Using where</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/05/Mysql%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/05/Mysql%E5%9F%BA%E7%A1%80%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0/" class="post-title-link" itemprop="url">Mysql基础查询数据更新</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-05 10:00:00" itemprop="dateCreated datePublished" datetime="2020-05-05T10:00:00+08:00">2020-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-28 13:29:39" itemprop="dateModified" datetime="2020-05-28T13:29:39+08:00">2020-05-28</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>1、约束类型：</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、primary <span class="type">key</span>：主键约束，主键这一行的数据不能重复且不能为空</span><br><span class="line"><span class="number">2</span>、not null：非空约束，表示不可空</span><br><span class="line"><span class="number">3</span>、unique：唯一约束，此字段的值不允许重复</span><br><span class="line"><span class="number">4</span>、<span class="section">default</span>：默认值约束，设置默认值</span><br><span class="line"><span class="number">5</span>、foreign <span class="type">key</span>：当为关系字段填写值时，会关联到表中查询值是否存在，若存在则填写成功。</span><br></pre></td></tr></table></figure>

<p>2、外键：是另一表的主键，外键可以有重复，可以是空值，用来和其他表建立联系。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 获取外键名</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> employee;</span><br><span class="line"><span class="comment">-- 添加外键</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> employee <span class="keyword">ADD</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(dept_id) <span class="keyword">REFERENCES</span> department(<span class="keyword">id</span>); </span><br></pre></td></tr></table></figure>
<p>on delete/on update默认规则是RESTRICT。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASCADE</span>(级联)：父表<span class="keyword">delete</span>、<span class="keyword">update</span>的时候，子表会<span class="keyword">delete</span>、<span class="keyword">update</span>掉关联记录；</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">NULL</span>：父表<span class="keyword">delete</span>、<span class="keyword">update</span>的时候，子表会将关联记录的外键字段所在列设为<span class="keyword">null</span>，所以注意在设计子表时外键不能设为<span class="keyword">not</span> <span class="keyword">null</span>；</span><br><span class="line"><span class="keyword">RESTRICT</span>(约束)：如果想要删除父表的记录时，而在子表中有关联该父表的记录，则不允许删除父表中的记录；</span><br><span class="line"><span class="keyword">NO ACTION</span>：同 <span class="keyword">RESTRICT</span>，但<span class="keyword">NO ACTION</span>是在其他约束的动作之后执行</span><br></pre></td></tr></table></figure>
<p><img src="/images/20-databse/03-sql-key.png"></p>
<p>3、写法顺序：select–from–where–group by–having–order by </p>
<p>4、执行顺序：其中每一个操作都会产生一张虚拟表，作为一个处理的输入，这些虚拟表对用户来说是透明的，只有最后一个虚拟表会被作为结果返回。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FORM：对<span class="keyword">FROM</span>的左边的表和右边的表计算笛卡尔积。产生虚表VT1</span><br><span class="line"><span class="keyword">ON</span>：对虚表VT1进行<span class="keyword">ON</span>筛选，只有那些符合&lt;<span class="keyword">join</span>-condition&gt;的行才会被记录在虚表VT2中。</span><br><span class="line"><span class="keyword">JOIN</span>：如果指定了<span class="keyword">OUTER</span> <span class="keyword">JOIN</span>（比如<span class="keyword">left join</span>、 <span class="keyword">right join</span>），那么保留表中未匹配的行就会作为外部行添加到虚拟表VT2中产生虚拟表VT3,rug <span class="keyword">from</span>子句中包含两个以上的表的话，那么就会对上一个<span class="keyword">join</span>连接产生的结果VT3和下一个表重复执行步骤<span class="number">1</span>~<span class="number">3</span>这三个步骤，一直到处理完所有的表为止。</span><br><span class="line"><span class="keyword">WHERE</span>：对虚拟表VT3进行<span class="keyword">WHERE</span>条件过滤，只有符合&lt;<span class="keyword">where</span>-condition&gt;的记录才会被插入到虚拟表VT4中。</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span>：根据<span class="keyword">group</span> <span class="keyword">by</span>子句中的列，对VT4中的记录进行分组操作，产生VT5。</span><br><span class="line"><span class="keyword">HAVING</span>：对虚拟表VT5应用<span class="keyword">having</span>过滤，只有符合&lt;havingcondition&gt;的记录才会被插入到虚拟表VT6中。</span><br><span class="line"><span class="keyword">SELECT</span>：执行操作，选择指定的列，插入到虚拟表中。</span><br><span class="line"><span class="keyword">DISTINCT</span>： 对中的记录进行去重。产生虚拟表VT8。</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span>： VT8中的记录按照&lt;order_by_list&gt;进行排序操作，产生虚拟表VT9。</span><br><span class="line"><span class="keyword">LIMIT</span>：取出指定行的记录，产生虚拟表，并将结果返回。</span><br></pre></td></tr></table></figure>

<p>5、数据库引擎<br>MyISAM：不支持外键约束。不支持事务。对数据大批量导入时，它会边插入数据边建索引，所以为了提高执行效率，应该先禁用索引，在完全导入后再开启索引。<br>InnoDB：支持外键约束，支持事务。对索引都是单独处理的，无需引用索引。</p>
<p>6、下列查询语句所用表结构示意图：<br><img src="/images/20-databse/02-sql-table.png"></p>
<h2 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h2><p>一个子句通常由一个关键字加上所提供的数据组成。<br>1、 带in关键字的查询<br>in操作符用来查询满足指定范围内的条件记录</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s_id,f_name <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> s_id(<span class="number">101</span>,<span class="number">102</span>)</span><br></pre></td></tr></table></figure>
<p>2、带between…and的范围查询<br>between and用来查询某个范围内的值</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">SELECT</span> f_name,f_price FROM fruits WHERE f_price between <span class="number">2</span>.<span class="number">00</span> and <span class="number">10</span>.<span class="number">20</span>ss</span><br></pre></td></tr></table></figure>
<p>3、带like字符匹配(模糊查询)<br>SQL中可以和like一起使用的通配符有%和_，%可代表任意长度的字符(包括零字符)，下划线只匹配任意单个字符。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询以b开头y结尾的选项</span></span><br><span class="line"><span class="keyword">SELECT</span> f_name <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name <span class="keyword">like</span> <span class="string">&#x27;b%y&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> suppliers <span class="keyword">WHERE</span> s_city <span class="keyword">like</span> <span class="string">&#x27;__市&#x27;</span></span><br></pre></td></tr></table></figure>
<p>4、空值：is null<br>null不同于空字符串。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> suppliers <span class="keyword">WHERE</span> s_city <span class="keyword">is</span> <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>5、多条件查询<br>and，or连接多个查询条件，and优先级高于or。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> f_name,f_price <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> s_id=<span class="number">101</span> <span class="keyword">and</span> f_price &gt;= <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>6、查询结果不重复<br>关键字distinct，放在去重的字段前</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询s_id字段的值，返回s_id字段值且不重复</span></span><br><span class="line"><span class="keyword">SELECT</span> count(<span class="keyword">distinct</span> s_id) <span class="keyword">from</span> fruits</span><br></pre></td></tr></table></figure>
<p>7、查询结果排序<br>order by子句对查询结果排序，永远是最后一个子句。</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruits <span class="keyword">ORDER</span> <span class="keyword">BY</span> s_id <span class="keyword">desc</span> <span class="comment">// 降序</span></span><br></pre></td></tr></table></figure>

<p>8、分组查询<br>按照某个或多个字段进行分组，group by关键字常和聚合函数（AVG、COUNT、MAX、MIN、SUM）一起使用。<br>过滤：group by可以和having一起限定显示记录所需满足的条件。<br>with rollup：在查询出的分组后增加一条统计记录，与order by互斥。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	s_id,</span><br><span class="line">	<span class="keyword">count</span>( * ) <span class="string">&#x27;商品种类&#x27;</span>,</span><br><span class="line">	<span class="keyword">GROUP_CONCAT</span>( f_name ) <span class="string">&#x27;商品名称&#x27;</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	fruits </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">	s_id </span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">ROLLUP</span></span><br><span class="line"><span class="keyword">HAVING</span></span><br><span class="line">	商品种类 &gt; <span class="number">1</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span></span><br><span class="line">	<span class="keyword">count</span>( * )</span><br></pre></td></tr></table></figure>

<p><strong>小提示：</strong><br>count(*) 计算表中总行数，不管某列是非空值还是空值（NULL）。<br>count(字段名) 计算指定列的总行数，计算时将忽略指定列的值为NULL的行。<br>WHERE 不能放在GROUP BY 后，且条件中不能有聚集函数如SUM()，AVG()等。</p>
<p>9、限制查询结果数量</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用limit实现top n问题，limit 偏移量，行数量</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruits <span class="keyword">ORDER</span> <span class="keyword">BY</span> f_price <span class="keyword">desc</span> <span class="keyword">limit</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>

<p>10、limit实现分页</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- page：请求的第几页，pageSize：每页条数</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruits limits (page<span class="number">-1</span>)*pagesize，pagesize</span><br></pre></td></tr></table></figure>

<p>11、DISTINCT<br>指示数据库只返回不同的值，若DISTINCT后跟多个字段，则作用于多个字段。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> f_name <span class="keyword">from</span> fruits</span><br></pre></td></tr></table></figure>

<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="表连接"><a href="#表连接" class="headerlink" title="表连接"></a>表连接</h3><p>1、内连接([inner] join)<br>只列出连接表中与连接条件相匹配的数据行</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> f_name,f_price,fruits.s_id,s_name,s_city</span><br><span class="line"><span class="keyword">from</span> fruits <span class="keyword">inner</span> <span class="keyword">join</span> suppliers</span><br><span class="line"><span class="keyword">on</span> fruits.s_id = suppliers.s_id</span><br><span class="line"><span class="keyword">where</span> f_name = <span class="string">&#x27;apple&#x27;</span></span><br></pre></td></tr></table></figure>
<p>等价于</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> f_name,f_price,f.s_id,s_name,s_city</span><br><span class="line"><span class="keyword">FROM</span> fruits <span class="keyword">as</span> f,suppliers <span class="keyword">as</span> s</span><br><span class="line"><span class="keyword">WHERE</span> f_name=<span class="string">&#x27;apple&#x27;</span> <span class="keyword">and</span> f.s_id = s.s_id</span><br></pre></td></tr></table></figure>
<p>2、左/右外连接(LEFT/RIGHT [OUTER] JOIN)<br>不仅列出与连接条件（on）相匹配的行，还列出左表table1(左外连接)、或右表table2(右外连接)所有符合WHERE过滤条件的数据行。<br>左外连接：左表列出全部，右表只列出匹配的记录。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询所有商品及其供应商，包括为供应商品的供应商信息</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	f_name,</span><br><span class="line">	f_price,</span><br><span class="line">	f.s_id,</span><br><span class="line">	s_name,</span><br><span class="line">	s_city </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	fruits <span class="keyword">AS</span> f</span><br><span class="line">	<span class="keyword">JOIN</span> suppliers <span class="keyword">AS</span> s <span class="keyword">ON</span> f.s_id = s.s_id</span><br></pre></td></tr></table></figure>
<p>3、全连接(FULL [OUTER] JOIN)<br>在内连接的基础上增加，左右两边没有显示的数据。<br>注意: mysql并不支持全连接 full JOIN 关键字，但是mysql 提供了 UNION 关键字 可以间接实现 full JOIN 功能。<br>UNION 用于合并多张表的查询结果，字段名以第一个为准，字段数量必须相同，union all 用于结果不去重的场景。</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> tname <span class="keyword">FROM</span> person <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> dept <span class="keyword">ON</span> person.did = dept.did</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> tname <span class="keyword">FROM</span> person <span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> dept <span class="keyword">ON</span> person.did = dept.did;</span><br></pre></td></tr></table></figure>
<p><img src="/images/20-databse/01-sql-join.png"></p>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>作用：某些情况下，当进行查询的时候，需要的条件是另外一个select 语句的结果，这个时候，就要用到子查询。<br>定义：为了给主查询（外部查询）提供数据而首先执行的查询（内部查询）被叫做子查询。也就是说，先执行子查询，根据子查询的结果，再执行主查询。<br>关键字：用于子查询的关键字主要包括 IN、NOT IN、EXIST、NOT EXIST、=、&lt;&gt;等（符号“&lt;&gt;”的意思是：不等于）。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询fruits表中最贵的水果</span></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	f_name </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	fruits </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	f_price = ( <span class="keyword">SELECT</span> MAX( f_price ) <span class="keyword">FROM</span> fruits )</span><br></pre></td></tr></table></figure>

<h3 id="正则表达式查询"><a href="#正则表达式查询" class="headerlink" title="正则表达式查询"></a>正则表达式查询</h3><p>使用正则关键字regexp，正则语法与Python中类似，示例如下</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在fruits表中查询以x开头y结尾，中间至少包含一次ab</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> fruits <span class="keyword">WHERE</span> f_name <span class="string">&#x27;^x(ab)+y$&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>1、简单case函数<br>在 SELECT 语句中，简单 CASE 函数仅检查是否相等，而不进行其它比较。<br>格式：CASE [col_name] WHEN [value1] THEN [result1]…ELSE [default] END</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	f_name,</span><br><span class="line">	f_price,</span><br><span class="line"><span class="keyword">CASE</span> f_price		</span><br><span class="line">		<span class="keyword">WHEN</span> <span class="number">1000</span> <span class="keyword">THEN</span> <span class="string">&#x27;贵&#x27;</span></span><br><span class="line">		<span class="keyword">ELSE</span> <span class="string">&#x27;正常&#x27;</span> </span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;info&#x27;</span>	</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	fruits;</span><br></pre></td></tr></table></figure>
<p>2、case搜索函数<br>在 SELECT 语句中，CASE 搜索函数允许根据比较值在结果集内对值进行替换。<br>格式：CASE WHEN [expr] THEN [result1]…ELSE [default] END</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	f_name,</span><br><span class="line">	f_price,</span><br><span class="line"><span class="keyword">CASE</span>		</span><br><span class="line">		<span class="keyword">WHEN</span> f_price &lt; <span class="number">10</span> <span class="keyword">THEN</span> <span class="string">&#x27;便宜&#x27;</span> <span class="keyword">WHEN</span> f_price &gt; <span class="number">20</span> <span class="keyword">THEN</span></span><br><span class="line">		<span class="string">&#x27;贵&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;正常&#x27;</span> </span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">AS</span> <span class="string">&#x27;info&#x27;</span>	</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	fruits;</span><br></pre></td></tr></table></figure>
<p>3、IF函数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	f_name,</span><br><span class="line"><span class="keyword">IF</span></span><br><span class="line">	( f_price &gt; <span class="number">10</span>, <span class="keyword">IF</span>(f_price&lt;<span class="number">20</span>,<span class="string">&#x27;正常&#x27;</span>,<span class="string">&#x27;贵&#x27;</span>), <span class="string">&#x27;便宜&#x27;</span> ) <span class="keyword">as</span> info</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	fruits</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/02/Linux%20%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E3%80%81%E7%BB%84%E4%BB%A5%E5%8F%8A%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%AE%80%E4%BB%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/Linux%20%E7%B3%BB%E7%BB%9F%E7%94%A8%E6%88%B7%E3%80%81%E7%BB%84%E4%BB%A5%E5%8F%8A%E6%96%87%E4%BB%B6%E6%9D%83%E9%99%90%E7%AE%80%E4%BB%8B/" class="post-title-link" itemprop="url">Linux 系统用户、组以及文件权限简介</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 12:00:00" itemprop="dateCreated datePublished" datetime="2020-05-02T12:00:00+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-06 20:56:27" itemprop="dateModified" datetime="2020-05-06T20:56:27+08:00">2020-05-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BF%90%E7%BB%B4%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">运维笔记</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Linux-安全性模型概述"><a href="#Linux-安全性模型概述" class="headerlink" title="Linux 安全性模型概述"></a>Linux 安全性模型概述</h2><p>Linux使用User（用户）和Group（组）控制使用者对文件的存取权限，在Linux系统中被创建的用户，可以使用账号和口令登录Linux。Linux系统将一切视为文件，每个文件都有owner,并且owner属于某个Group。</p>
<h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><p>Linux 系统的每个用户都有一个唯一的 User ID，Use r的信息存储在 /etc/passwd 中，该文件的格式示例如下：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span>0<span class="symbol">:</span>0<span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span></span><br></pre></td></tr></table></figure>
<p>每一位对应的含义为：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用户名:密码:用户ID:组ID:用户全名:主目录:登录<span class="keyword">shell</span></span><br></pre></td></tr></table></figure>
<p>在旧的系统中，直接将用户的密码存在第二位。由于 /etc/passwd 文件所有用户都有读权限，出于安全性考虑，后来的系统将密码单独拿出来存放在了 /etc/shadow 文件中， 而 /etc/passwd 文件的第二位只用于存储用户是否需要密码，如果用户存在密码，这该位用 ‘x’ 标记，如果是 “!” 或者为空则说明此用户不能用密码登录。</p>
<p>一般情况下只有拥有 HOME 目录和指定 shell 的用户才能登录系统。User 未经授权将禁止读写或执行其他 User 的文件。Linux 的 root 用户拥有至高无上的权限，可以无条件的对系统中的所有文件进行访问、修改和删除。一般不要随便用 root 登录并操作系统。</p>
<p>有两个命令可以用于添加新的用户，即 useradd 和 adduser。useradd 是系统原生命令，而 adduser 则是一个 perl 脚本，是对 useradd 的封装，已提供更好的创建用户的接口。adduser 命令的参数选项如下：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-b, <span class="params">--base-dir</span> BASE_DIR       指定主目录的基目录，一般默认为 <span class="string">/home</span></span><br><span class="line">-c, <span class="params">--comment</span> COMMENT         用户注释，即用户的详细信息（如姓名，年龄，电话等）</span><br><span class="line">-d, <span class="params">--home-dir</span> HOME_DIR       为用户指定一个 HOME 目录</span><br><span class="line">-D, <span class="params">--defaults</span>                查看或者改变创建用户时的配置，默认配置在 <span class="string">/etc/default/useradd</span> 中</span><br><span class="line">-e, <span class="params">--expiredate</span> EXPIRE_DATE  指定账户失效日期，格式为 YYYY-MM-DD</span><br><span class="line">-f, <span class="params">--inactive</span> INACTIVE       缓冲时间，指定在密码过期后多少天即关闭该帐号</span><br><span class="line">-g, <span class="params">--gid</span> GROUP               为用户指定一个组或者组 ID</span><br><span class="line">-G, <span class="params">--groups</span> GROUPS           将用户添加到其它的组，多个组时用逗号分隔</span><br><span class="line">-k, <span class="params">--skel</span> SKEL_DIR           指定创建 HOME 目录的模板目录，一般默认为 <span class="string">/etc/skel</span></span><br><span class="line">-K, <span class="params">--key</span> KEY=VALUE           覆盖 <span class="string">/etc/login.defs</span> 中的缺省配置</span><br><span class="line">-l, <span class="params">--no-log-init</span>             不要将此用户添加到最近登录和登录失败数据库</span><br><span class="line">-m, <span class="params">--create-home</span>             创建用户时一并创建用户的主目录</span><br><span class="line">-M, <span class="params">--no-create-home</span>          不要创建用户主目录</span><br><span class="line">-N, <span class="params">--no-user-group</span>           不创建与用户同名的组</span><br><span class="line">-o, <span class="params">--non-unique</span>              允许 UID 与其他用户相同</span><br><span class="line">-p, <span class="params">--password</span> PASSWORD       指定用户密码</span><br><span class="line">-r, <span class="params">--system</span>                  创建为一个系统账户</span><br><span class="line">-s, <span class="params">--shell</span> SHELL             指定用户的登录 Shell</span><br><span class="line">-u, <span class="params">--uid</span> UID                 为用户指定一个 UID</span><br><span class="line">-U, <span class="params">--user-group</span>              创建一个与用户同名的组</span><br></pre></td></tr></table></figure>
<p><code>userdel</code> 命令用于删除用户，常用的选项是-r，它的作用是把用户的主目录一起删除。</p>
<p><code>usermod</code>命令用于修改账户信息，常用的选项包括 -c, -d, -m, -g, -G, -s, -u 以及 -o 等，这些选项的意义与useradd命令中的选项一样，可以为用户指定新的资源值。</p>
<p>管理用户相关的命令工具汇总：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">useradd   ：添加用户</span><br><span class="line">adduser   ：添加用户</span><br><span class="line">passwd    ：为用户设置密码</span><br><span class="line">usermod   ：修改用户命令，可以通过 usermod 来修改登录名、用户的家目录等等</span><br><span class="line">pwcov     ：同步用户从 <span class="regexp">/etc/</span>passwd 到 <span class="regexp">/etc/</span>shadow</span><br><span class="line">pwck      ：pwck是校验用户配置文件 <span class="regexp">/etc/</span>passwd 和<span class="regexp">/etc/</span>shadow 文件内容是否合法或完整</span><br><span class="line">pwunconv  ：是 pwcov 的立逆向操作，是从 <span class="regexp">/etc/</span>shadow 和 <span class="regexp">/etc/</span>passwd 创建 <span class="regexp">/etc/</span>passwd ，然后会删除 <span class="regexp">/etc/</span>shadow 文件</span><br><span class="line">finger    ：查看用户信息工具</span><br><span class="line">id        ：查看用户的 UID、GID 及所归属的用户组</span><br><span class="line">chfn      ：更改用户信息工具</span><br><span class="line">su        ：用户切换工具</span><br><span class="line">sudo      ：sudo 是通过另一个用户来执行命令（execute a command as another user）</span><br><span class="line">visudo    ：visodo 是编辑 <span class="regexp">/etc/</span>sudoers 的命令；也可以不用这个命令，直接用vi 来编辑 <span class="regexp">/etc/</span>sudoers 的效果是一样的</span><br><span class="line">sudoedit  ：和 sudo 功能差不多</span><br></pre></td></tr></table></figure>
<h2 id="用户群组概述"><a href="#用户群组概述" class="headerlink" title="用户群组概述"></a>用户群组概述</h2><p>Linux 系统的每个 User 都属于一个 Group，具有唯一的标识符 GID。Group 信息存储于 /etc/group 中，且可以为 group 创建密码，密码存放在 /etc/gshadow 文件中，但是一般情况下不需要为用户组创建密码。系统默认会为每个 User 关联一个和 User 同名的 Group，每个 User 也至少存在于自己同名的 Group 中，同时 User 也可以加入其他的 Group。在同一个 Group 中的成员可以共享其他成员的文件。增加一个新的用户组使用 groupadd 命令。 其格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">用法：<span class="selector-tag">groupadd</span> <span class="selector-attr">[选项]</span> 组</span><br></pre></td></tr></table></figure>
<p>可以使用的选项有：</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-f, <span class="params">--force</span>                如果组已经存在则成功退出，并且如果 GID 已经存在则取消 -g</span><br><span class="line">-g, <span class="params">--gid</span> GID              为新组使用 GID</span><br><span class="line">-h, <span class="params">--help</span>                 显示此帮助信息并推出</span><br><span class="line">-K, <span class="params">--key</span> KEY=VALUE        不使用 <span class="string">/etc/login.defs</span> 中的默认值</span><br><span class="line">-o, <span class="params">--non-unique</span>           允许创建有重复 GID 的组</span><br><span class="line">-p, <span class="params">--password</span> PASSWORD    为新组使用此加密过的密码</span><br><span class="line">-r, <span class="params">--system</span>               创建一个系统账户</span><br><span class="line">-R, <span class="params">--root</span> CHROOT_DIR      chroot 到的目录</span><br></pre></td></tr></table></figure>
<p>如果要删除一个已有的用户组，使用groupdel命令，其格式为：<code>groupdel 用户组</code>。修改用户组的属性使用groupmod命令，其语法为：groupmod 选项 用户组</p>
<p>如果需要将一个用户添加到某个用户组中，可以采用如下命令：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -<span class="keyword">a</span> -G 用户组 用户名</span><br></pre></td></tr></table></figure>
<p>参数 -a 代表 append， 也就是将用户添加到新用户组中而不必离开原有的其他用户组，不过需要与 -G 选项配合使用， -G 表示指定用户组。如果仅仅只改变一个用户原有的用户组，则采用如下命令：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">useradd</span> -g 用户组</span><br></pre></td></tr></table></figure>
<p>管理用户组相关的命令工具汇总：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">groupadd   ：添加用户组；</span><br><span class="line">groupdel   ：删除用户组；</span><br><span class="line">groupmod   ：修改用户组信息</span><br><span class="line">groups     ：显示用户所属的用户组</span><br><span class="line">grpck</span><br><span class="line">grpconv    ：通过/etc/group和/etc/gshadow 的文件内容来同步或创建/etc/gshadow ，如果/etc/gshadow 不存在则创建；</span><br><span class="line">grpunconv  ：通过/etc<span class="built_in">/group </span>和/etc/gshadow 文件内容来同步或创建/etc<span class="built_in">/group </span>，然后删除gshadow文件；</span><br></pre></td></tr></table></figure>

<h2 id="Linux-文件和目录权限解读"><a href="#Linux-文件和目录权限解读" class="headerlink" title="Linux 文件和目录权限解读"></a>Linux 文件和目录权限解读</h2><h3 id="1、三种基本权限"><a href="#1、三种基本权限" class="headerlink" title="1、三种基本权限"></a>1、三种基本权限</h3><p>（1）r (read) 读</p>
<p>针对目录，有读（r）权限就代表能对此目录有列表功能，就是可以执行ls命令进行查看，另外还有cp的功能。 针对文件，有读（r）权限就代表能对此文件有阅读功能，可以通过cat等命令查看文件内容。</p>
<p>（2）w (write) 写</p>
<p>针对目录，有写（w）权限就代表着在此目录下创建文件和目录，可以通过touch，mkdir等命令创建文件和目录，另外还可以删除此目录下的文件。 针对文件，有写（w）权限就代表着对此文件可以写入新的内容和修改文件内容。</p>
<p>（3）x (execute) 执行</p>
<p>针对目录，有执行（x）权限就代表能进入此目录，利用cd等命令进入此目录 针对文件，有执行（x）权限就代表可以执行此文件。</p>
<p>在 Linux 下每一文件或目录的访问权限都有三组，每组用三位表示，分别为文件属主的读、写和执行权限；和属主同组的用户的读、写和执行权限；系统中其他用户的读、写和执行权限。当用ls -l命令显示文件或目录的周详信息时，最左边的一列为文件的访问权限。最左边的一位为文件的类型，例如“-”表示普通文件，“d”表示目录等。ls -l所列出的信息各栏含义如下：</p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">第一个栏位，表示文件的属性。</span><br><span class="line">第二个栏位，表示文件个数，即硬链接数。</span><br><span class="line">第三个栏位，表示该文件或目录的拥有者。</span><br><span class="line">第四个栏位，表示所属的组（<span class="keyword">group</span>）。</span><br><span class="line">第五栏位，表示文件大小。</span><br><span class="line">第六个栏位，表示创建日期。</span><br><span class="line">第七个栏位，表示文件名。</span><br></pre></td></tr></table></figure>
<h3 id="2、特殊位导致权限变化一般有以下两种"><a href="#2、特殊位导致权限变化一般有以下两种" class="headerlink" title="2、特殊位导致权限变化一般有以下两种"></a>2、特殊位导致权限变化一般有以下两种</h3><p>（1）特权位（s）<br>特权位只针对文件有效，并且只能添加在权限位的前三位和中间三位。一个可执行文件拥有 s 位并且在前三位时，即有 SUID 特殊权限(SETUID)时，当别的用户来执行此文件，使用的权限是此可执行文件属主权限；如果一个可执行文件拥有 s 位并且在中间三位时，即有 SGID 特殊权限(SETGID) 当别的用户来执行此文件，使用的权限是此可执行文件属组的权限。</p>
<p>例如，有普通用户 user1，当 user1 修改密码时，执行 passwd 命令时，passwd 文件权限为：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ll /usr/bin/passwd</span><br><span class="line">-rwsr-xr-x <span class="number">1</span> root root <span class="number">54256</span> May <span class="number">17</span>  <span class="number">2017</span> /usr/bin/passwd</span><br></pre></td></tr></table></figure>
<p>那么：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> user1 对于 /usr/bin/passwd 这个程序具有 x 权限，表示 user1 能执行 passwd</span><br><span class="line"><span class="number">2.</span> passwd 文件的所有者是 root </span><br><span class="line"><span class="number">3.</span> user1 执行 passwd 的过程中，会暂时获得 root 的权限</span><br><span class="line"><span class="number">4.</span> /etc/shadow 就可以被  user1 所执行的 passwd 所修改</span><br></pre></td></tr></table></figure>
<p>（2）粘帖位（t）<br>粘帖位只针对目录有效。有 t 位的目录，任何用户在有权限的情况下是可以创建文件和目录，就算是有权限删除别人的文件或目录也不能删除，同时互相也不能强制保存修改，自己只能删除自己创建的目录，用于一些共享上传的文件服务器场合。粘滞位只能占用后三位权限位。</p>
<p>例如 <code>/tmp</code> 目录，它的权限为：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ll /tmp -d</span><br><span class="line">drwxrwxrwt <span class="number">8</span> root root <span class="number">4096</span> Apr  <span class="number">6</span> <span class="number">15</span>:<span class="number">29</span> /tmp</span><br></pre></td></tr></table></figure>
<p>这表示任何人都可以在 /tmp 目录内新增、修改文件，但是只有该文件或目录的创建者与 root 用户能够删除自己的文件或目录。</p>
<p>注： s 位和 t 位都是占用 x 位，那么是否有 x 位，主要是看 s 或 t 的大小写来判别：大写，表示没有执行权限 x 位；小写，表示有执行权限 x 位。对于不可执行文件来说，SETUID 和 SETGID 没有任何意义。</p>
<h3 id="3、隐藏属性权限"><a href="#3、隐藏属性权限" class="headerlink" title="3、隐藏属性权限"></a>3、隐藏属性权限</h3><p>Linux 除了 9 个权限外，还有些隐藏属性，使用 lsattr 和 chattr 命令来查看和设置这些隐藏属性。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsattr -- listfile attributes on a Linux second extended file system</span><br><span class="line">chattr -- change file attributeson a Linux second extended file system</span><br></pre></td></tr></table></figure>
<p>chattr命令语法格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">chattr</span> <span class="selector-attr">[-RVf]</span> <span class="selector-attr">[-+=aAcCdDeijsStTu]</span> <span class="selector-attr">[-v version]</span> <span class="selector-tag">files</span>…</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-R :  递归处理所有的文件及子目录</span><br><span class="line">-V :  详细显示修改内容，并打印输出</span><br><span class="line"><span class="bullet">- </span>:  失效属性</span><br><span class="line">+ :  激活属性</span><br><span class="line"><span class="section">= :  指定属性</span></span><br></pre></td></tr></table></figure>
<p>属性:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">A</span>    <span class="string">no atime update, 不允许修改 atime</span></span><br><span class="line"><span class="attr">S</span>    <span class="string">synchronous updates, 实时写入文件，不使用缓冲区</span></span><br><span class="line"><span class="attr">D</span>    <span class="string">synchoronous directory updates, 实时同步到磁盘，针对目录设置</span></span><br><span class="line"><span class="attr">T</span>    <span class="string">top of directory hierarchy, Orlov 块分配器会将该目录视为目录层次结构的顶部</span></span><br><span class="line"><span class="attr">a</span>    <span class="string">append only, 只允许以 append 模式打开文件</span></span><br><span class="line"><span class="attr">c</span>    <span class="string">compressed, 自动压缩文件，读取时自动解压缩</span></span><br><span class="line"><span class="attr">d</span>    <span class="string">no dump, 当 dump 时，具有 d 属性的文件不加入 dump</span></span><br><span class="line"><span class="attr">e</span>    <span class="string">extent format, 在 ext 文件系统中，表示该文件使用区段(extents)映射磁盘上的块</span></span><br><span class="line"><span class="attr">i</span>    <span class="string">immuttbale, 不允许对文件执行删除，改名，增加软硬链接等操作，且无法写入</span></span><br><span class="line"><span class="attr">j</span>    <span class="string">data journalling, 写入记录 journal</span></span><br><span class="line"><span class="attr">s</span>    <span class="string">secure deletion, 可以安全删除，即硬盘空间被全部收回，不留痕迹</span></span><br><span class="line"><span class="attr">t</span>    <span class="string">no tail-merging, 与其它文件合并时末端不会存在局部块碎片</span></span><br><span class="line"><span class="attr">u</span>    <span class="string">undeletable, 与 s 相反，删除时数据还会存在磁盘中，可恢复</span></span><br></pre></td></tr></table></figure>
<h3 id="4、chmod-命令"><a href="#4、chmod-命令" class="headerlink" title="4、chmod 命令"></a>4、chmod 命令</h3><p>chmod 命令是非常重要的，用于改动文件或目录的访问权限。用户用他控制文件或目录的访问权限。该命令有两种用法。一种是包含字母和操作符表达式的文字设定法；另一种是包含数字的数字设定法。</p>
<p>文字设定法</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">chmod</span> <span class="selector-attr">[who]</span> <span class="selector-attr">[+	-	=]</span> <span class="selector-attr">[mode]</span> <span class="selector-tag">file</span>…</span><br></pre></td></tr></table></figure>
<p>命令中各选项的含义为：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">操作对象who可是下述字母中的任一个或他们的组合：</span></span><br><span class="line"><span class="attr">u</span> <span class="string">表示 “用户（user）”，即文件或目录的所有者</span></span><br><span class="line"><span class="attr">g</span> <span class="string">表示 “同组（group）用户”，即和文件属主有相同组 ID 的所有用户</span></span><br><span class="line"><span class="attr">o</span> <span class="string">表示 “其他（others）用户”</span></span><br><span class="line"><span class="attr">a</span> <span class="string">表示 “所有（all）用户”。此为系统默认值</span></span><br></pre></td></tr></table></figure>
<p>操作符号可以是：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ 添加某个权限。</span><br><span class="line"><span class="bullet">- </span>取消某个权限。</span><br><span class="line"><span class="section">= 赋予给定权限并取消其他所有权限（如果有的话）。</span></span><br></pre></td></tr></table></figure>
<p>设置 mode 所表示的权限可用下述字母的任意组合：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">r</span> <span class="string">可读</span></span><br><span class="line"><span class="attr">w</span> <span class="string">可写</span></span><br><span class="line"><span class="attr">x</span> <span class="string">可执行</span></span><br></pre></td></tr></table></figure>
<p>x 只有目标文件对某些用户是可执行的或该目标文件是目录时才追加 x 属性。</p>
<p>s 在文件执行时把进程的属主或组 ID 置为该文件的文件属主。方式<code>u+s</code>设置文件的用户 ID 位，g+s 设置组 ID 位。</p>
<p>文件可以是以空格分开的要改动权限的文件列表，支持通配符。在一个命令行中可给出多个权限方式，其间用逗号隔开。例如：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使同组和其他用户对文件有读权限</span></span><br><span class="line">chmod g+r, o+r <span class="built_in">file</span></span><br><span class="line">chmod go+r <span class="built_in">file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给文件加上 SETUID，并去掉同组和其他人的读权限</span></span><br><span class="line">chmod u+s, go-r <span class="built_in">file</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给目录加上粘滞位（粘滞位只占用 others 权限位）</span></span><br><span class="line">chmod o+t <span class="built_in">directory</span></span><br></pre></td></tr></table></figure>
<h3 id="数字设定法"><a href="#数字设定法" class="headerlink" title="数字设定法"></a>数字设定法</h3><p>数字表示的属性的含义：0表示没有权限，1表示可执行权限，2表示可写权限，4表示可读权限。通过将三个值相加来得到要设置的权限。所以数字属性的格式应为3 个从0到7的八进制数，其顺序是（u）（g）（o）。例如，如果想让某个文件的属主有“读/写”二种权限，需要把4（可读）+2（可写）=6（读/写）。数字设定法的一般形式为：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod [<span class="keyword">mode</span>] <span class="keyword">file</span>…</span><br></pre></td></tr></table></figure>
<p>例如，将一个文件的权限设置为属主可读可写，同组用户可读可写，其他用户可读，则命令为：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">664</span> file</span><br></pre></td></tr></table></figure>

<h3 id="5、chgrp和chown命令"><a href="#5、chgrp和chown命令" class="headerlink" title="5、chgrp和chown命令"></a>5、chgrp和chown命令</h3><p>chgrp 命令用于改动文件或目录所属的组。语法格式如下：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp [-R]<span class="built_in"> group </span>file…</span><br></pre></td></tr></table></figure>
<p>该命令改动指定文件所属的用户组。其中 group 可以是用户组 ID，也可以是 /etc/group 文件中用户组的组名。文件名是以空格分开的要改动属组的文件列表，支持通配符。如果用户不是该文件的属主或终极用户，则不能改动该文件的组。-R 参数递归式地改动指定目录及其下的所有子目录和文件的属组。例如改动 /opt/local /book/ 及其子目录下的所有文件的属组为 book：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chgrp –R book <span class="regexp">/opt/</span>local/book</span><br></pre></td></tr></table></figure>
<p><code>chown</code> 命令用于更改某个文件或目录的属主和属组。这个命令也非常常用。例如 root 用户把自己的一个文件拷贝给用户 huoty，为了让用户 huoty 能够存取这个文件，root 用户应该把这个文件的属主设为 huoty，否则，用户 huoty 无法存取这个文件。语法格式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">chown</span> <span class="selector-attr">[选项]</span> 用户或组 文件</span><br></pre></td></tr></table></figure>
<p>chown 将指定文件的拥有者改为指定的用户或组。用户能是用户名或用户ID。组能是组名或组ID。文件是以空格分开的要改动权限的文件列表，支持通配符。该命令的各选项含义如下：</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-</span><span class="comment">c</span><span class="string">,</span> --<span class="comment">changes</span>          <span class="comment">显示更改的部分的信息</span></span><br><span class="line"><span class="comment"></span><span class="literal">-</span><span class="comment">f</span><span class="string">,</span> --<span class="comment">silent</span><span class="string">,</span> --<span class="comment">quiet</span>  <span class="comment">忽略错误信息</span></span><br><span class="line"><span class="comment"></span><span class="literal">-</span><span class="comment">R</span><span class="string">,</span> --<span class="comment">recursive</span>        <span class="comment">递归处理指定目录以及其子目录下的所有文件</span></span><br><span class="line"><span class="comment"></span>--<span class="comment">reference</span>            <span class="comment">参考指定文件或目录的用户和组</span></span><br><span class="line"><span class="comment"></span><span class="literal">-</span><span class="comment">h</span><span class="string">,</span> --<span class="comment">no</span><span class="literal">-</span><span class="comment">dereference</span>   <span class="comment">只对符号链接的文件本身做修改，而不更改其他任何相关文件</span></span><br><span class="line"><span class="comment"></span>--<span class="comment">dereference</span>          <span class="comment">作用于符号链接的指向，而不是链接文件本身，与</span> <span class="literal">-</span><span class="comment">h</span> <span class="comment">参数相反</span></span><br><span class="line"><span class="comment"></span><span class="literal">-</span><span class="comment">v</span><span class="string">,</span> --<span class="comment">verbose</span>          <span class="comment">显示详细的处理信息</span></span><br></pre></td></tr></table></figure>
<p>使用例示：</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 改变文件的所有者：</span></span><br><span class="line"><span class="title">chown</span> www-<span class="class"><span class="keyword">data</span> test</span></span><br><span class="line"><span class="title">chown</span> www-<span class="class"><span class="keyword">data</span>: test</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 改变文件的所属组：</span></span><br><span class="line"><span class="title">chown</span> :www-<span class="class"><span class="keyword">data</span> test</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 同时改变文件的所有者和所属组：</span></span><br><span class="line"><span class="title">chown</span> huoty:huoty test</span><br></pre></td></tr></table></figure>

<h3 id="getfacl和setfacl命令"><a href="#getfacl和setfacl命令" class="headerlink" title="getfacl和setfacl命令"></a>getfacl和setfacl命令</h3><p><code>setfacl</code>命令可以用来细分 Linux 下的文件权限。chmod 命令可以把文件权限分为 u,g,o 三个组，而 setfacl 可以对每一个文件或目录设置更精确的文件权限。 即 setfacl 可以更精确的控制权限的分配，如，让某一个用户对某一个文件具有某种权限。这种独立于传统的 u,g,o 的 rwx 权限之外的具体权限设置叫 ACL（Access Control List）。ACL 可以针对单一用户、单一文件或目录来进行 r,w,x 的权限控制，对于需要特殊权限控制的情况是有用的。</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">setfacl [-bkndRLP] &#123; -m|-M|-x|-X ... &#125; <span class="keyword">file</span> ...</span><br><span class="line">-m, --modify-acl        更改文件的访问控制列表</span><br><span class="line">-M, --modify-<span class="keyword">file</span>=<span class="keyword">file</span>  从文件读取访问控制列表条目更改</span><br><span class="line">-x, --remove=acl        根据文件中访问控制列表移除条目</span><br><span class="line">-X, --remove-<span class="keyword">file</span>=<span class="keyword">file</span>  从文件读取访问控制列表条目并删除</span><br><span class="line">-b, --remove-<span class="keyword">all</span>        删除所有扩展访问控制列表条目</span><br><span class="line">-k, --remove-default    移除默认访问控制列表</span><br><span class="line">    --<span class="keyword">set</span>=acl           设定替换当前的文件访问控制列表</span><br><span class="line">    --<span class="keyword">set</span>-file=file     从文件中读取访问控制列表条目设定</span><br><span class="line">    --mask              重新计算有效权限掩码</span><br><span class="line">-n, --no-mask           不重新计算有效权限掩码</span><br><span class="line">-d, --default           应用到默认访问控制列表的操作</span><br><span class="line">-R, --recursive         递归操作子目录</span><br><span class="line">-L, --logical           依照系统逻辑，跟随符号链接</span><br><span class="line">-P, --physical          依照自然逻辑，不跟随符号链接</span><br><span class="line">    --restore=file      恢复访问控制列表，和<span class="comment"> getfacl -R</span> 作用相反</span><br><span class="line">    --test              测试模式，并不真正修改访问控制列表属性</span><br><span class="line">-v, --version           显示版本并退出</span><br><span class="line">-h, --help              显示本帮助信息</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置用户 user1 对 test 文件的访问权限</span></span><br><span class="line"><span class="attribute">setfacl</span> -m u:user<span class="number">1</span>:r-x test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置用户组 group1 对 test/ 目录的访问权限</span></span><br><span class="line"><span class="attribute">setfacl</span> -m u:user<span class="number">1</span>:rwx test/</span><br></pre></td></tr></table></figure>
<p><code>getfacl</code> 用于获取文件的 acl 权限控制：</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">getfacl [-aceEsRLPtpndvh] <span class="built_in">file</span> ...</span><br><span class="line">-<span class="keyword">a</span>, <span class="comment">--access            仅显示文件访问控制列表</span></span><br><span class="line">-d, <span class="comment">--default           仅显示默认的访问控制列表</span></span><br><span class="line">-c, <span class="comment">--omit-header       不显示注释表头</span></span><br><span class="line">-e, <span class="comment">--all-effective     显示所有的有效权限</span></span><br><span class="line">-E, <span class="comment">--no-effective      显示无效权限</span></span><br><span class="line">-s, <span class="comment">--skip-base         跳过只有基条目(base entries)的文件</span></span><br><span class="line">-R, <span class="comment">--recursive         递归显示子目录</span></span><br><span class="line">-L, <span class="comment">--logical           逻辑遍历(跟随符号链接)</span></span><br><span class="line">-P, <span class="comment">--physical          物理遍历(不跟随符号链接)</span></span><br><span class="line">-t, <span class="comment">--tabular           使用制表符分隔的输出格式</span></span><br><span class="line">-n, <span class="comment">--numeric           显示数字的用户/组标识</span></span><br><span class="line">-p, <span class="comment">--absolute-names    不去除路径前的 &#x27;/&#x27; 符号</span></span><br><span class="line">-v, <span class="comment">--version           显示版本并退出</span></span><br><span class="line">-h, <span class="comment">--help              显示本帮助信息</span></span><br></pre></td></tr></table></figure>
<p>使用示例<br>（1）管理 opt 目录<br>创建 readers 组，表示该组中的用户对文件有只读权限</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">groupadd readers</span></span><br></pre></td></tr></table></figure>
<p>创建 writers 组，表示改该组中的用户对文件用写权限</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">groupadd writers</span></span><br></pre></td></tr></table></figure>
<p>让 writers 组的用户对 /opt 目录可读写:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m <span class="attr">g:</span><span class="attr">writers:</span>rwx /opt</span><br></pre></td></tr></table></figure>
<p>给 /opt 目录添加 粘帖权限位（t）:</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">chmod</span> o+t /<span class="meta">opt</span></span><br></pre></td></tr></table></figure>
<p>把需要的用户添加到 writers 组：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">usermod</span> -a -G writers user<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>把需要的用户添加到 readers 组：</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">usermod</span> -a -G readers user<span class="number">1</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/02/Vue%20%E6%8F%92%E6%A7%BD%E3%80%81%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Leo Lin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="江湖の林九">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/Vue%20%E6%8F%92%E6%A7%BD%E3%80%81%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD/" class="post-title-link" itemprop="url">Vue 插槽、具名插槽、作用域插槽</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 10:00:00" itemprop="dateCreated datePublished" datetime="2020-05-02T10:00:00+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-20 16:02:21" itemprop="dateModified" datetime="2020-06-20T16:02:21+08:00">2020-06-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6/" itemprop="url" rel="index"><span itemprop="name">前端进阶</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在 2.6.0 中，我们为具名插槽和作用域插槽引入了一个新的统一的语法 (即 v-slot 指令)。<br>它取代了 slot 和 slot-scope 这两个目前已被废弃但未被移除且仍在文档中的特性。</p>
<p>1、编译的作用域</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">child-component</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span><span class="template-variable">&#123;&#123; <span class="name">message</span> &#125;&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">child-component</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>这里的message就是一个slot，它绑定的是父组件的数据，而不是child-component数据。<br>父子组件的模板内容分别在其相应的作用域内编译，因此slot分发的内容作用域是在父组件上的，但子组件内默认内容它的作用域是子组件本身。</p>
<h2 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h2><p>在父组件里，插入在子组件标签内的所有内容将替代子组件的slot标签及它的内容，<code>&lt;slot&gt;&lt;/slot&gt;</code>里也可以设置默认值。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span><span class="xml"><span class="tag">&lt;<span class="name">alert-box</span>&gt;</span>有Bug发生<span class="tag">&lt;/<span class="name">alert-box</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">&#x27;alert-box&#x27;</span>,&#123;</span><br><span class="line">	template:`</span><br><span class="line">	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span>Error:<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	`</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">	el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">	data:&#123;&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Vue单文件模块示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># SlotDemo.vue</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>这是默认值<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>子页面组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;SlotDemo&#x27;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># APP.vue(父组件)</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>引用testSlot组件的页面<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot-demo</span>&gt;</span>过渡...<span class="tag">&lt;/<span class="name">slot-demo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SlotDemo <span class="keyword">from</span> <span class="string">&#x27;./SlotDemo&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;APP&#x27;</span>,</span></span><br><span class="line">    components: &#123; SlotDemo &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/19-vue/01-slot.png"></p>
<h2 id="具名插槽"><a href="#具名插槽" class="headerlink" title="具名插槽"></a>具名插槽</h2><p>vue 2.6.0 以后的具名插槽相比 template上的 slot=’xxx’只需要改成v-slot : xxx 即可(值没有引号)。<br>给slot元素指定name后可以分发多个内容，书写v-slot:one 的形式时，可以简写为 #one。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span><span class="xml"><span class="tag">&lt;<span class="name">base-layout</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&#x27;header&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>标题信息1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>标题信息2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>主要内容1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>主要内容2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">slot</span>=<span class="string">&#x27;footer&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>底部信息1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>底部信息2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">base-layout</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">&#x27;base-layout&#x27;</span>,&#123;</span><br><span class="line">	template:`</span><br><span class="line">	<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;header&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="xml"><span class="tag">&lt;<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="xml">			</span><span class="xml"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;footer&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">	`</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Vue单文件模块示例</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># SlotDemo.vue</span><br><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>= &#x27;<span class="symbol">button</span>&#x27;&gt;</span><br><span class="line">      &lt;<span class="symbol">button</span>&gt; 默认按钮 &lt;/<span class="symbol">button</span>&gt;</span><br><span class="line">      &lt;<span class="symbol">slot</span> <span class="symbol">name</span>= &#x27;<span class="symbol">one</span>&#x27;&gt; 这就是默认值<span class="symbol">1</span>&lt;/<span class="symbol">slot</span>&gt;</span><br><span class="line">      &lt;<span class="symbol">slot</span> <span class="symbol">name</span>=&#x27;<span class="symbol">two</span>&#x27;&gt; 这就是默认值<span class="symbol">2</span> &lt;/<span class="symbol">slot</span>&gt;</span><br><span class="line">      &lt;<span class="symbol">slot</span> <span class="symbol">name</span>=&#x27;<span class="symbol">three</span>&#x27;&gt; 这就是默认值<span class="symbol">3</span> &lt;/<span class="symbol">slot</span>&gt;</span><br><span class="line">    &lt;/<span class="symbol">div</span>&gt;</span><br><span class="line">&lt;/<span class="symbol">template</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="symbol">script</span>&gt;</span><br><span class="line">  <span class="symbol">export</span> <span class="symbol">default</span> &#123;</span><br><span class="line">    name: <span class="string">&#x27;SlotDemo&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line"></span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># APP.vue(父组件)</span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">SlotDemo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:one</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是插入到one插槽的内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:two</span>&gt;</span> <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是插入到two插槽的内容<span class="tag">&lt;/<span class="name">div</span>&gt;</span> <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">SlotDemo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> SlotDemo <span class="keyword">from</span> <span class="string">&#x27;./SlotDemo&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;APP&#x27;</span>,</span></span><br><span class="line">    components: &#123; SlotDemo &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="作用域插槽"><a href="#作用域插槽" class="headerlink" title="作用域插槽"></a>作用域插槽</h2><p>可以访问使用<code>子组件的数据</code>和<code>父组件传递的props值</code>，常用于当子组件循环或某一部分的DOM结构应该由外部传递进来的场景。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// <span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-for</span>=<span class="string">&quot;item of list&quot;</span> <span class="attr">:item</span>=<span class="string">item</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">这段代码的意思是child组件去做一个列表的循环，但是列表项中的每一项怎么显示，我并不关心，具体怎么显示，外部你来告诉我.</span><br></pre></td></tr></table></figure>
<p>1、slot-scope<br>绑定在 <code>&lt;slot&gt; </code>元素上的 attribute 被称为插槽 prop（此处info属性），slot-scope 声明了被接收的 prop 对象会作为 slotProps 变量存在于<code>&lt;template&gt;</code>作用域中。<br>slot-scope attribute 也可以直接用于非 <code>&lt;template&gt;</code> 元素 (包括组件)。</p>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"> <span class="xml"><span class="tag">&lt;<span class="name">fruit-list</span> <span class="attr">:list</span>=<span class="string">&#x27;list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="xml"><span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&#x27;slotProps&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        </span><span class="xml"><span class="tag">&lt;<span class="name">strong</span> <span class="attr">v-if</span>=<span class="string">&#x27;slotProps.info.id==3&#x27;</span> <span class="attr">class</span>=<span class="string">&quot;current&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          </span><span class="xquery">&#123;&#123;slotProps.info<span class="built_in">.name</span>&#125;</span><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">fruit-list</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Vue.component(<span class="string">&#x27;fruit-list&#x27;</span>, &#123;</span><br><span class="line">      props: [<span class="string">&#x27;list&#x27;</span>],</span><br><span class="line">      template: `</span><br><span class="line">     <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="xml"><span class="tag">&lt;<span class="name">li</span> <span class="attr">:key</span>=<span class="string">&#x27;item.id&#x27;</span> <span class="attr">v-for</span>=<span class="string">&#x27;item in list&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          </span><span class="xml"><span class="tag">&lt;<span class="name">slot</span> <span class="attr">:info</span>=<span class="string">&#x27;item&#x27;</span>&gt;</span></span><span class="xquery">&#123;&#123;<span class="type">item</span><span class="built_in">.name</span>&#125;</span><span class="xml">&#125;<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">      `</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">      el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">      data: &#123;</span><br><span class="line">        list: [&#123;</span><br><span class="line">           <span class="built_in"> id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">           <span class="built_in"> name</span>: <span class="string">&#x27;apple&#x27;</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">           <span class="built_in"> id</span>: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">           <span class="built_in"> name</span>: <span class="string">&#x27;orange&#x27;</span></span><br><span class="line">          &#125;, &#123;</span><br><span class="line">           <span class="built_in"> id</span>: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">           <span class="built_in"> name</span>: <span class="string">&#x27;banana&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>Vue单文件模块示例</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"># App.Vue(父组件)</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>这里是父组件<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--第一次使用：用flex展示数据--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">child</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">slot-scope</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;tmpl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-for</span>=<span class="string">&quot;item in user.data&quot;</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">item</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!--第二次使用：不使用其提供的数据, 作用域插槽退变成匿名插槽--&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">child</span>&gt;</span></span></span><br><span class="line"><span class="xml">      我就是模板</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">child</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">&quot;child&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h3&gt;这里是子组件&lt;/h3&gt;</span><br><span class="line">    <span class="comment">// 作用域插槽</span></span><br><span class="line">    &lt;slot :data=<span class="string">&quot;data&quot;</span>&gt;&lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        data: [<span class="string">&#x27;zhangsan&#x27;</span>,<span class="string">&#x27;lisi&#x27;</span>,<span class="string">&#x27;wanwu&#x27;</span>,<span class="string">&#x27;zhaoliu&#x27;</span>,<span class="string">&#x27;tianqi&#x27;</span>,<span class="string">&#x27;xiaoba&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2、v-slot</p>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"># 父组件</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">current-user</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:default</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; <span class="name">slotProps.user.firstName</span> &#125;&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">current-user</span>&gt;</span></span></span><br><span class="line"><span class="xml">或者直接作用在 <span class="tag">&lt;<span class="name">current-user</span>&gt;</span> 上的写法：</span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 显示调用默认插槽名字 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">current-user</span> <span class="attr">v-slot:default</span>=<span class="string">&quot;slotProp&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  </span><span class="template-variable">&#123;&#123; <span class="name">slotProp.user.firstName</span> &#125;&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">current-user</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml"># 子组件</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">slot</span> <span class="attr">v-bind:user</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123; <span class="name">user.lastName</span> &#125;&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">//定义内容</span></span><br><span class="line"><span class="xml">data()&#123;</span></span><br><span class="line"><span class="xml">  return&#123;</span></span><br><span class="line"><span class="xml">	user:&#123;</span></span><br><span class="line"><span class="xml">	  firstName:&quot;Fan&quot;,</span></span><br><span class="line"><span class="xml">	  lastName:&quot;Jun&quot;</span></span><br><span class="line"><span class="xml">	&#125;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<p>Vue单文件模块示例</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;todo in todos&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;todo.id&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;todo&#x27;</span> <span class="attr">:todo</span>=<span class="string">&quot;todo&quot;</span>&gt;</span>默认值1<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&#x27;one&#x27;</span> <span class="attr">:value</span>=<span class="string">&quot;child1&quot;</span>&gt;</span>默认值2<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&#x27;SlotDemo&#x27;</span>,</span></span><br><span class="line">    data () &#123;</span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">        child1: <span class="string">&#x27;data1&#x27;</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    props: &#123;</span><br><span class="line">      todos: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">Array</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight handlebars"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"># APP.vue（父组件）</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">todo-list</span> <span class="attr">:todos</span>=<span class="string">&quot;todos&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:todo</span>=<span class="string">&quot;slotProps&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;slotProps.todo.isComplete&quot;</span>&gt;</span>✓<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">slotProps.todo.text</span>&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:one</span>=<span class="string">&quot;slotone&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span><span class="template-variable">&#123;&#123; <span class="name">slotone.value</span> &#125;&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">todo-list</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">  import todoList from &#x27;./SlotDemo&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">  export default &#123;</span></span><br><span class="line"><span class="xml">    data () &#123;</span></span><br><span class="line"><span class="xml">      return &#123;</span></span><br><span class="line"><span class="xml">        todos: [</span></span><br><span class="line"><span class="xml">          &#123;</span></span><br><span class="line"><span class="xml">            id: 0,</span></span><br><span class="line"><span class="xml">            text: &#x27;ziwei0&#x27;,</span></span><br><span class="line"><span class="xml">            isComplete: false</span></span><br><span class="line"><span class="xml">          &#125;,</span></span><br><span class="line"><span class="xml">          &#123;</span></span><br><span class="line"><span class="xml">            text: &#x27;ziwei1&#x27;,</span></span><br><span class="line"><span class="xml">            id: 1,</span></span><br><span class="line"><span class="xml">            isComplete: true</span></span><br><span class="line"><span class="xml">          &#125;,</span></span><br><span class="line"><span class="xml">          &#123;</span></span><br><span class="line"><span class="xml">            text: &#x27;ziwei2&#x27;,</span></span><br><span class="line"><span class="xml">            id: 2,</span></span><br><span class="line"><span class="xml">            isComplete: false</span></span><br><span class="line"><span class="xml">          &#125;,</span></span><br><span class="line"><span class="xml">          &#123;</span></span><br><span class="line"><span class="xml">            text: &#x27;ziwei3&#x27;,</span></span><br><span class="line"><span class="xml">            id: 3,</span></span><br><span class="line"><span class="xml">            isComplete: false</span></span><br><span class="line"><span class="xml">          &#125;</span></span><br><span class="line"><span class="xml">        ]</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    components: &#123;</span></span><br><span class="line"><span class="xml">      todoList</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>1.父组件传递todos数组给子组件<br>2.子组件通过props接受了数组数据<br>3.子组件拿到数组后v-for渲染列表，并且通过<code>&lt;slot :todo=&quot;todo&quot;&gt;</code>的方式，把数组内的每一个todo对象，传递给父组件<br>4.父组件通过<code>slot-scope=&quot;slotProps&quot;/v-slot:todo=&quot;slotProps&quot;</code>的方式，接收todo对象后可以通过slotProps.todo.xxx的方式来使用</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在用上v-slot之后，只需要考虑好下列2点<br>1.是否需要命名(匿名插槽、具名插槽)<br>2.父页面是否需要取存在子页面的数据(作用域插槽)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Leo Lin"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Leo Lin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/LeoLin9527" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LeoLin9527" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.weibo.com/6755640749" title="Weibo → https:&#x2F;&#x2F;www.weibo.com&#x2F;6755640749" rel="noopener" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leo Lin</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>
</html>
